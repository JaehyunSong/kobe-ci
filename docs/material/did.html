<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>差分の差分法 – Causal Inference@Kobe</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../material/rdd.html" rel="next">
<link href="../material/matching.html" rel="prev">
<link href="../figs/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-f7d2b2980468318b04e0c52838f8e54f.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-12bcd91ec681f8805fea2ef15e4b1634.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "一致なし",
    "search-matching-documents-text": "一致した文書",
    "search-copy-link-title": "検索へのリンクをコピー",
    "search-hide-matches-text": "追加の検索結果を非表示",
    "search-more-match-text": "追加の検索結果",
    "search-more-matches-text": "追加の検索結果",
    "search-clear-button-title": "消去",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "検索",
    "search-label": "サーチ"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-9F94XL4N4M"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-9F94XL4N4M', { 'anonymize_ip': true});
</script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&amp;display=swap" rel="stylesheet"> 
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Mono&amp;display=swap" rel="stylesheet"> 

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="Jaehyun Song, Ph.D.">
<meta property="og:description" content="Causal Inference@Kobe">
<meta property="og:image" content="https://www.jaysong.net/kobe-ci/material/imgs/favicon.png">
<meta property="og:site_name" content="Causal Inference@Kobe">
<meta name="twitter:title" content="Jaehyun Song, Ph.D.">
<meta name="twitter:description" content="Causal Inference@Kobe">
<meta name="twitter:image" content="https://www.jaysong.net/kobe-ci/material/imgs/favicon.png">
<meta name="twitter:creator" content="@Tintstyle">
<meta name="twitter:site" content="@Tintstyle">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../figs/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Causal Inference@Kobe</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="サーチ"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="ナビゲーションを切り替える" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">シラバス</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-">    
        <li>
    <a class="dropdown-item" href="../syllabus/syllabus.html">
 <span class="dropdown-text">シラバス</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../syllabus/dataset.html">
 <span class="dropdown-text">データセットについて</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-rの使い方" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Rの使い方</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-rの使い方">    
        <li>
    <a class="dropdown-item" href="../intro/install.html">
 <span class="dropdown-text">Rの導入</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../intro/project.html">
 <span class="dropdown-text">プロジェクト管理</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../intro/file.html">
 <span class="dropdown-text">ファイル管理</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../intro/filesystem.html">
 <span class="dropdown-text">ファイル・システム</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../intro/packages.html">
 <span class="dropdown-text">パッケージ</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu--1" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">講義資料</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu--1">    
        <li>
    <a class="dropdown-item" href="../material/intro_rct.html">
 <span class="dropdown-text">因果推論の考え方とランダム化比較試験</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../material/matching.html">
 <span class="dropdown-text">マッチング</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../material/did.html">
 <span class="dropdown-text">差分の差分法</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../material/rdd.html">
 <span class="dropdown-text">回帰不連続デザイン</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://jupyter.cs.rcos.nii.ac.jp/" target="_blank"> <i class="bi bi-terminal" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.jaysong.net/RBook/" target="_blank"> <i class="bi bi-book" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="サイドバーを切り替える" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../material/did.html">差分の差分法</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="サイドバーを切り替える" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../material/intro_rct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">因果推論の考え方とランダム化比較試験</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../material/matching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">マッチング</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../material/did.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">差分の差分法</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../material/rdd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">回帰不連続デザイン</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目次</h2>
   
  <ul>
  <li><a href="#スライド" id="toc-スライド" class="nav-link active" data-scroll-target="#スライド">スライド</a></li>
  <li><a href="#セットアップ" id="toc-セットアップ" class="nav-link" data-scroll-target="#セットアップ">セットアップ</a></li>
  <li><a href="#diff-in-diff" id="toc-diff-in-diff" class="nav-link" data-scroll-target="#diff-in-diff">Diff-in-Diff</a></li>
  <li><a href="#scm" id="toc-scm" class="nav-link" data-scroll-target="#scm">SCM</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">差分の差分法</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="スライド" class="level2">
<h2 class="anchored" data-anchor-id="スライド">スライド</h2>
<p><a href="../slide/did.html" class="btn btn-primary btn-sm" target="_blank" role="button"><i class="bi bi-window"></i> 新しいタブで開く</a></p>
<iframe class="slide-deck" src="../slide/did.html" width="100%" style="aspect-ratio: 16 / 9.2;"></iframe>
</section>
<section id="セットアップ" class="level2">
<h2 class="anchored" data-anchor-id="セットアップ">セットアップ</h2>
<p>　本日の実習に必要なパッケージとデータを読み込む。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse,     <span class="co"># Rの必須パッケージ</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>               summarytools,  <span class="co"># 記述統計</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>               modelsummary,  <span class="co"># 推定結果の要約</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>               estimatr,      <span class="co"># ロバストな回帰分析</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>               gsynth,        <span class="co"># 一般化SCM</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>               panelView)     <span class="co"># パネルデータのチェック</span></span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a>did_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/did_data4.csv"</span>)</span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a>did_df</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18,749 × 14
   county state  year shooting fatal_shooting non_fatal_shooting turnout demvote
    &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;    &lt;dbl&gt;          &lt;dbl&gt;              &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1   1001 01     1996        0              0                  0    56.1    32.5
 2   1001 01     2000        0              0                  0    56.8    28.7
 3   1001 01     2004        0              0                  0    60.2    23.7
 4   1001 01     2008        0              0                  0    64.1    25.8
 5   1001 01     2012        0              0                  0    61.0    26.5
 6   1001 01     2016        0              0                  0    60.7    24.0
 7   1003 01     1996        0              0                  0    51.8    27.1
 8   1003 01     2000        0              0                  0    54.6    24.8
 9   1003 01     2004        0              0                  0    59.8    22.5
10   1003 01     2008        0              0                  0    62.4    23.8
# ℹ 18,739 more rows
# ℹ 6 more variables: population &lt;dbl&gt;, non_white &lt;dbl&gt;,
#   change_unem_rate &lt;dbl&gt;, county_f &lt;dbl&gt;, state_f &lt;chr&gt;, year_f &lt;dbl&gt;</code></pre>
</div>
</div>
<p>　データの詳細はスライドを参照すること。DID推定には時間（年）とカウンティー（郡）の固定効果を投入し、州レベルでクラスタリングした標準誤差を使う予定である。これらの変数を予めfactor化しておこう。factor化した変数は変数名の後ろに<code>_f</code>を付けて、新しい列として追加しておく。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>did_df <span class="ot">&lt;-</span> did_df <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="fu">mutate</span>(<span class="at">county_f =</span> <span class="fu">factor</span>(county),</span>
<span id="cb3-3"><a href="#cb3-3"></a>         <span class="at">state_f  =</span> <span class="fu">factor</span>(state),</span>
<span id="cb3-4"><a href="#cb3-4"></a>         <span class="at">year_f   =</span> <span class="fu">factor</span>(year))</span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a>did_df</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18,749 × 14
   county state  year shooting fatal_shooting non_fatal_shooting turnout demvote
    &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;    &lt;dbl&gt;          &lt;dbl&gt;              &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1   1001 01     1996        0              0                  0    56.1    32.5
 2   1001 01     2000        0              0                  0    56.8    28.7
 3   1001 01     2004        0              0                  0    60.2    23.7
 4   1001 01     2008        0              0                  0    64.1    25.8
 5   1001 01     2012        0              0                  0    61.0    26.5
 6   1001 01     2016        0              0                  0    60.7    24.0
 7   1003 01     1996        0              0                  0    51.8    27.1
 8   1003 01     2000        0              0                  0    54.6    24.8
 9   1003 01     2004        0              0                  0    59.8    22.5
10   1003 01     2008        0              0                  0    62.4    23.8
# ℹ 18,739 more rows
# ℹ 6 more variables: population &lt;dbl&gt;, non_white &lt;dbl&gt;,
#   change_unem_rate &lt;dbl&gt;, county_f &lt;fct&gt;, state_f &lt;fct&gt;, year_f &lt;fct&gt;</code></pre>
</div>
</div>
<p>　連続変数（<code>shooting</code>から<code>change_unem_rate</code>まで）の記述統計量を出力する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>did_df <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="fu">select</span>(shooting<span class="sc">:</span>change_unem_rate) <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">descr</span>(<span class="at">stats =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="st">"min"</span>, <span class="st">"max"</span>, <span class="st">"n.valid"</span>),</span>
<span id="cb5-4"><a href="#cb5-4"></a>        <span class="at">transpose =</span> <span class="cn">TRUE</span>, <span class="at">order =</span> <span class="st">"p"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Descriptive Statistics  

                               Mean     Std.Dev      Min           Max    N.Valid
------------------------ ---------- ----------- -------- ------------- ----------
                shooting       0.00        0.07     0.00          1.00   18749.00
          fatal_shooting       0.00        0.05     0.00          1.00   18749.00
      non_fatal_shooting       0.00        0.04     0.00          1.00   18749.00
                 turnout      57.94       10.32     1.08        300.00   18627.00
                 demvote      39.01       13.79     3.14         92.85   18627.00
              population   95121.69   306688.63    55.00   10137915.00   18749.00
               non_white       0.13        0.16     0.00          0.96   18749.00
        change_unem_rate      -0.39        2.34   -19.60         15.30   18749.00</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>select()</code>関数がおかしい?
</div>
</div>
<div class="callout-body-container callout-body">
<p>　今回の講義に限らず、よくある問題としてパッケージ間の衝突がある。これは同じ名前の関数が複数存在する際に生じる。たとえば、<code>select()</code>関数は{dplyr}パッケージだけでなく、{MASS}という有名なパッケージにも同じ名前の関数が存在する。自分が{dplyr}のみ読み込み、{MASS}を読み込まなかったとしても衝突は生じうる。たとえば、{X}というパッケージが{MASS}に依存する場合、{X}を読み込むと、裏では{MASS}も読み込まれるからだ。そもそも我々も{dplyr}を読み込んでないが、{tidyverse}が{dplyr}に依存しているため、{dplyr}が読み込まれている。</p>
<p>　したがって、絶対存在するはずの関数で使い方も間違っていないにも関わらずエラーが発生した場合は、「どのパッケージの関数か」を明記してみよう。書き方は<code>パッケージ名::関数名()</code>だ。たとえば、{dplyr}パッケージの<code>select()</code>関数は<code>dplyr::select()</code>と書く。</p>
</div>
</div>
</section>
<section id="diff-in-diff" class="level2">
<h2 class="anchored" data-anchor-id="diff-in-diff">Diff-in-Diff</h2>
<p>　それでは差分の差分法の実装について紹介する。推定式は以下の通りである。</p>
<p><span class="math display">\[
\mbox{Outcome}_{i, t} = \beta_0 + \beta_1 \mbox{Shooting}_{i, t} + \sum_k \delta_{k, i, t} \mbox{Controls}_{k, i, t} + \lambda_{t} + \omega_{i} + \varepsilon_{i, t}
\]</span></p>
<ul>
<li><span class="math inline">\(\mbox{Otucome}\)</span>: 応答変数
<ul>
<li><code>turnout</code>: 投票率（大統領選挙）</li>
<li><code>demvote</code>: 民主党候補者の得票率</li>
</ul></li>
<li><span class="math inline">\(\mbox{Shooting}\)</span>: 処置変数
<ul>
<li><code>shooting</code>: 銃撃事件の発生有無</li>
<li><code>fatal_shooting</code>: 死者を伴う銃撃事件の発生有無</li>
<li><code>non_fatal_shooting</code>: 死者を伴わない銃撃事件の発生有無</li>
</ul></li>
<li><span class="math inline">\(\mbox{Controls}\)</span>: 統制変数
<ul>
<li><code>population</code>: カウンティーの人口</li>
<li><code>non_white</code>: 非白人の割合</li>
<li><code>change_unem_rate</code>: 失業率の変化</li>
<li>統制変数あり/なしのモデルを個別に推定</li>
</ul></li>
<li><span class="math inline">\(\lambda\)</span>: 年固定効果</li>
<li><span class="math inline">\(\omega\)</span>: カウンティー固定効果</li>
</ul>
<p>応答変数が2種類、処置変数が3種類、共変量の有無でモデルを分けるので、推定するモデルは計12個である。</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">モデル</th>
<th style="text-align: left;">オブジェクト名</th>
<th style="text-align: left;">応答変数</th>
<th style="text-align: left;">処置変数</th>
<th style="text-align: left;">統制変数</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">モデル1</td>
<td style="text-align: left;"><code>did_fit1</code></td>
<td style="text-align: left;"><code>turnout</code></td>
<td style="text-align: left;"><code>shooting</code></td>
<td style="text-align: left;">なし</td>
</tr>
<tr class="even">
<td style="text-align: left;">モデル2</td>
<td style="text-align: left;"><code>did_fit2</code></td>
<td style="text-align: left;"><code>turnout</code></td>
<td style="text-align: left;"><code>shooting</code></td>
<td style="text-align: left;">あり</td>
</tr>
<tr class="odd">
<td style="text-align: left;">モデル3</td>
<td style="text-align: left;"><code>did_fit3</code></td>
<td style="text-align: left;"><code>turnout</code></td>
<td style="text-align: left;"><code>fatal_shooting</code></td>
<td style="text-align: left;">なし</td>
</tr>
<tr class="even">
<td style="text-align: left;">モデル4</td>
<td style="text-align: left;"><code>did_fit4</code></td>
<td style="text-align: left;"><code>turnout</code></td>
<td style="text-align: left;"><code>fatal_shooting</code></td>
<td style="text-align: left;">あり</td>
</tr>
<tr class="odd">
<td style="text-align: left;">モデル5</td>
<td style="text-align: left;"><code>did_fit5</code></td>
<td style="text-align: left;"><code>turnout</code></td>
<td style="text-align: left;"><code>non_fatal_shooting</code></td>
<td style="text-align: left;">なし</td>
</tr>
<tr class="even">
<td style="text-align: left;">モデル6</td>
<td style="text-align: left;"><code>did_fit6</code></td>
<td style="text-align: left;"><code>turnout</code></td>
<td style="text-align: left;"><code>non_fatal_shooting</code></td>
<td style="text-align: left;">あり</td>
</tr>
<tr class="odd">
<td style="text-align: left;">モデル7</td>
<td style="text-align: left;"><code>did_fit7</code></td>
<td style="text-align: left;"><code>demvote</code></td>
<td style="text-align: left;"><code>shooting</code></td>
<td style="text-align: left;">なし</td>
</tr>
<tr class="even">
<td style="text-align: left;">モデル8</td>
<td style="text-align: left;"><code>did_fit8</code></td>
<td style="text-align: left;"><code>demvote</code></td>
<td style="text-align: left;"><code>shooting</code></td>
<td style="text-align: left;">あり</td>
</tr>
<tr class="odd">
<td style="text-align: left;">モデル9</td>
<td style="text-align: left;"><code>did_fit9</code></td>
<td style="text-align: left;"><code>demvote</code></td>
<td style="text-align: left;"><code>fatal_shooting</code></td>
<td style="text-align: left;">なし</td>
</tr>
<tr class="even">
<td style="text-align: left;">モデル10</td>
<td style="text-align: left;"><code>did_fit10</code></td>
<td style="text-align: left;"><code>demvote</code></td>
<td style="text-align: left;"><code>fatal_shooting</code></td>
<td style="text-align: left;">あり</td>
</tr>
<tr class="odd">
<td style="text-align: left;">モデル11</td>
<td style="text-align: left;"><code>did_fit11</code></td>
<td style="text-align: left;"><code>demvote</code></td>
<td style="text-align: left;"><code>non_fatal_shooting</code></td>
<td style="text-align: left;">なし</td>
</tr>
<tr class="even">
<td style="text-align: left;">モデル12</td>
<td style="text-align: left;"><code>did_fit12</code></td>
<td style="text-align: left;"><code>demvote</code></td>
<td style="text-align: left;"><code>non_fatal_shooting</code></td>
<td style="text-align: left;">あり</td>
</tr>
</tbody>
</table>
<p>　まずはモデル1を推定し、<code>did_fit1</code>という名のオブジェクトとして格納する。基本的には線形回帰分析であるため、<code>lm()</code>でも推定はできる。しかし、差分の差分法の場合、通常、クラスター化した頑健な標準誤差（cluster robust standard error）を使う。<code>lm()</code>単体ではこれが計算できないため、今回は{estimatr}パッケージが提供する<code>lm_robust()</code>関数を使用する。使い方は<code>lm()</code>同様、まず回帰式と使用するデータ名を指定する。続いて、固定効果を<code>fixed_effects</code>引数で指定する<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>。書き方は<code>~固定効果変数1 + 固定効果変数2 + ...</code>である。回帰式と違って、<code>~</code>の左側には変数がないことに注意すること。続いて、<code>clusters</code>引数でクラスタリングする変数を指定する。今回は州レベルでクラスタリングするので、<code>state_f</code>で良い。最後に標準誤差のタイプを指定するが、デフォルトは<code>"CR2"</code>となっている。今回のデータはそれなりの大きさのデータであり、<code>"CR2"</code>だと推定時間が非常に長くなる。ここでは推定時間が比較的早い<code>"stata"</code>とする。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>did_fit1 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(turnout <span class="sc">~</span> shooting, </span>
<span id="cb7-2"><a href="#cb7-2"></a>                      <span class="at">data          =</span> did_df, </span>
<span id="cb7-3"><a href="#cb7-3"></a>                      <span class="at">fixed_effects =</span> <span class="sc">~</span>year_f <span class="sc">+</span> county_f,</span>
<span id="cb7-4"><a href="#cb7-4"></a>                      <span class="at">clusters      =</span> state_f,</span>
<span id="cb7-5"><a href="#cb7-5"></a>                      <span class="at">se_type       =</span> <span class="st">"stata"</span>)</span>
<span id="cb7-6"><a href="#cb7-6"></a></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="fu">summary</span>(did_fit1)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm_robust(formula = turnout ~ shooting, data = did_df, clusters = state_f, 
    fixed_effects = ~year_f + county_f, se_type = "stata")

Standard error type:  stata 

Coefficients:
         Estimate Std. Error t value Pr(&gt;|t|) CI Lower CI Upper DF
shooting  -0.5211     0.6457  -0.807   0.4235   -1.819   0.7764 49

Multiple R-squared:  0.8575 ,   Adjusted R-squared:  0.8288
Multiple R-squared (proj. model):  6.907e-05 ,  Adjusted R-squared (proj. model):  -0.2008 
F-statistic (proj. model): 0.6513 on 1 and 49 DF,  p-value: 0.4235</code></pre>
</div>
</div>
<p>　処置効果の推定値は-0.521である。これは学校内銃撃事件が発生したカウンティーの場合、大統領選挙において投票率が約-0.521%p低下することを意味する。しかし、標準誤差がかなり大きく、統計的有意な結果ではない。つまり、「学校内銃撃事件が投票率を上げる（or 下げる）とは言えない」と解釈できる。決して「学校内銃撃事件が投票率を上げない（or 下げない）」と解釈しないこと。</p>
<p>　共変量を投入してみたらどうだろうか。たとえば、人口は自治体の都市化程度を表すこともあるので、都市化程度と投票率には関係があると考えられる。また、人口が多いと自然に事件が発生する確率もあがるので、交絡要因として考えられる。人種や失業率も同様であろう。ここではカウンティーの人口（<code>population</code>）、非白人の割合（<code>non_white</code>）、失業率の変化（<code>change_unem_rate</code>）を統制変数として投入し、<code>did_fit2</code>という名で格納する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>did_fit2 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(turnout <span class="sc">~</span> shooting <span class="sc">+</span> </span>
<span id="cb9-2"><a href="#cb9-2"></a>                        population <span class="sc">+</span> non_white <span class="sc">+</span> change_unem_rate, </span>
<span id="cb9-3"><a href="#cb9-3"></a>                      <span class="at">data          =</span> did_df, </span>
<span id="cb9-4"><a href="#cb9-4"></a>                      <span class="at">fixed_effects =</span> <span class="sc">~</span>year_f <span class="sc">+</span> county_f,</span>
<span id="cb9-5"><a href="#cb9-5"></a>                      <span class="at">clusters      =</span> state_f,</span>
<span id="cb9-6"><a href="#cb9-6"></a>                      <span class="at">se_type       =</span> <span class="st">"stata"</span>)</span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="fu">summary</span>(did_fit2)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm_robust(formula = turnout ~ shooting + population + non_white + 
    change_unem_rate, data = did_df, clusters = state_f, fixed_effects = ~year_f + 
    county_f, se_type = "stata")

Standard error type:  stata 

Coefficients:
                   Estimate Std. Error t value Pr(&gt;|t|)   CI Lower   CI Upper
shooting         -7.098e-01  6.237e-01  -1.138  0.26066 -1.963e+00  5.436e-01
population        8.029e-06  5.688e-06   1.411  0.16443 -3.402e-06  1.946e-05
non_white        -3.483e+01  1.558e+01  -2.236  0.02990 -6.613e+01 -3.534e+00
change_unem_rate  1.592e-01  6.584e-02   2.418  0.01938  2.688e-02  2.915e-01
                 DF
shooting         49
population       49
non_white        49
change_unem_rate 49

Multiple R-squared:  0.8598 ,   Adjusted R-squared:  0.8316
Multiple R-squared (proj. model):  0.01669 ,    Adjusted R-squared (proj. model):  -0.1811 
F-statistic (proj. model): 5.047 on 4 and 49 DF,  p-value: 0.001739</code></pre>
</div>
</div>
<p>　処置効果の推定値は-0.710である。これは他の条件が同じ場合、学校内銃撃事件が発生したカウンティーは大統領選挙において投票率が約-0.710%p低下することを意味する。ちなみに、<code>e-01</code>は<span class="math inline">\(\times 10^{-1}\)</span>を、<code>e-06</code>は<span class="math inline">\(\times 10^{-6}\)</span>を、<code>e+01</code>は<span class="math inline">\(\times 10^{1}\)</span>意味する。今回も統計的に非有意な結果が得られている。</p>
<p>　これまでの処置変数は死者の有無と関係なく、学校内銃撃事件が発生したか否かだった。もしかしたら、死者を伴う銃撃事件が発生した場合、その効果が大きいかも知れない。したがって、これからは処置変数を死者を伴う学校内銃撃事件の発生有無（<code>fatal_shooting</code>）、死者を伴わない学校内銃撃事件の発生有無（<code>non_fatal_shooting</code>）に変えてもう一度推定してみよう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>did_fit3 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(turnout <span class="sc">~</span> fatal_shooting, </span>
<span id="cb11-2"><a href="#cb11-2"></a>                      <span class="at">data          =</span> did_df, </span>
<span id="cb11-3"><a href="#cb11-3"></a>                      <span class="at">fixed_effects =</span> <span class="sc">~</span>year_f <span class="sc">+</span> county_f,</span>
<span id="cb11-4"><a href="#cb11-4"></a>                      <span class="at">clusters      =</span> state_f,</span>
<span id="cb11-5"><a href="#cb11-5"></a>                      <span class="at">se_type       =</span> <span class="st">"stata"</span>)</span>
<span id="cb11-6"><a href="#cb11-6"></a></span>
<span id="cb11-7"><a href="#cb11-7"></a>did_fit4 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(turnout <span class="sc">~</span> fatal_shooting <span class="sc">+</span> </span>
<span id="cb11-8"><a href="#cb11-8"></a>                        population <span class="sc">+</span> non_white <span class="sc">+</span> change_unem_rate, </span>
<span id="cb11-9"><a href="#cb11-9"></a>                      <span class="at">data          =</span> did_df, </span>
<span id="cb11-10"><a href="#cb11-10"></a>                      <span class="at">fixed_effects =</span> <span class="sc">~</span>year_f <span class="sc">+</span> county_f,</span>
<span id="cb11-11"><a href="#cb11-11"></a>                      <span class="at">clusters      =</span> state_f,</span>
<span id="cb11-12"><a href="#cb11-12"></a>                      <span class="at">se_type       =</span> <span class="st">"stata"</span>)</span>
<span id="cb11-13"><a href="#cb11-13"></a></span>
<span id="cb11-14"><a href="#cb11-14"></a>did_fit5 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(turnout <span class="sc">~</span> non_fatal_shooting, </span>
<span id="cb11-15"><a href="#cb11-15"></a>                      <span class="at">data          =</span> did_df, </span>
<span id="cb11-16"><a href="#cb11-16"></a>                      <span class="at">fixed_effects =</span> <span class="sc">~</span>year_f <span class="sc">+</span> county_f,</span>
<span id="cb11-17"><a href="#cb11-17"></a>                      <span class="at">clusters      =</span> state_f,</span>
<span id="cb11-18"><a href="#cb11-18"></a>                      <span class="at">se_type       =</span> <span class="st">"stata"</span>)</span>
<span id="cb11-19"><a href="#cb11-19"></a></span>
<span id="cb11-20"><a href="#cb11-20"></a>did_fit6 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(turnout <span class="sc">~</span> non_fatal_shooting <span class="sc">+</span> </span>
<span id="cb11-21"><a href="#cb11-21"></a>                        population <span class="sc">+</span> non_white <span class="sc">+</span> change_unem_rate, </span>
<span id="cb11-22"><a href="#cb11-22"></a>                      <span class="at">data          =</span> did_df, </span>
<span id="cb11-23"><a href="#cb11-23"></a>                      <span class="at">fixed_effects =</span> <span class="sc">~</span>year_f <span class="sc">+</span> county_f,</span>
<span id="cb11-24"><a href="#cb11-24"></a>                      <span class="at">clusters      =</span> state_f,</span>
<span id="cb11-25"><a href="#cb11-25"></a>                      <span class="at">se_type       =</span> <span class="st">"stata"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　これまで推定してきた6つのモデルを比較してみよう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(did_fit1, did_fit2, did_fit3, </span>
<span id="cb12-2"><a href="#cb12-2"></a>                  did_fit4, did_fit5, did_fit6))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_b6e5av4k55hr6pna8m2s(i, j, css_id) {
        var table = document.getElementById("tinytable_b6e5av4k55hr6pna8m2s");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_b6e5av4k55hr6pna8m2s');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_b6e5av4k55hr6pna8m2s(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_b6e5av4k55hr6pna8m2s");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(0, 0, 'tinytable_css_id8hfhg69ti580cgl7su31') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(0, 1, 'tinytable_css_idiiz1zdzw06rkqx2doosx') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(0, 2, 'tinytable_css_idiiz1zdzw06rkqx2doosx') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(0, 3, 'tinytable_css_idiiz1zdzw06rkqx2doosx') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(0, 4, 'tinytable_css_idiiz1zdzw06rkqx2doosx') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(0, 5, 'tinytable_css_idiiz1zdzw06rkqx2doosx') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(0, 6, 'tinytable_css_idiiz1zdzw06rkqx2doosx') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(1, 0, 'tinytable_css_id69zarr4ec89mywdh3y1j') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(1, 1, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(1, 2, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(1, 3, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(1, 4, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(1, 5, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(1, 6, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(2, 0, 'tinytable_css_id69zarr4ec89mywdh3y1j') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(2, 1, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(2, 2, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(2, 3, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(2, 4, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(2, 5, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(2, 6, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(3, 0, 'tinytable_css_id69zarr4ec89mywdh3y1j') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(3, 1, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(3, 2, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(3, 3, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(3, 4, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(3, 5, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(3, 6, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(4, 0, 'tinytable_css_id69zarr4ec89mywdh3y1j') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(4, 1, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(4, 2, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(4, 3, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(4, 4, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(4, 5, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(4, 6, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(5, 0, 'tinytable_css_id69zarr4ec89mywdh3y1j') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(5, 1, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(5, 2, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(5, 3, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(5, 4, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(5, 5, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(5, 6, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(6, 0, 'tinytable_css_id69zarr4ec89mywdh3y1j') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(6, 1, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(6, 2, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(6, 3, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(6, 4, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(6, 5, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(6, 6, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(7, 0, 'tinytable_css_id69zarr4ec89mywdh3y1j') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(7, 1, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(7, 2, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(7, 3, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(7, 4, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(7, 5, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(7, 6, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(8, 0, 'tinytable_css_id69zarr4ec89mywdh3y1j') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(8, 1, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(8, 2, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(8, 3, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(8, 4, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(8, 5, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(8, 6, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(9, 0, 'tinytable_css_id69zarr4ec89mywdh3y1j') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(9, 1, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(9, 2, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(9, 3, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(9, 4, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(9, 5, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(9, 6, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(10, 0, 'tinytable_css_id69zarr4ec89mywdh3y1j') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(10, 1, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(10, 2, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(10, 3, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(10, 4, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(10, 5, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(10, 6, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(11, 0, 'tinytable_css_id69zarr4ec89mywdh3y1j') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(11, 1, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(11, 2, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(11, 3, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(11, 4, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(11, 5, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(11, 6, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(12, 0, 'tinytable_css_idptecxthvzh2cx0ezww8i') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(12, 1, 'tinytable_css_idc0cmrx2m7p80alclv3gh') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(12, 2, 'tinytable_css_idc0cmrx2m7p80alclv3gh') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(12, 3, 'tinytable_css_idc0cmrx2m7p80alclv3gh') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(12, 4, 'tinytable_css_idc0cmrx2m7p80alclv3gh') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(12, 5, 'tinytable_css_idc0cmrx2m7p80alclv3gh') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(12, 6, 'tinytable_css_idc0cmrx2m7p80alclv3gh') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(13, 0, 'tinytable_css_id69zarr4ec89mywdh3y1j') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(13, 1, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(13, 2, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(13, 3, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(13, 4, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(13, 5, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(13, 6, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(14, 0, 'tinytable_css_id69zarr4ec89mywdh3y1j') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(14, 1, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(14, 2, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(14, 3, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(14, 4, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(14, 5, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(14, 6, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(15, 0, 'tinytable_css_id69zarr4ec89mywdh3y1j') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(15, 1, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(15, 2, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(15, 3, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(15, 4, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(15, 5, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(15, 6, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(16, 0, 'tinytable_css_id69zarr4ec89mywdh3y1j') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(16, 1, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(16, 2, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(16, 3, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(16, 4, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(16, 5, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(16, 6, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(17, 0, 'tinytable_css_id69zarr4ec89mywdh3y1j') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(17, 1, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(17, 2, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(17, 3, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(17, 4, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(17, 5, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(17, 6, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(18, 0, 'tinytable_css_id69zarr4ec89mywdh3y1j') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(18, 1, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(18, 2, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(18, 3, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(18, 4, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(18, 5, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(18, 6, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(19, 0, 'tinytable_css_id69zarr4ec89mywdh3y1j') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(19, 1, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(19, 2, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(19, 3, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(19, 4, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(19, 5, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
window.addEventListener('load', function () { styleCell_b6e5av4k55hr6pna8m2s(19, 6, 'tinytable_css_idfvwj6duxv4yx2dnix1y6') })
    </script>

    <style>
    .table td.tinytable_css_id8hfhg69ti580cgl7su31, .table th.tinytable_css_id8hfhg69ti580cgl7su31 {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idiiz1zdzw06rkqx2doosx, .table th.tinytable_css_idiiz1zdzw06rkqx2doosx {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id69zarr4ec89mywdh3y1j, .table th.tinytable_css_id69zarr4ec89mywdh3y1j {  text-align: left; }
    .table td.tinytable_css_idfvwj6duxv4yx2dnix1y6, .table th.tinytable_css_idfvwj6duxv4yx2dnix1y6 {  text-align: center; }
    .table td.tinytable_css_idptecxthvzh2cx0ezww8i, .table th.tinytable_css_idptecxthvzh2cx0ezww8i {  border-bottom: solid 0.05em black;  text-align: left; }
    .table td.tinytable_css_idc0cmrx2m7p80alclv3gh, .table th.tinytable_css_idc0cmrx2m7p80alclv3gh {  border-bottom: solid 0.05em black;  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_b6e5av4k55hr6pna8m2s" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">(1)</th>
                <th scope="col">(2)</th>
                <th scope="col">(3)</th>
                <th scope="col">(4)</th>
                <th scope="col">(5)</th>
                <th scope="col">(6)</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>shooting          </td>
                  <td>-0.521     </td>
                  <td>-0.710     </td>
                  <td>           </td>
                  <td>           </td>
                  <td>           </td>
                  <td>           </td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>(0.646)    </td>
                  <td>(0.624)    </td>
                  <td>           </td>
                  <td>           </td>
                  <td>           </td>
                  <td>           </td>
                </tr>
                <tr>
                  <td>population        </td>
                  <td>           </td>
                  <td>0.000      </td>
                  <td>           </td>
                  <td>0.000      </td>
                  <td>           </td>
                  <td>0.000      </td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>           </td>
                  <td>(0.000)    </td>
                  <td>           </td>
                  <td>(0.000)    </td>
                  <td>           </td>
                  <td>(0.000)    </td>
                </tr>
                <tr>
                  <td>non_white         </td>
                  <td>           </td>
                  <td>-34.834    </td>
                  <td>           </td>
                  <td>-34.844    </td>
                  <td>           </td>
                  <td>-34.814    </td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>           </td>
                  <td>(15.575)   </td>
                  <td>           </td>
                  <td>(15.618)   </td>
                  <td>           </td>
                  <td>(15.614)   </td>
                </tr>
                <tr>
                  <td>change_unem_rate  </td>
                  <td>           </td>
                  <td>0.159      </td>
                  <td>           </td>
                  <td>0.159      </td>
                  <td>           </td>
                  <td>0.160      </td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>           </td>
                  <td>(0.066)    </td>
                  <td>           </td>
                  <td>(0.066)    </td>
                  <td>           </td>
                  <td>(0.066)    </td>
                </tr>
                <tr>
                  <td>fatal_shooting    </td>
                  <td>           </td>
                  <td>           </td>
                  <td>-0.678     </td>
                  <td>-0.918     </td>
                  <td>           </td>
                  <td>           </td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>           </td>
                  <td>           </td>
                  <td>(0.619)    </td>
                  <td>(0.658)    </td>
                  <td>           </td>
                  <td>           </td>
                </tr>
                <tr>
                  <td>non_fatal_shooting</td>
                  <td>           </td>
                  <td>           </td>
                  <td>           </td>
                  <td>           </td>
                  <td>-0.239     </td>
                  <td>-0.327     </td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>           </td>
                  <td>           </td>
                  <td>           </td>
                  <td>           </td>
                  <td>(1.094)    </td>
                  <td>(1.145)    </td>
                </tr>
                <tr>
                  <td>Num.Obs.          </td>
                  <td>18627      </td>
                  <td>18627      </td>
                  <td>18627      </td>
                  <td>18627      </td>
                  <td>18627      </td>
                  <td>18627      </td>
                </tr>
                <tr>
                  <td>R2                </td>
                  <td>0.857      </td>
                  <td>0.860      </td>
                  <td>0.857      </td>
                  <td>0.860      </td>
                  <td>0.857      </td>
                  <td>0.860      </td>
                </tr>
                <tr>
                  <td>R2 Adj.           </td>
                  <td>0.829      </td>
                  <td>0.832      </td>
                  <td>0.829      </td>
                  <td>0.832      </td>
                  <td>0.829      </td>
                  <td>0.832      </td>
                </tr>
                <tr>
                  <td>AIC               </td>
                  <td>103543.4   </td>
                  <td>103237.2   </td>
                  <td>103543.3   </td>
                  <td>103237.1   </td>
                  <td>103544.6   </td>
                  <td>103239.4   </td>
                </tr>
                <tr>
                  <td>BIC               </td>
                  <td>103559.0   </td>
                  <td>103276.4   </td>
                  <td>103559.0   </td>
                  <td>103276.3   </td>
                  <td>103560.2   </td>
                  <td>103278.6   </td>
                </tr>
                <tr>
                  <td>RMSE              </td>
                  <td>3.90       </td>
                  <td>3.87       </td>
                  <td>3.90       </td>
                  <td>3.87       </td>
                  <td>3.90       </td>
                  <td>3.87       </td>
                </tr>
                <tr>
                  <td>Std.Errors        </td>
                  <td>by: state_f</td>
                  <td>by: state_f</td>
                  <td>by: state_f</td>
                  <td>by: state_f</td>
                  <td>by: state_f</td>
                  <td>by: state_f</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>　いずれのモデルも統計的に有意な処置効果は確認されていない。これらの結果を表として報告するには紙がもったいない気もする。これらの結果はOnline Appendixに回し、本文中には処置効果の点推定値と95%信頼区間を示せば良いだろう。</p>
<p>　{broom}の<code>tidy()</code>関数で推定結果のみを抽出し、それぞれオブジェクトとして格納しておこう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>tidy_fit1 <span class="ot">&lt;-</span> <span class="fu">tidy</span>(did_fit1, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-2"><a href="#cb13-2"></a>tidy_fit2 <span class="ot">&lt;-</span> <span class="fu">tidy</span>(did_fit2, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-3"><a href="#cb13-3"></a>tidy_fit3 <span class="ot">&lt;-</span> <span class="fu">tidy</span>(did_fit3, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-4"><a href="#cb13-4"></a>tidy_fit4 <span class="ot">&lt;-</span> <span class="fu">tidy</span>(did_fit4, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-5"><a href="#cb13-5"></a>tidy_fit5 <span class="ot">&lt;-</span> <span class="fu">tidy</span>(did_fit5, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-6"><a href="#cb13-6"></a>tidy_fit6 <span class="ot">&lt;-</span> <span class="fu">tidy</span>(did_fit6, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　全て確認する必要はないので、<code>tidy_fit1</code>のみを確認してみる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>tidy_fit1</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      term   estimate std.error  statistic   p.value conf.low conf.high df
1 shooting -0.5210841 0.6456718 -0.8070417 0.4235426 -1.81861  0.776442 49
  outcome
1 turnout</code></pre>
</div>
</div>
<p>　以上の6つの表形式オブジェクトを一つの表としてまとめる。それぞれのオブジェクトには<code>共変量の有無_処置変数の種類</code>の名前を付けよう。共変量なしのモデルは<code>M1</code>、ありのモデルは<code>M2</code>とする。処置変数は<code>shooting</code>の場合は<code>Tr1</code>、<code>fatal_shooting</code>は<code>Tr2</code>、<code>non_fatal_shooting</code>は<code>Tr3</code>とする。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>did_est1 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">list</span>(<span class="st">"M1_Tr1"</span> <span class="ot">=</span> tidy_fit1,</span>
<span id="cb16-2"><a href="#cb16-2"></a>                           <span class="st">"M2_Tr1"</span> <span class="ot">=</span> tidy_fit2,</span>
<span id="cb16-3"><a href="#cb16-3"></a>                           <span class="st">"M1_Tr2"</span> <span class="ot">=</span> tidy_fit3,</span>
<span id="cb16-4"><a href="#cb16-4"></a>                           <span class="st">"M2_Tr2"</span> <span class="ot">=</span> tidy_fit4,</span>
<span id="cb16-5"><a href="#cb16-5"></a>                           <span class="st">"M1_Tr3"</span> <span class="ot">=</span> tidy_fit5,</span>
<span id="cb16-6"><a href="#cb16-6"></a>                           <span class="st">"M2_Tr3"</span> <span class="ot">=</span> tidy_fit6),</span>
<span id="cb16-7"><a href="#cb16-7"></a>                      <span class="at">.id =</span> <span class="st">"Model"</span>)</span>
<span id="cb16-8"><a href="#cb16-8"></a></span>
<span id="cb16-9"><a href="#cb16-9"></a>did_est1</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Model               term      estimate    std.error  statistic    p.value
1  M1_Tr1           shooting -5.210841e-01 6.456718e-01 -0.8070417 0.42354260
2  M2_Tr1           shooting -7.097922e-01 6.237320e-01 -1.1379763 0.26066411
3  M2_Tr1         population  8.028568e-06 5.688141e-06  1.4114574 0.16442833
4  M2_Tr1          non_white -3.483443e+01 1.557543e+01 -2.2364985 0.02990378
5  M2_Tr1   change_unem_rate  1.592020e-01 6.584450e-02  2.4178480 0.01937671
6  M1_Tr2     fatal_shooting -6.779229e-01 6.191749e-01 -1.0948810 0.27892152
7  M2_Tr2     fatal_shooting -9.179995e-01 6.576559e-01 -1.3958659 0.16904785
8  M2_Tr2         population  8.026778e-06 5.747531e-06  1.3965611 0.16883977
9  M2_Tr2          non_white -3.484436e+01 1.561829e+01 -2.2309975 0.03029042
10 M2_Tr2   change_unem_rate  1.591126e-01 6.591001e-02  2.4140886 0.01955574
11 M1_Tr3 non_fatal_shooting -2.387205e-01 1.093832e+00 -0.2182423 0.82814672
12 M2_Tr3 non_fatal_shooting -3.269742e-01 1.145303e+00 -0.2854915 0.77647098
13 M2_Tr3         population  7.821482e-06 5.712400e-06  1.3692110 0.17717684
14 M2_Tr3          non_white -3.481384e+01 1.561438e+01 -2.2296020 0.03038921
15 M2_Tr3   change_unem_rate  1.595359e-01 6.590170e-02  2.4208169 0.01923637
        conf.low     conf.high df outcome
1  -1.818610e+00  7.764420e-01 49 turnout
2  -1.963229e+00  5.436442e-01 49 turnout
3  -3.402178e-06  1.945932e-05 49 turnout
4  -6.613442e+01 -3.534428e+00 49 turnout
5   2.688251e-02  2.915215e-01 49 turnout
6  -1.922202e+00  5.663557e-01 49 turnout
7  -2.239609e+00  4.036096e-01 49 turnout
8  -3.523318e-06  1.957687e-05 49 turnout
9  -6.623047e+01 -3.458237e+00 49 turnout
10  2.666148e-02  2.915637e-01 49 turnout
11 -2.436859e+00  1.959418e+00 49 turnout
12 -2.628546e+00  1.974598e+00 49 turnout
13 -3.658017e-06  1.930098e-05 49 turnout
14 -6.619211e+01 -3.435580e+00 49 turnout
15  2.710152e-02  2.919704e-01 49 turnout</code></pre>
</div>
</div>
<p>　続いて、処置効果のみを抽出する。処置効果は<code>term</code>列の値が<code>"shooting"</code>、<code>"fatal_shooting"</code>、<code>"non_fatal_shooting"</code>のいずれかと一致する行であるため、<code>filter()</code>関数を使用する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>did_est1 <span class="ot">&lt;-</span> did_est1 <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="fu">filter</span>(term <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"shooting"</span>, <span class="st">"fatal_shooting"</span>, <span class="st">"non_fatal_shooting"</span>))</span>
<span id="cb18-3"><a href="#cb18-3"></a></span>
<span id="cb18-4"><a href="#cb18-4"></a>did_est1</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Model               term   estimate std.error  statistic   p.value  conf.low
1 M1_Tr1           shooting -0.5210841 0.6456718 -0.8070417 0.4235426 -1.818610
2 M2_Tr1           shooting -0.7097922 0.6237320 -1.1379763 0.2606641 -1.963229
3 M1_Tr2     fatal_shooting -0.6779229 0.6191749 -1.0948810 0.2789215 -1.922202
4 M2_Tr2     fatal_shooting -0.9179995 0.6576559 -1.3958659 0.1690478 -2.239609
5 M1_Tr3 non_fatal_shooting -0.2387205 1.0938325 -0.2182423 0.8281467 -2.436859
6 M2_Tr3 non_fatal_shooting -0.3269742 1.1453027 -0.2854915 0.7764710 -2.628546
  conf.high df outcome
1 0.7764420 49 turnout
2 0.5436442 49 turnout
3 0.5663557 49 turnout
4 0.4036096 49 turnout
5 1.9594182 49 turnout
6 1.9745977 49 turnout</code></pre>
</div>
</div>
<p>　ちなみに<code>grepl()</code>関数を使うと、<code>"shooting"</code>が含まれる行を抽出することもできる。以下のコードは上記のコードと同じ機能をする。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>did_est1 <span class="ot">&lt;-</span> did_est1 <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"shooting"</span>, term))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　つづいて、<code>Model</code>列を<code>Model</code>と<code>Treat</code>列へ分割する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>did_est1 <span class="ot">&lt;-</span> did_est1 <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="fu">separate</span>(<span class="at">col  =</span> Model,</span>
<span id="cb21-3"><a href="#cb21-3"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"Model"</span>, <span class="st">"Treat"</span>),</span>
<span id="cb21-4"><a href="#cb21-4"></a>           <span class="at">sep  =</span> <span class="st">"_"</span>)</span>
<span id="cb21-5"><a href="#cb21-5"></a></span>
<span id="cb21-6"><a href="#cb21-6"></a>did_est1</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Model Treat               term   estimate std.error  statistic   p.value
1    M1   Tr1           shooting -0.5210841 0.6456718 -0.8070417 0.4235426
2    M2   Tr1           shooting -0.7097922 0.6237320 -1.1379763 0.2606641
3    M1   Tr2     fatal_shooting -0.6779229 0.6191749 -1.0948810 0.2789215
4    M2   Tr2     fatal_shooting -0.9179995 0.6576559 -1.3958659 0.1690478
5    M1   Tr3 non_fatal_shooting -0.2387205 1.0938325 -0.2182423 0.8281467
6    M2   Tr3 non_fatal_shooting -0.3269742 1.1453027 -0.2854915 0.7764710
   conf.low conf.high df outcome
1 -1.818610 0.7764420 49 turnout
2 -1.963229 0.5436442 49 turnout
3 -1.922202 0.5663557 49 turnout
4 -2.239609 0.4036096 49 turnout
5 -2.436859 1.9594182 49 turnout
6 -2.628546 1.9745977 49 turnout</code></pre>
</div>
</div>
<p>　可視化に入る前に<code>Model</code>列と<code>Treat</code>列の値を修正する。<code>Model</code>列の値が<code>"M1"</code>なら<code>"County-Year FE"</code>に、それ以外なら<code>"County-Year FE + Covariates"</code>とリコーディングする。戻り値が2種類だから<code>if_else()</code>を使う。<code>Treat</code>列の場合、戻り値が3つなので、<code>recode()</code>か<code>case_when()</code>を使う。ここでは<code>recode()</code>を使ってリコーディングする。最後に<code>Model</code>と<code>Treat</code>を表示順番でfactor化し（<code>fct_inorder()</code>）、更に順番を逆転する（<code>fct_rev()</code>）。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>did_est1 <span class="ot">&lt;-</span> did_est1 <span class="sc">|&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>  <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="fu">if_else</span>(Model <span class="sc">==</span> <span class="st">"M1"</span>,</span>
<span id="cb23-3"><a href="#cb23-3"></a>                           <span class="st">"County-Year FE"</span>, </span>
<span id="cb23-4"><a href="#cb23-4"></a>                           <span class="st">"County-Year FE + Covariates"</span>),</span>
<span id="cb23-5"><a href="#cb23-5"></a>         <span class="at">Treat =</span> <span class="fu">recode</span>(Treat,</span>
<span id="cb23-6"><a href="#cb23-6"></a>                        <span class="st">"Tr1"</span> <span class="ot">=</span> <span class="st">"Any Shooting (t-1)"</span>,</span>
<span id="cb23-7"><a href="#cb23-7"></a>                        <span class="st">"Tr2"</span> <span class="ot">=</span> <span class="st">"Fatal Shooting (t-1)"</span>,</span>
<span id="cb23-8"><a href="#cb23-8"></a>                        <span class="st">"Tr3"</span> <span class="ot">=</span> <span class="st">"Nonfatal Shooting (t-1)"</span>),</span>
<span id="cb23-9"><a href="#cb23-9"></a>         <span class="at">Model =</span> <span class="fu">fct_rev</span>(<span class="fu">fct_inorder</span>(Model)),</span>
<span id="cb23-10"><a href="#cb23-10"></a>         <span class="at">Treat =</span> <span class="fu">fct_rev</span>(<span class="fu">fct_inorder</span>(Treat)))</span>
<span id="cb23-11"><a href="#cb23-11"></a></span>
<span id="cb23-12"><a href="#cb23-12"></a>did_est1</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        Model                   Treat               term
1              County-Year FE      Any Shooting (t-1)           shooting
2 County-Year FE + Covariates      Any Shooting (t-1)           shooting
3              County-Year FE    Fatal Shooting (t-1)     fatal_shooting
4 County-Year FE + Covariates    Fatal Shooting (t-1)     fatal_shooting
5              County-Year FE Nonfatal Shooting (t-1) non_fatal_shooting
6 County-Year FE + Covariates Nonfatal Shooting (t-1) non_fatal_shooting
    estimate std.error  statistic   p.value  conf.low conf.high df outcome
1 -0.5210841 0.6456718 -0.8070417 0.4235426 -1.818610 0.7764420 49 turnout
2 -0.7097922 0.6237320 -1.1379763 0.2606641 -1.963229 0.5436442 49 turnout
3 -0.6779229 0.6191749 -1.0948810 0.2789215 -1.922202 0.5663557 49 turnout
4 -0.9179995 0.6576559 -1.3958659 0.1690478 -2.239609 0.4036096 49 turnout
5 -0.2387205 1.0938325 -0.2182423 0.8281467 -2.436859 1.9594182 49 turnout
6 -0.3269742 1.1453027 -0.2854915 0.7764710 -2.628546 1.9745977 49 turnout</code></pre>
</div>
</div>
<p>　それでは{ggplot2}を使ってpoint-rangeプロットを作成してみよう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>did_est1 <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="co"># x = 0の箇所に垂直線を引く。垂直線は破線（linetype = 2）とする。</span></span>
<span id="cb25-4"><a href="#cb25-4"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high,</span>
<span id="cb25-6"><a href="#cb25-6"></a>                      <span class="at">y =</span> Treat, <span class="at">color =</span> Model),</span>
<span id="cb25-7"><a href="#cb25-7"></a>                  <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb25-8"><a href="#cb25-8"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Change in Turnout (%p)"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">color =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb25-9"><a href="#cb25-9"></a>  <span class="co"># 色を指定する。</span></span>
<span id="cb25-10"><a href="#cb25-10"></a>  <span class="co"># Modelの値が County-Year FE なら黒、</span></span>
<span id="cb25-11"><a href="#cb25-11"></a>  <span class="co"># County-Year FE + Covariates ならグレー、</span></span>
<span id="cb25-12"><a href="#cb25-12"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"County-Year FE"</span> <span class="ot">=</span> <span class="st">"black"</span>, </span>
<span id="cb25-13"><a href="#cb25-13"></a>                                <span class="st">"County-Year FE + Covariates"</span> <span class="ot">=</span> <span class="st">"gray50"</span>)) <span class="sc">+</span></span>
<span id="cb25-14"><a href="#cb25-14"></a>  <span class="co"># 横軸の下限と上限を-10〜10とする。</span></span>
<span id="cb25-15"><a href="#cb25-15"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb25-16"><a href="#cb25-16"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb25-17"><a href="#cb25-17"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="did_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1350"></p>
</figure>
</div>
</div>
</div>
<p>　元の論文を見ると、点の上に点推定値が書かれているが、私たちもこれを真似してみよう。文字列をプロットするレイヤーは<code>geom_text()</code>と<code>geom_label()</code>、<code>annotate()</code>があるが、ここでは<code>geom_text()</code>を使用する。文字列が表示される横軸上の位置（<code>x</code>）と縦軸上の位置（<code>y</code>）、そして出力する文字列（<code>label</code>）をマッピングする。点推定値は3桁まで出力したいので、<code>sprintf()</code>を使って、3桁に丸める。ただし、これだけだと点と文字が重なってしまう。<code>vjust</code>を<code>-0.75</code>にすることで、出力する文字列を点の位置を上の方向へ若干ずらすことができる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>did_est1 <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high,</span>
<span id="cb26-5"><a href="#cb26-5"></a>                      <span class="at">y =</span> Treat, <span class="at">color =</span> Model),</span>
<span id="cb26-6"><a href="#cb26-6"></a>                  <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb26-7"><a href="#cb26-7"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">y =</span> Treat, <span class="at">color =</span> Model, </span>
<span id="cb26-8"><a href="#cb26-8"></a>                <span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, estimate)),</span>
<span id="cb26-9"><a href="#cb26-9"></a>            <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb26-10"><a href="#cb26-10"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb26-11"><a href="#cb26-11"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Change in Turnout (%p)"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">color =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb26-12"><a href="#cb26-12"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"County-Year FE"</span> <span class="ot">=</span> <span class="st">"black"</span>, </span>
<span id="cb26-13"><a href="#cb26-13"></a>                                <span class="st">"County-Year FE + Covariates"</span> <span class="ot">=</span> <span class="st">"gray50"</span>)) <span class="sc">+</span></span>
<span id="cb26-14"><a href="#cb26-14"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb26-15"><a href="#cb26-15"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb26-16"><a href="#cb26-16"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="did_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1350"></p>
</figure>
</div>
</div>
</div>
<p>　ちなみにこのコードを見ると、<code>geom_pointrange()</code>と<code>geom_text()</code>は<code>x</code>、<code>y</code>、<code>color</code>を共有しているので、<code>ggplot()</code>内でマッピングすることもできる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>did_est1 <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">y =</span> Treat, <span class="at">color =</span> Model)) <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high),</span>
<span id="cb27-5"><a href="#cb27-5"></a>                  <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, estimate)),</span>
<span id="cb27-7"><a href="#cb27-7"></a>            <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb27-8"><a href="#cb27-8"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Change in Turnout (%p)"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">color =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb27-10"><a href="#cb27-10"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"County-Year FE"</span> <span class="ot">=</span> <span class="st">"black"</span>, </span>
<span id="cb27-11"><a href="#cb27-11"></a>                                <span class="st">"County-Year FE + Covariates"</span> <span class="ot">=</span> <span class="st">"gray50"</span>)) <span class="sc">+</span></span>
<span id="cb27-12"><a href="#cb27-12"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb27-13"><a href="#cb27-13"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb27-14"><a href="#cb27-14"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　続いて、民主党候補者の得票率（<code>demvote</code>）を応答変数として6つのモデルを推定し、同じ作業を繰り返す。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>did_fit7 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(demvote <span class="sc">~</span> shooting, </span>
<span id="cb28-2"><a href="#cb28-2"></a>                      <span class="at">data          =</span> did_df, </span>
<span id="cb28-3"><a href="#cb28-3"></a>                      <span class="at">fixed_effects =</span> <span class="sc">~</span>year_f <span class="sc">+</span> county_f,</span>
<span id="cb28-4"><a href="#cb28-4"></a>                      <span class="at">clusters      =</span> state_f,</span>
<span id="cb28-5"><a href="#cb28-5"></a>                      <span class="at">se_type       =</span> <span class="st">"stata"</span>)</span>
<span id="cb28-6"><a href="#cb28-6"></a></span>
<span id="cb28-7"><a href="#cb28-7"></a>did_fit8 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(demvote <span class="sc">~</span> shooting <span class="sc">+</span> </span>
<span id="cb28-8"><a href="#cb28-8"></a>                        population <span class="sc">+</span> non_white <span class="sc">+</span> change_unem_rate, </span>
<span id="cb28-9"><a href="#cb28-9"></a>                      <span class="at">data          =</span> did_df, </span>
<span id="cb28-10"><a href="#cb28-10"></a>                      <span class="at">fixed_effects =</span> <span class="sc">~</span>year_f <span class="sc">+</span> county_f,</span>
<span id="cb28-11"><a href="#cb28-11"></a>                      <span class="at">clusters      =</span> state_f,</span>
<span id="cb28-12"><a href="#cb28-12"></a>                      <span class="at">se_type       =</span> <span class="st">"stata"</span>)</span>
<span id="cb28-13"><a href="#cb28-13"></a></span>
<span id="cb28-14"><a href="#cb28-14"></a>did_fit9 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(demvote <span class="sc">~</span> fatal_shooting, </span>
<span id="cb28-15"><a href="#cb28-15"></a>                      <span class="at">data          =</span> did_df, </span>
<span id="cb28-16"><a href="#cb28-16"></a>                      <span class="at">fixed_effects =</span> <span class="sc">~</span>year_f <span class="sc">+</span> county_f,</span>
<span id="cb28-17"><a href="#cb28-17"></a>                      <span class="at">clusters      =</span> state_f,</span>
<span id="cb28-18"><a href="#cb28-18"></a>                      <span class="at">se_type       =</span> <span class="st">"stata"</span>)</span>
<span id="cb28-19"><a href="#cb28-19"></a></span>
<span id="cb28-20"><a href="#cb28-20"></a>did_fit10 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(demvote <span class="sc">~</span> fatal_shooting <span class="sc">+</span> </span>
<span id="cb28-21"><a href="#cb28-21"></a>                         population <span class="sc">+</span> non_white <span class="sc">+</span> change_unem_rate, </span>
<span id="cb28-22"><a href="#cb28-22"></a>                       <span class="at">data          =</span> did_df, </span>
<span id="cb28-23"><a href="#cb28-23"></a>                       <span class="at">fixed_effects =</span> <span class="sc">~</span>year_f <span class="sc">+</span> county_f,</span>
<span id="cb28-24"><a href="#cb28-24"></a>                       <span class="at">clusters      =</span> state_f,</span>
<span id="cb28-25"><a href="#cb28-25"></a>                       <span class="at">se_type       =</span> <span class="st">"stata"</span>)</span>
<span id="cb28-26"><a href="#cb28-26"></a></span>
<span id="cb28-27"><a href="#cb28-27"></a>did_fit11 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(demvote <span class="sc">~</span> non_fatal_shooting, </span>
<span id="cb28-28"><a href="#cb28-28"></a>                       <span class="at">data          =</span> did_df, </span>
<span id="cb28-29"><a href="#cb28-29"></a>                       <span class="at">fixed_effects =</span> <span class="sc">~</span>year_f <span class="sc">+</span> county_f,</span>
<span id="cb28-30"><a href="#cb28-30"></a>                       <span class="at">clusters      =</span> state_f,</span>
<span id="cb28-31"><a href="#cb28-31"></a>                       <span class="at">se_type       =</span> <span class="st">"stata"</span>)</span>
<span id="cb28-32"><a href="#cb28-32"></a></span>
<span id="cb28-33"><a href="#cb28-33"></a>did_fit12 <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(demvote <span class="sc">~</span> non_fatal_shooting <span class="sc">+</span> </span>
<span id="cb28-34"><a href="#cb28-34"></a>                         population <span class="sc">+</span> non_white <span class="sc">+</span> change_unem_rate, </span>
<span id="cb28-35"><a href="#cb28-35"></a>                       <span class="at">data          =</span> did_df, </span>
<span id="cb28-36"><a href="#cb28-36"></a>                       <span class="at">fixed_effects =</span> <span class="sc">~</span>year_f <span class="sc">+</span> county_f,</span>
<span id="cb28-37"><a href="#cb28-37"></a>                       <span class="at">clusters      =</span> state_f,</span>
<span id="cb28-38"><a href="#cb28-38"></a>                       <span class="at">se_type       =</span> <span class="st">"stata"</span>)</span>
<span id="cb28-39"><a href="#cb28-39"></a></span>
<span id="cb28-40"><a href="#cb28-40"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Model 7"</span>  <span class="ot">=</span> did_fit7,  <span class="st">"Model 8"</span>  <span class="ot">=</span> did_fit8, </span>
<span id="cb28-41"><a href="#cb28-41"></a>                  <span class="st">"Model 9"</span>  <span class="ot">=</span> did_fit9,  <span class="st">"Model 10"</span> <span class="ot">=</span> did_fit10, </span>
<span id="cb28-42"><a href="#cb28-42"></a>                  <span class="st">"Model 11"</span> <span class="ot">=</span> did_fit11, <span class="st">"Model 12"</span> <span class="ot">=</span> did_fit12))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_kcazvgdf8khbfzn1oczw(i, j, css_id) {
        var table = document.getElementById("tinytable_kcazvgdf8khbfzn1oczw");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_kcazvgdf8khbfzn1oczw');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_kcazvgdf8khbfzn1oczw(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_kcazvgdf8khbfzn1oczw");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(0, 0, 'tinytable_css_idaa3u1nke7km496wco5hx') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(0, 1, 'tinytable_css_idw9o6luv854yzjm55pc0r') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(0, 2, 'tinytable_css_idw9o6luv854yzjm55pc0r') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(0, 3, 'tinytable_css_idw9o6luv854yzjm55pc0r') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(0, 4, 'tinytable_css_idw9o6luv854yzjm55pc0r') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(0, 5, 'tinytable_css_idw9o6luv854yzjm55pc0r') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(0, 6, 'tinytable_css_idw9o6luv854yzjm55pc0r') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(1, 0, 'tinytable_css_idtexoayfy1u87ccoisi9x') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(1, 1, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(1, 2, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(1, 3, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(1, 4, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(1, 5, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(1, 6, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(2, 0, 'tinytable_css_idtexoayfy1u87ccoisi9x') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(2, 1, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(2, 2, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(2, 3, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(2, 4, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(2, 5, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(2, 6, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(3, 0, 'tinytable_css_idtexoayfy1u87ccoisi9x') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(3, 1, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(3, 2, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(3, 3, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(3, 4, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(3, 5, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(3, 6, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(4, 0, 'tinytable_css_idtexoayfy1u87ccoisi9x') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(4, 1, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(4, 2, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(4, 3, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(4, 4, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(4, 5, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(4, 6, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(5, 0, 'tinytable_css_idtexoayfy1u87ccoisi9x') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(5, 1, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(5, 2, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(5, 3, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(5, 4, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(5, 5, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(5, 6, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(6, 0, 'tinytable_css_idtexoayfy1u87ccoisi9x') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(6, 1, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(6, 2, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(6, 3, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(6, 4, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(6, 5, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(6, 6, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(7, 0, 'tinytable_css_idtexoayfy1u87ccoisi9x') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(7, 1, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(7, 2, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(7, 3, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(7, 4, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(7, 5, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(7, 6, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(8, 0, 'tinytable_css_idtexoayfy1u87ccoisi9x') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(8, 1, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(8, 2, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(8, 3, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(8, 4, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(8, 5, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(8, 6, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(9, 0, 'tinytable_css_idtexoayfy1u87ccoisi9x') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(9, 1, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(9, 2, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(9, 3, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(9, 4, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(9, 5, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(9, 6, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(10, 0, 'tinytable_css_idtexoayfy1u87ccoisi9x') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(10, 1, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(10, 2, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(10, 3, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(10, 4, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(10, 5, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(10, 6, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(11, 0, 'tinytable_css_idtexoayfy1u87ccoisi9x') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(11, 1, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(11, 2, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(11, 3, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(11, 4, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(11, 5, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(11, 6, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(12, 0, 'tinytable_css_idg9hneu9777fg9dqb73vl') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(12, 1, 'tinytable_css_idkjlcec7o2ez7fa95bvtx') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(12, 2, 'tinytable_css_idkjlcec7o2ez7fa95bvtx') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(12, 3, 'tinytable_css_idkjlcec7o2ez7fa95bvtx') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(12, 4, 'tinytable_css_idkjlcec7o2ez7fa95bvtx') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(12, 5, 'tinytable_css_idkjlcec7o2ez7fa95bvtx') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(12, 6, 'tinytable_css_idkjlcec7o2ez7fa95bvtx') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(13, 0, 'tinytable_css_idtexoayfy1u87ccoisi9x') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(13, 1, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(13, 2, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(13, 3, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(13, 4, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(13, 5, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(13, 6, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(14, 0, 'tinytable_css_idtexoayfy1u87ccoisi9x') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(14, 1, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(14, 2, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(14, 3, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(14, 4, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(14, 5, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(14, 6, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(15, 0, 'tinytable_css_idtexoayfy1u87ccoisi9x') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(15, 1, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(15, 2, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(15, 3, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(15, 4, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(15, 5, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(15, 6, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(16, 0, 'tinytable_css_idtexoayfy1u87ccoisi9x') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(16, 1, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(16, 2, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(16, 3, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(16, 4, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(16, 5, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(16, 6, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(17, 0, 'tinytable_css_idtexoayfy1u87ccoisi9x') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(17, 1, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(17, 2, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(17, 3, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(17, 4, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(17, 5, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(17, 6, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(18, 0, 'tinytable_css_idtexoayfy1u87ccoisi9x') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(18, 1, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(18, 2, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(18, 3, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(18, 4, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(18, 5, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(18, 6, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(19, 0, 'tinytable_css_idtexoayfy1u87ccoisi9x') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(19, 1, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(19, 2, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(19, 3, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(19, 4, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(19, 5, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
window.addEventListener('load', function () { styleCell_kcazvgdf8khbfzn1oczw(19, 6, 'tinytable_css_idtj76qgv9br6369ziz4cb') })
    </script>

    <style>
    .table td.tinytable_css_idaa3u1nke7km496wco5hx, .table th.tinytable_css_idaa3u1nke7km496wco5hx {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idw9o6luv854yzjm55pc0r, .table th.tinytable_css_idw9o6luv854yzjm55pc0r {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idtexoayfy1u87ccoisi9x, .table th.tinytable_css_idtexoayfy1u87ccoisi9x {  text-align: left; }
    .table td.tinytable_css_idtj76qgv9br6369ziz4cb, .table th.tinytable_css_idtj76qgv9br6369ziz4cb {  text-align: center; }
    .table td.tinytable_css_idg9hneu9777fg9dqb73vl, .table th.tinytable_css_idg9hneu9777fg9dqb73vl {  border-bottom: solid 0.05em black;  text-align: left; }
    .table td.tinytable_css_idkjlcec7o2ez7fa95bvtx, .table th.tinytable_css_idkjlcec7o2ez7fa95bvtx {  border-bottom: solid 0.05em black;  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_kcazvgdf8khbfzn1oczw" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Model 7</th>
                <th scope="col">Model 8</th>
                <th scope="col">Model 9</th>
                <th scope="col">Model 10</th>
                <th scope="col">Model 11</th>
                <th scope="col">Model 12</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>shooting          </td>
                  <td>4.513      </td>
                  <td>2.364      </td>
                  <td>           </td>
                  <td>           </td>
                  <td>           </td>
                  <td>           </td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>(0.875)    </td>
                  <td>(0.737)    </td>
                  <td>           </td>
                  <td>           </td>
                  <td>           </td>
                  <td>           </td>
                </tr>
                <tr>
                  <td>population        </td>
                  <td>           </td>
                  <td>0.000      </td>
                  <td>           </td>
                  <td>0.000      </td>
                  <td>           </td>
                  <td>0.000      </td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>           </td>
                  <td>(0.000)    </td>
                  <td>           </td>
                  <td>(0.000)    </td>
                  <td>           </td>
                  <td>(0.000)    </td>
                </tr>
                <tr>
                  <td>non_white         </td>
                  <td>           </td>
                  <td>86.873     </td>
                  <td>           </td>
                  <td>86.866     </td>
                  <td>           </td>
                  <td>86.796     </td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>           </td>
                  <td>(17.863)   </td>
                  <td>           </td>
                  <td>(17.855)   </td>
                  <td>           </td>
                  <td>(17.855)   </td>
                </tr>
                <tr>
                  <td>change_unem_rate  </td>
                  <td>           </td>
                  <td>-0.139     </td>
                  <td>           </td>
                  <td>-0.139     </td>
                  <td>           </td>
                  <td>-0.140     </td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>           </td>
                  <td>(0.127)    </td>
                  <td>           </td>
                  <td>(0.128)    </td>
                  <td>           </td>
                  <td>(0.127)    </td>
                </tr>
                <tr>
                  <td>fatal_shooting    </td>
                  <td>           </td>
                  <td>           </td>
                  <td>4.404      </td>
                  <td>1.782      </td>
                  <td>           </td>
                  <td>           </td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>           </td>
                  <td>           </td>
                  <td>(1.092)    </td>
                  <td>(0.836)    </td>
                  <td>           </td>
                  <td>           </td>
                </tr>
                <tr>
                  <td>non_fatal_shooting</td>
                  <td>           </td>
                  <td>           </td>
                  <td>           </td>
                  <td>           </td>
                  <td>4.217      </td>
                  <td>2.930      </td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>           </td>
                  <td>           </td>
                  <td>           </td>
                  <td>           </td>
                  <td>(1.298)    </td>
                  <td>(1.037)    </td>
                </tr>
                <tr>
                  <td>Num.Obs.          </td>
                  <td>18627      </td>
                  <td>18627      </td>
                  <td>18627      </td>
                  <td>18627      </td>
                  <td>18627      </td>
                  <td>18627      </td>
                </tr>
                <tr>
                  <td>R2                </td>
                  <td>0.882      </td>
                  <td>0.894      </td>
                  <td>0.882      </td>
                  <td>0.894      </td>
                  <td>0.882      </td>
                  <td>0.894      </td>
                </tr>
                <tr>
                  <td>R2 Adj.           </td>
                  <td>0.859      </td>
                  <td>0.873      </td>
                  <td>0.859      </td>
                  <td>0.873      </td>
                  <td>0.859      </td>
                  <td>0.873      </td>
                </tr>
                <tr>
                  <td>AIC               </td>
                  <td>110745.2   </td>
                  <td>108755.4   </td>
                  <td>110772.0   </td>
                  <td>108768.2   </td>
                  <td>110786.5   </td>
                  <td>108762.1   </td>
                </tr>
                <tr>
                  <td>BIC               </td>
                  <td>110760.8   </td>
                  <td>108794.6   </td>
                  <td>110787.7   </td>
                  <td>108807.3   </td>
                  <td>110802.2   </td>
                  <td>108801.3   </td>
                </tr>
                <tr>
                  <td>RMSE              </td>
                  <td>4.73       </td>
                  <td>4.48       </td>
                  <td>4.73       </td>
                  <td>4.48       </td>
                  <td>4.73       </td>
                  <td>4.48       </td>
                </tr>
                <tr>
                  <td>Std.Errors        </td>
                  <td>by: state_f</td>
                  <td>by: state_f</td>
                  <td>by: state_f</td>
                  <td>by: state_f</td>
                  <td>by: state_f</td>
                  <td>by: state_f</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>　今回はいずれも統計的に有意な結果が得られている。例えば、モデル7（<code>did_fit7</code>）の場合、処置効果の推定値は4.513である。これは学校内銃撃事件が発生したカウンティーの場合、大統領選挙において民主党候補者の得票率が約4.513%p増加することを意味する。</p>
<p>　以上の結果を図としてまとめてみよう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>tidy_fit7  <span class="ot">&lt;-</span> <span class="fu">tidy</span>(did_fit7)</span>
<span id="cb29-2"><a href="#cb29-2"></a>tidy_fit8  <span class="ot">&lt;-</span> <span class="fu">tidy</span>(did_fit8)</span>
<span id="cb29-3"><a href="#cb29-3"></a>tidy_fit9  <span class="ot">&lt;-</span> <span class="fu">tidy</span>(did_fit9)</span>
<span id="cb29-4"><a href="#cb29-4"></a>tidy_fit10 <span class="ot">&lt;-</span> <span class="fu">tidy</span>(did_fit10)</span>
<span id="cb29-5"><a href="#cb29-5"></a>tidy_fit11 <span class="ot">&lt;-</span> <span class="fu">tidy</span>(did_fit11)</span>
<span id="cb29-6"><a href="#cb29-6"></a>tidy_fit12 <span class="ot">&lt;-</span> <span class="fu">tidy</span>(did_fit12)</span>
<span id="cb29-7"><a href="#cb29-7"></a></span>
<span id="cb29-8"><a href="#cb29-8"></a>did_est2 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">list</span>(<span class="st">"M1_Tr1"</span> <span class="ot">=</span> tidy_fit7,</span>
<span id="cb29-9"><a href="#cb29-9"></a>                           <span class="st">"M2_Tr1"</span> <span class="ot">=</span> tidy_fit8,</span>
<span id="cb29-10"><a href="#cb29-10"></a>                           <span class="st">"M1_Tr2"</span> <span class="ot">=</span> tidy_fit9,</span>
<span id="cb29-11"><a href="#cb29-11"></a>                           <span class="st">"M2_Tr2"</span> <span class="ot">=</span> tidy_fit10,</span>
<span id="cb29-12"><a href="#cb29-12"></a>                           <span class="st">"M1_Tr3"</span> <span class="ot">=</span> tidy_fit11,</span>
<span id="cb29-13"><a href="#cb29-13"></a>                           <span class="st">"M2_Tr3"</span> <span class="ot">=</span> tidy_fit12),</span>
<span id="cb29-14"><a href="#cb29-14"></a>                      <span class="at">.id =</span> <span class="st">"Model"</span>)</span>
<span id="cb29-15"><a href="#cb29-15"></a></span>
<span id="cb29-16"><a href="#cb29-16"></a>did_est2</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Model               term      estimate    std.error statistic      p.value
1  M1_Tr1           shooting  4.513237e+00 8.752702e-01  5.156393 4.514820e-06
2  M2_Tr1           shooting  2.363839e+00 7.367346e-01  3.208536 2.353748e-03
3  M2_Tr1         population  3.174252e-05 6.778757e-06  4.682646 2.275534e-05
4  M2_Tr1          non_white  8.687344e+01 1.786287e+01  4.863352 1.234074e-05
5  M2_Tr1   change_unem_rate -1.389392e-01 1.274198e-01 -1.090405 2.808682e-01
6  M1_Tr2     fatal_shooting  4.404109e+00 1.091944e+00  4.033274 1.920110e-04
7  M2_Tr2     fatal_shooting  1.782393e+00 8.363792e-01  2.131083 3.812471e-02
8  M2_Tr2         population  3.206812e-05 6.801197e-06  4.715070 2.039958e-05
9  M2_Tr2          non_white  8.686629e+01 1.785535e+01  4.865000 1.227169e-05
10 M2_Tr2   change_unem_rate -1.392341e-01 1.275138e-01 -1.091914 2.802109e-01
11 M1_Tr3 non_fatal_shooting  4.216683e+00 1.298056e+00  3.248460 2.098382e-03
12 M2_Tr3 non_fatal_shooting  2.929866e+00 1.037217e+00  2.824737 6.825655e-03
13 M2_Tr3         population  3.229215e-05 6.717999e-06  4.806810 1.495567e-05
14 M2_Tr3          non_white  8.679618e+01 1.785514e+01  4.861131 1.243440e-05
15 M2_Tr3   change_unem_rate -1.400321e-01 1.274994e-01 -1.098296 2.774427e-01
        conf.low    conf.high df outcome
1   2.754316e+00 6.272159e+00 49 demvote
2   8.833157e-01 3.844363e+00 49 demvote
3   1.812010e-05 4.536494e-05 49 demvote
4   5.097665e+01 1.227702e+02 49 demvote
5  -3.949989e-01 1.171206e-01 49 demvote
6   2.209766e+00 6.598453e+00 49 demvote
7   1.016261e-01 3.463160e+00 49 demvote
8   1.840061e-05 4.573564e-05 49 demvote
9   5.098461e+01 1.227480e+02 49 demvote
10 -3.954828e-01 1.170146e-01 49 demvote
11  1.608142e+00 6.825225e+00 49 demvote
12  8.454996e-01 5.014232e+00 49 demvote
13  1.879182e-05 4.579247e-05 49 demvote
14  5.091493e+01 1.226774e+02 49 demvote
15 -3.962518e-01 1.161876e-01 49 demvote</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>did_est2 <span class="ot">&lt;-</span> did_est2 <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"shooting"</span>, term))</span>
<span id="cb31-3"><a href="#cb31-3"></a></span>
<span id="cb31-4"><a href="#cb31-4"></a>did_est2</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Model               term estimate std.error statistic      p.value  conf.low
1 M1_Tr1           shooting 4.513237 0.8752702  5.156393 4.514820e-06 2.7543158
2 M2_Tr1           shooting 2.363839 0.7367346  3.208536 2.353748e-03 0.8833157
3 M1_Tr2     fatal_shooting 4.404109 1.0919440  4.033274 1.920110e-04 2.2097656
4 M2_Tr2     fatal_shooting 1.782393 0.8363792  2.131083 3.812471e-02 0.1016261
5 M1_Tr3 non_fatal_shooting 4.216683 1.2980560  3.248460 2.098382e-03 1.6081422
6 M2_Tr3 non_fatal_shooting 2.929866 1.0372173  2.824737 6.825655e-03 0.8454996
  conf.high df outcome
1  6.272159 49 demvote
2  3.844363 49 demvote
3  6.598453 49 demvote
4  3.463160 49 demvote
5  6.825225 49 demvote
6  5.014232 49 demvote</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>did_est2 <span class="ot">&lt;-</span> did_est2 <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>  <span class="fu">separate</span>(<span class="at">col  =</span> Model,</span>
<span id="cb33-3"><a href="#cb33-3"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"Model"</span>, <span class="st">"Treat"</span>),</span>
<span id="cb33-4"><a href="#cb33-4"></a>           <span class="at">sep  =</span> <span class="st">"_"</span>)</span>
<span id="cb33-5"><a href="#cb33-5"></a></span>
<span id="cb33-6"><a href="#cb33-6"></a>did_est2</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Model Treat               term estimate std.error statistic      p.value
1    M1   Tr1           shooting 4.513237 0.8752702  5.156393 4.514820e-06
2    M2   Tr1           shooting 2.363839 0.7367346  3.208536 2.353748e-03
3    M1   Tr2     fatal_shooting 4.404109 1.0919440  4.033274 1.920110e-04
4    M2   Tr2     fatal_shooting 1.782393 0.8363792  2.131083 3.812471e-02
5    M1   Tr3 non_fatal_shooting 4.216683 1.2980560  3.248460 2.098382e-03
6    M2   Tr3 non_fatal_shooting 2.929866 1.0372173  2.824737 6.825655e-03
   conf.low conf.high df outcome
1 2.7543158  6.272159 49 demvote
2 0.8833157  3.844363 49 demvote
3 2.2097656  6.598453 49 demvote
4 0.1016261  3.463160 49 demvote
5 1.6081422  6.825225 49 demvote
6 0.8454996  5.014232 49 demvote</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>did_est2 <span class="ot">&lt;-</span> did_est2 <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>  <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="fu">if_else</span>(Model <span class="sc">==</span> <span class="st">"M1"</span>,</span>
<span id="cb35-3"><a href="#cb35-3"></a>                           <span class="st">"County-Year FE"</span>, </span>
<span id="cb35-4"><a href="#cb35-4"></a>                           <span class="st">"County-Year FE + Covariates"</span>),</span>
<span id="cb35-5"><a href="#cb35-5"></a>         <span class="at">Treat =</span> <span class="fu">recode</span>(Treat,</span>
<span id="cb35-6"><a href="#cb35-6"></a>                        <span class="st">"Tr1"</span> <span class="ot">=</span> <span class="st">"Any Shooting (t-1)"</span>,</span>
<span id="cb35-7"><a href="#cb35-7"></a>                        <span class="st">"Tr2"</span> <span class="ot">=</span> <span class="st">"Fatal Shooting (t-1)"</span>,</span>
<span id="cb35-8"><a href="#cb35-8"></a>                        <span class="st">"Tr3"</span> <span class="ot">=</span> <span class="st">"Nonfatal Shooting (t-1)"</span>),</span>
<span id="cb35-9"><a href="#cb35-9"></a>         <span class="at">Model =</span> <span class="fu">fct_rev</span>(<span class="fu">fct_inorder</span>(Model)),</span>
<span id="cb35-10"><a href="#cb35-10"></a>         <span class="at">Treat =</span> <span class="fu">fct_rev</span>(<span class="fu">fct_inorder</span>(Treat)))</span>
<span id="cb35-11"><a href="#cb35-11"></a></span>
<span id="cb35-12"><a href="#cb35-12"></a>did_est2</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        Model                   Treat               term
1              County-Year FE      Any Shooting (t-1)           shooting
2 County-Year FE + Covariates      Any Shooting (t-1)           shooting
3              County-Year FE    Fatal Shooting (t-1)     fatal_shooting
4 County-Year FE + Covariates    Fatal Shooting (t-1)     fatal_shooting
5              County-Year FE Nonfatal Shooting (t-1) non_fatal_shooting
6 County-Year FE + Covariates Nonfatal Shooting (t-1) non_fatal_shooting
  estimate std.error statistic      p.value  conf.low conf.high df outcome
1 4.513237 0.8752702  5.156393 4.514820e-06 2.7543158  6.272159 49 demvote
2 2.363839 0.7367346  3.208536 2.353748e-03 0.8833157  3.844363 49 demvote
3 4.404109 1.0919440  4.033274 1.920110e-04 2.2097656  6.598453 49 demvote
4 1.782393 0.8363792  2.131083 3.812471e-02 0.1016261  3.463160 49 demvote
5 4.216683 1.2980560  3.248460 2.098382e-03 1.6081422  6.825225 49 demvote
6 2.929866 1.0372173  2.824737 6.825655e-03 0.8454996  5.014232 49 demvote</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>did_est2 <span class="sc">|&gt;</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb37-4"><a href="#cb37-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high,</span>
<span id="cb37-5"><a href="#cb37-5"></a>                      <span class="at">y =</span> Treat, <span class="at">color =</span> Model),</span>
<span id="cb37-6"><a href="#cb37-6"></a>                  <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb37-7"><a href="#cb37-7"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">y =</span> Treat, <span class="at">color =</span> Model, </span>
<span id="cb37-8"><a href="#cb37-8"></a>                <span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, estimate)),</span>
<span id="cb37-9"><a href="#cb37-9"></a>            <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb37-10"><a href="#cb37-10"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb37-11"><a href="#cb37-11"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Change in Democratic Vote Share (%p)"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">color =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb37-12"><a href="#cb37-12"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"County-Year FE"</span> <span class="ot">=</span> <span class="st">"black"</span>, </span>
<span id="cb37-13"><a href="#cb37-13"></a>                                <span class="st">"County-Year FE + Covariates"</span> <span class="ot">=</span> <span class="st">"gray50"</span>)) <span class="sc">+</span></span>
<span id="cb37-14"><a href="#cb37-14"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb37-15"><a href="#cb37-15"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb37-16"><a href="#cb37-16"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="did_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1350"></p>
</figure>
</div>
</div>
</div>
<p>　最後に、これまで作成した2つの図を一つにまとめてみよう。<code>bind_rows()</code>関数を使い、それぞれの表に識別子（<code>Outcome</code>）を与える。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>did_est <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">list</span>(<span class="st">"Out1"</span> <span class="ot">=</span> did_est1,</span>
<span id="cb38-2"><a href="#cb38-2"></a>                          <span class="st">"Out2"</span> <span class="ot">=</span> did_est2),</span>
<span id="cb38-3"><a href="#cb38-3"></a>                     <span class="at">.id =</span> <span class="st">"Outcome"</span>)</span>
<span id="cb38-4"><a href="#cb38-4"></a></span>
<span id="cb38-5"><a href="#cb38-5"></a>did_est</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Outcome                       Model                   Treat
1     Out1              County-Year FE      Any Shooting (t-1)
2     Out1 County-Year FE + Covariates      Any Shooting (t-1)
3     Out1              County-Year FE    Fatal Shooting (t-1)
4     Out1 County-Year FE + Covariates    Fatal Shooting (t-1)
5     Out1              County-Year FE Nonfatal Shooting (t-1)
6     Out1 County-Year FE + Covariates Nonfatal Shooting (t-1)
7     Out2              County-Year FE      Any Shooting (t-1)
8     Out2 County-Year FE + Covariates      Any Shooting (t-1)
9     Out2              County-Year FE    Fatal Shooting (t-1)
10    Out2 County-Year FE + Covariates    Fatal Shooting (t-1)
11    Out2              County-Year FE Nonfatal Shooting (t-1)
12    Out2 County-Year FE + Covariates Nonfatal Shooting (t-1)
                 term   estimate std.error  statistic      p.value   conf.low
1            shooting -0.5210841 0.6456718 -0.8070417 4.235426e-01 -1.8186103
2            shooting -0.7097922 0.6237320 -1.1379763 2.606641e-01 -1.9632286
3      fatal_shooting -0.6779229 0.6191749 -1.0948810 2.789215e-01 -1.9222015
4      fatal_shooting -0.9179995 0.6576559 -1.3958659 1.690478e-01 -2.2396086
5  non_fatal_shooting -0.2387205 1.0938325 -0.2182423 8.281467e-01 -2.4368592
6  non_fatal_shooting -0.3269742 1.1453027 -0.2854915 7.764710e-01 -2.6285461
7            shooting  4.5132372 0.8752702  5.1563930 4.514820e-06  2.7543158
8            shooting  2.3638394 0.7367346  3.2085357 2.353748e-03  0.8833157
9      fatal_shooting  4.4041092 1.0919440  4.0332738 1.920110e-04  2.2097656
10     fatal_shooting  1.7823931 0.8363792  2.1310825 3.812471e-02  0.1016261
11 non_fatal_shooting  4.2166835 1.2980560  3.2484602 2.098382e-03  1.6081422
12 non_fatal_shooting  2.9298657 1.0372173  2.8247368 6.825655e-03  0.8454996
   conf.high df outcome
1  0.7764420 49 turnout
2  0.5436442 49 turnout
3  0.5663557 49 turnout
4  0.4036096 49 turnout
5  1.9594182 49 turnout
6  1.9745977 49 turnout
7  6.2721585 49 demvote
8  3.8443631 49 demvote
9  6.5984529 49 demvote
10 3.4631600 49 demvote
11 6.8252248 49 demvote
12 5.0142319 49 demvote</code></pre>
</div>
</div>
<p>　<code>Outcome</code>列のリコーディングし、factor化する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>did_est <span class="ot">&lt;-</span> did_est <span class="sc">|&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>  <span class="fu">mutate</span>(<span class="at">Outcome =</span> <span class="fu">if_else</span>(Outcome <span class="sc">==</span> <span class="st">"Out1"</span>,</span>
<span id="cb40-3"><a href="#cb40-3"></a>                           <span class="st">"Change in Turnout (%p)"</span>,</span>
<span id="cb40-4"><a href="#cb40-4"></a>                           <span class="st">"Change in Democratic Vote Share (%p)"</span>),</span>
<span id="cb40-5"><a href="#cb40-5"></a>         <span class="at">Outcome =</span> <span class="fu">fct_inorder</span>(Outcome))</span>
<span id="cb40-6"><a href="#cb40-6"></a></span>
<span id="cb40-7"><a href="#cb40-7"></a>did_est</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                Outcome                       Model
1                Change in Turnout (%p)              County-Year FE
2                Change in Turnout (%p) County-Year FE + Covariates
3                Change in Turnout (%p)              County-Year FE
4                Change in Turnout (%p) County-Year FE + Covariates
5                Change in Turnout (%p)              County-Year FE
6                Change in Turnout (%p) County-Year FE + Covariates
7  Change in Democratic Vote Share (%p)              County-Year FE
8  Change in Democratic Vote Share (%p) County-Year FE + Covariates
9  Change in Democratic Vote Share (%p)              County-Year FE
10 Change in Democratic Vote Share (%p) County-Year FE + Covariates
11 Change in Democratic Vote Share (%p)              County-Year FE
12 Change in Democratic Vote Share (%p) County-Year FE + Covariates
                     Treat               term   estimate std.error  statistic
1       Any Shooting (t-1)           shooting -0.5210841 0.6456718 -0.8070417
2       Any Shooting (t-1)           shooting -0.7097922 0.6237320 -1.1379763
3     Fatal Shooting (t-1)     fatal_shooting -0.6779229 0.6191749 -1.0948810
4     Fatal Shooting (t-1)     fatal_shooting -0.9179995 0.6576559 -1.3958659
5  Nonfatal Shooting (t-1) non_fatal_shooting -0.2387205 1.0938325 -0.2182423
6  Nonfatal Shooting (t-1) non_fatal_shooting -0.3269742 1.1453027 -0.2854915
7       Any Shooting (t-1)           shooting  4.5132372 0.8752702  5.1563930
8       Any Shooting (t-1)           shooting  2.3638394 0.7367346  3.2085357
9     Fatal Shooting (t-1)     fatal_shooting  4.4041092 1.0919440  4.0332738
10    Fatal Shooting (t-1)     fatal_shooting  1.7823931 0.8363792  2.1310825
11 Nonfatal Shooting (t-1) non_fatal_shooting  4.2166835 1.2980560  3.2484602
12 Nonfatal Shooting (t-1) non_fatal_shooting  2.9298657 1.0372173  2.8247368
        p.value   conf.low conf.high df outcome
1  4.235426e-01 -1.8186103 0.7764420 49 turnout
2  2.606641e-01 -1.9632286 0.5436442 49 turnout
3  2.789215e-01 -1.9222015 0.5663557 49 turnout
4  1.690478e-01 -2.2396086 0.4036096 49 turnout
5  8.281467e-01 -2.4368592 1.9594182 49 turnout
6  7.764710e-01 -2.6285461 1.9745977 49 turnout
7  4.514820e-06  2.7543158 6.2721585 49 demvote
8  2.353748e-03  0.8833157 3.8443631 49 demvote
9  1.920110e-04  2.2097656 6.5984529 49 demvote
10 3.812471e-02  0.1016261 3.4631600 49 demvote
11 2.098382e-03  1.6081422 6.8252248 49 demvote
12 6.825655e-03  0.8454996 5.0142319 49 demvote</code></pre>
</div>
</div>
<p>　図の作り方はこれまでと変わらないが、ファセット分割を行うため、<code>facet_wrap()</code>レイヤーを追加する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>did_est <span class="sc">|&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb42-3"><a href="#cb42-3"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb42-4"><a href="#cb42-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high,</span>
<span id="cb42-5"><a href="#cb42-5"></a>                      <span class="at">y =</span> Treat, <span class="at">color =</span> Model),</span>
<span id="cb42-6"><a href="#cb42-6"></a>                  <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb42-7"><a href="#cb42-7"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">y =</span> Treat, <span class="at">color =</span> Model, </span>
<span id="cb42-8"><a href="#cb42-8"></a>                <span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, estimate)),</span>
<span id="cb42-9"><a href="#cb42-9"></a>            <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb42-10"><a href="#cb42-10"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb42-11"><a href="#cb42-11"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Treatment Effects"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">color =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb42-12"><a href="#cb42-12"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"County-Year FE"</span> <span class="ot">=</span> <span class="st">"black"</span>, </span>
<span id="cb42-13"><a href="#cb42-13"></a>                                <span class="st">"County-Year FE + Covariates"</span> <span class="ot">=</span> <span class="st">"gray50"</span>)) <span class="sc">+</span></span>
<span id="cb42-14"><a href="#cb42-14"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb42-15"><a href="#cb42-15"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Outcome, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb42-16"><a href="#cb42-16"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb42-17"><a href="#cb42-17"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="did_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1350"></p>
</figure>
</div>
</div>
</div>
<p>　以上の結果から「学校内銃撃事件の発生は投票参加を促すとは言えないものの、民主党候補者の得票率を上げる」ということが言えよう。</p>
</section>
<section id="scm" class="level2">
<h2 class="anchored" data-anchor-id="scm">SCM</h2>
<p>　ここでは、差分の差分法の応用としてSynthetic Control Method（SCM）を{gsynth}パッケージの使い方に重点を起きながら説明する。Synthetic Control MethodをRに実装したパッケージは{Synth}、{gsynth}、{bpCausal}などがある。SCMの代表的な論文の一つであるAbadie et al.（2015）は{Synth}パッケージを使っているが、使い方はかなり複雑である。したがって、ここでは使い方が最も簡単な{gsynth}パッケージについて説明する<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>。</p>
<p>　ここで使用するのは歴代参院選（第7回以降）における都道府県の投票率である<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>。処置変数は第24回参院選から導入された「合区」だ。具体的には鳥取選挙区と島根選挙区が「鳥取・島根選挙区」に、徳島選挙区と高知選挙区が「徳島・高知選挙区」として合区されたか否かである。合区によって自分の1票の価値がほぼ半分に下がり、投票参加を妨げたのではないかという議論もあるが、本当だろうか。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>scm_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/did_data5.csv"</span>)</span>
<span id="cb43-2"><a href="#cb43-2"></a></span>
<span id="cb43-3"><a href="#cb43-3"></a>scm_df</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 938 × 9
   Election PrefCode PrefName_E PrefName_J Eligible  Voters EffVote Magnitude
      &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
 1        7        1 Hokkaido   北海道      2903802 1829347 1683764         4
 2        7        2 Aomori     青森県       823336  509254  478380         1
 3        7        3 Iwate      岩手県       849109  619767  591977         1
 4        7        4 Miyagi     宮城県      1049109  694827  666205         1
 5        7        5 Akita      秋田県       771983  591315  558603         1
 6        7        6 Yamagata   山形県       784438  636550  615414         1
 7        7        7 Fukushima  福島県      1123975  893381  855609         2
 8        7        8 Ibaraki    茨城県      1246254  785174  750181         2
 9        7        9 Tochigi    栃木県       909245  638413  614249         2
10        7       10 Gunma      群馬県       990083  719678  690448         2
# ℹ 928 more rows
# ℹ 1 more variable: Candidates &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>scm_df <span class="sc">|&gt;</span></span>
<span id="cb45-2"><a href="#cb45-2"></a>  <span class="fu">select</span>(Eligible<span class="sc">:</span>Candidates) <span class="sc">|&gt;</span></span>
<span id="cb45-3"><a href="#cb45-3"></a>  <span class="fu">descr</span>(<span class="at">stats =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="st">"min"</span>, <span class="st">"max"</span>, <span class="st">"n.valid"</span>),</span>
<span id="cb45-4"><a href="#cb45-4"></a>        <span class="at">transpose =</span> <span class="cn">TRUE</span>, <span class="at">order =</span> <span class="st">"p"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Descriptive Statistics  

                         Mean      Std.Dev         Min           Max   N.Valid
---------------- ------------ ------------ ----------- ------------- ---------
        Eligible   1933435.87   1867850.63   364184.00   11454822.00    938.00
          Voters   1139531.46   1029039.25   226580.00    6477709.00    938.00
         EffVote   1096934.10    997876.11   217637.00    6298466.00    938.00
       Magnitude         1.60         0.87        1.00          6.00    938.00
      Candidates         5.49         5.42        2.00         72.00    938.00</code></pre>
</div>
</div>
<table class="caption-top table">
<thead>
<tr class="header">
<th>変数名</th>
<th>説明</th>
<th>備考</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>Election</code></td>
<td>選挙</td>
<td>第<strong>XX</strong>回参議院議員通常選挙</td>
</tr>
<tr class="even">
<td><code>PrefCode</code></td>
<td>都道府県</td>
<td>JIS規格コード</td>
</tr>
<tr class="odd">
<td><code>PrefName_E</code></td>
<td>都道府県</td>
<td>英語</td>
</tr>
<tr class="even">
<td><code>PrefName_J</code></td>
<td>都道府県</td>
<td>日本語</td>
</tr>
<tr class="odd">
<td><code>Eligible</code></td>
<td>有権者数</td>
<td></td>
</tr>
<tr class="even">
<td><code>Voters</code></td>
<td>投票者数</td>
<td></td>
</tr>
<tr class="odd">
<td><code>EffVote</code></td>
<td>有効投票数</td>
<td></td>
</tr>
<tr class="even">
<td><code>Magnitude</code></td>
<td>定数</td>
<td></td>
</tr>
<tr class="odd">
<td><code>Candidates</code></td>
<td>候補者数</td>
<td></td>
</tr>
</tbody>
</table>
<p>　合区された選挙区における定数および候補者数の扱いについてだが、たとえば島根選挙区の場合、合区前の定数は1である。合区後の鳥取・島根選挙区も定数1だ。この場合、合区後の島根「県」の定数を1にするか0.5にするか、そして候補者数も合区における候補者数にすべきか、2に割るかが問題となるが、ここでは定数を1とし、候補者数も合区における候補者数とした。このようなコーディングが実証上、正しいかどうかは分からないが、実習の段階では問題ないだろう。</p>
<p>　それでは、データを以下のように加工する。</p>
<ol type="1">
<li><code>Treat</code>という変数を作成する。<code>PrefName</code>が「鳥取県」、「島根県」、「徳島県」、「高知県」であり、<code>Election</code>が24以上なら1、それ以外のケースは0とする。</li>
<li><code>Turnout</code>という変数を作成する。投票者数（<code>Voters</code>）を有権者数（<code>Eligible</code>）で割り、100を掛ける。</li>
<li><code>Spoilt</code>という変数を作成する。有効投票数（<code>EffVote</code>）を有権者数（<code>Eligible</code>）で割った値を1から引き、100を掛ける。</li>
<li>都道府県名（<code>PrefName_E</code>）をfactor変数に変換し、<code>PrefName_F</code>という列として追加します。水準（levels）の順番はデータの出現順とする。</li>
<li>都道府県名（<code>PrefName_J</code>）をfactor化し、要素の順番は<code>scm_df</code>内における表示順番とする。</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>scm_df <span class="ot">&lt;-</span> scm_df <span class="sc">|&gt;</span></span>
<span id="cb47-2"><a href="#cb47-2"></a>  <span class="fu">mutate</span>(<span class="at">Treat      =</span> <span class="fu">if_else</span>(PrefName_E <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Tottori"</span>, <span class="st">"Shimane"</span>,</span>
<span id="cb47-3"><a href="#cb47-3"></a>                                                <span class="st">"Tokushima"</span>,<span class="st">"Kochi"</span>) <span class="sc">&amp;</span></span>
<span id="cb47-4"><a href="#cb47-4"></a>                                Election <span class="sc">&gt;=</span> <span class="dv">24</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb47-5"><a href="#cb47-5"></a>         <span class="at">Turnout    =</span> Voters <span class="sc">/</span> Eligible <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb47-6"><a href="#cb47-6"></a>         <span class="at">Spoilt     =</span> (<span class="dv">1</span> <span class="sc">-</span> (EffVote <span class="sc">/</span> Voters)) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb47-7"><a href="#cb47-7"></a>         <span class="at">PrefName_J =</span> <span class="fu">fct_inorder</span>(PrefName_J))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　本格的な分析に入る前に、各ケースの処置有無を可視化してみよう。パネルデータの確認には{panelView}パッケージの<code>panelview()</code>関数を使う。第一引数は<code>応答変数 ~ 処置変数</code>であり、<code>data</code>引数にデータフレームのオブジェクト名を指定する。また、<code>index</code>にはユニットと時間を表す変数名を長さ2のcharacter型ベクトルとして指定します。ここでは<code>"PrefName_J"</code>と<code>"Election"</code>である。最後に、<code>pre.post = TRUE</code>を指定すると、処置前後を色分けしてくれるので、見やすくなる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="fu">panelview</span>(Turnout <span class="sc">~</span> Treat, <span class="at">data =</span> scm_df, </span>
<span id="cb48-2"><a href="#cb48-2"></a>          <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"PrefName_J"</span>, <span class="st">"Election"</span>), <span class="at">pre.post =</span> <span class="cn">TRUE</span>,</span>
<span id="cb48-3"><a href="#cb48-3"></a>          <span class="at">xlab =</span> <span class="st">"参院選"</span>, <span class="at">ylab =</span> <span class="st">"都道府県"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="did_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1200"></p>
</figure>
</div>
</div>
</div>
<p>　これを見ると処置を受けるケースが4県であり、どれも第24回参院選から処置を受けることが分かる。また、沖縄県の場合、第7・8回参院選のデータが欠損していることが分かる。</p>
<p>　次は投票率の変化を時系列的に示してみよう。使い方は先ほどとほぼ同じだが、<code>panelView()</code>内に<code>type = "outcome"</code>引数を追加する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="fu">panelview</span>(Turnout <span class="sc">~</span> Treat, <span class="at">data =</span> scm_df, </span>
<span id="cb49-2"><a href="#cb49-2"></a>          <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"PrefName_J"</span>, <span class="st">"Election"</span>), </span>
<span id="cb49-3"><a href="#cb49-3"></a>          <span class="at">type  =</span> <span class="st">"outcome"</span>,</span>
<span id="cb49-4"><a href="#cb49-4"></a>          <span class="at">main  =</span> <span class="st">"投票率の推移"</span>,</span>
<span id="cb49-5"><a href="#cb49-5"></a>          <span class="at">xlab  =</span> <span class="st">"参院選"</span>,</span>
<span id="cb49-6"><a href="#cb49-6"></a>          <span class="at">ylab  =</span> <span class="st">"投票率 (%)"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="did_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1200"></p>
</figure>
</div>
</div>
</div>
<p>　これを見ると、都道府県内における投票率の変化にはバラツキがあるが、傾向としてはかなり似通っていることが分かる。また、処置後の変化（濃い青の線）を見ると、他の都道府県よりかなり落ちているようにも見える。これは合区によって何かの変化が生じた可能性があることを示唆している。</p>
<p>　それではSCMをやってみよう。基本的な使い方は<code>lm()</code>関数に近いが、それでも必要な引数がそれなりにある。ここではその一部を紹介する。</p>
<ul>
<li>第1引数は<code>応答変数 ~ 処置変数 + 統制変数1 + 統制変数2 + ...</code>であり、統制変数は必須ではない。ここでは統制変数として定数（<code>Magnitude</code>）と候補者数（<code>Candidates</code>）を使用する。</li>
<li><code>data</code>にはデータフレームのオブジェクト名を指定する。</li>
<li><code>index</code>は<code>panelview()</code>と同じだが、<strong>一つ注意が必要</strong>です。それは、ユニットを表す変数をこれまではfactor化された<code>"PrefName_J"</code>を使ってきたが、factor化されて<strong>いない</strong><code>"PrefName_E"</code>にすることだ。まだ開発途上のパッケージということもあり、ユニット変数がfactor型だと、正しく推定できない。<code>PrefName_E</code>はfactor型でなくcharacter型ですので、問題ない（あえて<code>PrefName_E</code>をfactor化しなかったのはこのためである）。また、numeric型である<code>PrefCode</code>を指定すれば良い。。</li>
<li><code>force</code>は固定効果をユニットレベルにするか、時間レベルにするか、両方にするか、あるいはなしにするかを意味する。既定値はユニットレベル（<code>"unit"</code>）だが、ここでは両方（<code>"two-way"</code>）にする。</li>
<li><code>se</code>は標準誤差を計算するか否かであり、既定値は<code>FALSE</code>である。ここでは標準誤差も計算するために<code>TRUE</code>に指定する。標準誤差を計算しない場合、計算が早く終わる。</li>
<li><code>inference</code>は推定方法を意味し、既定値はノンパラメトリック推定（<code>"nonparametric"</code>）です。ただし、処置ケースが少ない場合、パラメトリック推定が推奨されているため、ここでは<code>"parametric"</code>を指定する。</li>
<li><code>nboots</code>は標準誤差を計算する際に使用されるブートストラッピングの回数である。既定値は200ですが、ここでは500回にする。</li>
<li><code>parallel</code>は並列計算の有無を意味する。既定値は<code>TRUE</code>で、このままでも通常は問題ない。ただし、R Markdown上で{gsynth}を使用する場合は並列計算ができないため、<code>FALSE</code>にしておく（処理時間が倍以上になる）。</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>scm_fit <span class="ot">&lt;-</span> <span class="fu">gsynth</span>(Turnout <span class="sc">~</span> Treat <span class="sc">+</span> Magnitude <span class="sc">+</span> Candidates, </span>
<span id="cb50-2"><a href="#cb50-2"></a>                  <span class="at">data =</span> scm_df, <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"PrefName_E"</span>, <span class="st">"Election"</span>), </span>
<span id="cb50-3"><a href="#cb50-3"></a>                  <span class="at">force =</span> <span class="st">"two-way"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">inference =</span> <span class="st">"parametric"</span>,</span>
<span id="cb50-4"><a href="#cb50-4"></a>                  <span class="at">nboots =</span> <span class="dv">500</span>, <span class="at">parallel =</span> <span class="cn">TRUE</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="fu">print</span>(scm_fit)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
gsynth.formula(formula = Turnout ~ Treat + Magnitude + Candidates, 
    data = scm_df, index = c("PrefName_E", "Election"), force = "two-way", 
    se = TRUE, nboots = 500, inference = "parametric", parallel = FALSE)

Average Treatment Effect on the Treated:
        Estimate S.E. CI.lower CI.upper   p.value
ATT.avg   -6.563 1.44   -9.386   -3.741 5.174e-06

   ~ by Period (including Pre-treatment Periods):
         ATT   S.E. CI.lower CI.upper   p.value n.Treated
-16  0.09054 1.2472  -2.3539  2.53503 9.421e-01         0
-15 -0.56609 1.3214  -3.1559  2.02374 6.683e-01         0
-14  3.32790 1.0784   1.2142  5.44161 2.030e-03         0
-13  1.44804 1.1103  -0.7280  3.62409 1.921e-01         0
-12 -1.53058 1.1324  -3.7501  0.68897 1.765e-01         0
-11 -1.21442 0.9235  -3.0245  0.59571 1.885e-01         0
-10 -2.51664 1.2470  -4.9608 -0.07247 4.358e-02         0
-9  -1.69683 1.1193  -3.8906  0.49691 1.295e-01         0
-8   1.12683 1.0835  -0.9969  3.25055 2.984e-01         0
-7  -1.03078 1.1020  -3.1907  1.12916 3.496e-01         0
-6   3.60723 1.4785   0.7093  6.50514 1.470e-02         0
-5  -0.85728 1.1469  -3.1051  1.39058 4.548e-01         0
-4   0.34762 0.9078  -1.4316  2.12688 7.018e-01         0
-3  -0.38462 0.9701  -2.2860  1.51674 6.918e-01         0
-2   0.26204 0.9329  -1.5664  2.09047 7.788e-01         0
-1   1.56199 0.9097  -0.2210  3.34494 8.597e-02         0
0   -1.97495 0.9575  -3.8517 -0.09820 3.916e-02         0
1   -6.57256 1.3963  -9.3093 -3.83577 2.514e-06         4
2   -6.87683 1.9895 -10.7761 -2.97756 5.470e-04         4
3   -6.24002 1.7844  -9.7374 -2.74262 4.706e-04         4

Coefficients for the Covariates:
               beta    S.E. CI.lower CI.upper   p.value
Magnitude   2.64853 0.75614   1.1665  4.13053 0.0004605
Candidates -0.05892 0.03847  -0.1343  0.01648 0.1256243</code></pre>
</div>
</div>
<p>　平均値な処置効果（AT<strong>T</strong>）は-6.563であり、統計的にも有意な結果が得られた。これは合区が行われた選挙区は、もし合区しなかった場合の投票率に比べ、約-6.563%p低いことを意味します。また、<code>~ by Period</code>以下の欄では各選挙ごとのAT<strong>T</strong>が表示されます。1以降が合区以降の時期であり、それぞれ約-6.573%p、-6.877%p、-6.240%pである。上記の-6.563はこの3つの数値の平均値である。ちなみに処置群の県が4つにも関わらず、AT<strong>T</strong>が一つだけ表示されるのは、4つの平均値を出しているからだ。それぞれの県ごとに効果を確認する方法は後ほど解説する。とりあえず、この結果から合区は投票率を下げたという解釈ができよう。</p>
<p>　以上の結果を可視化するためには<code>plot()</code>関数を使う。タイトル、横軸、縦軸のラベルは<code>main</code>、<code>xlab</code>、<code>ylab</code>で指定できる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="fu">plot</span>(scm_fit, </span>
<span id="cb53-2"><a href="#cb53-2"></a>     <span class="at">main =</span> <span class="st">"Estimated ATT"</span>, </span>
<span id="cb53-3"><a href="#cb53-3"></a>     <span class="at">xlab =</span> <span class="st">"Election (0 = 2013 Election)"</span>, </span>
<span id="cb53-4"><a href="#cb53-4"></a>     <span class="at">ylab =</span> <span class="st">"ATT (%p)"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="did_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050"></p>
</figure>
</div>
</div>
</div>
<p>　処置を受ける<strong>前</strong>は架空の4県とその実際の4県の間に投票率の差はあまりなかったが、処置を受けてから差が広がることが分かる。差分でなく、合成された架空の4県と実際の4県のトレンドを見るためには<code>type = "counterfactual"</code>、もしくは<code>type = "ct"</code>を指定します。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="fu">plot</span>(scm_fit, </span>
<span id="cb54-2"><a href="#cb54-2"></a>     <span class="at">type =</span> <span class="st">"counterfactual"</span>, </span>
<span id="cb54-3"><a href="#cb54-3"></a>     <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb54-4"><a href="#cb54-4"></a>     <span class="at">xlab =</span> <span class="st">"Election"</span>, </span>
<span id="cb54-5"><a href="#cb54-5"></a>     <span class="at">ylab =</span> <span class="st">"Turnout (%)"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="did_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050"></p>
</figure>
</div>
</div>
</div>
<p>　処置を受けたのは4県であるが、線が1本になっている。ここからも処置前は架空の4県と実際の4県はほぼ同じトレンドを示していますが、処置後は傾向が変わったことが確認できる。</p>
<p>　もし、4つの都道府県を個別に示したい場合はどうすれば良いだろうか。この場合、<code>plot()</code>内に<code>id</code>引数を使えば良い。たとえば、鳥取県の処置効果（ATT）を確認するためには<code>id = "Tottori"</code>と指定する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="fu">plot</span>(scm_fit, <span class="at">id =</span> <span class="st">"Tottori"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="did_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="fu">plot</span>(scm_fit, <span class="at">id =</span> <span class="st">"Tottori"</span>, <span class="at">type =</span> <span class="st">"ct"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="did_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050"></p>
</figure>
</div>
</div>
</div>
<p>　4つの都道府県のデータを個別のファセットで全て出すためにはゼロベースで作図した方が効率的かも知れない。また、この場合は図のカスタマイズの幅も広がる。{gsynth}から得られたオブジェクトには架空の鳥取、島根、徳島、高知のデータが個別に格納されているため、それを抽出すれば個別の図を作成することもできる。たとえば、処置群（4県）の観察済みのデータは<code>オブジェクト名$Y.tr</code>で抽出できる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>scm_fit<span class="sc">$</span>Y.tr</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Kochi  Shimane Tokushima  Tottori
7  74.63966 83.49050  69.39499 81.24437
8  75.69312 84.78405  69.88441 83.69962
9  71.37616 78.14244  63.66989 77.03502
10 75.69410 86.92480  78.45754 84.82852
11 70.90031 85.15588  63.40844 83.37384
12 72.83410 87.58638  77.05070 84.86225
13 61.27247 75.36695  49.81165 74.79201
14 72.01185 86.89197  70.26960 85.81677
15 70.52034 82.31831  65.59127 78.71451
16 54.89730 73.79272  48.42299 67.28538
17 50.63857 67.09330  47.14380 67.57092
18 56.21296 73.26601  56.91326 70.03591
19 58.38653 68.61257  57.24322 66.68463
20 57.29701 68.87462  54.59808 64.16773
21 58.39998 71.80893  58.46591 67.67363
22 58.49266 71.70006  58.23675 65.76520
23 49.88987 60.89257  49.29437 58.87696
24 45.51522 62.19714  46.97798 56.28266
25 46.34053 54.04000  38.59305 49.97934
26 47.36311 56.37101  45.72428 48.92585</code></pre>
</div>
</div>
<p>　このデータは行列構造となっているため、<code>as_tibble()</code>で表形式へ変更し、<code>treat_df</code>という名で格納する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a>treat_df <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(scm_fit<span class="sc">$</span>Y.tr)</span>
<span id="cb59-2"><a href="#cb59-2"></a></span>
<span id="cb59-3"><a href="#cb59-3"></a>treat_df</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 4
   Kochi Shimane Tokushima Tottori
   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1  74.6    83.5      69.4    81.2
 2  75.7    84.8      69.9    83.7
 3  71.4    78.1      63.7    77.0
 4  75.7    86.9      78.5    84.8
 5  70.9    85.2      63.4    83.4
 6  72.8    87.6      77.1    84.9
 7  61.3    75.4      49.8    74.8
 8  72.0    86.9      70.3    85.8
 9  70.5    82.3      65.6    78.7
10  54.9    73.8      48.4    67.3
11  50.6    67.1      47.1    67.6
12  56.2    73.3      56.9    70.0
13  58.4    68.6      57.2    66.7
14  57.3    68.9      54.6    64.2
15  58.4    71.8      58.5    67.7
16  58.5    71.7      58.2    65.8
17  49.9    60.9      49.3    58.9
18  45.5    62.2      47.0    56.3
19  46.3    54.0      38.6    50.0
20  47.4    56.4      45.7    48.9</code></pre>
</div>
</div>
<p>　この<code>treat_df</code>だけは各投票率がいつの投票率かが分からない。<code>Election</code>列を<code>Kochi</code>列前に追加し（<code>mutate()</code>内の最後に<code>.before = Kochi</code>を指定すると、<code>mutate()</code>で生成・修正された列が<code>Kochi</code>列の前へ移動する）、7から26までを入れる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a>treat_df <span class="ot">&lt;-</span> treat_df <span class="sc">|&gt;</span></span>
<span id="cb61-2"><a href="#cb61-2"></a>  <span class="fu">mutate</span>(<span class="at">Election =</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">26</span>, <span class="at">.before =</span> Kochi)</span>
<span id="cb61-3"><a href="#cb61-3"></a></span>
<span id="cb61-4"><a href="#cb61-4"></a>treat_df</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 5
   Election Kochi Shimane Tokushima Tottori
      &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1        7  74.6    83.5      69.4    81.2
 2        8  75.7    84.8      69.9    83.7
 3        9  71.4    78.1      63.7    77.0
 4       10  75.7    86.9      78.5    84.8
 5       11  70.9    85.2      63.4    83.4
 6       12  72.8    87.6      77.1    84.9
 7       13  61.3    75.4      49.8    74.8
 8       14  72.0    86.9      70.3    85.8
 9       15  70.5    82.3      65.6    78.7
10       16  54.9    73.8      48.4    67.3
11       17  50.6    67.1      47.1    67.6
12       18  56.2    73.3      56.9    70.0
13       19  58.4    68.6      57.2    66.7
14       20  57.3    68.9      54.6    64.2
15       21  58.4    71.8      58.5    67.7
16       22  58.5    71.7      58.2    65.8
17       23  49.9    60.9      49.3    58.9
18       24  45.5    62.2      47.0    56.3
19       25  46.3    54.0      38.6    50.0
20       26  47.4    56.4      45.7    48.9</code></pre>
</div>
</div>
<p>　続いて、{tidyr}の<code>pivot_longer()</code>関数を使って<code>treat_df</code>をlong型データへ変換する。<code>pivot_*()</code>関数の使い方については『私たちのR』<a href="https://www.jaysong.net/RBook/tidydata.html">第15章「整然データ構造」</a>を参照されたい。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a>treat_df <span class="ot">&lt;-</span> treat_df <span class="sc">|&gt;</span></span>
<span id="cb63-2"><a href="#cb63-2"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols      =</span> Kochi<span class="sc">:</span>Tottori,</span>
<span id="cb63-3"><a href="#cb63-3"></a>               <span class="at">names_to  =</span> <span class="st">"Pref"</span>,</span>
<span id="cb63-4"><a href="#cb63-4"></a>               <span class="at">values_to =</span> <span class="st">"Turnout"</span>)</span>
<span id="cb63-5"><a href="#cb63-5"></a></span>
<span id="cb63-6"><a href="#cb63-6"></a>treat_df</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 80 × 3
   Election Pref      Turnout
      &lt;int&gt; &lt;chr&gt;       &lt;dbl&gt;
 1        7 Kochi        74.6
 2        7 Shimane      83.5
 3        7 Tokushima    69.4
 4        7 Tottori      81.2
 5        8 Kochi        75.7
 6        8 Shimane      84.8
 7        8 Tokushima    69.9
 8        8 Tottori      83.7
 9        9 Kochi        71.4
10        9 Shimane      78.1
# ℹ 70 more rows</code></pre>
</div>
</div>
<p>　同じ作業を架空の処置群についても行う。架空の処置群は<code>オブジェクト名$Y.ct</code>で抽出できる。今回は全ての作業をパイプ演算子で繋ぎ、コードを効率化する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a>counter_df <span class="ot">&lt;-</span> scm_fit<span class="sc">$</span>Y.ct <span class="sc">|&gt;</span></span>
<span id="cb65-2"><a href="#cb65-2"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb65-3"><a href="#cb65-3"></a>  <span class="fu">mutate</span>(<span class="at">Election =</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">26</span>, <span class="at">.before =</span> Kochi) <span class="sc">|&gt;</span></span>
<span id="cb65-4"><a href="#cb65-4"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols      =</span> Kochi<span class="sc">:</span>Tottori,</span>
<span id="cb65-5"><a href="#cb65-5"></a>               <span class="at">names_to  =</span> <span class="st">"Pref"</span>,</span>
<span id="cb65-6"><a href="#cb65-6"></a>               <span class="at">values_to =</span> <span class="st">"Turnout"</span>)</span>
<span id="cb65-7"><a href="#cb65-7"></a></span>
<span id="cb65-8"><a href="#cb65-8"></a>counter_df</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 80 × 3
   Election Pref      Turnout
      &lt;int&gt; &lt;chr&gt;       &lt;dbl&gt;
 1        7 Kochi        73.5
 2        7 Shimane      84.0
 3        7 Tokushima    67.6
 4        7 Tottori      83.3
 5        8 Kochi        75.3
 6        8 Shimane      85.7
 7        8 Tokushima    70.7
 8        8 Tottori      84.7
 9        9 Kochi        65.6
10        9 Shimane      76.1
# ℹ 70 more rows</code></pre>
</div>
</div>
<p>　最後に<code>treat_df</code>と<code>counter_df</code>を結合する。<code>treat_df</code>の行なら<code>"観測値"</code>の値が、<code>counter_df</code>の行なら<code>"反実仮想"</code>の値が付けられた<code>Type</code>という列を追加し、この<code>Type</code>列をfactor化する。要素の順番は<code>"反実仮想"</code>、<code>"観測値"</code>の順とする。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a>tr_ct_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">list</span>(<span class="st">"観測値"</span>   <span class="ot">=</span> treat_df, </span>
<span id="cb67-2"><a href="#cb67-2"></a>                           <span class="st">"反実仮想"</span> <span class="ot">=</span> counter_df),</span>
<span id="cb67-3"><a href="#cb67-3"></a>                      <span class="at">.id =</span> <span class="st">"Type"</span>) <span class="sc">|&gt;</span></span>
<span id="cb67-4"><a href="#cb67-4"></a>  <span class="fu">mutate</span>(<span class="at">Type =</span> <span class="fu">factor</span>(Type, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"反実仮想"</span>, <span class="st">"観測値"</span>)))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　データが揃ったので{ggplot2}を使って折れ線グラフを作ってみよう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a>tr_ct_df <span class="sc">|&gt;</span></span>
<span id="cb68-2"><a href="#cb68-2"></a>  <span class="co"># Pref列をリコーディング &amp; factor化</span></span>
<span id="cb68-3"><a href="#cb68-3"></a>  <span class="fu">mutate</span>(<span class="at">Pref =</span> <span class="fu">recode</span>(Pref,</span>
<span id="cb68-4"><a href="#cb68-4"></a>                       <span class="st">"Tottori"</span>   <span class="ot">=</span> <span class="st">"鳥取"</span>,</span>
<span id="cb68-5"><a href="#cb68-5"></a>                       <span class="st">"Shimane"</span>   <span class="ot">=</span> <span class="st">"島根"</span>,</span>
<span id="cb68-6"><a href="#cb68-6"></a>                       <span class="st">"Tokushima"</span> <span class="ot">=</span> <span class="st">"徳島"</span>,</span>
<span id="cb68-7"><a href="#cb68-7"></a>                       <span class="st">"Kochi"</span>     <span class="ot">=</span> <span class="st">"高知"</span>),</span>
<span id="cb68-8"><a href="#cb68-8"></a>         <span class="at">Pref =</span> <span class="fu">factor</span>(Pref, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"鳥取"</span>, <span class="st">"島根"</span>, <span class="st">"徳島"</span>, <span class="st">"高知"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb68-9"><a href="#cb68-9"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb68-10"><a href="#cb68-10"></a>  <span class="co"># x = 23の箇所に垂直線の破線を引く</span></span>
<span id="cb68-11"><a href="#cb68-11"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">23</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb68-12"><a href="#cb68-12"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Election, <span class="at">y =</span> Turnout, <span class="at">linetype =</span> Type, <span class="at">color =</span> Type),</span>
<span id="cb68-13"><a href="#cb68-13"></a>            <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb68-14"><a href="#cb68-14"></a>  <span class="co"># 線の色</span></span>
<span id="cb68-15"><a href="#cb68-15"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"観測値"</span>   <span class="ot">=</span> <span class="st">"black"</span>, </span>
<span id="cb68-16"><a href="#cb68-16"></a>                                <span class="st">"反実仮想"</span> <span class="ot">=</span> <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb68-17"><a href="#cb68-17"></a>  <span class="co"># 線のタイプ（1 = 実線; 2 = 破線）</span></span>
<span id="cb68-18"><a href="#cb68-18"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"観測値"</span>   <span class="ot">=</span> <span class="dv">1</span>, </span>
<span id="cb68-19"><a href="#cb68-19"></a>                                   <span class="st">"反実仮想"</span> <span class="ot">=</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb68-20"><a href="#cb68-20"></a>  <span class="co"># colorの凡例は残し、linetypeの凡例は無くす</span></span>
<span id="cb68-21"><a href="#cb68-21"></a>  <span class="fu">guides</span>(<span class="at">linetype =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb68-22"><a href="#cb68-22"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"選挙"</span>, <span class="at">y =</span> <span class="st">"投票率 (%)"</span>, <span class="at">color =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb68-23"><a href="#cb68-23"></a>  <span class="co"># 都道府県ごとにファセット分割</span></span>
<span id="cb68-24"><a href="#cb68-24"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Pref, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb68-25"><a href="#cb68-25"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb68-26"><a href="#cb68-26"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="did_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1200"></p>
</figure>
</div>
</div>
</div>
<p>　ただし、この図だけだと処置効果（ATT）が分かりにくい。処置効果は観測値（=処置群）と反実仮想（=架空の統制群）の差分である。<code>tr_ct_df</code>からもATTの計算はできるが、ATTの不確実性（標準誤差や信頼区間など）までは分からない。処置効果（ATT）を抽出は<code>オブジェクト名$est.ind</code>で出来るが、3次元配列（array構造）になっているため、<code>オブジェクト名$est.ind[, , "処置群名"]</code>で抽出する必要がある。処置群名は今回の場合だと<code>PrefName_E</code>上の名前である。たとえば、鳥取における処置効果は以下のように抽出する。これらもまた表形式でなく、行列構造であるので、<code>as_tibble()</code>を使って表形式にしよう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="fu">as_tibble</span>(scm_fit<span class="sc">$</span>est.ind[, , <span class="st">"Tottori"</span>])</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 5
        Eff  S.E. CI.lower CI.upper p.value
      &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
 1  -2.03    2.49   -6.92     2.85  0.415  
 2  -0.960   2.48   -5.83     3.91  0.699  
 3   1.69    2.03   -2.30     5.67  0.407  
 4   1.07    2.06   -2.97     5.11  0.605  
 5   0.721   2.27   -3.72     5.16  0.750  
 6  -0.704   1.77   -4.17     2.76  0.690  
 7  -0.926   2.16   -5.17     3.31  0.668  
 8   0.816   2.07   -3.25     4.88  0.694  
 9   0.247   2.11   -3.88     4.38  0.907  
10  -3.24    2.09   -7.34     0.862 0.122  
11   5.88    2.91    0.184   11.6   0.0430 
12   0.143   2.23   -4.22     4.51  0.949  
13   0.0189  1.81   -3.53     3.57  0.992  
14  -1.48    1.82   -5.06     2.09  0.416  
15  -0.0566  1.78   -3.54     3.43  0.975  
16   0.456   1.83   -3.12     4.04  0.803  
17  -1.63    1.77   -5.11     1.84  0.357  
18  -6.90    2.76  -12.3     -1.49  0.0124 
19  -9.00    4.09  -17.0     -0.976 0.0279 
20 -10.9     3.54  -17.8     -3.94  0.00211</code></pre>
</div>
</div>
<p>　ここで<code>Eff</code>列が架空の鳥取と実際の鳥取の差、つまり処置効果である。そして、<code>CI.lower</code>と<code>CI.upper</code>がそれぞれ95%信頼区間の下限と上限だ。これら4つの県のデータを結合し、<code>Election</code>変数を追加、都道府県をfactor化したものを<code>att_df</code>という名で格納する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a>att_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">list</span>(<span class="st">"鳥取"</span> <span class="ot">=</span> <span class="fu">as_tibble</span>(scm_fit<span class="sc">$</span>est.ind[, , <span class="st">"Tottori"</span>]),</span>
<span id="cb71-2"><a href="#cb71-2"></a>                         <span class="st">"島根"</span> <span class="ot">=</span> <span class="fu">as_tibble</span>(scm_fit<span class="sc">$</span>est.ind[, , <span class="st">"Shimane"</span>]),</span>
<span id="cb71-3"><a href="#cb71-3"></a>                         <span class="st">"徳島"</span> <span class="ot">=</span> <span class="fu">as_tibble</span>(scm_fit<span class="sc">$</span>est.ind[, , <span class="st">"Tokushima"</span>]),</span>
<span id="cb71-4"><a href="#cb71-4"></a>                         <span class="st">"高知"</span> <span class="ot">=</span> <span class="fu">as_tibble</span>(scm_fit<span class="sc">$</span>est.ind[, , <span class="st">"Kochi"</span>])),</span>
<span id="cb71-5"><a href="#cb71-5"></a>                    <span class="at">.id =</span> <span class="st">"Pref"</span>) <span class="sc">|&gt;</span></span>
<span id="cb71-6"><a href="#cb71-6"></a>  <span class="fu">mutate</span>(<span class="at">Election =</span> <span class="fu">rep</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">26</span>, <span class="dv">4</span>), <span class="co"># 7~26を4回繰り返し</span></span>
<span id="cb71-7"><a href="#cb71-7"></a>         <span class="at">.before =</span> Pref) <span class="sc">|&gt;</span>       <span class="co"># Election列をPref列の前に</span></span>
<span id="cb71-8"><a href="#cb71-8"></a>  <span class="fu">mutate</span>(<span class="at">Pref =</span> <span class="fu">fct_inorder</span>(Pref))</span>
<span id="cb71-9"><a href="#cb71-9"></a></span>
<span id="cb71-10"><a href="#cb71-10"></a>att_df</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 80 × 7
   Election Pref     Eff  S.E. CI.lower CI.upper p.value
      &lt;int&gt; &lt;fct&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
 1        7 鳥取  -2.03   2.49    -6.92    2.85    0.415
 2        8 鳥取  -0.960  2.48    -5.83    3.91    0.699
 3        9 鳥取   1.69   2.03    -2.30    5.67    0.407
 4       10 鳥取   1.07   2.06    -2.97    5.11    0.605
 5       11 鳥取   0.721  2.27    -3.72    5.16    0.750
 6       12 鳥取  -0.704  1.77    -4.17    2.76    0.690
 7       13 鳥取  -0.926  2.16    -5.17    3.31    0.668
 8       14 鳥取   0.816  2.07    -3.25    4.88    0.694
 9       15 鳥取   0.247  2.11    -3.88    4.38    0.907
10       16 鳥取  -3.24   2.09    -7.34    0.862   0.122
# ℹ 70 more rows</code></pre>
</div>
</div>
<p>　それでは折れ線グラフを作ってみよう。ただし、今回は点推定値（折れ線グラフ）だけでなく、信頼区間も示す必要があるので<code>geom_ribbon()</code>レイヤーを追加する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a>att_df <span class="sc">|&gt;</span></span>
<span id="cb73-2"><a href="#cb73-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb73-3"><a href="#cb73-3"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb73-4"><a href="#cb73-4"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">23</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb73-5"><a href="#cb73-5"></a>  <span class="co"># 信頼区間</span></span>
<span id="cb73-6"><a href="#cb73-6"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Election, <span class="at">ymin =</span> CI.lower, <span class="at">ymax =</span> CI.upper),</span>
<span id="cb73-7"><a href="#cb73-7"></a>              <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb73-8"><a href="#cb73-8"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Election, <span class="at">y =</span> Eff)) <span class="sc">+</span></span>
<span id="cb73-9"><a href="#cb73-9"></a>  <span class="co"># 以下のgeom_point()なあってもなくても良い</span></span>
<span id="cb73-10"><a href="#cb73-10"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Election, <span class="at">y =</span> Eff), </span>
<span id="cb73-11"><a href="#cb73-11"></a>             <span class="at">size =</span> <span class="dv">3</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"black"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb73-12"><a href="#cb73-12"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Election"</span>, <span class="at">y =</span> <span class="st">"Gap (%p)"</span>) <span class="sc">+</span></span>
<span id="cb73-13"><a href="#cb73-13"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Pref, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb73-14"><a href="#cb73-14"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb73-15"><a href="#cb73-15"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="did_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1200"></p>
</figure>
</div>
</div>
</div>
<p>　個別に見ると、合区直後、合区によって投票率を下がったのは鳥取、徳島、高知である。しかし、合区から3回目の選挙となる2022年（第26回）では鳥取のみとなる。</p>
<p>　SCMは統制群から合成された架空の鳥取、島根、徳島、高知を作成し、こちらを実際の統制群として用いる手法である。その際に43都道府県を重み付け合成されるが、それぞれの重みはいくつだろうか。<code>gsynth()</code>から得られたオブジェクトから<code>wgt.implied</code>を抽出すればその重みが分かる。通常のSCMの場合、重みは正の値であるが、一般化SCMの場合は負も正もあり得る。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a>scm_fit<span class="sc">$</span>wgt.implied</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="rmhtoweeaz" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#rmhtoweeaz table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#rmhtoweeaz thead, #rmhtoweeaz tbody, #rmhtoweeaz tfoot, #rmhtoweeaz tr, #rmhtoweeaz td, #rmhtoweeaz th {
  border-style: none;
}

#rmhtoweeaz p {
  margin: 0;
  padding: 0;
}

#rmhtoweeaz .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rmhtoweeaz .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#rmhtoweeaz .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rmhtoweeaz .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rmhtoweeaz .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rmhtoweeaz .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rmhtoweeaz .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rmhtoweeaz .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rmhtoweeaz .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rmhtoweeaz .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rmhtoweeaz .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rmhtoweeaz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rmhtoweeaz .gt_spanner_row {
  border-bottom-style: hidden;
}

#rmhtoweeaz .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#rmhtoweeaz .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rmhtoweeaz .gt_from_md > :first-child {
  margin-top: 0;
}

#rmhtoweeaz .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rmhtoweeaz .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rmhtoweeaz .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rmhtoweeaz .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rmhtoweeaz .gt_row_group_first td {
  border-top-width: 2px;
}

#rmhtoweeaz .gt_row_group_first th {
  border-top-width: 2px;
}

#rmhtoweeaz .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rmhtoweeaz .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rmhtoweeaz .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rmhtoweeaz .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rmhtoweeaz .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rmhtoweeaz .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rmhtoweeaz .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#rmhtoweeaz .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rmhtoweeaz .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rmhtoweeaz .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rmhtoweeaz .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rmhtoweeaz .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rmhtoweeaz .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rmhtoweeaz .gt_left {
  text-align: left;
}

#rmhtoweeaz .gt_center {
  text-align: center;
}

#rmhtoweeaz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rmhtoweeaz .gt_font_normal {
  font-weight: normal;
}

#rmhtoweeaz .gt_font_bold {
  font-weight: bold;
}

#rmhtoweeaz .gt_font_italic {
  font-style: italic;
}

#rmhtoweeaz .gt_super {
  font-size: 65%;
}

#rmhtoweeaz .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#rmhtoweeaz .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rmhtoweeaz .gt_indent_1 {
  text-indent: 5px;
}

#rmhtoweeaz .gt_indent_2 {
  text-indent: 10px;
}

#rmhtoweeaz .gt_indent_3 {
  text-indent: 15px;
}

#rmhtoweeaz .gt_indent_4 {
  text-indent: 20px;
}

#rmhtoweeaz .gt_indent_5 {
  text-indent: 25px;
}

#rmhtoweeaz .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#rmhtoweeaz div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="Kochi" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Kochi</th>
<th id="Shimane" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Shimane</th>
<th id="Tokushima" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Tokushima</th>
<th id="Tottori" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Tottori</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Aichi</td>
<td class="gt_row gt_right" headers="stub_1_1 Kochi">0.022</td>
<td class="gt_row gt_right" headers="stub_1_1 Shimane">−2.169</td>
<td class="gt_row gt_right" headers="stub_1_1 Tokushima">−2.755</td>
<td class="gt_row gt_right" headers="stub_1_1 Tottori">0.448</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Akita</td>
<td class="gt_row gt_right" headers="stub_1_2 Kochi">−0.151</td>
<td class="gt_row gt_right" headers="stub_1_2 Shimane">−0.161</td>
<td class="gt_row gt_right" headers="stub_1_2 Tokushima">−0.798</td>
<td class="gt_row gt_right" headers="stub_1_2 Tottori">0.170</td>
</tr>
<tr class="odd">
<td id="stub_1_3" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Aomori</td>
<td class="gt_row gt_right" headers="stub_1_3 Kochi">−0.069</td>
<td class="gt_row gt_right" headers="stub_1_3 Shimane">−1.188</td>
<td class="gt_row gt_right" headers="stub_1_3 Tokushima">−1.613</td>
<td class="gt_row gt_right" headers="stub_1_3 Tottori">0.225</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Chiba</td>
<td class="gt_row gt_right" headers="stub_1_4 Kochi">0.309</td>
<td class="gt_row gt_right" headers="stub_1_4 Shimane">−2.096</td>
<td class="gt_row gt_right" headers="stub_1_4 Tokushima">−1.885</td>
<td class="gt_row gt_right" headers="stub_1_4 Tottori">0.327</td>
</tr>
<tr class="odd">
<td id="stub_1_5" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Ehime</td>
<td class="gt_row gt_right" headers="stub_1_5 Kochi">0.238</td>
<td class="gt_row gt_right" headers="stub_1_5 Shimane">0.471</td>
<td class="gt_row gt_right" headers="stub_1_5 Tokushima">0.851</td>
<td class="gt_row gt_right" headers="stub_1_5 Tottori">−0.009</td>
</tr>
<tr class="even">
<td id="stub_1_6" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Fukui</td>
<td class="gt_row gt_right" headers="stub_1_6 Kochi">−0.630</td>
<td class="gt_row gt_right" headers="stub_1_6 Shimane">4.081</td>
<td class="gt_row gt_right" headers="stub_1_6 Tokushima">4.711</td>
<td class="gt_row gt_right" headers="stub_1_6 Tottori">−1.122</td>
</tr>
<tr class="odd">
<td id="stub_1_7" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Fukuoka</td>
<td class="gt_row gt_right" headers="stub_1_7 Kochi">−0.541</td>
<td class="gt_row gt_right" headers="stub_1_7 Shimane">0.634</td>
<td class="gt_row gt_right" headers="stub_1_7 Tokushima">0.342</td>
<td class="gt_row gt_right" headers="stub_1_7 Tottori">−0.368</td>
</tr>
<tr class="even">
<td id="stub_1_8" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Fukushima</td>
<td class="gt_row gt_right" headers="stub_1_8 Kochi">0.947</td>
<td class="gt_row gt_right" headers="stub_1_8 Shimane">−0.235</td>
<td class="gt_row gt_right" headers="stub_1_8 Tokushima">0.669</td>
<td class="gt_row gt_right" headers="stub_1_8 Tottori">0.402</td>
</tr>
<tr class="odd">
<td id="stub_1_9" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Gifu</td>
<td class="gt_row gt_right" headers="stub_1_9 Kochi">0.354</td>
<td class="gt_row gt_right" headers="stub_1_9 Shimane">0.149</td>
<td class="gt_row gt_right" headers="stub_1_9 Tokushima">0.566</td>
<td class="gt_row gt_right" headers="stub_1_9 Tottori">0.097</td>
</tr>
<tr class="even">
<td id="stub_1_10" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Gunma</td>
<td class="gt_row gt_right" headers="stub_1_10 Kochi">0.318</td>
<td class="gt_row gt_right" headers="stub_1_10 Shimane">2.085</td>
<td class="gt_row gt_right" headers="stub_1_10 Tokushima">2.968</td>
<td class="gt_row gt_right" headers="stub_1_10 Tottori">−0.291</td>
</tr>
<tr class="odd">
<td id="stub_1_11" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Hiroshima</td>
<td class="gt_row gt_right" headers="stub_1_11 Kochi">−0.254</td>
<td class="gt_row gt_right" headers="stub_1_11 Shimane">1.622</td>
<td class="gt_row gt_right" headers="stub_1_11 Tokushima">2.146</td>
<td class="gt_row gt_right" headers="stub_1_11 Tottori">−0.570</td>
</tr>
<tr class="even">
<td id="stub_1_12" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Hokkaido</td>
<td class="gt_row gt_right" headers="stub_1_12 Kochi">−0.553</td>
<td class="gt_row gt_right" headers="stub_1_12 Shimane">−3.254</td>
<td class="gt_row gt_right" headers="stub_1_12 Tokushima">−5.161</td>
<td class="gt_row gt_right" headers="stub_1_12 Tottori">0.643</td>
</tr>
<tr class="odd">
<td id="stub_1_13" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Hyogo</td>
<td class="gt_row gt_right" headers="stub_1_13 Kochi">0.117</td>
<td class="gt_row gt_right" headers="stub_1_13 Shimane">−3.045</td>
<td class="gt_row gt_right" headers="stub_1_13 Tokushima">−3.918</td>
<td class="gt_row gt_right" headers="stub_1_13 Tottori">0.723</td>
</tr>
<tr class="even">
<td id="stub_1_14" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Ibaraki</td>
<td class="gt_row gt_right" headers="stub_1_14 Kochi">0.378</td>
<td class="gt_row gt_right" headers="stub_1_14 Shimane">−0.483</td>
<td class="gt_row gt_right" headers="stub_1_14 Tokushima">0.902</td>
<td class="gt_row gt_right" headers="stub_1_14 Tottori">−0.263</td>
</tr>
<tr class="odd">
<td id="stub_1_15" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Ishikawa</td>
<td class="gt_row gt_right" headers="stub_1_15 Kochi">−0.480</td>
<td class="gt_row gt_right" headers="stub_1_15 Shimane">1.476</td>
<td class="gt_row gt_right" headers="stub_1_15 Tokushima">1.294</td>
<td class="gt_row gt_right" headers="stub_1_15 Tottori">−0.432</td>
</tr>
<tr class="even">
<td id="stub_1_16" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Iwate</td>
<td class="gt_row gt_right" headers="stub_1_16 Kochi">0.006</td>
<td class="gt_row gt_right" headers="stub_1_16 Shimane">−2.615</td>
<td class="gt_row gt_right" headers="stub_1_16 Tokushima">−4.020</td>
<td class="gt_row gt_right" headers="stub_1_16 Tottori">0.833</td>
</tr>
<tr class="odd">
<td id="stub_1_17" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kagawa</td>
<td class="gt_row gt_right" headers="stub_1_17 Kochi">−0.391</td>
<td class="gt_row gt_right" headers="stub_1_17 Shimane">3.227</td>
<td class="gt_row gt_right" headers="stub_1_17 Tokushima">3.960</td>
<td class="gt_row gt_right" headers="stub_1_17 Tottori">−0.902</td>
</tr>
<tr class="even">
<td id="stub_1_18" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kagoshima</td>
<td class="gt_row gt_right" headers="stub_1_18 Kochi">0.098</td>
<td class="gt_row gt_right" headers="stub_1_18 Shimane">0.202</td>
<td class="gt_row gt_right" headers="stub_1_18 Tokushima">−0.102</td>
<td class="gt_row gt_right" headers="stub_1_18 Tottori">0.200</td>
</tr>
<tr class="odd">
<td id="stub_1_19" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kanagawa</td>
<td class="gt_row gt_right" headers="stub_1_19 Kochi">0.506</td>
<td class="gt_row gt_right" headers="stub_1_19 Shimane">−3.426</td>
<td class="gt_row gt_right" headers="stub_1_19 Tokushima">−3.741</td>
<td class="gt_row gt_right" headers="stub_1_19 Tottori">0.828</td>
</tr>
<tr class="even">
<td id="stub_1_20" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kumamoto</td>
<td class="gt_row gt_right" headers="stub_1_20 Kochi">−0.791</td>
<td class="gt_row gt_right" headers="stub_1_20 Shimane">1.767</td>
<td class="gt_row gt_right" headers="stub_1_20 Tokushima">1.083</td>
<td class="gt_row gt_right" headers="stub_1_20 Tottori">−0.490</td>
</tr>
<tr class="odd">
<td id="stub_1_21" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Kyoto</td>
<td class="gt_row gt_right" headers="stub_1_21 Kochi">0.397</td>
<td class="gt_row gt_right" headers="stub_1_21 Shimane">−4.141</td>
<td class="gt_row gt_right" headers="stub_1_21 Tokushima">−5.373</td>
<td class="gt_row gt_right" headers="stub_1_21 Tottori">1.200</td>
</tr>
<tr class="even">
<td id="stub_1_22" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Mie</td>
<td class="gt_row gt_right" headers="stub_1_22 Kochi">0.016</td>
<td class="gt_row gt_right" headers="stub_1_22 Shimane">−1.162</td>
<td class="gt_row gt_right" headers="stub_1_22 Tokushima">−1.447</td>
<td class="gt_row gt_right" headers="stub_1_22 Tottori">0.231</td>
</tr>
<tr class="odd">
<td id="stub_1_23" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Miyagi</td>
<td class="gt_row gt_right" headers="stub_1_23 Kochi">0.712</td>
<td class="gt_row gt_right" headers="stub_1_23 Shimane">−0.122</td>
<td class="gt_row gt_right" headers="stub_1_23 Tokushima">1.072</td>
<td class="gt_row gt_right" headers="stub_1_23 Tottori">0.070</td>
</tr>
<tr class="even">
<td id="stub_1_24" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Miyazaki</td>
<td class="gt_row gt_right" headers="stub_1_24 Kochi">−1.071</td>
<td class="gt_row gt_right" headers="stub_1_24 Shimane">5.630</td>
<td class="gt_row gt_right" headers="stub_1_24 Tokushima">6.465</td>
<td class="gt_row gt_right" headers="stub_1_24 Tottori">−1.699</td>
</tr>
<tr class="odd">
<td id="stub_1_25" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Nagano</td>
<td class="gt_row gt_right" headers="stub_1_25 Kochi">0.498</td>
<td class="gt_row gt_right" headers="stub_1_25 Shimane">−1.419</td>
<td class="gt_row gt_right" headers="stub_1_25 Tokushima">−1.244</td>
<td class="gt_row gt_right" headers="stub_1_25 Tottori">0.446</td>
</tr>
<tr class="even">
<td id="stub_1_26" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Nagasaki</td>
<td class="gt_row gt_right" headers="stub_1_26 Kochi">−0.921</td>
<td class="gt_row gt_right" headers="stub_1_26 Shimane">1.910</td>
<td class="gt_row gt_right" headers="stub_1_26 Tokushima">1.572</td>
<td class="gt_row gt_right" headers="stub_1_26 Tottori">−0.763</td>
</tr>
<tr class="odd">
<td id="stub_1_27" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Nara</td>
<td class="gt_row gt_right" headers="stub_1_27 Kochi">0.378</td>
<td class="gt_row gt_right" headers="stub_1_27 Shimane">−2.473</td>
<td class="gt_row gt_right" headers="stub_1_27 Tokushima">−2.658</td>
<td class="gt_row gt_right" headers="stub_1_27 Tottori">0.589</td>
</tr>
<tr class="even">
<td id="stub_1_28" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Nigata</td>
<td class="gt_row gt_right" headers="stub_1_28 Kochi">0.856</td>
<td class="gt_row gt_right" headers="stub_1_28 Shimane">−2.080</td>
<td class="gt_row gt_right" headers="stub_1_28 Tokushima">−1.318</td>
<td class="gt_row gt_right" headers="stub_1_28 Tottori">0.535</td>
</tr>
<tr class="odd">
<td id="stub_1_29" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Oita</td>
<td class="gt_row gt_right" headers="stub_1_29 Kochi">−0.593</td>
<td class="gt_row gt_right" headers="stub_1_29 Shimane">2.253</td>
<td class="gt_row gt_right" headers="stub_1_29 Tokushima">1.749</td>
<td class="gt_row gt_right" headers="stub_1_29 Tottori">−0.444</td>
</tr>
<tr class="even">
<td id="stub_1_30" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Okayama</td>
<td class="gt_row gt_right" headers="stub_1_30 Kochi">−0.264</td>
<td class="gt_row gt_right" headers="stub_1_30 Shimane">0.966</td>
<td class="gt_row gt_right" headers="stub_1_30 Tokushima">1.560</td>
<td class="gt_row gt_right" headers="stub_1_30 Tottori">−0.557</td>
</tr>
<tr class="odd">
<td id="stub_1_31" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Okinawa</td>
<td class="gt_row gt_right" headers="stub_1_31 Kochi">0.958</td>
<td class="gt_row gt_right" headers="stub_1_31 Shimane">0.416</td>
<td class="gt_row gt_right" headers="stub_1_31 Tokushima">0.697</td>
<td class="gt_row gt_right" headers="stub_1_31 Tottori">0.637</td>
</tr>
<tr class="even">
<td id="stub_1_32" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Osaka</td>
<td class="gt_row gt_right" headers="stub_1_32 Kochi">0.387</td>
<td class="gt_row gt_right" headers="stub_1_32 Shimane">−3.404</td>
<td class="gt_row gt_right" headers="stub_1_32 Tokushima">−4.601</td>
<td class="gt_row gt_right" headers="stub_1_32 Tottori">1.118</td>
</tr>
<tr class="odd">
<td id="stub_1_33" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Saga</td>
<td class="gt_row gt_right" headers="stub_1_33 Kochi">−0.913</td>
<td class="gt_row gt_right" headers="stub_1_33 Shimane">4.668</td>
<td class="gt_row gt_right" headers="stub_1_33 Tokushima">5.637</td>
<td class="gt_row gt_right" headers="stub_1_33 Tottori">−1.552</td>
</tr>
<tr class="even">
<td id="stub_1_34" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Saitama</td>
<td class="gt_row gt_right" headers="stub_1_34 Kochi">0.217</td>
<td class="gt_row gt_right" headers="stub_1_34 Shimane">−0.975</td>
<td class="gt_row gt_right" headers="stub_1_34 Tokushima">−0.328</td>
<td class="gt_row gt_right" headers="stub_1_34 Tottori">−0.031</td>
</tr>
<tr class="odd">
<td id="stub_1_35" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Shiga</td>
<td class="gt_row gt_right" headers="stub_1_35 Kochi">−0.012</td>
<td class="gt_row gt_right" headers="stub_1_35 Shimane">−0.073</td>
<td class="gt_row gt_right" headers="stub_1_35 Tokushima">−0.613</td>
<td class="gt_row gt_right" headers="stub_1_35 Tottori">0.235</td>
</tr>
<tr class="even">
<td id="stub_1_36" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Shizuoka</td>
<td class="gt_row gt_right" headers="stub_1_36 Kochi">0.599</td>
<td class="gt_row gt_right" headers="stub_1_36 Shimane">0.961</td>
<td class="gt_row gt_right" headers="stub_1_36 Tokushima">2.654</td>
<td class="gt_row gt_right" headers="stub_1_36 Tottori">−0.330</td>
</tr>
<tr class="odd">
<td id="stub_1_37" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Tochigi</td>
<td class="gt_row gt_right" headers="stub_1_37 Kochi">0.409</td>
<td class="gt_row gt_right" headers="stub_1_37 Shimane">0.338</td>
<td class="gt_row gt_right" headers="stub_1_37 Tokushima">1.366</td>
<td class="gt_row gt_right" headers="stub_1_37 Tottori">−0.143</td>
</tr>
<tr class="even">
<td id="stub_1_38" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Tokyo</td>
<td class="gt_row gt_right" headers="stub_1_38 Kochi">0.619</td>
<td class="gt_row gt_right" headers="stub_1_38 Shimane">−4.424</td>
<td class="gt_row gt_right" headers="stub_1_38 Tokushima">−5.420</td>
<td class="gt_row gt_right" headers="stub_1_38 Tottori">1.301</td>
</tr>
<tr class="odd">
<td id="stub_1_39" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Toyama</td>
<td class="gt_row gt_right" headers="stub_1_39 Kochi">−0.819</td>
<td class="gt_row gt_right" headers="stub_1_39 Shimane">4.384</td>
<td class="gt_row gt_right" headers="stub_1_39 Tokushima">5.389</td>
<td class="gt_row gt_right" headers="stub_1_39 Tottori">−1.467</td>
</tr>
<tr class="even">
<td id="stub_1_40" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Wakayama</td>
<td class="gt_row gt_right" headers="stub_1_40 Kochi">−0.050</td>
<td class="gt_row gt_right" headers="stub_1_40 Shimane">−1.103</td>
<td class="gt_row gt_right" headers="stub_1_40 Tokushima">−1.730</td>
<td class="gt_row gt_right" headers="stub_1_40 Tottori">0.323</td>
</tr>
<tr class="odd">
<td id="stub_1_41" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Yamagata</td>
<td class="gt_row gt_right" headers="stub_1_41 Kochi">0.652</td>
<td class="gt_row gt_right" headers="stub_1_41 Shimane">−1.077</td>
<td class="gt_row gt_right" headers="stub_1_41 Tokushima">−0.815</td>
<td class="gt_row gt_right" headers="stub_1_41 Tottori">0.508</td>
</tr>
<tr class="even">
<td id="stub_1_42" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Yamaguchi</td>
<td class="gt_row gt_right" headers="stub_1_42 Kochi">−1.048</td>
<td class="gt_row gt_right" headers="stub_1_42 Shimane">1.821</td>
<td class="gt_row gt_right" headers="stub_1_42 Tokushima">0.402</td>
<td class="gt_row gt_right" headers="stub_1_42 Tottori">−0.382</td>
</tr>
<tr class="odd">
<td id="stub_1_43" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Yamanashi</td>
<td class="gt_row gt_right" headers="stub_1_43 Kochi">−0.444</td>
<td class="gt_row gt_right" headers="stub_1_43 Shimane">2.064</td>
<td class="gt_row gt_right" headers="stub_1_43 Tokushima">1.486</td>
<td class="gt_row gt_right" headers="stub_1_43 Tottori">−0.274</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">脚注</h2>

<ol>
<li id="fn1"><p><code>fixed_effects</code>引数でなく、回帰式に説明変数として指定しても結果は同じである。しかし、回帰式に書く場合、固定効果の推定値も全て出力され、推定結果が非常に長くなる。しかし、固定効果の推定値は論文内で報告することもない。<code>fixed_effects</code>で指定すると、それらの結果は省略される。<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>{gsynth}は通常のSCMでなく、一般化SCM（Generalized Synthetic Control Method）を実装したパッケージである。通常のSCMは処置群は1つのみに使えるが、一般化SCMは処置群が複数あっても使える。一般化SCMについてはYiqing Xu. 2017. “<a href="https://www.cambridge.org/core/journals/political-analysis/article/generalized-synthetic-control-method-causal-inference-with-interactive-fixed-effects-models/B63A8BD7C239DD4141C67DA10CD0E4F3#article">Generalized Synthetic Control Method: Causal Inference with Interactive Fixed Effects Models</a>,” <em>Political Analysis,</em> 25 (1): 57-76.を参照されたい。<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>第7〜23回参院選のデータは<a href="http://db.cps.kutc.kansai-u.ac.jp/">参議院議員通常選挙データベース</a>からダウンロードしたものを架空したものであり、第24〜26回データは宋が手入力したものである。<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "コピーしました");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "コピーしました");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/www\.jaysong\.net\/kobe-ci\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
        for (let i=0; i<annoteTargets.length; i++) {
          const annoteTarget = annoteTargets[i];
          const targetCell = annoteTarget.getAttribute("data-target-cell");
          const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
          const contentFn = () => {
            const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            if (content) {
              const tipContent = content.cloneNode(true);
              tipContent.classList.add("code-annotation-tip-content");
              return tipContent.outerHTML;
            }
          }
          const config = {
            allowHTML: true,
            content: contentFn,
            onShow: (instance) => {
              selectCodeLines(instance.reference);
              instance.reference.classList.add('code-annotation-active');
              window.tippy.hideAll();
            },
            onHide: (instance) => {
              unselectCodeLines();
              instance.reference.classList.remove('code-annotation-active');
            },
            maxWidth: 300,
            delay: [50, 0],
            duration: [200, 0],
            offset: [5, 10],
            arrow: true,
            appendTo: function(el) {
              return el.parentElement.parentElement.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'quarto',
            placement: 'right',
            popperOptions: {
              modifiers: [
              {
                name: 'flip',
                options: {
                  flipVariations: false, // true by default
                  allowedAutoPlacements: ['right'],
                  fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                },
              },
              {
                name: 'preventOverflow',
                options: {
                  mainAxis: false,
                  altAxis: false
                }
              }
              ]        
            }      
          };
          window.tippy(annoteTarget, config); 
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../material/matching.html" class="pagination-link" aria-label="マッチング">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">マッチング</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../material/rdd.html" class="pagination-link" aria-label="回帰不連続デザイン">
        <span class="nav-page-text">回帰不連続デザイン</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2025, <a href="https://www.jaysong.net" target="_blank">Jaehyun Song</a>. Powered by <a href="https://quarto.org/" target="_blank">Quarto</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.jaysong.net">
      <i class="bi bi-house-fill" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/JaehyunSong">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>