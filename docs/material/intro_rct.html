<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>因果推論の考え方とランダム化比較試験 – Causal Inference@Kobe</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../material/matching.html" rel="next">
<link href="../figs/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-f7d2b2980468318b04e0c52838f8e54f.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-12bcd91ec681f8805fea2ef15e4b1634.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "一致なし",
    "search-matching-documents-text": "一致した文書",
    "search-copy-link-title": "検索へのリンクをコピー",
    "search-hide-matches-text": "追加の検索結果を非表示",
    "search-more-match-text": "追加の検索結果",
    "search-more-matches-text": "追加の検索結果",
    "search-clear-button-title": "消去",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "検索",
    "search-label": "サーチ"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-9F94XL4N4M"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-9F94XL4N4M', { 'anonymize_ip': true});
</script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&amp;display=swap" rel="stylesheet"> 
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Mono&amp;display=swap" rel="stylesheet"> 

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="Jaehyun Song, Ph.D.">
<meta property="og:description" content="Causal Inference@Kobe">
<meta property="og:image" content="https://www.jaysong.net/kobe-ci/material/imgs/favicon.png">
<meta property="og:site_name" content="Causal Inference@Kobe">
<meta name="twitter:title" content="Jaehyun Song, Ph.D.">
<meta name="twitter:description" content="Causal Inference@Kobe">
<meta name="twitter:image" content="https://www.jaysong.net/kobe-ci/material/imgs/favicon.png">
<meta name="twitter:creator" content="@Tintstyle">
<meta name="twitter:site" content="@Tintstyle">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../figs/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Causal Inference@Kobe</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="サーチ"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="ナビゲーションを切り替える" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">シラバス</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-">    
        <li>
    <a class="dropdown-item" href="../syllabus/syllabus.html">
 <span class="dropdown-text">シラバス</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../syllabus/dataset.html">
 <span class="dropdown-text">データセットについて</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-rの使い方" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Rの使い方</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-rの使い方">    
        <li>
    <a class="dropdown-item" href="../intro/install.html">
 <span class="dropdown-text">Rの導入</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../intro/project.html">
 <span class="dropdown-text">プロジェクト管理</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../intro/file.html">
 <span class="dropdown-text">ファイル管理</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../intro/filesystem.html">
 <span class="dropdown-text">ファイル・システム</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../intro/packages.html">
 <span class="dropdown-text">パッケージ</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu--1" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">講義資料</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu--1">    
        <li>
    <a class="dropdown-item" href="../material/intro_rct.html">
 <span class="dropdown-text">因果推論の考え方とランダム化比較試験</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../material/matching.html">
 <span class="dropdown-text">マッチング</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../material/did.html">
 <span class="dropdown-text">差分の差分法</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../material/rdd.html">
 <span class="dropdown-text">回帰不連続デザイン</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://jupyter.cs.rcos.nii.ac.jp/" target="_blank"> <i class="bi bi-terminal" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.jaysong.net/RBook/" target="_blank"> <i class="bi bi-book" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="サイドバーを切り替える" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../material/intro_rct.html">因果推論の考え方とランダム化比較試験</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="サイドバーを切り替える" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../material/intro_rct.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">因果推論の考え方とランダム化比較試験</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../material/matching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">マッチング</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../material/did.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">差分の差分法</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../material/rdd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">回帰不連続デザイン</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目次</h2>
   
  <ul>
  <li><a href="#スライド" id="toc-スライド" class="nav-link active" data-scroll-target="#スライド">スライド</a></li>
  <li><a href="#パッケージ" id="toc-パッケージ" class="nav-link" data-scroll-target="#パッケージ">パッケージ</a></li>
  <li><a href="#データの読み込み" id="toc-データの読み込み" class="nav-link" data-scroll-target="#データの読み込み">データの読み込み</a></li>
  <li><a href="#データハンドリング" id="toc-データハンドリング" class="nav-link" data-scroll-target="#データハンドリング">データハンドリング</a></li>
  <li><a href="#記述統計量" id="toc-記述統計量" class="nav-link" data-scroll-target="#記述統計量">記述統計量</a></li>
  <li><a href="#バランスチェック" id="toc-バランスチェック" class="nav-link" data-scroll-target="#バランスチェック">バランスチェック</a></li>
  <li><a href="#処置効果の推定" id="toc-処置効果の推定" class="nav-link" data-scroll-target="#処置効果の推定">処置効果の推定</a>
  <ul class="collapse">
  <li><a href="#グループごとの応答変数の平均値" id="toc-グループごとの応答変数の平均値" class="nav-link" data-scroll-target="#グループごとの応答変数の平均値">グループごとの応答変数の平均値</a></li>
  <li><a href="#統計的推定単回帰分析" id="toc-統計的推定単回帰分析" class="nav-link" data-scroll-target="#統計的推定単回帰分析">統計的推定（単回帰分析）</a></li>
  <li><a href="#多重比較の問題" id="toc-多重比較の問題" class="nav-link" data-scroll-target="#多重比較の問題">多重比較の問題</a></li>
  <li><a href="#統計的推定重回帰分析" id="toc-統計的推定重回帰分析" class="nav-link" data-scroll-target="#統計的推定重回帰分析">統計的推定（重回帰分析）</a></li>
  </ul></li>
  <li><a href="#番外編" id="toc-番外編" class="nav-link" data-scroll-target="#番外編">番外編</a>
  <ul class="collapse">
  <li><a href="#複数モデルの出力" id="toc-複数モデルの出力" class="nav-link" data-scroll-target="#複数モデルの出力">複数モデルの出力</a></li>
  <li><a href="#交互作用" id="toc-交互作用" class="nav-link" data-scroll-target="#交互作用">交互作用</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">因果推論の考え方とランダム化比較試験</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="スライド" class="level2">
<h2 class="anchored" data-anchor-id="スライド">スライド</h2>
<p><a href="../slide/intro_rct.html" class="btn btn-primary btn-sm" target="_blank" role="button"><i class="bi bi-window"></i> 新しいタブで開く</a></p>
<iframe class="slide-deck" src="../slide/intro_rct.html" width="100%" style="aspect-ratio: 16 / 9.2;"></iframe>
</section>
<section id="パッケージ" class="level2">
<h2 class="anchored" data-anchor-id="パッケージ">パッケージ</h2>
<p>　通常、Rでのパッケージのインストールとアップデートは<code>install.packages()</code>関数、読み込みは<code>library()</code>、または<code>require()</code>関数を使う。一つ注意すべき点は<code>install.packages()</code>の場合、R公式レポジトリであるCRANに登録されているパッケージのみが対象となっている点だ。しかし、今はCRANでなくGitHub上で公開されているパッケージも非常に多い。これらパッケージは{devtools}か{remote}パッケージを使う。これらの関数を使い分けることは面倒なので、本講義ではこれらの処理を統合した{pacman}パッケージを使用する。まずは、{pacman}パッケージをインストールする。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　まず、CRANに登録されているパッケージを読み込む際は、<code>pacman::p_load(読み込むパッケージ名)</code>を入力する<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>。インストールされていない場合は、自動的にCRANからダウンロード&amp;インストールした上で読み込んでくれるので便利だ<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>。以下では本講義で使用するパッケージとして{tidyverse}、{summarytools}、{fastDummies}、{modelsummary}、{broom}を読み込む。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># pacman::p_load(tidyverse, summarytools, fastDummies, modelsummary, broom) もOK</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, </span>
<span id="cb2-3"><a href="#cb2-3"></a>               summarytools, </span>
<span id="cb2-4"><a href="#cb2-4"></a>               fastDummies,</span>
<span id="cb2-5"><a href="#cb2-5"></a>               modelsummary,</span>
<span id="cb2-6"><a href="#cb2-6"></a>               broom)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　CRANでなく、GitHub上で公開されているパッケージを使う場合は<code>pacman::p_load_gh()</code>を使用する。<code>()</code>の中には<code>"ユーザー名/リポジトリ名"</code>を入力する。たとえば、{BalanceR}の作成者のGitHubアカウント名は<code>JaehyunSong</code>であり、{BalanceR}のリポジトリ名は<code>BalanceR</code>だから、以下のように入力する。<code>p_load()</code>とは違って、文字列は<code>"</code>で囲む必要があることに注意しよう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>pacman<span class="sc">::</span><span class="fu">p_load_gh</span>(<span class="st">"JaehyunSong/BalanceR"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="データの読み込み" class="level2">
<h2 class="anchored" data-anchor-id="データの読み込み">データの読み込み</h2>
<p>　<code>.csv</code>形式のデータを読み込むには<code>read_csv()</code>関数を使用する<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>。<code>()</code>内には読み込むファイルのパスを<code>"</code>で囲んで記入する。<code>read_csv()</code>関数はファイルの読み込み<strong>のみ</strong>の機能しか持たない。現在の作業環境内に読み込んだデータを格納するためには代入演算子<code>&lt;-</code>を使う。ここでは<code>data</code>フォルダー内の<code>intro_data3.csv</code>を読み込み、<code>raw_df</code>という名のオブジェクトとしてく格納する。作業環境内のオブジェクトはRを再起動すると削除されるため、改めてパッケージ・データの読み込みが必要だ。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>raw_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/intro_data3.csv"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　オブジェクトの中身を出力するためにはオブジェクト名を入力する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>raw_df</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344,084 × 8
   treatment  gender   yob hh_size voted2000 voted2002 voted2004 voted2006
   &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    
 1 Civic Duty male    1941       2 no        yes       no        no       
 2 Civic Duty female  1947       2 no        yes       no        no       
 3 Hawthorne  male    1951       3 no        yes       no        yes      
 4 Hawthorne  female  1950       3 no        yes       no        yes      
 5 Hawthorne  female  1982       3 no        yes       no        yes      
 6 Control    male    1981       3 no        no        no        no       
 7 Control    female  1959       3 no        yes       no        yes      
 8 Control    male    1956       3 no        yes       no        yes      
 9 Control    female  1968       2 no        yes       no        no       
10 Control    male    1967       2 no        yes       no        no       
# ℹ 344,074 more rows</code></pre>
</div>
</div>
<p>　表形式データの大きさ（行の列の数）の確認には<code>dim()</code>関数を使う。長さ2のnumeric（数値）型ベクトルが返され、それぞれデータセットの行と列の数を意味する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">dim</span>(raw_df)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 344084      8</code></pre>
</div>
</div>
<p>　表形式データの場合、各列には名前が付いており、それぞれが一つの変数に該当する。これら変数名のみの出力には<code>names()</code>関数を使う。今回のデータだと、列の数が少ないこともあり、一画面に全列が表示されるが、数百列のデータとなると画面に収まらないので、変数名を確認しておくことを推奨する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">names</span>(raw_df)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "treatment" "gender"    "yob"       "hh_size"   "voted2000" "voted2002"
[7] "voted2004" "voted2006"</code></pre>
</div>
</div>
</section>
<section id="データハンドリング" class="level2">
<h2 class="anchored" data-anchor-id="データハンドリング">データハンドリング</h2>
<p>　パイプ演算子には{magrittr}パッケージが提供する<code>%&gt;%</code>とR 4.1から提供されるネイティブパイプ演算子の<code>|&gt;</code>がある。現在の主流は古くから使われてきた<code>%&gt;%</code>であるが、今後、<code>|&gt;</code>が主流になると考えられるため、本講義では<code>|&gt;</code>を使用する。しかし、多くの場合、<code>|&gt;</code>の代わりに<code>%&gt;%</code>を使っても同じ結果が得られる。</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
パイプ演算子のショートカットキー
</div>
</div>
<div class="callout-body-container callout-body">
<p>　Rのnativeパイプ演算子（<code>|&gt;</code>）は意外と打ちにくい。ショートカットキーを活用しよう。</p>
<ul>
<li>macOS：Cmd（⌘） + Shift + m</li>
<li>Windows：Ctrl（Control） + Shift + m</li>
</ul>
</div>
</div>
<p>　パイプ演算子はパイプ前のオブジェクトを、パイプ後の関数の<strong>第一引数</strong>として渡す単純な演算子だ。たとえば、列名を変更する関数は<code>rename()</code>であるが、使い方は<code>renames(データ名, 新しい列名 = 既存の列名, ...)</code>である。<code>raw_df</code>の<code>gender</code>列の名前を<code>female</code>に変更する場合は以下のように書く。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">rename</span>(raw_df, <span class="at">female =</span> gender)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344,084 × 8
   treatment  female   yob hh_size voted2000 voted2002 voted2004 voted2006
   &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    
 1 Civic Duty male    1941       2 no        yes       no        no       
 2 Civic Duty female  1947       2 no        yes       no        no       
 3 Hawthorne  male    1951       3 no        yes       no        yes      
 4 Hawthorne  female  1950       3 no        yes       no        yes      
 5 Hawthorne  female  1982       3 no        yes       no        yes      
 6 Control    male    1981       3 no        no        no        no       
 7 Control    female  1959       3 no        yes       no        yes      
 8 Control    male    1956       3 no        yes       no        yes      
 9 Control    female  1968       2 no        yes       no        no       
10 Control    male    1967       2 no        yes       no        no       
# ℹ 344,074 more rows</code></pre>
</div>
</div>
<p>　ここで第1引数が<code>raw_df</code>だが、パイプ演算子を使うと以下のようになり、人間にとって読みやすいコードになる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>raw_df <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="fu">rename</span>(<span class="at">female =</span> gender)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344,084 × 8
   treatment  female   yob hh_size voted2000 voted2002 voted2004 voted2006
   &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    
 1 Civic Duty male    1941       2 no        yes       no        no       
 2 Civic Duty female  1947       2 no        yes       no        no       
 3 Hawthorne  male    1951       3 no        yes       no        yes      
 4 Hawthorne  female  1950       3 no        yes       no        yes      
 5 Hawthorne  female  1982       3 no        yes       no        yes      
 6 Control    male    1981       3 no        no        no        no       
 7 Control    female  1959       3 no        yes       no        yes      
 8 Control    male    1956       3 no        yes       no        yes      
 9 Control    female  1968       2 no        yes       no        no       
10 Control    male    1967       2 no        yes       no        no       
# ℹ 344,074 more rows</code></pre>
</div>
</div>
<p>　要するに、<code>X |&gt; Y</code>は「<code>X</code>（の結果）を使って<code>Y</code>を行う」ことを意味する。より詳しいパイプ演算子の解説は『私たちのR』の「<a href="https://www.jaysong.net/RBook/datahandling1.html#sec-handling1-pipe">データハンドリング [抽出]</a>」を参照されたい。</p>
<p>　続いて、変数のリコーディングをしてみよう。<code>x</code>の値が<code>"A"</code>なら1、それ以外は0のように、戻り値が2種類の場合、<code>if_else()</code>関数でリコーディングする。書き方は以下の通りだ。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">if_else</span>(条件式, 条件が満たされる場合の戻り値, 条件が満たされない場合の戻り値)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　たとえば、<code>raw_df</code>の<code>gender</code>列の値が<code>"female"</code>なら1、それ以外なら0とし、その結果を<code>female</code>列として追加するコードは以下の通り。同値を意味する演算子が<code>=</code>でなく、<code>==</code>であることに注意すること（<code>=</code>は<code>&lt;-</code>と同じ代入演算子であるが、Rでは代入演算子として<code>=</code>より<code>&lt;-</code>の使用を推奨している）。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">mutate</span>(raw_df, </span>
<span id="cb16-2"><a href="#cb16-2"></a>       <span class="at">female =</span> <span class="fu">if_else</span>(gender <span class="sc">==</span> <span class="st">"female"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344,084 × 9
   treatment gender   yob hh_size voted2000 voted2002 voted2004 voted2006 female
   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;
 1 Civic Du… male    1941       2 no        yes       no        no             0
 2 Civic Du… female  1947       2 no        yes       no        no             1
 3 Hawthorne male    1951       3 no        yes       no        yes            0
 4 Hawthorne female  1950       3 no        yes       no        yes            1
 5 Hawthorne female  1982       3 no        yes       no        yes            1
 6 Control   male    1981       3 no        no        no        no             0
 7 Control   female  1959       3 no        yes       no        yes            1
 8 Control   male    1956       3 no        yes       no        yes            0
 9 Control   female  1968       2 no        yes       no        no             1
10 Control   male    1967       2 no        yes       no        no             0
# ℹ 344,074 more rows</code></pre>
</div>
</div>
<p>　<code>mutate()</code>は指定された列に対して何らかの処理を行い、その結果を新しい列として追加するか、上書きする関数である。この<code>mutate()</code>関数の第1引数もデータであるため、以下のようにパイプ演算子を使うこともできる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>raw_df <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="fu">mutate</span>(<span class="at">female =</span> <span class="fu">if_else</span>(gender <span class="sc">==</span> <span class="st">"female"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344,084 × 9
   treatment gender   yob hh_size voted2000 voted2002 voted2004 voted2006 female
   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;
 1 Civic Du… male    1941       2 no        yes       no        no             0
 2 Civic Du… female  1947       2 no        yes       no        no             1
 3 Hawthorne male    1951       3 no        yes       no        yes            0
 4 Hawthorne female  1950       3 no        yes       no        yes            1
 5 Hawthorne female  1982       3 no        yes       no        yes            1
 6 Control   male    1981       3 no        no        no        no             0
 7 Control   female  1959       3 no        yes       no        yes            1
 8 Control   male    1956       3 no        yes       no        yes            0
 9 Control   female  1968       2 no        yes       no        no             1
10 Control   male    1967       2 no        yes       no        no             0
# ℹ 344,074 more rows</code></pre>
</div>
</div>
<p>　また、<code>mutate()</code>内には複数のコードを書くこともできる。<code>voted2000</code>列から<code>voted2006</code>列までそれぞれの値が<code>"yes"</code>であれば、1を、それ以外の場合は0にリコーディングしてみよう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>raw_df <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="fu">mutate</span>(<span class="at">female    =</span> <span class="fu">if_else</span>(gender    <span class="sc">==</span> <span class="st">"female"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-3"><a href="#cb20-3"></a>         <span class="at">voted2000 =</span> <span class="fu">if_else</span>(voted2000 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-4"><a href="#cb20-4"></a>         <span class="at">voted2002 =</span> <span class="fu">if_else</span>(voted2002 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-5"><a href="#cb20-5"></a>         <span class="at">voted2004 =</span> <span class="fu">if_else</span>(voted2004 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb20-6"><a href="#cb20-6"></a>         <span class="at">voted2006 =</span> <span class="fu">if_else</span>(voted2006 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344,084 × 9
   treatment gender   yob hh_size voted2000 voted2002 voted2004 voted2006 female
   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;
 1 Civic Du… male    1941       2         0         1         0         0      0
 2 Civic Du… female  1947       2         0         1         0         0      1
 3 Hawthorne male    1951       3         0         1         0         1      0
 4 Hawthorne female  1950       3         0         1         0         1      1
 5 Hawthorne female  1982       3         0         1         0         1      1
 6 Control   male    1981       3         0         0         0         0      0
 7 Control   female  1959       3         0         1         0         1      1
 8 Control   male    1956       3         0         1         0         1      0
 9 Control   female  1968       2         0         1         0         0      1
10 Control   male    1967       2         0         1         0         0      0
# ℹ 344,074 more rows</code></pre>
</div>
</div>
<p>　また、パイプ演算子は2つ以上使うこともできる。たとえば、<code>rename()</code>を使って<code>gender</code>列を<code>female</code>に変更し、<code>mutate()</code>でリコーディングを行う場合、以下のように書く。これは<code>raw_df</code>を使って<code>rename()</code>の処理を行い、その結果を<code>mutate()</code>関数のデータとして渡すことを意味する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>raw_df <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>  <span class="fu">rename</span>(<span class="at">female =</span> gender) <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="fu">mutate</span>(<span class="at">female    =</span> <span class="fu">if_else</span>(female    <span class="sc">==</span> <span class="st">"female"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb22-4"><a href="#cb22-4"></a>         <span class="at">voted2000 =</span> <span class="fu">if_else</span>(voted2000 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb22-5"><a href="#cb22-5"></a>         <span class="at">voted2002 =</span> <span class="fu">if_else</span>(voted2002 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb22-6"><a href="#cb22-6"></a>         <span class="at">voted2004 =</span> <span class="fu">if_else</span>(voted2004 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb22-7"><a href="#cb22-7"></a>         <span class="at">voted2006 =</span> <span class="fu">if_else</span>(voted2006 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344,084 × 8
   treatment  female   yob hh_size voted2000 voted2002 voted2004 voted2006
   &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 Civic Duty      0  1941       2         0         1         0         0
 2 Civic Duty      1  1947       2         0         1         0         0
 3 Hawthorne       0  1951       3         0         1         0         1
 4 Hawthorne       1  1950       3         0         1         0         1
 5 Hawthorne       1  1982       3         0         1         0         1
 6 Control         0  1981       3         0         0         0         0
 7 Control         1  1959       3         0         1         0         1
 8 Control         0  1956       3         0         1         0         1
 9 Control         1  1968       2         0         1         0         0
10 Control         0  1967       2         0         1         0         0
# ℹ 344,074 more rows</code></pre>
</div>
</div>
<p>　以上のコードはデータを加工し、その結果を<strong>出力するだけ</strong>であって、その結果を保存しない。もう一度<code>raw_df</code>を出力してみても、これまでのデータ加工内容は反映されていないことが分かる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>raw_df</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344,084 × 8
   treatment  gender   yob hh_size voted2000 voted2002 voted2004 voted2006
   &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    
 1 Civic Duty male    1941       2 no        yes       no        no       
 2 Civic Duty female  1947       2 no        yes       no        no       
 3 Hawthorne  male    1951       3 no        yes       no        yes      
 4 Hawthorne  female  1950       3 no        yes       no        yes      
 5 Hawthorne  female  1982       3 no        yes       no        yes      
 6 Control    male    1981       3 no        no        no        no       
 7 Control    female  1959       3 no        yes       no        yes      
 8 Control    male    1956       3 no        yes       no        yes      
 9 Control    female  1968       2 no        yes       no        no       
10 Control    male    1967       2 no        yes       no        no       
# ℹ 344,074 more rows</code></pre>
</div>
</div>
<p>　このように頑張ってデータを加工したもののその結果が全く反映されていない。加工したデータを引き続き使っていくためには、加工結果を作業環境内に保存する必要がある。作業環境内にオブジェクトを保存するためには代入演算子（<code>&lt;-</code>）を使い、名前を付けて作業空間内に保存する（ファイルとして保存されるわけではない）必要がある。今回は加工の結果を<code>df</code>という名で保存する。<code>raw_df</code>に上書きしても問題はないが、生データはとりあえず作業空間内に残しておくことを推奨する（Rに慣れれば上書きしても良い）。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>df <span class="ot">&lt;-</span> raw_df <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="fu">rename</span>(<span class="at">female =</span> gender) <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="fu">mutate</span>(<span class="at">female    =</span> <span class="fu">if_else</span>(female    <span class="sc">==</span> <span class="st">"female"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb26-4"><a href="#cb26-4"></a>         <span class="at">voted2000 =</span> <span class="fu">if_else</span>(voted2000 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb26-5"><a href="#cb26-5"></a>         <span class="at">voted2002 =</span> <span class="fu">if_else</span>(voted2002 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb26-6"><a href="#cb26-6"></a>         <span class="at">voted2004 =</span> <span class="fu">if_else</span>(voted2004 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb26-7"><a href="#cb26-7"></a>         <span class="at">voted2006 =</span> <span class="fu">if_else</span>(voted2006 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb26-8"><a href="#cb26-8"></a></span>
<span id="cb26-9"><a href="#cb26-9"></a>df</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344,084 × 8
   treatment  female   yob hh_size voted2000 voted2002 voted2004 voted2006
   &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 Civic Duty      0  1941       2         0         1         0         0
 2 Civic Duty      1  1947       2         0         1         0         0
 3 Hawthorne       0  1951       3         0         1         0         1
 4 Hawthorne       1  1950       3         0         1         0         1
 5 Hawthorne       1  1982       3         0         1         0         1
 6 Control         0  1981       3         0         0         0         0
 7 Control         1  1959       3         0         1         0         1
 8 Control         0  1956       3         0         1         0         1
 9 Control         1  1968       2         0         1         0         0
10 Control         0  1967       2         0         1         0         0
# ℹ 344,074 more rows</code></pre>
</div>
</div>
<p>　ちなみに、<code>across()</code>関数とラムダ式（無名関数）を組み合わせると以上のコードをより効率的に書くこともできる。<code>across()</code>は強力な関数だが、初心者にはやや難しいかも知れない。詳細は『私たちのR』の<a href="https://www.jaysong.net/RBook/datahandling2.html#handling2-summarise">第13.1章</a>を参照されたい。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>df <span class="ot">&lt;-</span> raw_df <span class="sc">|&gt;</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>  <span class="fu">rename</span>(<span class="at">female =</span> gender) <span class="sc">|&gt;</span></span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="fu">mutate</span>(<span class="at">female =</span> <span class="fu">if_else</span>(female <span class="sc">==</span> <span class="st">"female"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb28-4"><a href="#cb28-4"></a>         <span class="co"># 第1引数: votedで始まる変数を対象に処理を行う</span></span>
<span id="cb28-5"><a href="#cb28-5"></a>         <span class="co"># 第2引数: 当該変数の値が"yes"なら1、それ以外なら0を割り当てる無名関数</span></span>
<span id="cb28-6"><a href="#cb28-6"></a>         <span class="co">#          無名関数は「~」で始まり、変数が入る箇所は.xと表記する</span></span>
<span id="cb28-7"><a href="#cb28-7"></a>         <span class="co">#          引数が当該変数のみであれば、「~」を付けずに関数のみでもOK</span></span>
<span id="cb28-8"><a href="#cb28-8"></a>         <span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"voted"</span>), <span class="sc">~</span><span class="fu">if_else</span>(.x <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>)))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="記述統計量" class="level2">
<h2 class="anchored" data-anchor-id="記述統計量">記述統計量</h2>
<p>　記述統計量の計算には{summarytools}の<code>descr()</code>関数が便利だ。<code>descr(データ名)</code>を入力するだけで各変数の記述統計量が出力される。実際にやってみると分かるが、情報量がかなり多い。しかし、実際の論文では各変数の歪度や尖度まで報告することはあまりないだろう。ここでは<code>stats</code>引数を追加して、論文などでよく使う平均値（<code>"mean"</code>）、標準偏差（<code>"sd"</code>）、最小値（<code>"min"</code>）、最大値（<code>"max"</code>）、有効ケース数（<code>"n.valid"</code>）のみ出力する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>  <span class="fu">descr</span>(<span class="at">stats =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="st">"min"</span>, <span class="st">"max"</span>, <span class="st">"n.valid"</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Descriptive Statistics  
df  
N: 344084  

                   female     hh_size   voted2000   voted2002   voted2004   voted2006         yob
------------- ----------- ----------- ----------- ----------- ----------- ----------- -----------
         Mean        0.50        2.18        0.25        0.39        0.40        0.32     1956.21
      Std.Dev        0.50        0.79        0.43        0.49        0.49        0.46       14.45
          Min        0.00        1.00        0.00        0.00        0.00        0.00     1900.00
          Max        1.00        8.00        1.00        1.00        1.00        1.00     1986.00
      N.Valid   344084.00   344084.00   344084.00   344084.00   344084.00   344084.00   344084.00</code></pre>
</div>
</div>
<p>　ただし、<code>descr()</code>を使うと数値型（numeric）変数の記述統計量のみ表示される。<code>df</code>だと、<code>treatment</code>列は文字型（character）であるため、表示されない<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>。各グループがサンプルの何割かを計算するためには、<code>treatment</code>変数をダミー変数へ変換する必要がある。ダミー変数の作成は面倒な作業であるが、{fastDummies}パッケージの<code>dummy_cols()</code>を使えば簡単にできる。<code>dummy_cols()</code>の中には<code>select_columns = "ダミー化する列名"</code>を入れれば、当該変数をダミー変数へ変換し、新しい列として追加してくれる。それでは<code>treatment</code>列をダミー化&amp;追加し、その結果を<code>df</code>に上書きしてみよう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>  <span class="fu">dummy_cols</span>(<span class="at">select_columns =</span> <span class="st">"treatment"</span>)</span>
<span id="cb31-3"><a href="#cb31-3"></a></span>
<span id="cb31-4"><a href="#cb31-4"></a>df</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344,084 × 13
   treatment  female   yob hh_size voted2000 voted2002 voted2004 voted2006
   &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 Civic Duty      0  1941       2         0         1         0         0
 2 Civic Duty      1  1947       2         0         1         0         0
 3 Hawthorne       0  1951       3         0         1         0         1
 4 Hawthorne       1  1950       3         0         1         0         1
 5 Hawthorne       1  1982       3         0         1         0         1
 6 Control         0  1981       3         0         0         0         0
 7 Control         1  1959       3         0         1         0         1
 8 Control         0  1956       3         0         1         0         1
 9 Control         1  1968       2         0         1         0         0
10 Control         0  1967       2         0         1         0         0
# ℹ 344,074 more rows
# ℹ 5 more variables: `treatment_Civic Duty` &lt;int&gt;, treatment_Control &lt;int&gt;,
#   treatment_Hawthorne &lt;int&gt;, treatment_Neighbors &lt;int&gt;, treatment_Self &lt;int&gt;</code></pre>
</div>
</div>
<p>　画面には表示されないが、出力結果の下段を見ると<code>treatment_</code>で始まるいくつかの変数が追加されたことが分かる。ここでは<code>"tretmant"</code>で始まる列のみを抽出つして確認してみよう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"treatment"</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344,084 × 6
   treatment  `treatment_Civic Duty` treatment_Control treatment_Hawthorne
   &lt;chr&gt;                       &lt;int&gt;             &lt;int&gt;               &lt;int&gt;
 1 Civic Duty                      1                 0                   0
 2 Civic Duty                      1                 0                   0
 3 Hawthorne                       0                 0                   1
 4 Hawthorne                       0                 0                   1
 5 Hawthorne                       0                 0                   1
 6 Control                         0                 1                   0
 7 Control                         0                 1                   0
 8 Control                         0                 1                   0
 9 Control                         0                 1                   0
10 Control                         0                 1                   0
# ℹ 344,074 more rows
# ℹ 2 more variables: treatment_Neighbors &lt;int&gt;, treatment_Self &lt;int&gt;</code></pre>
</div>
</div>
<p>　<code>select()</code>関数内には抽出する列名を入力するだけで良い。たとえば、<code>female</code>と<code>yob</code>列を抽出するなら<code>select(female, yob)</code>である。また、<code>female</code><strong>から</strong><code>voted2006</code><strong>まで</strong>の意味で<code>female:voted2006</code>のような書き方もできる。他にも上の例のように<code>starts_with()</code>や<code>ends_with()</code>、<code>contain()</code>を使って特定の文字列で始まる（で終わる、を含む）列を指定することもできる。一部の列を除外する場合は変数名の前に<code>!</code>か<code>-</code>を付ける。</p>
<p>　とにかく、問題なくダミー化されていることが分かる。もう一度記述統計量を出してみよう。<code>descr()</code>は仕様上、出力される変数の順番はアルファベット順になるが、ここでは元の順番を維持するために<code>order = "p"</code>を追加する。また、通常の記述統計表が、先ほど見たものとは違って、各行が変数を、列は記述統計量を表す場合が多い。このように行と列を交換するためには<code>transpose = TRUE</code>を追加する<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>  <span class="fu">descr</span>(<span class="at">stats =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="st">"min"</span>, <span class="st">"max"</span>, <span class="st">"n.valid"</span>),</span>
<span id="cb35-3"><a href="#cb35-3"></a>        <span class="at">order =</span> <span class="st">"p"</span>, <span class="at">transpose =</span> <span class="cn">TRUE</span>, <span class="at">headings =</span> <span class="cn">FALSE</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">Mean</th>
<th style="text-align: right;">Std.Dev</th>
<th style="text-align: right;">Min</th>
<th style="text-align: right;">Max</th>
<th style="text-align: right;">N.Valid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>female</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">344084.00</td>
</tr>
<tr class="even">
<td>yob</td>
<td style="text-align: right;">1956.21</td>
<td style="text-align: right;">14.45</td>
<td style="text-align: right;">1900.00</td>
<td style="text-align: right;">1986.00</td>
<td style="text-align: right;">344084.00</td>
</tr>
<tr class="odd">
<td>hh_size</td>
<td style="text-align: right;">2.18</td>
<td style="text-align: right;">0.79</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">8.00</td>
<td style="text-align: right;">344084.00</td>
</tr>
<tr class="even">
<td>voted2000</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.43</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">344084.00</td>
</tr>
<tr class="odd">
<td>voted2002</td>
<td style="text-align: right;">0.39</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">344084.00</td>
</tr>
<tr class="even">
<td>voted2004</td>
<td style="text-align: right;">0.40</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">344084.00</td>
</tr>
<tr class="odd">
<td>voted2006</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">0.46</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">344084.00</td>
</tr>
<tr class="even">
<td>treatment_Civic Duty</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">344084.00</td>
</tr>
<tr class="odd">
<td>treatment_Control</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">344084.00</td>
</tr>
<tr class="even">
<td>treatment_Hawthorne</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">344084.00</td>
</tr>
<tr class="odd">
<td>treatment_Neighbors</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">344084.00</td>
</tr>
<tr class="even">
<td>treatment_Self</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">344084.00</td>
</tr>
</tbody>
</table>
</div>
<p>　他にも以下のように<code>dfSummary()</code>関数を使えば、綺麗な表としてまとめてくれる。しかも文字型、factor型変数の場合も度数分布表を作成してくれるので非常に便利だ。これも{summarytools}パッケージに含まれた機能なので、別途、パッケージを読み込む必要はない。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"treatment_"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="fu">dfSummary</span>(<span class="at">headings =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-4"><a href="#cb36-4"></a>  <span class="fu">print</span>(<span class="at">method =</span> <span class="st">"render"</span>, <span class="at">round.digits =</span> <span class="dv">3</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="container st-container">

<table class="table table-striped table-bordered st-table st-table-striped st-table-bordered st-multiline caption-top table-sm small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th class="st-protect-top-border" style="text-align: center;" data-quarto-table-cell-role="th"><strong>No</strong></th>
<th class="st-protect-top-border" style="text-align: center;" data-quarto-table-cell-role="th"><strong>Variable</strong></th>
<th class="st-protect-top-border" style="text-align: center;" data-quarto-table-cell-role="th"><strong>Stats / Values</strong></th>
<th class="st-protect-top-border" style="text-align: center;" data-quarto-table-cell-role="th"><strong>Freqs (% of Valid)</strong></th>
<th class="st-protect-top-border" style="text-align: center;" data-quarto-table-cell-role="th"><strong>Graph</strong></th>
<th class="st-protect-top-border" style="text-align: center;" data-quarto-table-cell-role="th"><strong>Valid</strong></th>
<th class="st-protect-top-border" style="text-align: center;" data-quarto-table-cell-role="th"><strong>Missing</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: left;">treatment [character]</td>
<td style="text-align: left; padding: 8; vertical-align: middle;"><table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">1. Civic Duty</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">2. Control</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">3. Hawthorne</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">4. Neighbors</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">5. Self</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; padding: 0; vertical-align: middle;"><table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: right; padding: 0 5px 0 7px; margin: 0; border: 0;">38218</td>
<td style="text-align: left; padding: 0 2px 0 0; border: 0;">(</td>
<td style="text-align: right; padding: 0; border: 0;">11.1%</td>
<td style="text-align: left; padding: 0 4px 0 2px; border: 0;">)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: right; padding: 0 5px 0 7px; margin: 0; border: 0;">191243</td>
<td style="text-align: left; padding: 0 2px 0 0; border: 0;">(</td>
<td style="text-align: right; padding: 0; border: 0;">55.6%</td>
<td style="text-align: left; padding: 0 4px 0 2px; border: 0;">)</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: right; padding: 0 5px 0 7px; margin: 0; border: 0;">38204</td>
<td style="text-align: left; padding: 0 2px 0 0; border: 0;">(</td>
<td style="text-align: right; padding: 0; border: 0;">11.1%</td>
<td style="text-align: left; padding: 0 4px 0 2px; border: 0;">)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: right; padding: 0 5px 0 7px; margin: 0; border: 0;">38201</td>
<td style="text-align: left; padding: 0 2px 0 0; border: 0;">(</td>
<td style="text-align: right; padding: 0; border: 0;">11.1%</td>
<td style="text-align: left; padding: 0 4px 0 2px; border: 0;">)</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: right; padding: 0 5px 0 7px; margin: 0; border: 0;">38218</td>
<td style="text-align: left; padding: 0 2px 0 0; border: 0;">(</td>
<td style="text-align: right; padding: 0; border: 0;">11.1%</td>
<td style="text-align: left; padding: 0 4px 0 2px; border: 0;">)</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; vertical-align: middle; padding: 0; background-color: transparent;"><img src="data:image/png;base64,%20iVBORw0KGgoAAAANSUhEUgAAAGAAAAB9CAQAAAD32a72AAAAAmJLR0QA/4ePzL8AAAAHdElNRQfoCA8DBTQAVdZxAAABB0lEQVR42u3aQQrCMBBG4UR6Rw/hefQOPaVuE7G1xcWbX963ExHmQSpkaH+2bBd6AAPoAX61jB8eXx+IW6cHbq21ccxl/uq6+8OVnvyD+CNkAM0AmgE0A2gG0AygGUAzgPZ2I6t459rXx/tliQvvAePM8UfIANr0EN9TFqXDw3pqL1TD/E8Zf4QMoBlAM4BmAM0AmgE0A2gG0OIDXGwRXGxVcnIvVON9oc0A3xcywIA8BtAMoBlAM4BmAM0AmgE090IE90KVuBeixR8hA2gG0AygGUAzgGYAzQCaAbT4APdCBPdClbgXosUfIQNoBtAMoBlAM4BmAM0AmgG0+ID/2gslij9CBtBeu/od7x9DAtEAAAA9dEVYdGljYzpjb3B5cmlnaHQAQ29weXJpZ2h0IDIwMDcgQXBwbGUgSW5jLiwgYWxsIHJpZ2h0cyByZXNlcnZlZC6eZtwpAAAAI3RFWHRpY2M6ZGVzY3JpcHRpb24AR2VuZXJpYyBSR0IgUHJvZmlsZRqnOI4AAAAASUVORK5CYII=" class="img-fluid" style="border:none;background-color:transparent;padding:0;max-width:max-content;"></td>
<td style="text-align: center;">344084 (100.0%)</td>
<td style="text-align: center;">0 (0.0%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: left;">female [numeric]</td>
<td style="text-align: left; padding: 8; vertical-align: middle;"><table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Min : 0</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Mean : 0.5</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Max : 1</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; padding: 0; vertical-align: middle;"><table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: right; padding: 0 2px 0 7px; margin: 0; border: 0;">0</td>
<td style="text-align: left; padding: 0 2px; border: 0;">:</td>
<td style="text-align: right; padding: 0 4px 0 6px; margin: 0; border: 0;">172289</td>
<td style="text-align: left; padding: 0; border: 0;">(</td>
<td style="text-align: right; padding: 0 2px; margin: 0; border: 0;">50.1%</td>
<td style="text-align: left; padding: 0 4px 0 0; border: 0;">)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: right; padding: 0 2px 0 7px; margin: 0; border: 0;">1</td>
<td style="text-align: left; padding: 0 2px; border: 0;">:</td>
<td style="text-align: right; padding: 0 4px 0 6px; margin: 0; border: 0;">171795</td>
<td style="text-align: left; padding: 0; border: 0;">(</td>
<td style="text-align: right; padding: 0 2px; margin: 0; border: 0;">49.9%</td>
<td style="text-align: left; padding: 0 4px 0 0; border: 0;">)</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; vertical-align: middle; padding: 0; background-color: transparent;"><img src="data:image/png;base64,%20iVBORw0KGgoAAAANSUhEUgAAAFgAAAA3CAQAAAAiPkUwAAAAAmJLR0QA/4ePzL8AAAAHdElNRQfoCA8DBTQAVdZxAAAAkklEQVRo3u3YsQ2AMAxE0RixIzvAPLBDpoTWiaCJFOKL/nVurFecIsV2J60sowGAo2X1wxW00Lt9gFPaRttekotJrhKAAQMGDBgw4FABDBgw4MnA1Z8ut235MeY/yta8pm+8Ua4ScuCiw2fIQ8pRNDX8IaV+BuQqARgwYMCAAQMOFcCAAQOeDKx9SFGIXCUA984D81ILx+yzmEIAAAA9dEVYdGljYzpjb3B5cmlnaHQAQ29weXJpZ2h0IDIwMDcgQXBwbGUgSW5jLiwgYWxsIHJpZ2h0cyByZXNlcnZlZC6eZtwpAAAAI3RFWHRpY2M6ZGVzY3JpcHRpb24AR2VuZXJpYyBSR0IgUHJvZmlsZRqnOI4AAAAASUVORK5CYII=" class="img-fluid" style="border:none;background-color:transparent;padding:0;max-width:max-content;"></td>
<td style="text-align: center;">344084 (100.0%)</td>
<td style="text-align: center;">0 (0.0%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: left;">yob [numeric]</td>
<td style="text-align: left; padding: 8; vertical-align: middle;"><table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Mean (sd) : 1956.2 (14.4)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">min ≤ med ≤ max:</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">1900 ≤ 1956 ≤ 1986</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">IQR (CV) : 18 (0)</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; vertical-align: middle;">86 distinct values</td>
<td style="text-align: left; vertical-align: middle; padding: 0; background-color: transparent;"><img src="data:image/png;base64,%20iVBORw0KGgoAAAANSUhEUgAAAJgAAABuCAQAAABxABKuAAAAAmJLR0QA/4ePzL8AAAAHdElNRQfoCA8DBTQAVdZxAAABx0lEQVR42u3cQZKCMBQAUbG8o3fQ8+gdPKVuQ7TUhoT8hH47NyN2zQ+BYZyeBxHH1gfQG4NBBoNO6Yup9dH87fa29F4rHnz6ZqfFP6Wx8+zVY7P3dSQhg0EGgzpZw25h9tedBGu3yOccSchgkMEgg0EGgwwGdbOt+GW+U6t3KT5MsHSfVnOX5khCBoMMBhkMCrvox7k/MRc22HbnPcaRhAwGGQwyGGQwyGCQwSCDQQaDDAYZDDIYZDDIYJDBIINBBoMMBhkMMhhkMMhgUOA/s62R/1Wz3NM8gwar98y1IwkZDAozklGfpciFCRbnfz2+cyQhg0EGgwwGGQwyGGQwyGCQwSCDQQaDAl1LtsK+x8dgB3bZ70hCBoMMBhkMarbo93JLOtfwLNnHLemcIwkZDDIYZDDIYNBOriXLPc2zk2DltjCOJGQwyGCQwaDNFv1YF9vLj2bDs2Ski+3l3+vjSEIGgwwGGQwyGFTxLBlrI1FK1W1FzC/lW8eRhAwGGQwyGFRw0R/nrPj2SZIb2kXPkpEur2t9DkcSMhhkMGjFGjbOIk+sWvRHWeQJRxJCv2H7HMK5KW1wN8hHl2TjOtmIcQ2DDAYZDHoBkgoxatSAN4MAAAA9dEVYdGljYzpjb3B5cmlnaHQAQ29weXJpZ2h0IDIwMDcgQXBwbGUgSW5jLiwgYWxsIHJpZ2h0cyByZXNlcnZlZC6eZtwpAAAAI3RFWHRpY2M6ZGVzY3JpcHRpb24AR2VuZXJpYyBSR0IgUHJvZmlsZRqnOI4AAAAASUVORK5CYII=" class="img-fluid" style="border:none;background-color:transparent;padding:0;max-width:max-content;"></td>
<td style="text-align: center;">344084 (100.0%)</td>
<td style="text-align: center;">0 (0.0%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: left;">hh_size [numeric]</td>
<td style="text-align: left; padding: 8; vertical-align: middle;"><table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Mean (sd) : 2.2 (0.8)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">min ≤ med ≤ max:</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">1 ≤ 2 ≤ 8</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">IQR (CV) : 0 (0.4)</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; padding: 0; vertical-align: middle;"><table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: right; padding: 0 2px 0 7px; margin: 0; border: 0;">1</td>
<td style="text-align: left; padding: 0 2px; border: 0;">:</td>
<td style="text-align: right; padding: 0 4px 0 6px; margin: 0; border: 0;">47834</td>
<td style="text-align: left; padding: 0; border: 0;">(</td>
<td style="text-align: right; padding: 0 2px; margin: 0; border: 0;">13.9%</td>
<td style="text-align: left; padding: 0 4px 0 0; border: 0;">)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: right; padding: 0 2px 0 7px; margin: 0; border: 0;">2</td>
<td style="text-align: left; padding: 0 2px; border: 0;">:</td>
<td style="text-align: right; padding: 0 4px 0 6px; margin: 0; border: 0;">214086</td>
<td style="text-align: left; padding: 0; border: 0;">(</td>
<td style="text-align: right; padding: 0 2px; margin: 0; border: 0;">62.2%</td>
<td style="text-align: left; padding: 0 4px 0 0; border: 0;">)</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: right; padding: 0 2px 0 7px; margin: 0; border: 0;">3</td>
<td style="text-align: left; padding: 0 2px; border: 0;">:</td>
<td style="text-align: right; padding: 0 4px 0 6px; margin: 0; border: 0;">57474</td>
<td style="text-align: left; padding: 0; border: 0;">(</td>
<td style="text-align: right; padding: 0 2px; margin: 0; border: 0;">16.7%</td>
<td style="text-align: left; padding: 0 4px 0 0; border: 0;">)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: right; padding: 0 2px 0 7px; margin: 0; border: 0;">4</td>
<td style="text-align: left; padding: 0 2px; border: 0;">:</td>
<td style="text-align: right; padding: 0 4px 0 6px; margin: 0; border: 0;">20916</td>
<td style="text-align: left; padding: 0; border: 0;">(</td>
<td style="text-align: right; padding: 0 2px; margin: 0; border: 0;">6.1%</td>
<td style="text-align: left; padding: 0 4px 0 0; border: 0;">)</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: right; padding: 0 2px 0 7px; margin: 0; border: 0;">5</td>
<td style="text-align: left; padding: 0 2px; border: 0;">:</td>
<td style="text-align: right; padding: 0 4px 0 6px; margin: 0; border: 0;">3315</td>
<td style="text-align: left; padding: 0; border: 0;">(</td>
<td style="text-align: right; padding: 0 2px; margin: 0; border: 0;">1.0%</td>
<td style="text-align: left; padding: 0 4px 0 0; border: 0;">)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: right; padding: 0 2px 0 7px; margin: 0; border: 0;">6</td>
<td style="text-align: left; padding: 0 2px; border: 0;">:</td>
<td style="text-align: right; padding: 0 4px 0 6px; margin: 0; border: 0;">402</td>
<td style="text-align: left; padding: 0; border: 0;">(</td>
<td style="text-align: right; padding: 0 2px; margin: 0; border: 0;">0.1%</td>
<td style="text-align: left; padding: 0 4px 0 0; border: 0;">)</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: right; padding: 0 2px 0 7px; margin: 0; border: 0;">7</td>
<td style="text-align: left; padding: 0 2px; border: 0;">:</td>
<td style="text-align: right; padding: 0 4px 0 6px; margin: 0; border: 0;">49</td>
<td style="text-align: left; padding: 0; border: 0;">(</td>
<td style="text-align: right; padding: 0 2px; margin: 0; border: 0;">0.0%</td>
<td style="text-align: left; padding: 0 4px 0 0; border: 0;">)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: right; padding: 0 2px 0 7px; margin: 0; border: 0;">8</td>
<td style="text-align: left; padding: 0 2px; border: 0;">:</td>
<td style="text-align: right; padding: 0 4px 0 6px; margin: 0; border: 0;">8</td>
<td style="text-align: left; padding: 0; border: 0;">(</td>
<td style="text-align: right; padding: 0 2px; margin: 0; border: 0;">0.0%</td>
<td style="text-align: left; padding: 0 4px 0 0; border: 0;">)</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; vertical-align: middle; padding: 0; background-color: transparent;"><img src="data:image/png;base64,%20iVBORw0KGgoAAAANSUhEUgAAAGoAAADECAQAAADdPnyCAAAAAmJLR0QA/4ePzL8AAAAHdElNRQfoCA8DBTQAVdZxAAABgUlEQVR42u3bYUoCURhG4Qz32CJaj+2hVdrfGY3SIrzn63n+SSBz6M6AL3o4P83z/OgLEPWfo47bF2933GCvh0df+t720o/7P73c+Bbvj2740sjjJ6pCVIWoClEVoipEVYiqEFUxMuri4/zaH9NvddgOFottKXfZdow8fiOjdvfUqTysb+6dH+5+q9k/4EYeP1EVoipEVYiqEFUhqkJUhaiKkVF2v5XZ/Yp+vfut9r2/q6j7d781Hywjj5+oClEVoipEVYiqEFUhqkJUhYlsZSayopFR3+5+K+56d0Vd737Np+HI4yeqQlSFqApRFaIqRFWIqhBVYfdbmd2vaH7U6Zz+pe/nUVOIqhBVIapCVIWoClEVoipEVYiqsPtViKq42P0efTl/EDWFqApRFaIqRFWIqhBVIapCVIWoCrtfxfwoE9nCRFWIqhBVIapCVIWoClEVoipEVYyMsvtVzI+y+y1MVIWoClEVoipEVYiqEFUhqkJUxciow5CtZWfkf0pUxQeNeCis3OJezAAAAD10RVh0aWNjOmNvcHlyaWdodABDb3B5cmlnaHQgMjAwNyBBcHBsZSBJbmMuLCBhbGwgcmlnaHRzIHJlc2VydmVkLp5m3CkAAAAjdEVYdGljYzpkZXNjcmlwdGlvbgBHZW5lcmljIFJHQiBQcm9maWxlGqc4jgAAAABJRU5ErkJggg==" class="img-fluid" style="border:none;background-color:transparent;padding:0;max-width:max-content;"></td>
<td style="text-align: center;">344084 (100.0%)</td>
<td style="text-align: center;">0 (0.0%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: left;">voted2000 [numeric]</td>
<td style="text-align: left; padding: 8; vertical-align: middle;"><table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Min : 0</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Mean : 0.3</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Max : 1</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; padding: 0; vertical-align: middle;"><table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: right; padding: 0 2px 0 7px; margin: 0; border: 0;">0</td>
<td style="text-align: left; padding: 0 2px; border: 0;">:</td>
<td style="text-align: right; padding: 0 4px 0 6px; margin: 0; border: 0;">257464</td>
<td style="text-align: left; padding: 0; border: 0;">(</td>
<td style="text-align: right; padding: 0 2px; margin: 0; border: 0;">74.8%</td>
<td style="text-align: left; padding: 0 4px 0 0; border: 0;">)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: right; padding: 0 2px 0 7px; margin: 0; border: 0;">1</td>
<td style="text-align: left; padding: 0 2px; border: 0;">:</td>
<td style="text-align: right; padding: 0 4px 0 6px; margin: 0; border: 0;">86620</td>
<td style="text-align: left; padding: 0; border: 0;">(</td>
<td style="text-align: right; padding: 0 2px; margin: 0; border: 0;">25.2%</td>
<td style="text-align: left; padding: 0 4px 0 0; border: 0;">)</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; vertical-align: middle; padding: 0; background-color: transparent;"><img src="data:image/png;base64,%20iVBORw0KGgoAAAANSUhEUgAAAH0AAAA3CAQAAACLSo2kAAAAAmJLR0QA/4ePzL8AAAAHdElNRQfoCA8DBTQAVdZxAAAAnklEQVRo3u3ZsQ2AIBQAUTDu6A46j+7AlNqiiQ0REe9eR2O45GMBcQ9UQ+sNmG76m8Z8sf3+4M/xJj2EqfXeqkqnFXjgTScynch0ItOJTCcynch0ItOJTCe63M2lsq90KeaXsLH4M73Ia8EDD04/nfX1wSeI5fOnp9ITRA+/S/DAm05kOpHpRKYTmU5kOpHpRKYTmU7kEwQReOBNJzoAJacLx1TWcigAAAA9dEVYdGljYzpjb3B5cmlnaHQAQ29weXJpZ2h0IDIwMDcgQXBwbGUgSW5jLiwgYWxsIHJpZ2h0cyByZXNlcnZlZC6eZtwpAAAAI3RFWHRpY2M6ZGVzY3JpcHRpb24AR2VuZXJpYyBSR0IgUHJvZmlsZRqnOI4AAAAASUVORK5CYII=" class="img-fluid" style="border:none;background-color:transparent;padding:0;max-width:max-content;"></td>
<td style="text-align: center;">344084 (100.0%)</td>
<td style="text-align: center;">0 (0.0%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">6</td>
<td style="text-align: left;">voted2002 [numeric]</td>
<td style="text-align: left; padding: 8; vertical-align: middle;"><table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Min : 0</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Mean : 0.4</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Max : 1</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; padding: 0; vertical-align: middle;"><table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: right; padding: 0 2px 0 7px; margin: 0; border: 0;">0</td>
<td style="text-align: left; padding: 0 2px; border: 0;">:</td>
<td style="text-align: right; padding: 0 4px 0 6px; margin: 0; border: 0;">209947</td>
<td style="text-align: left; padding: 0; border: 0;">(</td>
<td style="text-align: right; padding: 0 2px; margin: 0; border: 0;">61.0%</td>
<td style="text-align: left; padding: 0 4px 0 0; border: 0;">)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: right; padding: 0 2px 0 7px; margin: 0; border: 0;">1</td>
<td style="text-align: left; padding: 0 2px; border: 0;">:</td>
<td style="text-align: right; padding: 0 4px 0 6px; margin: 0; border: 0;">134137</td>
<td style="text-align: left; padding: 0; border: 0;">(</td>
<td style="text-align: right; padding: 0 2px; margin: 0; border: 0;">39.0%</td>
<td style="text-align: left; padding: 0 4px 0 0; border: 0;">)</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; vertical-align: middle; padding: 0; background-color: transparent;"><img src="data:image/png;base64,%20iVBORw0KGgoAAAANSUhEUgAAAGgAAAA3CAQAAABKzccIAAAAAmJLR0QA/4ePzL8AAAAHdElNRQfoCA8DBTQAVdZxAAAAn0lEQVRo3u3YsQmAMBBA0UTc0R10Ht3BKbWNgk0Q7nv+36WRPLhYXD1KroboCwj6G2hsD9tHH9RcH0ClTNF362i/nNKNnCB6gugJoieIniB6gugJoieIniB6t53C3vcVULVd9NTuz8TWGtKNXDrQ5Q2tIYvG5dVJD180vv0bSjdygugJoieIniB6gugJoieIniB6gujlXjRmKN3ICaJ3AppiC8fdrh9zAAAAPXRFWHRpY2M6Y29weXJpZ2h0AENvcHlyaWdodCAyMDA3IEFwcGxlIEluYy4sIGFsbCByaWdodHMgcmVzZXJ2ZWQunmbcKQAAACN0RVh0aWNjOmRlc2NyaXB0aW9uAEdlbmVyaWMgUkdCIFByb2ZpbGUapziOAAAAAElFTkSuQmCC" class="img-fluid" style="border:none;background-color:transparent;padding:0;max-width:max-content;"></td>
<td style="text-align: center;">344084 (100.0%)</td>
<td style="text-align: center;">0 (0.0%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">7</td>
<td style="text-align: left;">voted2004 [numeric]</td>
<td style="text-align: left; padding: 8; vertical-align: middle;"><table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Min : 0</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Mean : 0.4</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Max : 1</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; padding: 0; vertical-align: middle;"><table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: right; padding: 0 2px 0 7px; margin: 0; border: 0;">0</td>
<td style="text-align: left; padding: 0 2px; border: 0;">:</td>
<td style="text-align: right; padding: 0 4px 0 6px; margin: 0; border: 0;">205934</td>
<td style="text-align: left; padding: 0; border: 0;">(</td>
<td style="text-align: right; padding: 0 2px; margin: 0; border: 0;">59.8%</td>
<td style="text-align: left; padding: 0 4px 0 0; border: 0;">)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: right; padding: 0 2px 0 7px; margin: 0; border: 0;">1</td>
<td style="text-align: left; padding: 0 2px; border: 0;">:</td>
<td style="text-align: right; padding: 0 4px 0 6px; margin: 0; border: 0;">138150</td>
<td style="text-align: left; padding: 0; border: 0;">(</td>
<td style="text-align: right; padding: 0 2px; margin: 0; border: 0;">40.2%</td>
<td style="text-align: left; padding: 0 4px 0 0; border: 0;">)</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; vertical-align: middle; padding: 0; background-color: transparent;"><img src="data:image/png;base64,%20iVBORw0KGgoAAAANSUhEUgAAAGYAAAA3CAQAAABUBPe7AAAAAmJLR0QA/4ePzL8AAAAHdElNRQfoCA8DBTQAVdZxAAAAoElEQVRo3u3YsQmAMBBA0UTc0R10Ht0hU2obBQtFyM/5X5dG8uFicXlPcQytL2DMH2LG+rB1+IDmfBOT0tT6bg+V0ynUmBlDZQyVMVTGUBlDZQyVMVTGUBlDddkBlHdfgcj1Qia//kw79f1DjVmomNObWZstAZdPJhyxBPzqtxNqzIyhMobKGCpjqIyhMobKGCpjqIyhirsE7F2oMTOG6gClgAvHCon2YAAAAD10RVh0aWNjOmNvcHlyaWdodABDb3B5cmlnaHQgMjAwNyBBcHBsZSBJbmMuLCBhbGwgcmlnaHRzIHJlc2VydmVkLp5m3CkAAAAjdEVYdGljYzpkZXNjcmlwdGlvbgBHZW5lcmljIFJHQiBQcm9maWxlGqc4jgAAAABJRU5ErkJggg==" class="img-fluid" style="border:none;background-color:transparent;padding:0;max-width:max-content;"></td>
<td style="text-align: center;">344084 (100.0%)</td>
<td style="text-align: center;">0 (0.0%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">8</td>
<td style="text-align: left;">voted2006 [numeric]</td>
<td style="text-align: left; padding: 8; vertical-align: middle;"><table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Min : 0</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Mean : 0.3</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Max : 1</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; padding: 0; vertical-align: middle;"><table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: right; padding: 0 2px 0 7px; margin: 0; border: 0;">0</td>
<td style="text-align: left; padding: 0 2px; border: 0;">:</td>
<td style="text-align: right; padding: 0 4px 0 6px; margin: 0; border: 0;">235388</td>
<td style="text-align: left; padding: 0; border: 0;">(</td>
<td style="text-align: right; padding: 0 2px; margin: 0; border: 0;">68.4%</td>
<td style="text-align: left; padding: 0 4px 0 0; border: 0;">)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: right; padding: 0 2px 0 7px; margin: 0; border: 0;">1</td>
<td style="text-align: left; padding: 0 2px; border: 0;">:</td>
<td style="text-align: right; padding: 0 4px 0 6px; margin: 0; border: 0;">108696</td>
<td style="text-align: left; padding: 0; border: 0;">(</td>
<td style="text-align: right; padding: 0 2px; margin: 0; border: 0;">31.6%</td>
<td style="text-align: left; padding: 0 4px 0 0; border: 0;">)</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; vertical-align: middle; padding: 0; background-color: transparent;"><img src="data:image/png;base64,%20iVBORw0KGgoAAAANSUhEUgAAAHMAAAA3CAQAAACVg70XAAAAAmJLR0QA/4ePzL8AAAAHdElNRQfoCA8DBTQAVdZxAAAAoElEQVRo3u3YQQ5AMBBA0Vbc0R04D3dwSrYlsdCg8ue/XTfSn0wtJm8pgq71Bcw0866+PCyohzrmi8yUhtZ3e8x6OAUZWjNJzCQxk8RMEjNJzCQxk8RMEjNJTrugte4rv5fLZV6u/swflWVBhjZI5uFtzi+vo6dmr+LDdXTL31uQoTWTxEwSM0nMJDGTxEwSM0nMJDGTJOI6mivI0JpJsgNdPQvHfudQawAAAD10RVh0aWNjOmNvcHlyaWdodABDb3B5cmlnaHQgMjAwNyBBcHBsZSBJbmMuLCBhbGwgcmlnaHRzIHJlc2VydmVkLp5m3CkAAAAjdEVYdGljYzpkZXNjcmlwdGlvbgBHZW5lcmljIFJHQiBQcm9maWxlGqc4jgAAAABJRU5ErkJggg==" class="img-fluid" style="border:none;background-color:transparent;padding:0;max-width:max-content;"></td>
<td style="text-align: center;">344084 (100.0%)</td>
<td style="text-align: center;">0 (0.0%)</td>
</tr>
</tbody>
</table>

<p>Generated by <a href="https://github.com/dcomtois/summarytools">summarytools</a> 1.0.1 (<a href="https://www.r-project.org/">R</a> version 4.4.1)<br>2024-08-15</p>
</div>
</div>
</div>
</section>
<section id="バランスチェック" class="level2">
<h2 class="anchored" data-anchor-id="バランスチェック">バランスチェック</h2>
<p>　バランスチェックの簡単な方法はグループごとに処置前変数（pre-treatment variables）の平均値を比較することである。無作為割当が成功しているのであれば、処置前に測定された変数の平均値は近似するはずである。ここではグループ（<code>treatment</code>）ごとに性別、誕生年、世帯規模、2000〜2004年の投票参加の平均値を比較してみる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>  <span class="fu">group_by</span>(treatment) <span class="sc">|&gt;</span></span>
<span id="cb37-3"><a href="#cb37-3"></a>  <span class="fu">summarise</span>(<span class="at">female    =</span> <span class="fu">mean</span>(female, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb37-4"><a href="#cb37-4"></a>            <span class="at">yob       =</span> <span class="fu">mean</span>(yob, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb37-5"><a href="#cb37-5"></a>            <span class="at">hh_size   =</span> <span class="fu">mean</span>(hh_size, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb37-6"><a href="#cb37-6"></a>            <span class="at">voted2000 =</span> <span class="fu">mean</span>(voted2000, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb37-7"><a href="#cb37-7"></a>            <span class="at">voted2002 =</span> <span class="fu">mean</span>(voted2002, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb37-8"><a href="#cb37-8"></a>            <span class="at">voted2004 =</span> <span class="fu">mean</span>(voted2004, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
  treatment  female   yob hh_size voted2000 voted2002 voted2004
  &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 Civic Duty  0.500 1956.    2.19     0.254     0.389     0.399
2 Control     0.499 1956.    2.18     0.252     0.389     0.400
3 Hawthorne   0.499 1956.    2.18     0.250     0.394     0.403
4 Neighbors   0.500 1956.    2.19     0.251     0.387     0.407
5 Self        0.500 1956.    2.18     0.251     0.392     0.402</code></pre>
</div>
</div>
<p>　それぞれの変数の平均値は非常に似ているため、無作為割当が成功したと考えられる。しかし、変数の単位によって判断が難しいかも知れない。たとえば、2つのグループがあり、年齢の平均値の差は3、世帯規模のそれは2だとする。これを見ると年齢の方がよりバランスが取れていないようにも見えるが、年齢の幅は数十であるに対し、世帯規模はせいぜい5〜6程度であろう。したがって、各変数のばらつきまで考慮した比較が適切であり、その方法の一つが標準化バイアス（=標準化差分）である。</p>
<p>　標準化差分を計算する便利パッケージ、{BalanceR}を使ってみよう。第1引数はデータだから、パイプで渡せば良い。<code>BalanceR()</code>内には<code>group</code>引数にグループ識別変数を、<code>cov</code>には処置前変数のベクトルを入れる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>blc_chk <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>  <span class="fu">BalanceR</span>(<span class="at">group =</span> treatment,</span>
<span id="cb39-3"><a href="#cb39-3"></a>           <span class="at">cov   =</span> <span class="fu">c</span>(female, yob, hh_size, voted2000, voted2002, voted2004))</span>
<span id="cb39-4"><a href="#cb39-4"></a></span>
<span id="cb39-5"><a href="#cb39-5"></a>blc_chk</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Covariate Mean:Civic Duty SD:Civic Duty Mean:Control SD:Control
1    female           0.500         0.500        0.499      0.500
2       yob        1956.341        14.465     1956.186     14.436
3   hh_size           2.189         0.802        2.184      0.788
4 voted2000           0.254         0.435        0.252      0.434
5 voted2002           0.389         0.487        0.389      0.488
6 voted2004           0.399         0.490        0.400      0.490
  Mean:Hawthorne SD:Hawthorne Mean:Neighbors SD:Neighbors Mean:Self SD:Self
1          0.499        0.500          0.500        0.500     0.500   0.500
2       1956.295       14.400       1956.147       14.579  1956.207  14.416
3          2.180        0.789          2.188        0.805     2.181   0.782
4          0.250        0.433          0.251        0.434     0.251   0.434
5          0.394        0.489          0.387        0.487     0.392   0.488
6          0.403        0.491          0.407        0.491     0.402   0.490
  SB:Civic Duty-Control SB:Civic Duty-Hawthorne SB:Civic Duty-Neighbors
1                 0.248                   0.236                   0.024
2                 1.069                   0.317                   1.335
3                 0.687                   1.130                   0.169
4                 0.388                   0.738                   0.547
5                -0.108                  -1.123                   0.464
6                -0.182                  -0.772                  -1.472
  SB:Civic Duty-Self SB:Control-Hawthorne SB:Control-Neighbors SB:Control-Self
1              0.120               -0.013               -0.225          -0.128
2              0.924               -0.754                0.272          -0.146
3              1.051                0.448               -0.515           0.365
4              0.566                0.350                0.158           0.178
5             -0.628               -1.015                0.572          -0.520
6             -0.619               -0.590               -1.289          -0.437
  SB:Hawthorne-Neighbors SB:Hawthorne-Self SB:Neighbors-Self
1                 -0.212            -0.115             0.097
2                  1.022             0.609            -0.417
3                 -0.958            -0.085             0.878
4                 -0.192            -0.172             0.020
5                  1.587             0.496            -1.092
6                 -0.700             0.153             0.853</code></pre>
</div>
</div>
<p>　ちなみに、<code>df</code>内に<code>female</code>から<code>voted2004</code>は連続している（<code>names(df)</code>で確認してみよう）。この場合は以下のように（<code>female:voted2004</code>）書き換えることもできる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>blc_chk <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>  <span class="fu">BalanceR</span>(<span class="at">group =</span> treatment,</span>
<span id="cb41-3"><a href="#cb41-3"></a>           <span class="at">cov   =</span> female<span class="sc">:</span>voted2004)</span>
<span id="cb41-4"><a href="#cb41-4"></a></span>
<span id="cb41-5"><a href="#cb41-5"></a>blc_chk</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　標準化差分（標準化バイアス）を用いたバランスチェックはそれぞれのペアごとに計算を行うため、グループが多い場合は凡例が圧迫される場合が多い。しかし、重要なのは標準化差分の最大値だろう。ペア1、2、3でバランスが取れても、ペア4のバランスが取られていない場合は無意味だからだ。また、標準化差分の場合、符号の意味はなく、絶対値が重要だ。また、バランスチェックにおいてグループごとの平均値や標準偏差は不要である。ここで<code>summary()</code>関数を使うと、絶対値が最も大きい標準化差分のみ出力される。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="fu">summary</span>(blc_chk)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Covariate Abs_Maximum_SB
1    female          0.248
2       yob          1.335
3   hh_size          1.130
4 voted2000          0.738
5 voted2002          1.587
6 voted2004          1.472</code></pre>
</div>
</div>
<p>　<code>plot()</code>関数を使えば、これらの結果を可視化することもできる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="fu">plot</span>(blc_chk)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-blc-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-blc-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="intro_rct_files/figure-html/fig-blc-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-blc-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;1: 標準化差分によるバランス✔
</figcaption>
</figure>
</div>
</div>
</div>
<p>　先ほど述べたようにバランスチェックで重要なのは絶対値が最も大きい標準化差分である。<code>plot()</code>内に<code>simplify = TRUE</code>を指定すれば最大値のみ表示され、更に<code>abs = TRUE</code>にすると絶対値へ変換される。また、垂直のガイドラインは<code>vline</code>引数で変更できる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># plot() の第1引数は blc_chk なのでパイプの使える</span></span>
<span id="cb45-2"><a href="#cb45-2"></a>blc_chk <span class="sc">|&gt;</span></span>
<span id="cb45-3"><a href="#cb45-3"></a>  <span class="fu">plot</span>(<span class="at">vline =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>), <span class="at">simplify =</span> <span class="cn">TRUE</span>, <span class="at">abs =</span> <span class="cn">TRUE</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-blc-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-blc-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="intro_rct_files/figure-html/fig-blc-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-blc-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;2: 標準化差分を全て絶対値にし、最も大きいもののみを表示
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="処置効果の推定" class="level2">
<h2 class="anchored" data-anchor-id="処置効果の推定">処置効果の推定</h2>
<section id="グループごとの応答変数の平均値" class="level3">
<h3 class="anchored" data-anchor-id="グループごとの応答変数の平均値">グループごとの応答変数の平均値</h3>
<p>　処置効果を確認するためには各グループごとの応答変数（ここでは<code>voted2006</code>）の平均値を計算し、処置群の平均値から統制群の平均値を引く必要がある。まずは、特定の変数の平均値を計算する方法について紹介する。データ内にある特定の変数の平均値を計算するためには<code>summarise()</code>関数内に平均値を求める<code>mean()</code>関数を入れる。たとえば、<code>df</code>の<code>voted2006</code>の平均値を計算するコードは以下の通りである。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb46-2"><a href="#cb46-2"></a>  <span class="fu">summarise</span>(<span class="fu">mean</span>(voted2006, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  `mean(voted2006, na.rm = TRUE)`
                            &lt;dbl&gt;
1                           0.316</code></pre>
</div>
</div>
<p>　<code>na.rm = TRUE</code>は「欠損値があれば、それを除外する」を意味し、指定されていない場合（=既定値）は<code>FALSE</code>になる。今回は欠損値がないものの、念の為に入れておく。</p>
<p>　出力結果を見ると、平均値が表示される列の名前が<code>`mean(voted2006, na.rm = TRUE)`</code>となっており、非常に見にくい。この場合、以下のように<code>mean()</code>の前に出力される列名を予め指定することもできる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb48-2"><a href="#cb48-2"></a>  <span class="co"># voted2006の平均値が表示される列名を Outcome にする。</span></span>
<span id="cb48-3"><a href="#cb48-3"></a>  <span class="fu">summarise</span>(<span class="at">Outcome =</span> <span class="fu">mean</span>(voted2006, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  Outcome
    &lt;dbl&gt;
1   0.316</code></pre>
</div>
</div>
<p>　我々が知りたいのは<code>voted2006</code>の平均値でなく、<strong>グループごと</strong>の平均値だろう。被験者がどのグループに属しているかわ示す変数は<code>treatment</code>であるが、<code>summarise()</code>にデータを渡す前に<code>group_by()</code>変数を使うと、グループごとに計算を行い、その結果を返す。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb50-2"><a href="#cb50-2"></a>  <span class="fu">group_by</span>(treatment) <span class="sc">|&gt;</span></span>
<span id="cb50-3"><a href="#cb50-3"></a>  <span class="fu">summarise</span>(<span class="at">Outcome =</span> <span class="fu">mean</span>(voted2006, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  treatment  Outcome
  &lt;chr&gt;        &lt;dbl&gt;
1 Civic Duty   0.315
2 Control      0.297
3 Hawthorne    0.322
4 Neighbors    0.378
5 Self         0.345</code></pre>
</div>
</div>
<p>　<code>group_by()</code>内でも<code>=</code>演算子を使うと、グループ名が出力される列名を変更することができる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2"></a>  <span class="co"># グループ名が表示される列名を Group にする。</span></span>
<span id="cb52-3"><a href="#cb52-3"></a>  <span class="fu">group_by</span>(<span class="at">Groups =</span> treatment) <span class="sc">|&gt;</span></span>
<span id="cb52-4"><a href="#cb52-4"></a>  <span class="fu">summarise</span>(<span class="at">Outcome =</span> <span class="fu">mean</span>(voted2006, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  Groups     Outcome
  &lt;chr&gt;        &lt;dbl&gt;
1 Civic Duty   0.315
2 Control      0.297
3 Hawthorne    0.322
4 Neighbors    0.378
5 Self         0.345</code></pre>
</div>
</div>
<p>　ここで一つ注目したいのが、グループの表示順番である。変数のデータ型が文字型だと（Rコンソール上で<code>class(df$treatment)</code>を入力するか、<code>df</code>の出力画面で<code>treatment</code>の下に<code>&lt;chr&gt;</code>と表示されていることで確認できる）、今のようにアルファベット順で表示される。しかし、統制群は最初か最後に来るのが通例である。この順番をアルファベット順でなく、任意の順番にするためには<code>treatment</code>変数をfactor型変数へ変換する必要がある。Factor型は「順序付きの文字型変数」だと理解しても良い<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>。列の追加・上書き（今回は<code>treatment</code>列の上書き）の処理が必要なので<code>mutate()</code>関数を使う。変数をfactor型に変換する関数は<code>factor()</code>関数で、第1引数としてはfactor型へ変換する変数名を指定する。第2引数は<code>levels</code>であり、出力したい順番の文字型ベクトルを指定する。<strong>スペルミス</strong>に注意すること。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb54-2"><a href="#cb54-2"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">factor</span>(treatment,</span>
<span id="cb54-3"><a href="#cb54-3"></a>                            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Civic Duty"</span>,</span>
<span id="cb54-4"><a href="#cb54-4"></a>                                       <span class="st">"Self"</span>, <span class="st">"Neighbors"</span>, <span class="st">"Hawthorne"</span>)))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344,084 × 13
   treatment  female   yob hh_size voted2000 voted2002 voted2004 voted2006
   &lt;fct&gt;       &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 Civic Duty      0  1941       2         0         1         0         0
 2 Civic Duty      1  1947       2         0         1         0         0
 3 Hawthorne       0  1951       3         0         1         0         1
 4 Hawthorne       1  1950       3         0         1         0         1
 5 Hawthorne       1  1982       3         0         1         0         1
 6 Control         0  1981       3         0         0         0         0
 7 Control         1  1959       3         0         1         0         1
 8 Control         0  1956       3         0         1         0         1
 9 Control         1  1968       2         0         1         0         0
10 Control         0  1967       2         0         1         0         0
# ℹ 344,074 more rows
# ℹ 5 more variables: `treatment_Civic Duty` &lt;int&gt;, treatment_Control &lt;int&gt;,
#   treatment_Hawthorne &lt;int&gt;, treatment_Neighbors &lt;int&gt;, treatment_Self &lt;int&gt;</code></pre>
</div>
</div>
<p>　<code>treatment</code>列名の下が<code>&lt;fct&gt;</code>となっていることが分かる。これは<code>treatment</code>列のデータ型がfactor型であることを意味する。問題なく動くことが確認できたので、<code>df</code>を上書きしよう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb56-2"><a href="#cb56-2"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">factor</span>(treatment,</span>
<span id="cb56-3"><a href="#cb56-3"></a>                            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Civic Duty"</span>, <span class="st">"Hawthorne"</span>,</span>
<span id="cb56-4"><a href="#cb56-4"></a>                                       <span class="st">"Self"</span>, <span class="st">"Neighbors"</span>)))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　それでは、改めてグループごとの<code>voted2006</code>の平均値を計算してみよう。今回は計算結果を<code>out_mean_df</code>という名のオブジェクトとして格納する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>out_mean_df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb57-2"><a href="#cb57-2"></a>  <span class="fu">group_by</span>(<span class="at">Groups =</span> treatment) <span class="sc">|&gt;</span></span>
<span id="cb57-3"><a href="#cb57-3"></a>  <span class="fu">summarise</span>(<span class="at">Outcome =</span> <span class="fu">mean</span>(voted2006, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb57-4"><a href="#cb57-4"></a></span>
<span id="cb57-5"><a href="#cb57-5"></a>out_mean_df</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  Groups     Outcome
  &lt;fct&gt;        &lt;dbl&gt;
1 Control      0.297
2 Civic Duty   0.315
3 Hawthorne    0.322
4 Self         0.345
5 Neighbors    0.378</code></pre>
</div>
</div>
<p>　今回は統制群は最初に出力されていることが確認できる。</p>
<p>　それではこの結果をグラフとして示してみよう。作図には{ggplot2}パッケージを使う。まずは<code>out_mean_df</code>を<code>ggplot()</code>関数に渡す。<code>ggplot()</code>関数以降は、<code>+</code>演算子を使ってレイヤーを足していくこととなる。棒グラフのレイヤーは<code>geom_bar()</code>関数であり、その中に<code>aes()</code>関数を入れる。<code>aes()</code>の中には棒グラフの作図に必要な情報を入れる必要がある（これを<strong>マッピング</strong>（mapping）と呼ぶ）。棒グラフを作成するために必要な最低限の情報とは各棒の横軸上の位置（<code>x</code>）と棒の高さ（<code>y</code>）だ。今回は横軸がグループ名、縦軸が平均値となる棒グラフを作る。<code>aes()</code>外側には<code>stat = "identity"</code>を忘れずに付けること。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a>out_mean_df <span class="sc">|&gt;</span></span>
<span id="cb59-2"><a href="#cb59-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb59-3"><a href="#cb59-3"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> Groups, <span class="at">y =</span> Outcome), <span class="at">stat =</span> <span class="st">"identity"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-bar-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-intro-bar-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="intro_rct_files/figure-html/fig-intro-bar-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-intro-bar-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;3: 各グループごとの投票率
</figcaption>
</figure>
</div>
</div>
</div>
<p>　続いて、このグラフの見た目を調整してみよう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a>out_mean_df <span class="sc">|&gt;</span></span>
<span id="cb60-2"><a href="#cb60-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb60-3"><a href="#cb60-3"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> Groups, <span class="at">y =</span> Outcome), <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb60-4"><a href="#cb60-4"></a>  <span class="co"># 縦軸（y軸）のラベルを変更する</span></span>
<span id="cb60-5"><a href="#cb60-5"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Mean(Outcome)"</span>) <span class="sc">+</span></span>
<span id="cb60-6"><a href="#cb60-6"></a>  <span class="co"># grayテーマ（デフォルトのテーマ）を使用し、フォントサイズは14</span></span>
<span id="cb60-7"><a href="#cb60-7"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-bar-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-intro-bar-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="intro_rct_files/figure-html/fig-intro-bar-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-intro-bar-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;4: 縦軸タイトルの変更 + 文字サイスの修正
</figcaption>
</figure>
</div>
</div>
</div>
<p>　また、<code>geom_label()</code>レイヤーを足すと、棒の上にラベルを付けることもできる。ラベルに必要な情報は各ラベルの横軸上の位置（<code>x</code>）、縦軸上の位置（<code>y</code>）、ラベルの表示内容（<code>label</code>）だ。今回のラベルは平均値の具体的な数値を入れてみよう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a>out_mean_df <span class="sc">|&gt;</span></span>
<span id="cb61-2"><a href="#cb61-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb61-3"><a href="#cb61-3"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> Groups, <span class="at">y =</span> Outcome), <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb61-4"><a href="#cb61-4"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> Groups, <span class="at">y =</span> Outcome, <span class="at">label =</span> Outcome)) <span class="sc">+</span></span>
<span id="cb61-5"><a href="#cb61-5"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Mean(Outcome)"</span>) <span class="sc">+</span></span>
<span id="cb61-6"><a href="#cb61-6"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-bar-3" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-intro-bar-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="intro_rct_files/figure-html/fig-intro-bar-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-intro-bar-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;5: 棒にラベルを追加
</figcaption>
</figure>
</div>
</div>
</div>
<p>　小数点が長すぎるので3桁まで表示としよう。ここでは<code>sprintf()</code>を使用する。使い方が簡単とは言えないが、覚える必要はなく、必要な時にググるか、本資料のコードをコピペすれば良い<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a>out_mean_df <span class="sc">|&gt;</span></span>
<span id="cb62-2"><a href="#cb62-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb62-3"><a href="#cb62-3"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> Groups, <span class="at">y =</span> Outcome), <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb62-4"><a href="#cb62-4"></a>  <span class="co"># 2桁までなら %.3f を %.2f に変更</span></span>
<span id="cb62-5"><a href="#cb62-5"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> Groups, <span class="at">y =</span> Outcome, <span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, Outcome))) <span class="sc">+</span></span>
<span id="cb62-6"><a href="#cb62-6"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Mean(Outcome)"</span>) <span class="sc">+</span></span>
<span id="cb62-7"><a href="#cb62-7"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-bar-4" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-intro-bar-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="intro_rct_files/figure-html/fig-intro-bar-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-intro-bar-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;6: 推定値を小数点3桁まで表示
</figcaption>
</figure>
</div>
</div>
</div>
<p>　これで可視化ができた。ただし、以上のコードには改善の余地がある。<code>geom_bar()</code>と<code>geom_label()</code>内の<code>aes()</code>関数に注目して欲しい。よく見ると<code>x</code>と<code>y</code>と同じだろう。<code>geom_*()</code>が共有するマッピングがあれば、<code>ggplot()</code>内で指定することでコードを効率化することもできる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a>out_mean_df <span class="sc">|&gt;</span></span>
<span id="cb63-2"><a href="#cb63-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Groups, <span class="at">y =</span> Outcome)) <span class="sc">+</span></span>
<span id="cb63-3"><a href="#cb63-3"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb63-4"><a href="#cb63-4"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, Outcome))) <span class="sc">+</span></span>
<span id="cb63-5"><a href="#cb63-5"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Mean(Outcome)"</span>) <span class="sc">+</span></span>
<span id="cb63-6"><a href="#cb63-6"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-bar-5" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-intro-bar-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="intro_rct_files/figure-html/fig-intro-bar-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-intro-bar-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;7: マッピングを共有する箇所を<code>ggplot()</code>内でまとめる
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="統計的推定単回帰分析" class="level3">
<h3 class="anchored" data-anchor-id="統計的推定単回帰分析">統計的推定（単回帰分析）</h3>
<p>　これまでの作業はグループごとの応答変数の平均値であって、処置効果ではない。処置効果を計算するためには処置群の平均値から統制群の平均値を引く必要がある。たとえば、Civic Dutyはがき群の平均値は約0.315、統制群のそれは0.297であるため、Civic Dutyはがきの処置効果は約0.018である。しかし、これを各グループごとに計算することは面倒だし、何よりも得られた値が<strong>点推定値</strong>だという限界がある。得られた処置効果の不確実性は計算できない。</p>
<p>　ここで有効なのが線形回帰分析である。回帰分析を行うことで処置効果の点推定値のみならず、不確実性の指標である標準誤差も計算され、区間推定や統計的仮説検定も可能となる。線形回帰分析の関数は<code>lm()</code>だ。第1引数としては回帰式であり、<code>応答変数 ~ 説明変数</code>と表記する。第2引数は<code>data</code>であり、回帰式で指定した変数が入っているデータ名を指定する。回帰分析の結果は名前を付けてオブジェクトとして格納し、<code>summary()</code>関数を使うと、詳細が確認できる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(voted2006 <span class="sc">~</span> treatment, <span class="at">data =</span> df)</span>
<span id="cb64-2"><a href="#cb64-2"></a></span>
<span id="cb64-3"><a href="#cb64-3"></a><span class="fu">summary</span>(fit1)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = voted2006 ~ treatment, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-0.3780 -0.3145 -0.2966  0.6549  0.7034 

Coefficients:
                    Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         0.296638   0.001061 279.525  &lt; 2e-16 ***
treatmentCivic Duty 0.017899   0.002600   6.884 5.85e-12 ***
treatmentHawthorne  0.025736   0.002601   9.896  &lt; 2e-16 ***
treatmentSelf       0.048513   0.002600  18.657  &lt; 2e-16 ***
treatmentNeighbors  0.081310   0.002601  31.263  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4641 on 344079 degrees of freedom
Multiple R-squared:  0.003394,  Adjusted R-squared:  0.003383 
F-statistic:   293 on 4 and 344079 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>　ちなみに、これもパイプ演算子を使うことができる。ただし、第1引数として渡すパイプ演算子の特徴上、そのまま使うことはできない。なぜなら<code>lm()</code>関数の第1引数はデータでなく、回帰式（formula型）だから。この場合はプレースホルダー（place holder）を指定する必要がある。パイプ前のオブジェクトが入る位置を任意に指定することであり、<code>_</code>を使う。<code>%&gt;%</code>演算子を使う場合は<code>_</code>でなく、<code>.</code>を使う。上記のコードと以下のコードは同じコードとなる。プレースホルダーは自分が使うパイプ演算子によって使い分けること。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a>fit1 <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> <span class="co"># |&gt; パイプを使う場合</span></span>
<span id="cb66-2"><a href="#cb66-2"></a>  <span class="fu">lm</span>(voted2006 <span class="sc">~</span> treatment, <span class="at">data =</span> _)</span>
<span id="cb66-3"><a href="#cb66-3"></a></span>
<span id="cb66-4"><a href="#cb66-4"></a>fit1 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="co"># %&gt;% パイプを使う場合</span></span>
<span id="cb66-5"><a href="#cb66-5"></a>  <span class="fu">lm</span>(voted2006 <span class="sc">~</span> treatment, <span class="at">data =</span> .)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　Factor型、または文字型変数が説明変数の場合、自動的にダミー変数として処理され、factor型の場合、最初の水準（ここでは<code>"Control"</code>）がベースカテゴリとなる。もし説明変数が文字型なら、アルファベット順で最初の水準がベースカテゴリとなり、今回の例だと<code>"Civic Duty"</code>がベースカテゴリとなる。処置効果は「統制群に比べて〜」が重要となるので、数値型以外の説明変数は予めfactor化しておいた方が望ましい。</p>
<p>　Civic Dutyの推定値は約0.018であり、これは統制群に比べ、Civic Duty群の<code>voted2006</code>の平均値は約0.018高いことを意味する。応答変数が0、1であるため、これを割合（=投票率）で換算すると、約1.8%p高いことを意味する。つまり、Civic Dutyのはがきをもらった被験者はそうでない被験者に比べて投票率が約1.8%p高いことを意味する。他の推定値も同じやり方で解釈すれば良い。</p>
<p>　それではこれらの処置効果が<strong>統計的に有意</strong>なものかを確認してみよう。統計的有意か否かを判定するためには有意と非有意の境界線が必要である、これは通常、<strong>有意水準</strong>（significance level; <span class="math inline">\(\alpha\)</span>）と呼ばれる。この有意水準は分析者が決めるものであるが、社会科学で広く使われる基準は<span class="math inline">\(\alpha = 0.05\)</span>、つまり5%だ。分析結果の画面には<code>Pr(&gt;|t|)</code>列が表示されているが、これが<span class="math inline">\(p\)</span>値と呼ばれるもので、これが0.05を下回る場合、統計的に有意と判定する。もし、<span class="math inline">\(\alpha = 0.1\)</span>を採用するなら、<span class="math inline">\(p &lt; 0.1\)</span>の場合において統計的に有意と判定する。Civic Dutyの<span class="math inline">\(p\)</span>値は5.85e-12であり、これは<span class="math inline">\(5.75 \times 10^{-12}\)</span>を意味する。<span class="math inline">\(10^{-1}\)</span>は0.1、<span class="math inline">\(10^{-2}\)</span>は0.01であることを考えると非常に小さい数値であり、統計的に有意であると考えられる。また、<span class="math inline">\(p\)</span>値が一定値以下であれば<code>&lt; 2e-16</code>と表示される。4つの処置群において処置効果は統計的に有意であると判定できよう。</p>
<p>　続いて、この結果を可視化してみよう。ここでも{ggplot2}パッケージを使って可視化をするが、{ggplot2}で使用可能なオブジェクトは表形式のデータである。Rコンソール上で<code>class(オブジェクト名)</code>を入力すると、データのクラスが出力されるが、このクラスに<code>"data.frame"</code>があれば、{ggplot2}で使用できる。たとえば、<code>fit1</code>オブジェクトのクラスは<code>"lm"</code>であるため、そのまま{ggplot2}で使うことはできない。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="fu">class</span>(fit1)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "lm"</code></pre>
</div>
</div>
<p>　推定結果を表形式に変換するためには{broom}パッケージの<code>tidy()</code>関数が便利だ。使い方は簡単で<code>tidy()</code>内に回帰分析の推定結果が格納されたオブジェクトを入れるだけである。ただし、デフォルトの設定では95%信頼区間が表示されないため、中には<code>conf.int = TRUE</code>を追加しておく必要がある。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="co"># 90%信頼区間を使うのであれば conf.int = 0.9 を追加（デフォルトは0.95）</span></span>
<span id="cb69-2"><a href="#cb69-2"></a>fit1_coef <span class="ot">&lt;-</span> <span class="fu">tidy</span>(fit1, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span>
<span id="cb69-3"><a href="#cb69-3"></a></span>
<span id="cb69-4"><a href="#cb69-4"></a>fit1_coef</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
  term                estimate std.error statistic   p.value conf.low conf.high
  &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)           0.297    0.00106    280.   0           0.295     0.299 
2 treatmentCivic Duty   0.0179   0.00260      6.88 5.85e- 12   0.0128    0.0230
3 treatmentHawthorne    0.0257   0.00260      9.90 4.37e- 23   0.0206    0.0308
4 treatmentSelf         0.0485   0.00260     18.7  1.22e- 77   0.0434    0.0536
5 treatmentNeighbors    0.0813   0.00260     31.3  2.94e-214   0.0762    0.0864</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="fu">class</span>(fit1_coef)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<p>　<code>fit1_coef</code>のクラスに<code>"data.frame"</code>が含まれているので、これを使って作図することができる。</p>
<p>　作図する前に、<code>fit1_coef</code>の加工しておきたい。それぞれの係数（<code>estimate</code>列）は処置効果を表しているが、切片（<code>"(Intercept)"</code>）の推定値は処置効果とは無関係である。したがって、予め切片の行を除外しておきたい。特定の行を残したり、除外する関数は<code>filter()</code>である。今回は<code>term</code>列の値が<code>"(Intercept)"</code><strong>ではない</strong>行を残したいので、同値演算子（<code>==</code>）の否定を意味する<code>!=</code>演算子を使用する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a>fit1_coef <span class="ot">&lt;-</span> fit1_coef <span class="sc">|&gt;</span></span>
<span id="cb73-2"><a href="#cb73-2"></a>  <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"(Intercept)"</span>)</span>
<span id="cb73-3"><a href="#cb73-3"></a></span>
<span id="cb73-4"><a href="#cb73-4"></a>fit1_coef</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
  term                estimate std.error statistic   p.value conf.low conf.high
  &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 treatmentCivic Duty   0.0179   0.00260      6.88 5.85e- 12   0.0128    0.0230
2 treatmentHawthorne    0.0257   0.00260      9.90 4.37e- 23   0.0206    0.0308
3 treatmentSelf         0.0485   0.00260     18.7  1.22e- 77   0.0434    0.0536
4 treatmentNeighbors    0.0813   0.00260     31.3  2.94e-214   0.0762    0.0864</code></pre>
</div>
</div>
<p>　それでは作図に入ろう。処置効果を示す場合は、点推定値以外にもその不確実性を示すのは一般的である。不確実性の指標として幅広く使われるのは標準誤差（standard error; 標準<strong>偏差</strong>ではない）であるが、可視化の際にはこの標準誤差に基づき計算した信頼区間を示すのが一般的だ。有意水準が5%（<span class="math inline">\(\alpha\)</span> = 0.05）であれば、95%信頼区間を示し、10%（<span class="math inline">\(\alpha\)</span> = 0.1）なら90%信頼区間を用いる。<code>tidy()</code>で得られたデータの場合、信頼区間の下限と上限はそれぞれ<code>conf.low</code>と<code>conf.high</code>という名の列に格納されている（<code>conf.int = TRUE</code>を指定しておかないと、信頼区間は計算されない）。</p>
<p>　点と区間を同時に示すプロットがpoint-rangeプロットであり、{ggplot2}では<code>geom_pointrange()</code>レイヤーを使う。必要な情報はpoint-rangeの横軸上の位置（<code>x</code>）、点の縦軸上の位置（<code>y</code>）、区間の上限（<code>ymax</code>）と下限（<code>ymin</code>）である。これらの情報は全て<code>fit1_coef</code>に入っているため、<code>fit1_coef</code>をそのまま<code>ggplot()</code>関数に渡して作図することができる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a>fit1_coef <span class="sc">|&gt;</span></span>
<span id="cb75-2"><a href="#cb75-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb75-3"><a href="#cb75-3"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> estimate,</span>
<span id="cb75-4"><a href="#cb75-4"></a>                      <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-pointrange-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-intro-pointrange-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="intro_rct_files/figure-html/fig-intro-pointrange-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-intro-pointrange-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;8: 処置効果と95%信頼区間
</figcaption>
</figure>
</div>
</div>
</div>
<p>　それでは図をカスタマイズしてみよう。図内の様々なラベルを修正する<code>labs()</code>レイヤーでラベルを修正する。テーマはデフォルトの<code>theme_gray()</code>の代わりに白黒テーマ（<code>theme_bw()</code>）を使用し、フォントサイズは12とする。また、y = 0の水平線を追加する。95%信頼区間内に0が含まれる場合、「5%水準で統計的に有意でない」と判断できる。水平線を描くには<code>geom_hline()</code>レイヤーを追加し、<code>yintercept = 0</code>を指定することで、0のところに水平線が描ける。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a>fit1_coef <span class="sc">|&gt;</span></span>
<span id="cb76-2"><a href="#cb76-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb76-3"><a href="#cb76-3"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb76-4"><a href="#cb76-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> estimate,</span>
<span id="cb76-5"><a href="#cb76-5"></a>                      <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb76-6"><a href="#cb76-6"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Treatments"</span>, <span class="at">y =</span> <span class="st">"Average Treatment Effects"</span>) <span class="sc">+</span></span>
<span id="cb76-7"><a href="#cb76-7"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-pointrange-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-intro-pointrange-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="intro_rct_files/figure-html/fig-intro-pointrange-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-intro-pointrange-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;9: 軸タイトルの修正 + y = 0の水平線を追加 + テーマの変更
</figcaption>
</figure>
</div>
</div>
</div>
<p>　まだ気になる点がある。それは横軸の目盛りラベルに<code>treatment</code>という不要な情報がある点だ。これは作図の時点で修正することも可能だが、まずは<code>df</code>の<code>term</code>変数の値を修正する方法を紹介する。変数の値を修正する時には<code>recode()</code>関数を使用する。第1引数はリコーディングする変数名であり、引き続き<code>"元の値" = "新しい値"</code>を指定すれば良い。<strong>スペルミスに注意</strong>すること。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a>fit1_coef <span class="ot">&lt;-</span> fit1_coef <span class="sc">|&gt;</span></span>
<span id="cb77-2"><a href="#cb77-2"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">recode</span>(term,</span>
<span id="cb77-3"><a href="#cb77-3"></a>                       <span class="st">"treatmentCivic Duty"</span> <span class="ot">=</span> <span class="st">"Civic Duty"</span>,</span>
<span id="cb77-4"><a href="#cb77-4"></a>                       <span class="st">"treatmentHawthorne"</span>  <span class="ot">=</span> <span class="st">"Hawthorne"</span>,</span>
<span id="cb77-5"><a href="#cb77-5"></a>                       <span class="st">"treatmentSelf"</span>       <span class="ot">=</span> <span class="st">"Self"</span>,</span>
<span id="cb77-6"><a href="#cb77-6"></a>                       <span class="st">"treatmentNeighbors"</span>  <span class="ot">=</span> <span class="st">"Neighbors"</span>))</span>
<span id="cb77-7"><a href="#cb77-7"></a></span>
<span id="cb77-8"><a href="#cb77-8"></a>fit1_coef</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
  term       estimate std.error statistic   p.value conf.low conf.high
  &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 Civic Duty   0.0179   0.00260      6.88 5.85e- 12   0.0128    0.0230
2 Hawthorne    0.0257   0.00260      9.90 4.37e- 23   0.0206    0.0308
3 Self         0.0485   0.00260     18.7  1.22e- 77   0.0434    0.0536
4 Neighbors    0.0813   0.00260     31.3  2.94e-214   0.0762    0.0864</code></pre>
</div>
</div>
<p>　以上の作業は<code>term</code>列の各値から<code>"treatment"</code>文字を<code>""</code>に置換することなので、文字列を置換する関数である<code>str_replace()</code>を使えば、より短くすることができる<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a>。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a>fit1_coef <span class="ot">&lt;-</span> fit1_coef <span class="sc">|&gt;</span></span>
<span id="cb79-2"><a href="#cb79-2"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">str_replace</span>(term, <span class="st">"treatment"</span>, <span class="st">""</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　<code>fit1_coef</code>も修正できたので、 <a href="#fig-intro-pointrange-2" class="quarto-xref">図&nbsp;9</a> と同じコードでもう一度作図してみよう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a>fit1_coef <span class="sc">|&gt;</span></span>
<span id="cb80-2"><a href="#cb80-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb80-3"><a href="#cb80-3"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb80-4"><a href="#cb80-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> estimate,</span>
<span id="cb80-5"><a href="#cb80-5"></a>                      <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb80-6"><a href="#cb80-6"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Treatments"</span>, <span class="at">y =</span> <span class="st">"Average Treatment Effects"</span>) <span class="sc">+</span></span>
<span id="cb80-7"><a href="#cb80-7"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-pointrange-3" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-intro-pointrange-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="intro_rct_files/figure-html/fig-intro-pointrange-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-intro-pointrange-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;10: 横軸ラベルの変更
</figcaption>
</figure>
</div>
</div>
</div>
<p>　最後に横軸の順番を修正してみよう。<code>fit1_coef</code>の<code>term</code>列は文字型変数であるため、アルファベット順になる。これを<code>df</code>の<code>treatment</code>列と同様、Civic Duty、Self、Neighbors、Hawthorneの順にしたい。この場合<code>fit1_coef</code>の<code>term</code>列をfactor化すれば良い。<code>factor()</code>関数を使っても良いが、ここではまた便利な技を紹介しよう。それは<code>fct_inorder()</code>関数だ。これは表示されている順番をfactorの順番とする関数だ。実際、<code>fit1_coef</code>の中身を見ると、表示順番はCivic Duty、Self、Neighbors、Hawthorneだ。非常に嬉しい状況なので、<code>fct_inorder()</code>を使ってみよう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a>fit1_coef <span class="ot">&lt;-</span> fit1_coef <span class="sc">|&gt;</span></span>
<span id="cb81-2"><a href="#cb81-2"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">fct_inorder</span>(term))</span>
<span id="cb81-3"><a href="#cb81-3"></a></span>
<span id="cb81-4"><a href="#cb81-4"></a>fit1_coef</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
  term       estimate std.error statistic   p.value conf.low conf.high
  &lt;fct&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 Civic Duty   0.0179   0.00260      6.88 5.85e- 12   0.0128    0.0230
2 Hawthorne    0.0257   0.00260      9.90 4.37e- 23   0.0206    0.0308
3 Self         0.0485   0.00260     18.7  1.22e- 77   0.0434    0.0536
4 Neighbors    0.0813   0.00260     31.3  2.94e-214   0.0762    0.0864</code></pre>
</div>
</div>
<p>　それでは、 <a href="#fig-intro-pointrange-3" class="quarto-xref">図&nbsp;10</a> と同じコードでもう一度作図してみよう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a>fit1_coef <span class="sc">|&gt;</span></span>
<span id="cb83-2"><a href="#cb83-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb83-3"><a href="#cb83-3"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb83-4"><a href="#cb83-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> estimate,</span>
<span id="cb83-5"><a href="#cb83-5"></a>                      <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb83-6"><a href="#cb83-6"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Treatments"</span>, <span class="at">y =</span> <span class="st">"Average Treatment Effects"</span>) <span class="sc">+</span></span>
<span id="cb83-7"><a href="#cb83-7"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-pointrange-4" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-intro-pointrange-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="intro_rct_files/figure-html/fig-intro-pointrange-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-intro-pointrange-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;11: 横軸ラベルの順番を変更した後
</figcaption>
</figure>
</div>
</div>
</div>
<p>　これで処置効果の可視化もバッチリだ。</p>
</section>
<section id="多重比較の問題" class="level3">
<h3 class="anchored" data-anchor-id="多重比較の問題">多重比較の問題</h3>
<p>　グループが2つ、つまり統制群と統制群のみが存在する場合、我々が比較を行う回数は1回のみである（統制群 - 処置群）。しかし、今回のデータの場合、処置群は4つである。これは比較を4回行うことを意味する。具体的には「統制群 - 処置群1」、「統制群 - 処置群2」、「統制群 - 処置群3」、「統制群 - 処置群4」だ。比較を繰り返すほど、統計的に有意な結果が得られる可能性は高い。極端な話、1000回程度検定を繰り返せば、本当は効果がなくても<strong>たまたま</strong>統計的に有意な結果が何回かは得られるだろう。これが多重検定（multiple testing）の問題である。したがって、比較の回数が多くなるにつれ、統計的有意性検定にも何らかのペナルティーを課す必要がある。</p>
<p>　多重比較におけるペナルティーの付け方はいくつかあるが、ここでは最も保守的な（=研究者にとって都合の悪い）補正法であるボンフェローニ補正（Bonferroni correction）を紹介する。これは非常に単純で、<span class="math inline">\(p\)</span>値や信頼区間を計算する際、「統計的有意」と判定されるハードルを上げる方法である。予め決めておいた有意水準（<span class="math inline">\(\alpha\)</span>）が0.05で、比較の回数が4回であれば、<span class="math inline">\(p\)</span>値が<span class="math inline">\(0.05 \times \frac{1}{4} = 0.0125\)</span>を下回る場合において「5%水準で有意である」と判定する。信頼区間でいえば通常の95%信頼区間（1 - 0.05）でなく、98.75%信頼区間（1 - 0.0125）を使うこととなる。この結果、統計的に有意な結果が得られたら「1.25%水準で〜」と解釈するのではなく、「5%水準で〜」と解釈する必要がある。</p>
<p>　95%以外の信頼区間を求めるのは簡単で、<code>tidy()</code>関数内に<code>conf.level</code>を修正すれば良い。指定されていない場合はデフォルトで0.95が割り当てられているが、これを0.9875と修正する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a>fit1_coef <span class="ot">&lt;-</span> <span class="fu">tidy</span>(fit1, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.9875</span>)</span>
<span id="cb84-2"><a href="#cb84-2"></a></span>
<span id="cb84-3"><a href="#cb84-3"></a>fit1_coef</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
  term                estimate std.error statistic   p.value conf.low conf.high
  &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)           0.297    0.00106    280.   0           0.294     0.299 
2 treatmentCivic Duty   0.0179   0.00260      6.88 5.85e- 12   0.0114    0.0244
3 treatmentHawthorne    0.0257   0.00260      9.90 4.37e- 23   0.0192    0.0322
4 treatmentSelf         0.0485   0.00260     18.7  1.22e- 77   0.0420    0.0550
5 treatmentNeighbors    0.0813   0.00260     31.3  2.94e-214   0.0748    0.0878</code></pre>
</div>
</div>
<p>　それでは <a href="#fig-intro-pointrange-4" class="quarto-xref">図&nbsp;11</a> と同じ図を作ってみよう。まず、切片の行を除外するが、ここでは<code>filter()</code>を使わず、<code>slice()</code>の使った方法を紹介する。<code>slice()</code>は<code>()</code>内に指定した行を残す関数だ。たとえば、<code>slice(fit1_coef, 2)</code>なら<code>fit1_coef</code>の2行目のみを残す。<code>fit1_coef</code>は<code>slice()</code>の第1引数だから、パイプ演算子を使うことも可能で、こちらの方を推奨する。そうすれば<code>()</code>内には残す行のみの指定で済む。<code>slice(2)</code>のみなら2行目を残し、<code>slice(1, 3, 5)</code>なら1、3、5行目を残す。<code>:</code>を使うと「〜行目から〜行目まで」の指定ができる。処置効果の係数は<code>fit1_coef</code>の2行目から5行目までなので、<code>2:5</code>と指定すれば良い。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a>fit1_coef <span class="ot">&lt;-</span> fit1_coef <span class="sc">|&gt;</span></span>
<span id="cb86-2"><a href="#cb86-2"></a>  <span class="fu">slice</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb86-3"><a href="#cb86-3"></a></span>
<span id="cb86-4"><a href="#cb86-4"></a>fit1_coef</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
  term                estimate std.error statistic   p.value conf.low conf.high
  &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 treatmentCivic Duty   0.0179   0.00260      6.88 5.85e- 12   0.0114    0.0244
2 treatmentHawthorne    0.0257   0.00260      9.90 4.37e- 23   0.0192    0.0322
3 treatmentSelf         0.0485   0.00260     18.7  1.22e- 77   0.0420    0.0550
4 treatmentNeighbors    0.0813   0.00260     31.3  2.94e-214   0.0748    0.0878</code></pre>
</div>
</div>
<p>　続いて、<code>term</code>変数の値から<code>"treatment"</code>の文字を除去し、<code>fit1_coef</code>での出力順番で<code>term</code>をfactor化する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a>fit1_coef <span class="ot">&lt;-</span> fit1_coef <span class="sc">|&gt;</span></span>
<span id="cb88-2"><a href="#cb88-2"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">recode</span>(term,</span>
<span id="cb88-3"><a href="#cb88-3"></a>                       <span class="st">"treatmentCivic Duty"</span> <span class="ot">=</span> <span class="st">"Civic Duty"</span>,</span>
<span id="cb88-4"><a href="#cb88-4"></a>                       <span class="st">"treatmentHawthorne"</span>  <span class="ot">=</span> <span class="st">"Hawthorne"</span>,</span>
<span id="cb88-5"><a href="#cb88-5"></a>                       <span class="st">"treatmentSelf"</span>       <span class="ot">=</span> <span class="st">"Self"</span>,</span>
<span id="cb88-6"><a href="#cb88-6"></a>                       <span class="st">"treatmentNeighbors"</span>  <span class="ot">=</span> <span class="st">"Neighbors"</span>),</span>
<span id="cb88-7"><a href="#cb88-7"></a>         <span class="at">term =</span> <span class="fu">fct_inorder</span>(term))</span>
<span id="cb88-8"><a href="#cb88-8"></a></span>
<span id="cb88-9"><a href="#cb88-9"></a>fit1_coef</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
  term       estimate std.error statistic   p.value conf.low conf.high
  &lt;fct&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 Civic Duty   0.0179   0.00260      6.88 5.85e- 12   0.0114    0.0244
2 Hawthorne    0.0257   0.00260      9.90 4.37e- 23   0.0192    0.0322
3 Self         0.0485   0.00260     18.7  1.22e- 77   0.0420    0.0550
4 Neighbors    0.0813   0.00260     31.3  2.94e-214   0.0748    0.0878</code></pre>
</div>
</div>
<p>　最後に <a href="#fig-intro-pointrange-4" class="quarto-xref">図&nbsp;11</a> と同じコードで作図する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a>fit1_coef <span class="sc">|&gt;</span></span>
<span id="cb90-2"><a href="#cb90-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb90-3"><a href="#cb90-3"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb90-4"><a href="#cb90-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> estimate,</span>
<span id="cb90-5"><a href="#cb90-5"></a>                      <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb90-6"><a href="#cb90-6"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Treatments"</span>, </span>
<span id="cb90-7"><a href="#cb90-7"></a>       <span class="at">y =</span> <span class="st">"Average Treatment Effects (w/ 98.75% CI)"</span>) <span class="sc">+</span></span>
<span id="cb90-8"><a href="#cb90-8"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-pointrange-5" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-intro-pointrange-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="intro_rct_files/figure-html/fig-intro-pointrange-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-intro-pointrange-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;12: 処置効果と98.75%信頼区間
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="統計的推定重回帰分析" class="level3">
<h3 class="anchored" data-anchor-id="統計的推定重回帰分析">統計的推定（重回帰分析）</h3>
<p>　今回の例は無作為割当が成功しており、処置前変数の偏りは見られない。しかし、何らかの理由で処置前変数の偏りが生じる場合がある。その「何らかの理由」が応答変数にまで影響を与えるのであれば、それは交絡変数（confounder）となり、バイアスの原因となる。この場合、偏りが生じている処置前変数を統制（control）することによってバイアスを小さくすることができる。今回は不要であるが、性別や誕生年などの共変量を統制した推定をしてみよう。</p>
<p>　やり方は簡単で、<code>lm()</code>内の回帰式を<code>応答変数 ~ 説明変数1 + 説明変数2 + ...</code>のように説明変数を<code>+</code>で足していけば良い。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a>fit2 <span class="ot">&lt;-</span><span class="fu">lm</span>(voted2006 <span class="sc">~</span> treatment <span class="sc">+</span> female <span class="sc">+</span> yob <span class="sc">+</span> hh_size <span class="sc">+</span></span>
<span id="cb91-2"><a href="#cb91-2"></a>            voted2000 <span class="sc">+</span> voted2002 <span class="sc">+</span> voted2004, <span class="at">data =</span> df)</span>
<span id="cb91-3"><a href="#cb91-3"></a></span>
<span id="cb91-4"><a href="#cb91-4"></a><span class="fu">summary</span>(fit2)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = voted2006 ~ treatment + female + yob + hh_size + 
    voted2000 + voted2002 + voted2004, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-0.7679 -0.3344 -0.1953  0.5300  0.9359 

Coefficients:
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)          5.845e+00  1.099e-01  53.202  &lt; 2e-16 ***
treatmentCivic Duty  1.839e-02  2.504e-03   7.343 2.10e-13 ***
treatmentHawthorne   2.506e-02  2.504e-03  10.005  &lt; 2e-16 ***
treatmentSelf        4.797e-02  2.504e-03  19.157  &lt; 2e-16 ***
treatmentNeighbors   8.064e-02  2.504e-03  32.199  &lt; 2e-16 ***
female              -5.783e-03  1.525e-03  -3.791  0.00015 ***
yob                 -2.913e-03  5.642e-05 -51.633  &lt; 2e-16 ***
hh_size              5.075e-03  1.018e-03   4.986 6.17e-07 ***
voted2000            9.401e-02  1.783e-03  52.722  &lt; 2e-16 ***
voted2002            1.414e-01  1.590e-03  88.876  &lt; 2e-16 ***
voted2004            1.578e-01  1.564e-03 100.838  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4469 on 344073 degrees of freedom
Multiple R-squared:  0.07592,   Adjusted R-squared:  0.0759 
F-statistic:  2827 on 10 and 344073 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>　{modelsummary}パッケージの<code>modelsummary()</code>関数を使えば、推定結果がより見やすくなる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a><span class="fu">modelsummary</span>(fit2)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_st0fll3pouz09n89i9o1(i, j, css_id) {
        var table = document.getElementById("tinytable_st0fll3pouz09n89i9o1");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_st0fll3pouz09n89i9o1');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_st0fll3pouz09n89i9o1(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_st0fll3pouz09n89i9o1");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(0, 0, 'tinytable_css_id50ty4ku75ang4vamlnnf') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(0, 1, 'tinytable_css_idtokcu26v8zopndv4epkf') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(1, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(1, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(2, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(2, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(3, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(3, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(4, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(4, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(5, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(5, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(6, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(6, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(7, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(7, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(8, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(8, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(9, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(9, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(10, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(10, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(11, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(11, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(12, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(12, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(13, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(13, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(14, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(14, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(15, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(15, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(16, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(16, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(17, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(17, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(18, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(18, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(19, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(19, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(20, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(20, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(21, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(21, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(22, 0, 'tinytable_css_idjjlm2lar1n3z3r6i2z6t') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(22, 1, 'tinytable_css_idfztdir9b1of2yodz5isl') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(23, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(23, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(24, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(24, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(25, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(25, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(26, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(26, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(27, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(27, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(28, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(28, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(29, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(29, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(30, 0, 'tinytable_css_idisrihasb8u110vzzrtlk') })
window.addEventListener('load', function () { styleCell_st0fll3pouz09n89i9o1(30, 1, 'tinytable_css_ide9v2g9bx72rb87pbweo5') })
    </script>

    <style>
    .table td.tinytable_css_id50ty4ku75ang4vamlnnf, .table th.tinytable_css_id50ty4ku75ang4vamlnnf {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idtokcu26v8zopndv4epkf, .table th.tinytable_css_idtokcu26v8zopndv4epkf {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idisrihasb8u110vzzrtlk, .table th.tinytable_css_idisrihasb8u110vzzrtlk {  text-align: left; }
    .table td.tinytable_css_ide9v2g9bx72rb87pbweo5, .table th.tinytable_css_ide9v2g9bx72rb87pbweo5 {  text-align: center; }
    .table td.tinytable_css_idjjlm2lar1n3z3r6i2z6t, .table th.tinytable_css_idjjlm2lar1n3z3r6i2z6t {  border-bottom: solid 0.05em black;  text-align: left; }
    .table td.tinytable_css_idfztdir9b1of2yodz5isl, .table th.tinytable_css_idfztdir9b1of2yodz5isl {  border-bottom: solid 0.05em black;  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_st0fll3pouz09n89i9o1" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">(1)</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>(Intercept)        </td>
                  <td>5.845      </td>
                </tr>
                <tr>
                  <td>                   </td>
                  <td>(0.110)    </td>
                </tr>
                <tr>
                  <td>treatmentCivic Duty</td>
                  <td>0.018      </td>
                </tr>
                <tr>
                  <td>                   </td>
                  <td>(0.003)    </td>
                </tr>
                <tr>
                  <td>treatmentHawthorne </td>
                  <td>0.025      </td>
                </tr>
                <tr>
                  <td>                   </td>
                  <td>(0.003)    </td>
                </tr>
                <tr>
                  <td>treatmentSelf      </td>
                  <td>0.048      </td>
                </tr>
                <tr>
                  <td>                   </td>
                  <td>(0.003)    </td>
                </tr>
                <tr>
                  <td>treatmentNeighbors </td>
                  <td>0.081      </td>
                </tr>
                <tr>
                  <td>                   </td>
                  <td>(0.003)    </td>
                </tr>
                <tr>
                  <td>female             </td>
                  <td>-0.006     </td>
                </tr>
                <tr>
                  <td>                   </td>
                  <td>(0.002)    </td>
                </tr>
                <tr>
                  <td>yob                </td>
                  <td>-0.003     </td>
                </tr>
                <tr>
                  <td>                   </td>
                  <td>(0.000)    </td>
                </tr>
                <tr>
                  <td>hh_size            </td>
                  <td>0.005      </td>
                </tr>
                <tr>
                  <td>                   </td>
                  <td>(0.001)    </td>
                </tr>
                <tr>
                  <td>voted2000          </td>
                  <td>0.094      </td>
                </tr>
                <tr>
                  <td>                   </td>
                  <td>(0.002)    </td>
                </tr>
                <tr>
                  <td>voted2002          </td>
                  <td>0.141      </td>
                </tr>
                <tr>
                  <td>                   </td>
                  <td>(0.002)    </td>
                </tr>
                <tr>
                  <td>voted2004          </td>
                  <td>0.158      </td>
                </tr>
                <tr>
                  <td>                   </td>
                  <td>(0.002)    </td>
                </tr>
                <tr>
                  <td>Num.Obs.           </td>
                  <td>344084     </td>
                </tr>
                <tr>
                  <td>R2                 </td>
                  <td>0.076      </td>
                </tr>
                <tr>
                  <td>R2 Adj.            </td>
                  <td>0.076      </td>
                </tr>
                <tr>
                  <td>AIC                </td>
                  <td>422192.9   </td>
                </tr>
                <tr>
                  <td>BIC                </td>
                  <td>422321.9   </td>
                </tr>
                <tr>
                  <td>Log.Lik.           </td>
                  <td>-211084.453</td>
                </tr>
                <tr>
                  <td>F                  </td>
                  <td>2826.942   </td>
                </tr>
                <tr>
                  <td>RMSE               </td>
                  <td>0.45       </td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>　また、複数のモデルを<code>list()</code>関数でまとめると、モデル間比較もできる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"w/o Covariates"</span> <span class="ot">=</span> fit1, <span class="st">"w/ Covariates"</span> <span class="ot">=</span> fit2))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_f4qhvw8zhj564yuh8edx(i, j, css_id) {
        var table = document.getElementById("tinytable_f4qhvw8zhj564yuh8edx");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_f4qhvw8zhj564yuh8edx');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_f4qhvw8zhj564yuh8edx(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_f4qhvw8zhj564yuh8edx");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(0, 0, 'tinytable_css_ido05ozwej648avdcqy4h6') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(0, 1, 'tinytable_css_idjfs9efzyp352r02129rz') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(0, 2, 'tinytable_css_idjfs9efzyp352r02129rz') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(1, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(1, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(1, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(2, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(2, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(2, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(3, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(3, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(3, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(4, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(4, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(4, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(5, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(5, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(5, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(6, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(6, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(6, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(7, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(7, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(7, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(8, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(8, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(8, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(9, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(9, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(9, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(10, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(10, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(10, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(11, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(11, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(11, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(12, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(12, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(12, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(13, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(13, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(13, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(14, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(14, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(14, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(15, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(15, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(15, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(16, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(16, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(16, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(17, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(17, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(17, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(18, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(18, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(18, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(19, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(19, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(19, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(20, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(20, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(20, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(21, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(21, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(21, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(22, 0, 'tinytable_css_id630wip6uzgvqcque474q') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(22, 1, 'tinytable_css_idkqq2ag7z9gymkq9uu7bq') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(22, 2, 'tinytable_css_idkqq2ag7z9gymkq9uu7bq') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(23, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(23, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(23, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(24, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(24, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(24, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(25, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(25, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(25, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(26, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(26, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(26, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(27, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(27, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(27, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(28, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(28, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(28, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(29, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(29, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(29, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(30, 0, 'tinytable_css_idii92yzdijamgxznen1yw') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(30, 1, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
window.addEventListener('load', function () { styleCell_f4qhvw8zhj564yuh8edx(30, 2, 'tinytable_css_iduo55qzn62f32mcj5fjux') })
    </script>

    <style>
    .table td.tinytable_css_ido05ozwej648avdcqy4h6, .table th.tinytable_css_ido05ozwej648avdcqy4h6 {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idjfs9efzyp352r02129rz, .table th.tinytable_css_idjfs9efzyp352r02129rz {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idii92yzdijamgxznen1yw, .table th.tinytable_css_idii92yzdijamgxznen1yw {  text-align: left; }
    .table td.tinytable_css_iduo55qzn62f32mcj5fjux, .table th.tinytable_css_iduo55qzn62f32mcj5fjux {  text-align: center; }
    .table td.tinytable_css_id630wip6uzgvqcque474q, .table th.tinytable_css_id630wip6uzgvqcque474q {  border-bottom: solid 0.05em black;  text-align: left; }
    .table td.tinytable_css_idkqq2ag7z9gymkq9uu7bq, .table th.tinytable_css_idkqq2ag7z9gymkq9uu7bq {  border-bottom: solid 0.05em black;  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_f4qhvw8zhj564yuh8edx" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">w/o Covariates</th>
                <th scope="col">w/ Covariates</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>(Intercept)        </td>
                  <td>0.297      </td>
                  <td>5.845      </td>
                </tr>
                <tr>
                  <td>                   </td>
                  <td>(0.001)    </td>
                  <td>(0.110)    </td>
                </tr>
                <tr>
                  <td>treatmentCivic Duty</td>
                  <td>0.018      </td>
                  <td>0.018      </td>
                </tr>
                <tr>
                  <td>                   </td>
                  <td>(0.003)    </td>
                  <td>(0.003)    </td>
                </tr>
                <tr>
                  <td>treatmentHawthorne </td>
                  <td>0.026      </td>
                  <td>0.025      </td>
                </tr>
                <tr>
                  <td>                   </td>
                  <td>(0.003)    </td>
                  <td>(0.003)    </td>
                </tr>
                <tr>
                  <td>treatmentSelf      </td>
                  <td>0.049      </td>
                  <td>0.048      </td>
                </tr>
                <tr>
                  <td>                   </td>
                  <td>(0.003)    </td>
                  <td>(0.003)    </td>
                </tr>
                <tr>
                  <td>treatmentNeighbors </td>
                  <td>0.081      </td>
                  <td>0.081      </td>
                </tr>
                <tr>
                  <td>                   </td>
                  <td>(0.003)    </td>
                  <td>(0.003)    </td>
                </tr>
                <tr>
                  <td>female             </td>
                  <td>           </td>
                  <td>-0.006     </td>
                </tr>
                <tr>
                  <td>                   </td>
                  <td>           </td>
                  <td>(0.002)    </td>
                </tr>
                <tr>
                  <td>yob                </td>
                  <td>           </td>
                  <td>-0.003     </td>
                </tr>
                <tr>
                  <td>                   </td>
                  <td>           </td>
                  <td>(0.000)    </td>
                </tr>
                <tr>
                  <td>hh_size            </td>
                  <td>           </td>
                  <td>0.005      </td>
                </tr>
                <tr>
                  <td>                   </td>
                  <td>           </td>
                  <td>(0.001)    </td>
                </tr>
                <tr>
                  <td>voted2000          </td>
                  <td>           </td>
                  <td>0.094      </td>
                </tr>
                <tr>
                  <td>                   </td>
                  <td>           </td>
                  <td>(0.002)    </td>
                </tr>
                <tr>
                  <td>voted2002          </td>
                  <td>           </td>
                  <td>0.141      </td>
                </tr>
                <tr>
                  <td>                   </td>
                  <td>           </td>
                  <td>(0.002)    </td>
                </tr>
                <tr>
                  <td>voted2004          </td>
                  <td>           </td>
                  <td>0.158      </td>
                </tr>
                <tr>
                  <td>                   </td>
                  <td>           </td>
                  <td>(0.002)    </td>
                </tr>
                <tr>
                  <td>Num.Obs.           </td>
                  <td>344084     </td>
                  <td>344084     </td>
                </tr>
                <tr>
                  <td>R2                 </td>
                  <td>0.003      </td>
                  <td>0.076      </td>
                </tr>
                <tr>
                  <td>R2 Adj.            </td>
                  <td>0.003      </td>
                  <td>0.076      </td>
                </tr>
                <tr>
                  <td>AIC                </td>
                  <td>448179.9   </td>
                  <td>422192.9   </td>
                </tr>
                <tr>
                  <td>BIC                </td>
                  <td>448244.4   </td>
                  <td>422321.9   </td>
                </tr>
                <tr>
                  <td>Log.Lik.           </td>
                  <td>-224083.935</td>
                  <td>-211084.453</td>
                </tr>
                <tr>
                  <td>F                  </td>
                  <td>292.976    </td>
                  <td>2826.942   </td>
                </tr>
                <tr>
                  <td>RMSE               </td>
                  <td>0.46       </td>
                  <td>0.45       </td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>　<code>modelsummary()</code>は推定値と標準誤差（カッコ内）が別々の行として出力する。これを一行でまとめるためには、以下のようにコードを修正する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"w/o Covariates"</span> <span class="ot">=</span> fit1, <span class="st">"w/ Covariates"</span> <span class="ot">=</span> fit2),</span>
<span id="cb95-2"><a href="#cb95-2"></a>             <span class="at">estimate  =</span> <span class="st">"{estimate} ({std.error})"</span>,</span>
<span id="cb95-3"><a href="#cb95-3"></a>             <span class="at">statistic =</span> <span class="cn">NULL</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_fzrizlp00puy2tswblne(i, j, css_id) {
        var table = document.getElementById("tinytable_fzrizlp00puy2tswblne");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_fzrizlp00puy2tswblne');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_fzrizlp00puy2tswblne(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_fzrizlp00puy2tswblne");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(0, 0, 'tinytable_css_idlmagcqr2kxx4ham7u7qq') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(0, 1, 'tinytable_css_id2uuxjb2ifuno3nyrpzp0') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(0, 2, 'tinytable_css_id2uuxjb2ifuno3nyrpzp0') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(1, 0, 'tinytable_css_idz67m2aetdyixkhi1qcf7') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(1, 1, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(1, 2, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(2, 0, 'tinytable_css_idz67m2aetdyixkhi1qcf7') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(2, 1, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(2, 2, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(3, 0, 'tinytable_css_idz67m2aetdyixkhi1qcf7') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(3, 1, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(3, 2, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(4, 0, 'tinytable_css_idz67m2aetdyixkhi1qcf7') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(4, 1, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(4, 2, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(5, 0, 'tinytable_css_idz67m2aetdyixkhi1qcf7') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(5, 1, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(5, 2, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(6, 0, 'tinytable_css_idz67m2aetdyixkhi1qcf7') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(6, 1, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(6, 2, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(7, 0, 'tinytable_css_idz67m2aetdyixkhi1qcf7') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(7, 1, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(7, 2, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(8, 0, 'tinytable_css_idz67m2aetdyixkhi1qcf7') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(8, 1, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(8, 2, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(9, 0, 'tinytable_css_idz67m2aetdyixkhi1qcf7') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(9, 1, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(9, 2, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(10, 0, 'tinytable_css_idz67m2aetdyixkhi1qcf7') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(10, 1, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(10, 2, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(11, 0, 'tinytable_css_idmpkpzeyrdw2jsg0f01r3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(11, 1, 'tinytable_css_idqj4y6c8cj28cghtodsug') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(11, 2, 'tinytable_css_idqj4y6c8cj28cghtodsug') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(12, 0, 'tinytable_css_idz67m2aetdyixkhi1qcf7') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(12, 1, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(12, 2, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(13, 0, 'tinytable_css_idz67m2aetdyixkhi1qcf7') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(13, 1, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(13, 2, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(14, 0, 'tinytable_css_idz67m2aetdyixkhi1qcf7') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(14, 1, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(14, 2, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(15, 0, 'tinytable_css_idz67m2aetdyixkhi1qcf7') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(15, 1, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(15, 2, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(16, 0, 'tinytable_css_idz67m2aetdyixkhi1qcf7') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(16, 1, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(16, 2, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(17, 0, 'tinytable_css_idz67m2aetdyixkhi1qcf7') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(17, 1, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(17, 2, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(18, 0, 'tinytable_css_idz67m2aetdyixkhi1qcf7') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(18, 1, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(18, 2, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(19, 0, 'tinytable_css_idz67m2aetdyixkhi1qcf7') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(19, 1, 'tinytable_css_idfnair266n7th18gs4rw3') })
window.addEventListener('load', function () { styleCell_fzrizlp00puy2tswblne(19, 2, 'tinytable_css_idfnair266n7th18gs4rw3') })
    </script>

    <style>
    .table td.tinytable_css_idlmagcqr2kxx4ham7u7qq, .table th.tinytable_css_idlmagcqr2kxx4ham7u7qq {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id2uuxjb2ifuno3nyrpzp0, .table th.tinytable_css_id2uuxjb2ifuno3nyrpzp0 {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idz67m2aetdyixkhi1qcf7, .table th.tinytable_css_idz67m2aetdyixkhi1qcf7 {  text-align: left; }
    .table td.tinytable_css_idfnair266n7th18gs4rw3, .table th.tinytable_css_idfnair266n7th18gs4rw3 {  text-align: center; }
    .table td.tinytable_css_idmpkpzeyrdw2jsg0f01r3, .table th.tinytable_css_idmpkpzeyrdw2jsg0f01r3 {  border-bottom: solid 0.05em black;  text-align: left; }
    .table td.tinytable_css_idqj4y6c8cj28cghtodsug, .table th.tinytable_css_idqj4y6c8cj28cghtodsug {  border-bottom: solid 0.05em black;  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_fzrizlp00puy2tswblne" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">w/o Covariates</th>
                <th scope="col">w/ Covariates</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>(Intercept)        </td>
                  <td>0.297 (0.001)</td>
                  <td>5.845 (0.110) </td>
                </tr>
                <tr>
                  <td>treatmentCivic Duty</td>
                  <td>0.018 (0.003)</td>
                  <td>0.018 (0.003) </td>
                </tr>
                <tr>
                  <td>treatmentHawthorne </td>
                  <td>0.026 (0.003)</td>
                  <td>0.025 (0.003) </td>
                </tr>
                <tr>
                  <td>treatmentSelf      </td>
                  <td>0.049 (0.003)</td>
                  <td>0.048 (0.003) </td>
                </tr>
                <tr>
                  <td>treatmentNeighbors </td>
                  <td>0.081 (0.003)</td>
                  <td>0.081 (0.003) </td>
                </tr>
                <tr>
                  <td>female             </td>
                  <td>             </td>
                  <td>-0.006 (0.002)</td>
                </tr>
                <tr>
                  <td>yob                </td>
                  <td>             </td>
                  <td>-0.003 (0.000)</td>
                </tr>
                <tr>
                  <td>hh_size            </td>
                  <td>             </td>
                  <td>0.005 (0.001) </td>
                </tr>
                <tr>
                  <td>voted2000          </td>
                  <td>             </td>
                  <td>0.094 (0.002) </td>
                </tr>
                <tr>
                  <td>voted2002          </td>
                  <td>             </td>
                  <td>0.141 (0.002) </td>
                </tr>
                <tr>
                  <td>voted2004          </td>
                  <td>             </td>
                  <td>0.158 (0.002) </td>
                </tr>
                <tr>
                  <td>Num.Obs.           </td>
                  <td>344084       </td>
                  <td>344084        </td>
                </tr>
                <tr>
                  <td>R2                 </td>
                  <td>0.003        </td>
                  <td>0.076         </td>
                </tr>
                <tr>
                  <td>R2 Adj.            </td>
                  <td>0.003        </td>
                  <td>0.076         </td>
                </tr>
                <tr>
                  <td>AIC                </td>
                  <td>448179.9     </td>
                  <td>422192.9      </td>
                </tr>
                <tr>
                  <td>BIC                </td>
                  <td>448244.4     </td>
                  <td>422321.9      </td>
                </tr>
                <tr>
                  <td>Log.Lik.           </td>
                  <td>-224083.935  </td>
                  <td>-211084.453   </td>
                </tr>
                <tr>
                  <td>F                  </td>
                  <td>292.976      </td>
                  <td>2826.942      </td>
                </tr>
                <tr>
                  <td>RMSE               </td>
                  <td>0.46         </td>
                  <td>0.45          </td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>　また、<code>align</code>で各列を左寄せや右寄せに（文字列は左寄せ、数値は右寄せが一般的）、<code>coef_rename</code>引数で表示される変数名を変更することもできる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"w/o Covariates"</span> <span class="ot">=</span> fit1, <span class="st">"w/ Covariates"</span> <span class="ot">=</span> fit2),</span>
<span id="cb96-2"><a href="#cb96-2"></a>             <span class="at">estimate  =</span> <span class="st">"{estimate} ({std.error})"</span>,</span>
<span id="cb96-3"><a href="#cb96-3"></a>             <span class="at">statistic =</span> <span class="cn">NULL</span>,</span>
<span id="cb96-4"><a href="#cb96-4"></a>             <span class="at">align =</span> <span class="st">"lrr"</span>, <span class="co"># 1列は左寄せ、2列は右寄せ、3列は右寄せ</span></span>
<span id="cb96-5"><a href="#cb96-5"></a>             <span class="at">coef_rename =</span> <span class="fu">c</span>(<span class="st">"treatmentCivic Duty"</span> <span class="ot">=</span> <span class="st">"Civic Duty"</span>,</span>
<span id="cb96-6"><a href="#cb96-6"></a>                             <span class="st">"treatmentHawthorne"</span>  <span class="ot">=</span> <span class="st">"Hawthorne"</span>,</span>
<span id="cb96-7"><a href="#cb96-7"></a>                             <span class="st">"treatmentSelf"</span>       <span class="ot">=</span> <span class="st">"Self"</span>,</span>
<span id="cb96-8"><a href="#cb96-8"></a>                             <span class="st">"treatmentNeighbors"</span>  <span class="ot">=</span> <span class="st">"Neighbors"</span>,</span>
<span id="cb96-9"><a href="#cb96-9"></a>                             <span class="st">"female"</span>              <span class="ot">=</span> <span class="st">"Female"</span>,</span>
<span id="cb96-10"><a href="#cb96-10"></a>                             <span class="st">"yob"</span>                 <span class="ot">=</span> <span class="st">"Year of Birth"</span>,</span>
<span id="cb96-11"><a href="#cb96-11"></a>                             <span class="st">"hh_size"</span>             <span class="ot">=</span> <span class="st">"Household Size"</span>,</span>
<span id="cb96-12"><a href="#cb96-12"></a>                             <span class="st">"voted2000"</span>           <span class="ot">=</span> <span class="st">"Voted (2000)"</span>,</span>
<span id="cb96-13"><a href="#cb96-13"></a>                             <span class="st">"voted2002"</span>           <span class="ot">=</span> <span class="st">"Voted (2002)"</span>,</span>
<span id="cb96-14"><a href="#cb96-14"></a>                             <span class="st">"voted2004"</span>           <span class="ot">=</span> <span class="st">"Voted (2004)"</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_sy8gg5cqabd5qk3i9x2i(i, j, css_id) {
        var table = document.getElementById("tinytable_sy8gg5cqabd5qk3i9x2i");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_sy8gg5cqabd5qk3i9x2i');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_sy8gg5cqabd5qk3i9x2i(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_sy8gg5cqabd5qk3i9x2i");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(0, 0, 'tinytable_css_idugxzodqipdnw45doqgnd') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(0, 1, 'tinytable_css_idmvuuyf105pmghh8ld0ay') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(0, 2, 'tinytable_css_idmvuuyf105pmghh8ld0ay') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(1, 0, 'tinytable_css_idwr0q48aakjm448o69rpu') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(1, 1, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(1, 2, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(2, 0, 'tinytable_css_idwr0q48aakjm448o69rpu') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(2, 1, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(2, 2, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(3, 0, 'tinytable_css_idwr0q48aakjm448o69rpu') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(3, 1, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(3, 2, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(4, 0, 'tinytable_css_idwr0q48aakjm448o69rpu') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(4, 1, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(4, 2, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(5, 0, 'tinytable_css_idwr0q48aakjm448o69rpu') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(5, 1, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(5, 2, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(6, 0, 'tinytable_css_idwr0q48aakjm448o69rpu') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(6, 1, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(6, 2, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(7, 0, 'tinytable_css_idwr0q48aakjm448o69rpu') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(7, 1, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(7, 2, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(8, 0, 'tinytable_css_idwr0q48aakjm448o69rpu') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(8, 1, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(8, 2, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(9, 0, 'tinytable_css_idwr0q48aakjm448o69rpu') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(9, 1, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(9, 2, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(10, 0, 'tinytable_css_idwr0q48aakjm448o69rpu') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(10, 1, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(10, 2, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(11, 0, 'tinytable_css_idhgx4vrqzkqx23blnymok') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(11, 1, 'tinytable_css_idr643b20dvwwrbka1ckjd') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(11, 2, 'tinytable_css_idr643b20dvwwrbka1ckjd') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(12, 0, 'tinytable_css_idwr0q48aakjm448o69rpu') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(12, 1, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(12, 2, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(13, 0, 'tinytable_css_idwr0q48aakjm448o69rpu') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(13, 1, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(13, 2, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(14, 0, 'tinytable_css_idwr0q48aakjm448o69rpu') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(14, 1, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(14, 2, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(15, 0, 'tinytable_css_idwr0q48aakjm448o69rpu') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(15, 1, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(15, 2, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(16, 0, 'tinytable_css_idwr0q48aakjm448o69rpu') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(16, 1, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(16, 2, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(17, 0, 'tinytable_css_idwr0q48aakjm448o69rpu') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(17, 1, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(17, 2, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(18, 0, 'tinytable_css_idwr0q48aakjm448o69rpu') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(18, 1, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(18, 2, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(19, 0, 'tinytable_css_idwr0q48aakjm448o69rpu') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(19, 1, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
window.addEventListener('load', function () { styleCell_sy8gg5cqabd5qk3i9x2i(19, 2, 'tinytable_css_iduawgf4b8fkg24mbw9e2q') })
    </script>

    <style>
    .table td.tinytable_css_idugxzodqipdnw45doqgnd, .table th.tinytable_css_idugxzodqipdnw45doqgnd {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idmvuuyf105pmghh8ld0ay, .table th.tinytable_css_idmvuuyf105pmghh8ld0ay {  text-align: right;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idwr0q48aakjm448o69rpu, .table th.tinytable_css_idwr0q48aakjm448o69rpu {  text-align: left; }
    .table td.tinytable_css_iduawgf4b8fkg24mbw9e2q, .table th.tinytable_css_iduawgf4b8fkg24mbw9e2q {  text-align: right; }
    .table td.tinytable_css_idhgx4vrqzkqx23blnymok, .table th.tinytable_css_idhgx4vrqzkqx23blnymok {  border-bottom: solid 0.05em black;  text-align: left; }
    .table td.tinytable_css_idr643b20dvwwrbka1ckjd, .table th.tinytable_css_idr643b20dvwwrbka1ckjd {  border-bottom: solid 0.05em black;  text-align: right; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_sy8gg5cqabd5qk3i9x2i" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">w/o Covariates</th>
                <th scope="col">w/ Covariates</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>(Intercept)   </td>
                  <td>0.297 (0.001)</td>
                  <td>5.845 (0.110) </td>
                </tr>
                <tr>
                  <td>Civic Duty    </td>
                  <td>0.018 (0.003)</td>
                  <td>0.018 (0.003) </td>
                </tr>
                <tr>
                  <td>Hawthorne     </td>
                  <td>0.026 (0.003)</td>
                  <td>0.025 (0.003) </td>
                </tr>
                <tr>
                  <td>Self          </td>
                  <td>0.049 (0.003)</td>
                  <td>0.048 (0.003) </td>
                </tr>
                <tr>
                  <td>Neighbors     </td>
                  <td>0.081 (0.003)</td>
                  <td>0.081 (0.003) </td>
                </tr>
                <tr>
                  <td>Female        </td>
                  <td>             </td>
                  <td>-0.006 (0.002)</td>
                </tr>
                <tr>
                  <td>Year of Birth </td>
                  <td>             </td>
                  <td>-0.003 (0.000)</td>
                </tr>
                <tr>
                  <td>Household Size</td>
                  <td>             </td>
                  <td>0.005 (0.001) </td>
                </tr>
                <tr>
                  <td>Voted (2000)  </td>
                  <td>             </td>
                  <td>0.094 (0.002) </td>
                </tr>
                <tr>
                  <td>Voted (2002)  </td>
                  <td>             </td>
                  <td>0.141 (0.002) </td>
                </tr>
                <tr>
                  <td>Voted (2004)  </td>
                  <td>             </td>
                  <td>0.158 (0.002) </td>
                </tr>
                <tr>
                  <td>Num.Obs.      </td>
                  <td>344084       </td>
                  <td>344084        </td>
                </tr>
                <tr>
                  <td>R2            </td>
                  <td>0.003        </td>
                  <td>0.076         </td>
                </tr>
                <tr>
                  <td>R2 Adj.       </td>
                  <td>0.003        </td>
                  <td>0.076         </td>
                </tr>
                <tr>
                  <td>AIC           </td>
                  <td>448179.9     </td>
                  <td>422192.9      </td>
                </tr>
                <tr>
                  <td>BIC           </td>
                  <td>448244.4     </td>
                  <td>422321.9      </td>
                </tr>
                <tr>
                  <td>Log.Lik.      </td>
                  <td>-224083.935  </td>
                  <td>-211084.453   </td>
                </tr>
                <tr>
                  <td>F             </td>
                  <td>292.976      </td>
                  <td>2826.942      </td>
                </tr>
                <tr>
                  <td>RMSE          </td>
                  <td>0.46         </td>
                  <td>0.45          </td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>　処置効果に注目すると、共変量の有無が推定結果に影響をほぼ与えないことが分かる。これは無作為割当に成功したことを意味する。</p>
</section>
</section>
<section id="番外編" class="level2">
<h2 class="anchored" data-anchor-id="番外編">番外編</h2>
<section id="複数モデルの出力" class="level3">
<h3 class="anchored" data-anchor-id="複数モデルの出力">複数モデルの出力</h3>
<p>　<code>modelsummary()</code>を使えば、複数のモデルの推定結果を一つの表としてまとめられる。しかし、図の場合はどうだろう。共変量なしモデルとありモデルを <a href="#fig-intro-pointrange-5" class="quarto-xref">図&nbsp;12</a> のように一つにまとめることはできるだろうか。もちろん出来る。</p>
<p>　まず、重回帰分析を行った結果（<code>fit2</code>）から処置効果の推定値情報を抽出し、<code>fit1_coef</code>と同じ構造のデータとしてまとめる。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a>fit2_coef <span class="ot">&lt;-</span> <span class="fu">tidy</span>(fit2, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.9875</span>)</span>
<span id="cb97-2"><a href="#cb97-2"></a></span>
<span id="cb97-3"><a href="#cb97-3"></a>fit2_coef <span class="ot">&lt;-</span> fit2_coef <span class="sc">|&gt;</span></span>
<span id="cb97-4"><a href="#cb97-4"></a>  <span class="fu">slice</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb97-5"><a href="#cb97-5"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">recode</span>(term,</span>
<span id="cb97-6"><a href="#cb97-6"></a>                       <span class="st">"treatmentCivic Duty"</span> <span class="ot">=</span> <span class="st">"Civic Duty"</span>,</span>
<span id="cb97-7"><a href="#cb97-7"></a>                       <span class="st">"treatmentHawthorne"</span>  <span class="ot">=</span> <span class="st">"Hawthorne"</span>,</span>
<span id="cb97-8"><a href="#cb97-8"></a>                       <span class="st">"treatmentSelf"</span>       <span class="ot">=</span> <span class="st">"Self"</span>,</span>
<span id="cb97-9"><a href="#cb97-9"></a>                       <span class="st">"treatmentNeighbors"</span>  <span class="ot">=</span> <span class="st">"Neighbors"</span>),</span>
<span id="cb97-10"><a href="#cb97-10"></a>         <span class="at">term =</span> <span class="fu">fct_inorder</span>(term))</span>
<span id="cb97-11"><a href="#cb97-11"></a></span>
<span id="cb97-12"><a href="#cb97-12"></a>fit2_coef</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
  term       estimate std.error statistic   p.value conf.low conf.high
  &lt;fct&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 Civic Duty   0.0184   0.00250      7.34 2.10e- 13   0.0121    0.0246
2 Hawthorne    0.0251   0.00250     10.0  1.45e- 23   0.0188    0.0313
3 Self         0.0480   0.00250     19.2  9.27e- 82   0.0417    0.0542
4 Neighbors    0.0806   0.00250     32.2  3.92e-227   0.0744    0.0869</code></pre>
</div>
</div>
<p>　処置効果の推定値や標準誤差などが異なるが、構造としては同じである。続いて、<code>bind_rows()</code>を用い、この2つのデータを一つの表として結合する。2つの表は<code>list()</code>関数でまとめるが、それぞれ<code>"モデル名" = データ名</code>と指定する。最後に、<code>.id = "Model"</code>を追加する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a><span class="fu">bind_rows</span>(<span class="fu">list</span>(<span class="st">"Model 1"</span> <span class="ot">=</span> fit1_coef, </span>
<span id="cb99-2"><a href="#cb99-2"></a>               <span class="st">"Model 2"</span> <span class="ot">=</span> fit2_coef),</span>
<span id="cb99-3"><a href="#cb99-3"></a>          <span class="at">.id =</span> <span class="st">"Model"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 8
  Model   term       estimate std.error statistic   p.value conf.low conf.high
  &lt;chr&gt;   &lt;fct&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 Model 1 Civic Duty   0.0179   0.00260      6.88 5.85e- 12   0.0114    0.0244
2 Model 1 Hawthorne    0.0257   0.00260      9.90 4.37e- 23   0.0192    0.0322
3 Model 1 Self         0.0485   0.00260     18.7  1.22e- 77   0.0420    0.0550
4 Model 1 Neighbors    0.0813   0.00260     31.3  2.94e-214   0.0748    0.0878
5 Model 2 Civic Duty   0.0184   0.00250      7.34 2.10e- 13   0.0121    0.0246
6 Model 2 Hawthorne    0.0251   0.00250     10.0  1.45e- 23   0.0188    0.0313
7 Model 2 Self         0.0480   0.00250     19.2  9.27e- 82   0.0417    0.0542
8 Model 2 Neighbors    0.0806   0.00250     32.2  3.92e-227   0.0744    0.0869</code></pre>
</div>
</div>
<p>　2つの表が1つとなり、<code>Model</code>という列が追加される（これは<code>.id</code>で指定した名前）。そして、<code>fit1_coef</code>だった行は<code>"Model 1"</code>、<code>fit2_coef</code>だった行は<code>"Model 2"</code>が付く。ただし、これだけだと表が結合されて出力される<strong>だけ</strong>なので、<code>fit_coef</code>という名のオブジェクトとして作業環境内に格納しておく。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a>fit_coef <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">list</span>(<span class="st">"Model 1"</span> <span class="ot">=</span> fit1_coef, </span>
<span id="cb101-2"><a href="#cb101-2"></a>                           <span class="st">"Model 2"</span> <span class="ot">=</span> fit2_coef),</span>
<span id="cb101-3"><a href="#cb101-3"></a>                      <span class="at">.id =</span> <span class="st">"Model"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　それでは<code>fit_coef</code>を使って、作図をしてみよう。コードは <a href="#fig-intro-pointrange-5" class="quarto-xref">図&nbsp;12</a> と同じであるが、<code>facet_wrap()</code>レイヤーを追加する。これはグラフのファセット（facet）分割を意味し、ファセットとは「面」を意味する。<code>()</code>内には<code>~分割の基準となる変数名</code>を入れる。2つのモデルがあり、<code>fit_coef</code>だと<code>Model</code>列がどのモデルの推定値かを示している。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1"></a>fit_coef <span class="sc">|&gt;</span></span>
<span id="cb102-2"><a href="#cb102-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb102-3"><a href="#cb102-3"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb102-4"><a href="#cb102-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> estimate,</span>
<span id="cb102-5"><a href="#cb102-5"></a>                      <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb102-6"><a href="#cb102-6"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Treatments"</span>, <span class="at">y =</span> <span class="st">"Average Treatment Effects"</span>) <span class="sc">+</span></span>
<span id="cb102-7"><a href="#cb102-7"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Model) <span class="sc">+</span></span>
<span id="cb102-8"><a href="#cb102-8"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-pointrange-6" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-intro-pointrange-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="intro_rct_files/figure-html/fig-intro-pointrange-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-intro-pointrange-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;13: Model 1とModel 2の比較（ファセット分割）
</figcaption>
</figure>
</div>
</div>
</div>
<p>　今回の結果だとモデル1もモデル2も推定値がほぼ同じである。ファセット分割の場合、小さい差の比較が難しいというデメリットがある。この場合、ファセット分割をせず、一つのファセットにpoint-rangeの色分けした方が読みやすくなる。point-rangeを<code>Model</code>の値に応じて色分けする場合、<code>aes()</code>内に<code>color = Model</code>を追加する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a>fit_coef <span class="sc">|&gt;</span></span>
<span id="cb103-2"><a href="#cb103-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb103-3"><a href="#cb103-3"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb103-4"><a href="#cb103-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> estimate,</span>
<span id="cb103-5"><a href="#cb103-5"></a>                      <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high,</span>
<span id="cb103-6"><a href="#cb103-6"></a>                      <span class="at">color =</span> Model)) <span class="sc">+</span></span>
<span id="cb103-7"><a href="#cb103-7"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Treatments"</span>, <span class="at">y =</span> <span class="st">"Average Treatment Effects"</span>) <span class="sc">+</span></span>
<span id="cb103-8"><a href="#cb103-8"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-pointrange-7" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-intro-pointrange-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="intro_rct_files/figure-html/fig-intro-pointrange-7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-intro-pointrange-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;14: Model 1とModel 2の比較（色分け）
</figcaption>
</figure>
</div>
</div>
</div>
<p>　何かおかしい。point-rangeの横軸上の位置が同じということから重なってしまい、モデル1のpoint-rangeがよく見えない。これをずらすために<code>aes()</code>の<strong>外</strong>側に<code>position = position_dodge2(1/2)</code>を追加する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1"></a>fit_coef <span class="sc">|&gt;</span></span>
<span id="cb104-2"><a href="#cb104-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb104-3"><a href="#cb104-3"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb104-4"><a href="#cb104-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> estimate,</span>
<span id="cb104-5"><a href="#cb104-5"></a>                      <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high,</span>
<span id="cb104-6"><a href="#cb104-6"></a>                      <span class="at">color =</span> Model),</span>
<span id="cb104-7"><a href="#cb104-7"></a>                  <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb104-8"><a href="#cb104-8"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Treatments"</span>, <span class="at">y =</span> <span class="st">"Average Treatment Effects"</span>) <span class="sc">+</span></span>
<span id="cb104-9"><a href="#cb104-9"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-pointrange-8" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-intro-pointrange-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="intro_rct_files/figure-html/fig-intro-pointrange-8-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-intro-pointrange-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;15: Pointrangeの位置調整
</figcaption>
</figure>
</div>
</div>
</div>
<p>　これで図は完成だが、少し修正してみよう。{ggplot2}の場合、凡例は右側に表示されるが、これを下側へ移動させるためには<code>theme()</code>レイヤーを追加し、<code>legend.position = "bottom"</code>を指定する。また、モデル1とモデル2が具体的に何を意味するのかを明確に示したい。これは<code>fit_coef</code>の<code>Model</code>列を修正しても良いが、今回は<code>scale_color_discrete()</code>レイヤーで修正する例を紹介する。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a>fit_coef <span class="sc">|&gt;</span></span>
<span id="cb105-2"><a href="#cb105-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb105-3"><a href="#cb105-3"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb105-4"><a href="#cb105-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> estimate,</span>
<span id="cb105-5"><a href="#cb105-5"></a>                      <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high,</span>
<span id="cb105-6"><a href="#cb105-6"></a>                      <span class="at">color =</span> Model),</span>
<span id="cb105-7"><a href="#cb105-7"></a>                  <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb105-8"><a href="#cb105-8"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Treatments"</span>, <span class="at">y =</span> <span class="st">"Average Treatment Effects"</span>) <span class="sc">+</span></span>
<span id="cb105-9"><a href="#cb105-9"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Model 1"</span> <span class="ot">=</span> <span class="st">"w/o Covariates"</span>,</span>
<span id="cb105-10"><a href="#cb105-10"></a>                                  <span class="st">"Model 2"</span> <span class="ot">=</span> <span class="st">"w/ Covariates"</span>)) <span class="sc">+</span></span>
<span id="cb105-11"><a href="#cb105-11"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb105-12"><a href="#cb105-12"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-pointrange-9" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-intro-pointrange-9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="intro_rct_files/figure-html/fig-intro-pointrange-9-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-intro-pointrange-9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;16: 凡例の位置調整
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="交互作用" class="level3">
<h3 class="anchored" data-anchor-id="交互作用">交互作用</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(voted2006 <span class="sc">~</span> treatment <span class="sc">*</span> hh_size <span class="sc">+</span> female <span class="sc">+</span> yob <span class="sc">+</span> hh_size <span class="sc">+</span></span>
<span id="cb106-2"><a href="#cb106-2"></a>             voted2000 <span class="sc">+</span> voted2002 <span class="sc">+</span> voted2004, <span class="at">data =</span> df)</span>
<span id="cb106-3"><a href="#cb106-3"></a></span>
<span id="cb106-4"><a href="#cb106-4"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"w/o Interaction"</span> <span class="ot">=</span> fit2, <span class="st">"w/ Interaction"</span> <span class="ot">=</span> fit3),</span>
<span id="cb106-5"><a href="#cb106-5"></a>             <span class="at">estimate  =</span> <span class="st">"{estimate} ({std.error})"</span>,</span>
<span id="cb106-6"><a href="#cb106-6"></a>             <span class="at">statistic =</span> <span class="cn">NULL</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_2fy2cd8z64zdza4avk5t(i, j, css_id) {
        var table = document.getElementById("tinytable_2fy2cd8z64zdza4avk5t");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_2fy2cd8z64zdza4avk5t');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_2fy2cd8z64zdza4avk5t(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_2fy2cd8z64zdza4avk5t");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(0, 0, 'tinytable_css_idv8mxijuuuj2w4kj5dkds') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(0, 1, 'tinytable_css_id9r9rnk6sd2ofr9m4npw4') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(0, 2, 'tinytable_css_id9r9rnk6sd2ofr9m4npw4') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(1, 0, 'tinytable_css_iddq0c94v6ok1jgclvcgxs') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(1, 1, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(1, 2, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(2, 0, 'tinytable_css_iddq0c94v6ok1jgclvcgxs') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(2, 1, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(2, 2, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(3, 0, 'tinytable_css_iddq0c94v6ok1jgclvcgxs') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(3, 1, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(3, 2, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(4, 0, 'tinytable_css_iddq0c94v6ok1jgclvcgxs') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(4, 1, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(4, 2, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(5, 0, 'tinytable_css_iddq0c94v6ok1jgclvcgxs') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(5, 1, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(5, 2, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(6, 0, 'tinytable_css_iddq0c94v6ok1jgclvcgxs') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(6, 1, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(6, 2, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(7, 0, 'tinytable_css_iddq0c94v6ok1jgclvcgxs') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(7, 1, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(7, 2, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(8, 0, 'tinytable_css_iddq0c94v6ok1jgclvcgxs') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(8, 1, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(8, 2, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(9, 0, 'tinytable_css_iddq0c94v6ok1jgclvcgxs') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(9, 1, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(9, 2, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(10, 0, 'tinytable_css_iddq0c94v6ok1jgclvcgxs') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(10, 1, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(10, 2, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(11, 0, 'tinytable_css_iddq0c94v6ok1jgclvcgxs') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(11, 1, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(11, 2, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(12, 0, 'tinytable_css_iddq0c94v6ok1jgclvcgxs') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(12, 1, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(12, 2, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(13, 0, 'tinytable_css_iddq0c94v6ok1jgclvcgxs') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(13, 1, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(13, 2, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(14, 0, 'tinytable_css_iddq0c94v6ok1jgclvcgxs') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(14, 1, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(14, 2, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(15, 0, 'tinytable_css_id1kqf0hfl7gz9voqxlin3') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(15, 1, 'tinytable_css_iduxjs7y5emt10kns7m8sl') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(15, 2, 'tinytable_css_iduxjs7y5emt10kns7m8sl') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(16, 0, 'tinytable_css_iddq0c94v6ok1jgclvcgxs') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(16, 1, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(16, 2, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(17, 0, 'tinytable_css_iddq0c94v6ok1jgclvcgxs') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(17, 1, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(17, 2, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(18, 0, 'tinytable_css_iddq0c94v6ok1jgclvcgxs') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(18, 1, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(18, 2, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(19, 0, 'tinytable_css_iddq0c94v6ok1jgclvcgxs') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(19, 1, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(19, 2, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(20, 0, 'tinytable_css_iddq0c94v6ok1jgclvcgxs') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(20, 1, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(20, 2, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(21, 0, 'tinytable_css_iddq0c94v6ok1jgclvcgxs') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(21, 1, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(21, 2, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(22, 0, 'tinytable_css_iddq0c94v6ok1jgclvcgxs') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(22, 1, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(22, 2, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(23, 0, 'tinytable_css_iddq0c94v6ok1jgclvcgxs') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(23, 1, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
window.addEventListener('load', function () { styleCell_2fy2cd8z64zdza4avk5t(23, 2, 'tinytable_css_id3qkfj6km47eeb9kk7whb') })
    </script>

    <style>
    .table td.tinytable_css_idv8mxijuuuj2w4kj5dkds, .table th.tinytable_css_idv8mxijuuuj2w4kj5dkds {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id9r9rnk6sd2ofr9m4npw4, .table th.tinytable_css_id9r9rnk6sd2ofr9m4npw4 {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_iddq0c94v6ok1jgclvcgxs, .table th.tinytable_css_iddq0c94v6ok1jgclvcgxs {  text-align: left; }
    .table td.tinytable_css_id3qkfj6km47eeb9kk7whb, .table th.tinytable_css_id3qkfj6km47eeb9kk7whb {  text-align: center; }
    .table td.tinytable_css_id1kqf0hfl7gz9voqxlin3, .table th.tinytable_css_id1kqf0hfl7gz9voqxlin3 {  border-bottom: solid 0.05em black;  text-align: left; }
    .table td.tinytable_css_iduxjs7y5emt10kns7m8sl, .table th.tinytable_css_iduxjs7y5emt10kns7m8sl {  border-bottom: solid 0.05em black;  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_2fy2cd8z64zdza4avk5t" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">w/o Interaction</th>
                <th scope="col">w/ Interaction</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>(Intercept)                  </td>
                  <td>5.845 (0.110) </td>
                  <td>5.836 (0.110) </td>
                </tr>
                <tr>
                  <td>treatmentCivic Duty          </td>
                  <td>0.018 (0.003) </td>
                  <td>0.044 (0.007) </td>
                </tr>
                <tr>
                  <td>treatmentHawthorne           </td>
                  <td>0.025 (0.003) </td>
                  <td>0.034 (0.007) </td>
                </tr>
                <tr>
                  <td>treatmentSelf                </td>
                  <td>0.048 (0.003) </td>
                  <td>0.076 (0.007) </td>
                </tr>
                <tr>
                  <td>treatmentNeighbors           </td>
                  <td>0.081 (0.003) </td>
                  <td>0.111 (0.007) </td>
                </tr>
                <tr>
                  <td>female                       </td>
                  <td>-0.006 (0.002)</td>
                  <td>-0.006 (0.002)</td>
                </tr>
                <tr>
                  <td>yob                          </td>
                  <td>-0.003 (0.000)</td>
                  <td>-0.003 (0.000)</td>
                </tr>
                <tr>
                  <td>hh_size                      </td>
                  <td>0.005 (0.001) </td>
                  <td>0.010 (0.001) </td>
                </tr>
                <tr>
                  <td>voted2000                    </td>
                  <td>0.094 (0.002) </td>
                  <td>0.094 (0.002) </td>
                </tr>
                <tr>
                  <td>voted2002                    </td>
                  <td>0.141 (0.002) </td>
                  <td>0.141 (0.002) </td>
                </tr>
                <tr>
                  <td>voted2004                    </td>
                  <td>0.158 (0.002) </td>
                  <td>0.158 (0.002) </td>
                </tr>
                <tr>
                  <td>treatmentCivic Duty × hh_size</td>
                  <td>              </td>
                  <td>-0.012 (0.003)</td>
                </tr>
                <tr>
                  <td>treatmentHawthorne × hh_size </td>
                  <td>              </td>
                  <td>-0.004 (0.003)</td>
                </tr>
                <tr>
                  <td>treatmentSelf × hh_size      </td>
                  <td>              </td>
                  <td>-0.013 (0.003)</td>
                </tr>
                <tr>
                  <td>treatmentNeighbors × hh_size </td>
                  <td>              </td>
                  <td>-0.014 (0.003)</td>
                </tr>
                <tr>
                  <td>Num.Obs.                     </td>
                  <td>344084        </td>
                  <td>344084        </td>
                </tr>
                <tr>
                  <td>R2                           </td>
                  <td>0.076         </td>
                  <td>0.076         </td>
                </tr>
                <tr>
                  <td>R2 Adj.                      </td>
                  <td>0.076         </td>
                  <td>0.076         </td>
                </tr>
                <tr>
                  <td>AIC                          </td>
                  <td>422192.9      </td>
                  <td>422163.5      </td>
                </tr>
                <tr>
                  <td>BIC                          </td>
                  <td>422321.9      </td>
                  <td>422335.5      </td>
                </tr>
                <tr>
                  <td>Log.Lik.                     </td>
                  <td>-211084.453   </td>
                  <td>-211065.750   </td>
                </tr>
                <tr>
                  <td>F                            </td>
                  <td>2826.942      </td>
                  <td>2022.112      </td>
                </tr>
                <tr>
                  <td>RMSE                         </td>
                  <td>0.45          </td>
                  <td>0.45          </td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(marginaleffects)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1"></a>fit3_pred <span class="ot">&lt;-</span> <span class="fu">predictions</span>(fit3,</span>
<span id="cb108-2"><a href="#cb108-2"></a>                         <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">treatment =</span> <span class="fu">c</span>(<span class="st">"Control"</span>,</span>
<span id="cb108-3"><a href="#cb108-3"></a>                                                          <span class="st">"Civic Duty"</span>,</span>
<span id="cb108-4"><a href="#cb108-4"></a>                                                          <span class="st">"Hawthorne"</span>,</span>
<span id="cb108-5"><a href="#cb108-5"></a>                                                          <span class="st">"Neighbors"</span>,</span>
<span id="cb108-6"><a href="#cb108-6"></a>                                                          <span class="st">"Self"</span>),</span>
<span id="cb108-7"><a href="#cb108-7"></a>                                            <span class="at">hh_size   =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">8</span>)))</span>
<span id="cb108-8"><a href="#cb108-8"></a></span>
<span id="cb108-9"><a href="#cb108-9"></a>fit3_pred</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  treatment hh_size Estimate Std. Error    z Pr(&gt;|z|)     S 2.5 % 97.5 % female
 Control          1    0.146    0.00232 62.8   &lt;0.001   Inf 0.141  0.150      0
 Control          4    0.175    0.00285 61.5   &lt;0.001   Inf 0.170  0.181      0
 Control          8    0.215    0.00787 27.3   &lt;0.001 542.3 0.199  0.230      0
 Civic Duty       1    0.178    0.00433 41.2   &lt;0.001   Inf 0.170  0.187      0
 Civic Duty       4    0.173    0.00578 29.8   &lt;0.001 647.9 0.161  0.184      0
 Civic Duty       8    0.165    0.01684  9.8   &lt;0.001  72.9 0.132  0.198      0
 Hawthorne        1    0.176    0.00435 40.4   &lt;0.001   Inf 0.167  0.184      0
 Hawthorne        4    0.193    0.00588 32.9   &lt;0.001 785.2 0.182  0.205      0
 Hawthorne        8    0.217    0.01714 12.7   &lt;0.001 119.9 0.184  0.251      0
 Neighbors        1    0.243    0.00431 56.3   &lt;0.001   Inf 0.234  0.251      0
 Neighbors        4    0.231    0.00577 40.1   &lt;0.001   Inf 0.220  0.242      0
 Neighbors        8    0.215    0.01678 12.8   &lt;0.001 122.7 0.182  0.248      0
 Self             1    0.209    0.00438 47.8   &lt;0.001   Inf 0.201  0.218      0
 Self             4    0.200    0.00592 33.8   &lt;0.001 827.7 0.188  0.212      0
 Self             8    0.188    0.01728 10.9   &lt;0.001  88.8 0.154  0.221      0
  yob voted2000 voted2002 voted2004
 1956         0         0         0
 1956         0         0         0
 1956         0         0         0
 1956         0         0         0
 1956         0         0         0
 1956         0         0         0
 1956         0         0         0
 1956         0         0         0
 1956         0         0         0
 1956         0         0         0
 1956         0         0         0
 1956         0         0         0
 1956         0         0         0
 1956         0         0         0
 1956         0         0         0

Columns: rowid, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, female, yob, voted2000, voted2002, voted2004, treatment, hh_size, voted2006 
Type:  response </code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1"></a>fit3_pred <span class="sc">|&gt;</span> </span>
<span id="cb110-2"><a href="#cb110-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb110-3"><a href="#cb110-3"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb110-4"><a href="#cb110-4"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>hh_size)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `geom_col()`:
! Problem while computing aesthetics.
ℹ Error occurred in the 1st layer.
Caused by error:
! object 'Estimate' not found</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1"></a><span class="fu">print</span>(fit3_pred, <span class="at">style =</span> <span class="st">"data.frame"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   rowid  estimate   std.error statistic       p.value   s.value  conf.low
1      1 0.1459165 0.002323454 62.801566  0.000000e+00       Inf 0.1413627
2      2 0.1754264 0.002851464 61.521525  0.000000e+00       Inf 0.1698376
3      3 0.2147729 0.007870487 27.288382 5.826749e-164 542.25352 0.1993470
4      4 0.1782236 0.004325704 41.201066  0.000000e+00       Inf 0.1697454
5      5 0.1725458 0.005780891 29.847619 9.425960e-196 647.86127 0.1612155
6      6 0.1649754 0.016840204  9.796522  1.165292e-22  72.86173 0.1319692
7      7 0.1755679 0.004349619 40.363982  0.000000e+00       Inf 0.1670428
8      8 0.1934422 0.005883334 32.879697 4.288219e-237 785.19658 0.1819111
9      9 0.2172746 0.017138668 12.677451  7.885487e-37 119.93214 0.1836834
10    10 0.2429128 0.004311551 56.340003  0.000000e+00       Inf 0.2344623
11    11 0.2310648 0.005768525 40.056126  0.000000e+00       Inf 0.2197587
12    12 0.2152674 0.016782230 12.827101  1.156090e-37 122.70209 0.1823748
13    13 0.2091471 0.004375073 47.804251  0.000000e+00       Inf 0.2005721
14    14 0.1999174 0.005921035 33.763922 6.679244e-250 827.74234 0.1883123
15    15 0.1876110 0.017280299 10.856931  1.848586e-27  88.80564 0.1537422
   conf.high female      yob voted2000 voted2002 voted2004  treatment hh_size
1  0.1504704      0 1956.214         0         0         0    Control       1
2  0.1810152      0 1956.214         0         0         0    Control       4
3  0.2301987      0 1956.214         0         0         0    Control       8
4  0.1867018      0 1956.214         0         0         0 Civic Duty       1
5  0.1838762      0 1956.214         0         0         0 Civic Duty       4
6  0.1979816      0 1956.214         0         0         0 Civic Duty       8
7  0.1840930      0 1956.214         0         0         0  Hawthorne       1
8  0.2049734      0 1956.214         0         0         0  Hawthorne       4
9  0.2508658      0 1956.214         0         0         0  Hawthorne       8
10 0.2513633      0 1956.214         0         0         0  Neighbors       1
11 0.2423709      0 1956.214         0         0         0  Neighbors       4
12 0.2481599      0 1956.214         0         0         0  Neighbors       8
13 0.2177221      0 1956.214         0         0         0       Self       1
14 0.2115224      0 1956.214         0         0         0       Self       4
15 0.2214798      0 1956.214         0         0         0       Self       8
   voted2006
1          0
2          0
3          0
4          0
5          0
6          0
7          0
8          0
9          0
10         0
11         0
12         0
13         0
14         0
15         0</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1"></a>fit3_pred <span class="sc">|&gt;</span> </span>
<span id="cb114-2"><a href="#cb114-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb114-3"><a href="#cb114-3"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> estimate)) <span class="sc">+</span></span>
<span id="cb114-4"><a href="#cb114-4"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>hh_size)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="intro_rct_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1200"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1"></a>fit3_pred <span class="sc">|&gt;</span> </span>
<span id="cb115-2"><a href="#cb115-2"></a>  <span class="fu">mutate</span>(<span class="at">hh_size =</span> <span class="fu">case_when</span>(hh_size <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Household size = 1"</span>,</span>
<span id="cb115-3"><a href="#cb115-3"></a>                             hh_size <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Household size = 4"</span>,</span>
<span id="cb115-4"><a href="#cb115-4"></a>                             hh_size <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Household size = 8"</span>),</span>
<span id="cb115-5"><a href="#cb115-5"></a>         <span class="at">hh_size =</span> <span class="fu">fct_inorder</span>(hh_size)) <span class="sc">|&gt;</span> </span>
<span id="cb115-6"><a href="#cb115-6"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb115-7"><a href="#cb115-7"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> estimate)) <span class="sc">+</span></span>
<span id="cb115-8"><a href="#cb115-8"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Groups"</span>, <span class="at">y =</span> <span class="st">"Predicted Turnout"</span>) <span class="sc">+</span></span>
<span id="cb115-9"><a href="#cb115-9"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">n.dodge =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb115-10"><a href="#cb115-10"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>hh_size)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="intro_rct_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1200"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1"></a>fit3_pred <span class="sc">|&gt;</span> </span>
<span id="cb116-2"><a href="#cb116-2"></a>  <span class="fu">mutate</span>(<span class="at">hh_size =</span> <span class="fu">case_when</span>(hh_size <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Household size = 1"</span>,</span>
<span id="cb116-3"><a href="#cb116-3"></a>                             hh_size <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Household size = 4"</span>,</span>
<span id="cb116-4"><a href="#cb116-4"></a>                             hh_size <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Household size = 8"</span>),</span>
<span id="cb116-5"><a href="#cb116-5"></a>         <span class="at">hh_size =</span> <span class="fu">fct_inorder</span>(hh_size)) <span class="sc">|&gt;</span> </span>
<span id="cb116-6"><a href="#cb116-6"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb116-7"><a href="#cb116-7"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> estimate)) <span class="sc">+</span></span>
<span id="cb116-8"><a href="#cb116-8"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> estimate, <span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, estimate))) <span class="sc">+</span></span>
<span id="cb116-9"><a href="#cb116-9"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Groups"</span>, <span class="at">y =</span> <span class="st">"Predicted Turnout"</span>) <span class="sc">+</span></span>
<span id="cb116-10"><a href="#cb116-10"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">n.dodge =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb116-11"><a href="#cb116-11"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>hh_size)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="intro_rct_files/figure-html/unnamed-chunk-76-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1200"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1"></a>fit3_pred <span class="sc">|&gt;</span> </span>
<span id="cb117-2"><a href="#cb117-2"></a>  <span class="fu">mutate</span>(<span class="at">hh_size =</span> <span class="fu">case_when</span>(hh_size <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Household size = 1"</span>,</span>
<span id="cb117-3"><a href="#cb117-3"></a>                             hh_size <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Household size = 4"</span>,</span>
<span id="cb117-4"><a href="#cb117-4"></a>                             hh_size <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Household size = 8"</span>),</span>
<span id="cb117-5"><a href="#cb117-5"></a>         <span class="at">hh_size =</span> <span class="fu">fct_inorder</span>(hh_size)) <span class="sc">|&gt;</span> </span>
<span id="cb117-6"><a href="#cb117-6"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb117-7"><a href="#cb117-7"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> estimate)) <span class="sc">+</span></span>
<span id="cb117-8"><a href="#cb117-8"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> estimate, <span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, estimate)),</span>
<span id="cb117-9"><a href="#cb117-9"></a>            <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">vjust =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb117-10"><a href="#cb117-10"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Groups"</span>, <span class="at">y =</span> <span class="st">"Predicted Turnout"</span>) <span class="sc">+</span></span>
<span id="cb117-11"><a href="#cb117-11"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">n.dodge =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb117-12"><a href="#cb117-12"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>hh_size)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="intro_rct_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1200"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a>fit3_ame <span class="ot">&lt;-</span> fit3 <span class="sc">|&gt;</span> </span>
<span id="cb118-2"><a href="#cb118-2"></a>  <span class="fu">marginaleffects</span>(<span class="at">variables =</span> <span class="st">"treatment"</span>,</span>
<span id="cb118-3"><a href="#cb118-3"></a>                  <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">hh_size =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>))</span>
<span id="cb118-4"><a href="#cb118-4"></a></span>
<span id="cb118-5"><a href="#cb118-5"></a><span class="fu">print</span>(fit3_ame, <span class="at">style =</span> <span class="st">"data.frame"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   rowid      term             contrast      estimate   std.error   statistic
1      1 treatment Civic Duty - Control  0.0323070808 0.004485340  7.20281612
2      2 treatment Civic Duty - Control  0.0205778631 0.002572273  7.99987543
3      3 treatment Civic Duty - Control  0.0088486454 0.003568488  2.47966211
4      4 treatment Civic Duty - Control -0.0028805723 0.006202487 -0.46442217
5      5 treatment Civic Duty - Control -0.0146097900 0.009155697 -1.59570485
6      6 treatment Civic Duty - Control -0.0263390077 0.012198440 -2.15921112
7      7 treatment Civic Duty - Control -0.0380682254 0.015277314 -2.49181409
8      8 treatment Civic Duty - Control -0.0497974431 0.018374163 -2.71018834
9      1 treatment  Hawthorne - Control  0.0296514006 0.004508577  6.57666514
10     2 treatment  Hawthorne - Control  0.0257728789 0.002569135 10.03173439
11     3 treatment  Hawthorne - Control  0.0218943571 0.003610946  6.06333052
12     4 treatment  Hawthorne - Control  0.0180158353 0.006296244  2.86136215
13     5 treatment  Hawthorne - Control  0.0141373135 0.009295792  1.52082938
14     6 treatment  Hawthorne - Control  0.0102587917 0.012383299  0.82843770
15     7 treatment  Hawthorne - Control  0.0063802699 0.015506312  0.41146277
16     8 treatment  Hawthorne - Control  0.0025017481 0.018647000  0.13416358
17     1 treatment  Neighbors - Control  0.0969962701 0.004473502 21.68240168
18     2 treatment  Neighbors - Control  0.0832103023 0.002571525 32.35834603
19     3 treatment  Neighbors - Control  0.0694243344 0.003565984 19.46849168
20     4 treatment  Neighbors - Control  0.0556383666 0.006190536  8.98764986
21     5 treatment  Neighbors - Control  0.0418523987 0.009134122  4.58198361
22     6 treatment  Neighbors - Control  0.0280664309 0.012167360  2.30669851
23     7 treatment  Neighbors - Control  0.0142804630 0.015236800  0.93723505
24     8 treatment  Neighbors - Control  0.0004944951 0.018324260  0.02698582
25     1 treatment       Self - Control  0.0632305717 0.004532556 13.95031202
26     2 treatment       Self - Control  0.0503173668 0.002570076 19.57815989
27     3 treatment       Self - Control  0.0374041619 0.003623024 10.32401664
28     4 treatment       Self - Control  0.0244909571 0.006333017  3.86718662
29     5 treatment       Self - Control  0.0115777522 0.009356692  1.23737664
30     6 treatment       Self - Control -0.0013354527 0.012467881 -0.10711145
31     7 treatment       Self - Control -0.0142486576 0.015614359 -0.91253556
32     8 treatment       Self - Control -0.0271618625 0.018778395 -1.44644215
         p.value      s.value     conf.low    conf.high hh_size predicted_lo
1   5.898149e-13  40.62480292  0.023515975  0.041098186       1    0.1459165
2   1.245451e-15  49.51225261  0.015536301  0.025619425       2    0.1557532
3   1.315069e-02   6.24871731  0.001854537  0.015842754       3    0.1655898
4   6.423453e-01   0.63857903 -0.015037223  0.009276078       4    0.1754264
5   1.105547e-01   3.17716767 -0.032554626  0.003335046       5    0.1852630
6   3.083379e-02   5.01934386 -0.050247511 -0.002430504       6    0.1950996
7   1.270925e-02   6.29797681 -0.068011210 -0.008125241       7    0.2049363
8   6.724501e-03   7.21635703 -0.085810141 -0.013784745       8    0.2147729
9   4.811166e-11  34.27482244  0.020814752  0.038488049       1    0.1459165
10  1.105573e-23  76.25955221  0.020737467  0.030808291       2    0.1557532
11  1.333313e-09  29.48233766  0.014817034  0.028971681       3    0.1655898
12  4.218249e-03   7.88914003  0.005675423  0.030356247       4    0.1754264
13  1.283027e-01   2.96237701 -0.004082104  0.032356731       5    0.1852630
14  4.074227e-01   1.29540186 -0.014012028  0.034529612       6    0.1950996
15  6.807332e-01   0.55483854 -0.024011543  0.036772082       7    0.2049363
16  8.932732e-01   0.16282657 -0.034045699  0.039049196       8    0.2147729
17 3.007683e-104 343.89186917  0.088228367  0.105764173       1    0.1459165
18 1.058753e-229 760.63916829  0.078170205  0.088250399       2    0.1557532
19  2.031661e-84 278.01930021  0.062435134  0.076413535       3    0.1655898
20  2.525732e-19  61.77993215  0.043505140  0.067771593       4    0.1754264
21  4.605860e-06  17.72809798  0.023949848  0.059754949       5    0.1852630
22  2.107163e-02   5.56855404  0.004218844  0.051914018       6    0.1950996
23  3.486377e-01   1.52019965 -0.015583116  0.044144042       7    0.2049363
24  9.784710e-01   0.03139893 -0.035420394  0.036409385       8    0.2147729
25  3.132320e-44 144.51760437  0.054346925  0.072114218       1    0.1459165
26  2.374442e-85 281.11629947  0.045280110  0.055354624       2    0.1557532
27  5.487823e-25  80.59196838  0.030303165  0.044505159       3    0.1655898
28  1.100982e-04  13.14892185  0.012078473  0.036903441       4    0.1754264
29  2.159473e-01   2.21124890 -0.006761027  0.029916532       5    0.1852630
30  9.147006e-01   0.12862855 -0.025772050  0.023101145       6    0.1950996
31  3.614869e-01   1.46798490 -0.044852238  0.016354923       7    0.2049363
32  1.480532e-01   2.75581216 -0.063966841  0.009643116       8    0.2147729
   predicted_hi predicted treatment female      yob voted2000 voted2002
1     0.1782236 0.1459165   Control      0 1956.214         0         0
2     0.1763310 0.1557532   Control      0 1956.214         0         0
3     0.1744384 0.1655898   Control      0 1956.214         0         0
4     0.1725458 0.1754264   Control      0 1956.214         0         0
5     0.1706532 0.1852630   Control      0 1956.214         0         0
6     0.1687606 0.1950996   Control      0 1956.214         0         0
7     0.1668680 0.2049363   Control      0 1956.214         0         0
8     0.1649754 0.2147729   Control      0 1956.214         0         0
9     0.1755679 0.1459165   Control      0 1956.214         0         0
10    0.1815260 0.1557532   Control      0 1956.214         0         0
11    0.1874841 0.1655898   Control      0 1956.214         0         0
12    0.1934422 0.1754264   Control      0 1956.214         0         0
13    0.1994003 0.1852630   Control      0 1956.214         0         0
14    0.2053584 0.1950996   Control      0 1956.214         0         0
15    0.2113165 0.2049363   Control      0 1956.214         0         0
16    0.2172746 0.2147729   Control      0 1956.214         0         0
17    0.2429128 0.1459165   Control      0 1956.214         0         0
18    0.2389635 0.1557532   Control      0 1956.214         0         0
19    0.2350141 0.1655898   Control      0 1956.214         0         0
20    0.2310648 0.1754264   Control      0 1956.214         0         0
21    0.2271154 0.1852630   Control      0 1956.214         0         0
22    0.2231661 0.1950996   Control      0 1956.214         0         0
23    0.2192167 0.2049363   Control      0 1956.214         0         0
24    0.2152674 0.2147729   Control      0 1956.214         0         0
25    0.2091471 0.1459165   Control      0 1956.214         0         0
26    0.2060705 0.1557532   Control      0 1956.214         0         0
27    0.2029939 0.1655898   Control      0 1956.214         0         0
28    0.1999174 0.1754264   Control      0 1956.214         0         0
29    0.1968408 0.1852630   Control      0 1956.214         0         0
30    0.1937642 0.1950996   Control      0 1956.214         0         0
31    0.1906876 0.2049363   Control      0 1956.214         0         0
32    0.1876110 0.2147729   Control      0 1956.214         0         0
   voted2004 voted2006
1          0         0
2          0         0
3          0         0
4          0         0
5          0         0
6          0         0
7          0         0
8          0         0
9          0         0
10         0         0
11         0         0
12         0         0
13         0         0
14         0         0
15         0         0
16         0         0
17         0         0
18         0         0
19         0         0
20         0         0
21         0         0
22         0         0
23         0         0
24         0         0
25         0         0
26         0         0
27         0         0
28         0         0
29         0         0
30         0         0
31         0         0
32         0         0</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1"></a>fit3_ame <span class="sc">|&gt;</span> </span>
<span id="cb120-2"><a href="#cb120-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb120-3"><a href="#cb120-3"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb120-4"><a href="#cb120-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> hh_size, <span class="at">y =</span> estimate, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb120-5"><a href="#cb120-5"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Household Size"</span>, <span class="at">y =</span> <span class="st">"Average Marginal Effects"</span>) <span class="sc">+</span></span>
<span id="cb120-6"><a href="#cb120-6"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>contrast)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="intro_rct_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a>fit3_ame <span class="sc">|&gt;</span> </span>
<span id="cb121-2"><a href="#cb121-2"></a>  <span class="fu">mutate</span>(<span class="at">contrast =</span> <span class="fu">str_remove</span>(contrast, <span class="st">" - Control"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb121-3"><a href="#cb121-3"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb121-4"><a href="#cb121-4"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb121-5"><a href="#cb121-5"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> hh_size, <span class="at">y =</span> estimate, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb121-6"><a href="#cb121-6"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Household Size"</span>, <span class="at">y =</span> <span class="st">"Average Marginal Effects"</span>) <span class="sc">+</span></span>
<span id="cb121-7"><a href="#cb121-7"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>contrast)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="intro_rct_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1"></a>fit3_ame <span class="sc">|&gt;</span> </span>
<span id="cb122-2"><a href="#cb122-2"></a>  <span class="fu">mutate</span>(<span class="at">contrast =</span> <span class="fu">str_remove</span>(contrast, <span class="st">" - Control"</span>),</span>
<span id="cb122-3"><a href="#cb122-3"></a>         <span class="at">sig      =</span> <span class="fu">if_else</span>(p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="st">"sig"</span>, <span class="st">"insig"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb122-4"><a href="#cb122-4"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb122-5"><a href="#cb122-5"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb122-6"><a href="#cb122-6"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> hh_size, <span class="at">y =</span> estimate, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high,</span>
<span id="cb122-7"><a href="#cb122-7"></a>                      <span class="at">color =</span> sig)) <span class="sc">+</span></span>
<span id="cb122-8"><a href="#cb122-8"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Household Size"</span>, <span class="at">y =</span> <span class="st">"Average Marginal Effects"</span>) <span class="sc">+</span></span>
<span id="cb122-9"><a href="#cb122-9"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>contrast)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="intro_rct_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1"></a>fit3_ame <span class="sc">|&gt;</span> </span>
<span id="cb123-2"><a href="#cb123-2"></a>  <span class="fu">mutate</span>(<span class="at">contrast =</span> <span class="fu">str_remove</span>(contrast, <span class="st">" - Control"</span>),</span>
<span id="cb123-3"><a href="#cb123-3"></a>         <span class="at">sig      =</span> <span class="fu">if_else</span>(p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="st">"sig"</span>, <span class="st">"insig"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb123-4"><a href="#cb123-4"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb123-5"><a href="#cb123-5"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb123-6"><a href="#cb123-6"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> hh_size, <span class="at">y =</span> estimate, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high,</span>
<span id="cb123-7"><a href="#cb123-7"></a>                      <span class="at">color =</span> sig)) <span class="sc">+</span></span>
<span id="cb123-8"><a href="#cb123-8"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Household Size"</span>, <span class="at">y =</span> <span class="st">"Average Marginal Effects"</span>) <span class="sc">+</span></span>
<span id="cb123-9"><a href="#cb123-9"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"sig"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"insig"</span> <span class="ot">=</span> <span class="st">"gray80"</span>)) <span class="sc">+</span></span>
<span id="cb123-10"><a href="#cb123-10"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>contrast) <span class="sc">+</span></span>
<span id="cb123-11"><a href="#cb123-11"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb123-12"><a href="#cb123-12"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="intro_rct_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050"></p>
</figure>
</div>
</div>
</div>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">脚注</h2>

<ol>
<li id="fn1"><p><code>pacman::p_load()</code>は「{pacman}パッケージの<code>p_load()</code>関数」を意味する。このような書き方をすると、パッケージを読み込まず、関数を使うことができる。むろん、<code>library(pacman)</code>で予め{pacman}パッケージを読み込んでおくと、<code>pacman::</code>は省略し、<code>p_load()</code>だけでも問題ない。ただし、最初の1、2回程度しか使わないパッケージをわざわざ読み込んでおくのは目盛りの無駄遣いなので、このようにパッケージから直接呼び出したほうが効率が良い。<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>パッケージのアップデートには<code>pacman::p_update()</code>または<code>pacman::p_up()</code>関数を使う。<code>()</code>内に何も入力しない場合、全パッケージがアップデートされる。<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Microsoft Excel形式（<code>.xls</code>、<code>.xlsx</code>）は{readxl}パッケージの<code>read_excel()</code>関数を、Stata形式（<code>.dta</code>）は{heaven}の<code>read_dta()</code>（または<code>read_stata()</code>）、SPSS形式（<code>.sav</code>）は{haven}の<code>read_sav()</code>（または<code>read_spss()</code>）を使用する。ただし、データ分析界隈の標準は<code>.csv</code>フォーマットである。<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>変数のデータ型はデータを出力する際、列名の下段に表示される。<code>&lt;chr&gt;</code>は文字型、<code>&lt;dbl&gt;</code>と<code>&lt;int&gt;</code>は数値型、<code>&lt;fct&gt;</code>はfactor型である。他にもいくつかのデータ型がある。詳細は『私たちのR』の<a href="https://www.jaysong.net/RBook/datatype.html">第8章</a>を参照すること。<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>RMarkdown内に埋め込むなら更に<code>style = "rmarkdown"</code>を追加してみよう。ただし、Chunkオプションに<code>results = "asis"</code>（Quartoなら<code>#| results: "asis"</code>）を付けること。<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>中身が1、2、3、…であってもfactor型であれば1、2、3、…は数字でなく文字として認識される。<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>もっと使いやすい<code>round()</code>があるが、<code>round()</code>の場合、丸めた結果が1.100なら1.1としか表記されない。表示される桁数を固定するためには<code>sprintf()</code>を使う。<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p><code>str_replace(term, "treatment", "")</code>の代わりに<code>str_remove(term, "treatment")</code>でも良い。<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "コピーしました");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "コピーしました");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/www\.jaysong\.net\/kobe-ci\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
        for (let i=0; i<annoteTargets.length; i++) {
          const annoteTarget = annoteTargets[i];
          const targetCell = annoteTarget.getAttribute("data-target-cell");
          const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
          const contentFn = () => {
            const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            if (content) {
              const tipContent = content.cloneNode(true);
              tipContent.classList.add("code-annotation-tip-content");
              return tipContent.outerHTML;
            }
          }
          const config = {
            allowHTML: true,
            content: contentFn,
            onShow: (instance) => {
              selectCodeLines(instance.reference);
              instance.reference.classList.add('code-annotation-active');
              window.tippy.hideAll();
            },
            onHide: (instance) => {
              unselectCodeLines();
              instance.reference.classList.remove('code-annotation-active');
            },
            maxWidth: 300,
            delay: [50, 0],
            duration: [200, 0],
            offset: [5, 10],
            arrow: true,
            appendTo: function(el) {
              return el.parentElement.parentElement.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'quarto',
            placement: 'right',
            popperOptions: {
              modifiers: [
              {
                name: 'flip',
                options: {
                  flipVariations: false, // true by default
                  allowedAutoPlacements: ['right'],
                  fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                },
              },
              {
                name: 'preventOverflow',
                options: {
                  mainAxis: false,
                  altAxis: false
                }
              }
              ]        
            }      
          };
          window.tippy(annoteTarget, config); 
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
  </div>
  <div class="nav-page nav-page-next">
      <a href="../material/matching.html" class="pagination-link" aria-label="マッチング">
        <span class="nav-page-text">マッチング</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2025, <a href="https://www.jaysong.net" target="_blank">Jaehyun Song</a>. Powered by <a href="https://quarto.org/" target="_blank">Quarto</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.jaysong.net">
      <i class="bi bi-house-fill" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/JaehyunSong">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>