{
  "hash": "84415970f62a03788ab164511b5c3c79",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"因果推論の考え方とランダム化比較試験\"\ntoc: true\nmetadata-files: \n  - _material.yml\n---\n\n## スライド\n\n<a href=\"../slide/intro_rct.html\" class=\"btn btn-primary btn-sm\" target=\"_blank\" role=\"button\"><i class=\"bi bi-window\"></i> 新しいタブで開く</a>\n\n```{=html}\n<iframe class=\"slide-deck\" src=\"../slide/intro_rct.html\" width=\"100%\" style=\"aspect-ratio: 16 / 9.2;\"></iframe>\n```\n\n## パッケージ\n\n　通常、Rでのパッケージのインストールとアップデートは`install.packages()`関数、読み込みは`library()`、または`require()`関数を使う。一つ注意すべき点は`install.packages()`の場合、R公式レポジトリであるCRANに登録されているパッケージのみが対象となっている点だ。しかし、今はCRANでなくGitHub上で公開されているパッケージも非常に多い。これらパッケージは{devtools}か{remote}パッケージを使う。これらの関数を使い分けることは面倒なので、本講義ではこれらの処理を統合した{pacman}パッケージを使用する。まずは、{pacman}パッケージをインストールする。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ninstall.packages(\"pacman\")\n```\n:::\n\n\n　まず、CRANに登録されているパッケージを読み込む際は、`pacman::p_load(読み込むパッケージ名)`を入力する[^pac-func]。インストールされていない場合は、自動的にCRANからダウンロード&インストールした上で読み込んでくれるので便利だ[^pacman-update]。以下では本講義で使用するパッケージとして{tidyverse}、{summarytools}、{fastDummies}、{modelsummary}、{broom}を読み込む。\n\n[^pac-func]: `pacman::p_load()`は「{pacman}パッケージの`p_load()`関数」を意味する。このような書き方をすると、パッケージを読み込まず、関数を使うことができる。むろん、`library(pacman)`で予め{pacman}パッケージを読み込んでおくと、`pacman::`は省略し、`p_load()`だけでも問題ない。ただし、最初の1、2回程度しか使わないパッケージをわざわざ読み込んでおくのは目盛りの無駄遣いなので、このようにパッケージから直接呼び出したほうが効率が良い。\n\n[^pacman-update]: パッケージのアップデートには`pacman::p_update()`または`pacman::p_up()`関数を使う。`()`内に何も入力しない場合、全パッケージがアップデートされる。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# pacman::p_load(tidyverse, summarytools, fastDummies, modelsummary, broom) もOK\npacman::p_load(tidyverse, \n               summarytools, \n               fastDummies,\n               modelsummary,\n               broom)\n```\n:::\n\n\n　CRANでなく、GitHub上で公開されているパッケージを使う場合は`pacman::p_load_gh()`を使用する。`()`の中には`\"ユーザー名/リポジトリ名\"`を入力する。たとえば、{BalanceR}の作成者のGitHubアカウント名は`JaehyunSong`であり、{BalanceR}のリポジトリ名は`BalanceR`だから、以下のように入力する。`p_load()`とは違って、文字列は`\"`で囲む必要があることに注意しよう。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npacman::p_load_gh(\"JaehyunSong/BalanceR\")\n```\n:::\n\n\n## データの読み込み\n\n　`.csv`形式のデータを読み込むには`read_csv()`関数を使用する[^haven]。`()`内には読み込むファイルのパスを`\"`で囲んで記入する。`read_csv()`関数はファイルの読み込み**のみ**の機能しか持たない。現在の作業環境内に読み込んだデータを格納するためには代入演算子`<-`を使う。ここでは`data`フォルダー内の`intro_data3.csv`を読み込み、`raw_df`という名のオブジェクトとしてく格納する。作業環境内のオブジェクトはRを再起動すると削除されるため、改めてパッケージ・データの読み込みが必要だ。\n\n[^haven]: Microsoft Excel形式（`.xls`、`.xlsx`）は{readxl}パッケージの`read_excel()`関数を、Stata形式（`.dta`）は{heaven}の`read_dta()`（または`read_stata()`）、SPSS形式（`.sav`）は{haven}の`read_sav()`（または`read_spss()`）を使用する。ただし、データ分析界隈の標準は`.csv`フォーマットである。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nraw_df <- read_csv(\"data/intro_data3.csv\")\n```\n:::\n\n\n　オブジェクトの中身を出力するためにはオブジェクト名を入力する。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nraw_df\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 344,084 × 8\n   treatment  gender   yob hh_size voted2000 voted2002 voted2004 voted2006\n   <chr>      <chr>  <dbl>   <dbl> <chr>     <chr>     <chr>     <chr>    \n 1 Civic Duty male    1941       2 no        yes       no        no       \n 2 Civic Duty female  1947       2 no        yes       no        no       \n 3 Hawthorne  male    1951       3 no        yes       no        yes      \n 4 Hawthorne  female  1950       3 no        yes       no        yes      \n 5 Hawthorne  female  1982       3 no        yes       no        yes      \n 6 Control    male    1981       3 no        no        no        no       \n 7 Control    female  1959       3 no        yes       no        yes      \n 8 Control    male    1956       3 no        yes       no        yes      \n 9 Control    female  1968       2 no        yes       no        no       \n10 Control    male    1967       2 no        yes       no        no       \n# ℹ 344,074 more rows\n```\n\n\n:::\n:::\n\n\n　表形式データの大きさ（行の列の数）の確認には`dim()`関数を使う。長さ2のnumeric（数値）型ベクトルが返され、それぞれデータセットの行と列の数を意味する。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndim(raw_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 344084      8\n```\n\n\n:::\n:::\n\n\n　表形式データの場合、各列には名前が付いており、それぞれが一つの変数に該当する。これら変数名のみの出力には`names()`関数を使う。今回のデータだと、列の数が少ないこともあり、一画面に全列が表示されるが、数百列のデータとなると画面に収まらないので、変数名を確認しておくことを推奨する。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nnames(raw_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"treatment\" \"gender\"    \"yob\"       \"hh_size\"   \"voted2000\" \"voted2002\"\n[7] \"voted2004\" \"voted2006\"\n```\n\n\n:::\n:::\n\n\n## データハンドリング\n\n　パイプ演算子には{magrittr}パッケージが提供する`%>%`とR 4.1から提供されるネイティブパイプ演算子の`|>`がある。現在の主流は古くから使われてきた`%>%`であるが、今後、`|>`が主流になると考えられるため、本講義では`|>`を使用する。しかし、多くの場合、`|>`の代わりに`%>%`を使っても同じ結果が得られる。 \n\n:::{.callout-note}\n## パイプ演算子のショートカットキー\n\n　Rのnativeパイプ演算子（`|>`）は意外と打ちにくい。ショートカットキーを活用しよう。\n\n* macOS：Cmd（⌘） + Shift + m\n* Windows：Ctrl（Control） + Shift + m\n:::\n\n　パイプ演算子はパイプ前のオブジェクトを、パイプ後の関数の**第一引数**として渡す単純な演算子だ。たとえば、列名を変更する関数は`rename()`であるが、使い方は`renames(データ名, 新しい列名 = 既存の列名, ...)`である。`raw_df`の`gender`列の名前を`female`に変更する場合は以下のように書く。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrename(raw_df, female = gender)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 344,084 × 8\n   treatment  female   yob hh_size voted2000 voted2002 voted2004 voted2006\n   <chr>      <chr>  <dbl>   <dbl> <chr>     <chr>     <chr>     <chr>    \n 1 Civic Duty male    1941       2 no        yes       no        no       \n 2 Civic Duty female  1947       2 no        yes       no        no       \n 3 Hawthorne  male    1951       3 no        yes       no        yes      \n 4 Hawthorne  female  1950       3 no        yes       no        yes      \n 5 Hawthorne  female  1982       3 no        yes       no        yes      \n 6 Control    male    1981       3 no        no        no        no       \n 7 Control    female  1959       3 no        yes       no        yes      \n 8 Control    male    1956       3 no        yes       no        yes      \n 9 Control    female  1968       2 no        yes       no        no       \n10 Control    male    1967       2 no        yes       no        no       \n# ℹ 344,074 more rows\n```\n\n\n:::\n:::\n\n\n　ここで第1引数が`raw_df`だが、パイプ演算子を使うと以下のようになり、人間にとって読みやすいコードになる。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nraw_df |>\n  rename(female = gender)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 344,084 × 8\n   treatment  female   yob hh_size voted2000 voted2002 voted2004 voted2006\n   <chr>      <chr>  <dbl>   <dbl> <chr>     <chr>     <chr>     <chr>    \n 1 Civic Duty male    1941       2 no        yes       no        no       \n 2 Civic Duty female  1947       2 no        yes       no        no       \n 3 Hawthorne  male    1951       3 no        yes       no        yes      \n 4 Hawthorne  female  1950       3 no        yes       no        yes      \n 5 Hawthorne  female  1982       3 no        yes       no        yes      \n 6 Control    male    1981       3 no        no        no        no       \n 7 Control    female  1959       3 no        yes       no        yes      \n 8 Control    male    1956       3 no        yes       no        yes      \n 9 Control    female  1968       2 no        yes       no        no       \n10 Control    male    1967       2 no        yes       no        no       \n# ℹ 344,074 more rows\n```\n\n\n:::\n:::\n\n\n　要するに、`X |> Y`は「`X`（の結果）を使って`Y`を行う」ことを意味する。より詳しいパイプ演算子の解説は『私たちのR』の「[データハンドリング [抽出]](https://www.jaysong.net/RBook/datahandling1.html#sec-handling1-pipe)」を参照されたい。\n\n　続いて、変数のリコーディングをしてみよう。`x`の値が`\"A\"`なら1、それ以外は0のように、戻り値が2種類の場合、`if_else()`関数でリコーディングする。書き方は以下の通りだ。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nif_else(条件式, 条件が満たされる場合の戻り値, 条件が満たされない場合の戻り値)\n```\n:::\n\n\n　たとえば、`raw_df`の`gender`列の値が`\"female\"`なら1、それ以外なら0とし、その結果を`female`列として追加するコードは以下の通り。同値を意味する演算子が`=`でなく、`==`であることに注意すること（`=`は`<-`と同じ代入演算子であるが、Rでは代入演算子として`=`より`<-`の使用を推奨している）。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmutate(raw_df, \n       female = if_else(gender == \"female\", 1, 0))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 344,084 × 9\n   treatment gender   yob hh_size voted2000 voted2002 voted2004 voted2006 female\n   <chr>     <chr>  <dbl>   <dbl> <chr>     <chr>     <chr>     <chr>      <dbl>\n 1 Civic Du… male    1941       2 no        yes       no        no             0\n 2 Civic Du… female  1947       2 no        yes       no        no             1\n 3 Hawthorne male    1951       3 no        yes       no        yes            0\n 4 Hawthorne female  1950       3 no        yes       no        yes            1\n 5 Hawthorne female  1982       3 no        yes       no        yes            1\n 6 Control   male    1981       3 no        no        no        no             0\n 7 Control   female  1959       3 no        yes       no        yes            1\n 8 Control   male    1956       3 no        yes       no        yes            0\n 9 Control   female  1968       2 no        yes       no        no             1\n10 Control   male    1967       2 no        yes       no        no             0\n# ℹ 344,074 more rows\n```\n\n\n:::\n:::\n\n\n　`mutate()`は指定された列に対して何らかの処理を行い、その結果を新しい列として追加するか、上書きする関数である。この`mutate()`関数の第1引数もデータであるため、以下のようにパイプ演算子を使うこともできる。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nraw_df |>\n  mutate(female = if_else(gender == \"female\", 1, 0))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 344,084 × 9\n   treatment gender   yob hh_size voted2000 voted2002 voted2004 voted2006 female\n   <chr>     <chr>  <dbl>   <dbl> <chr>     <chr>     <chr>     <chr>      <dbl>\n 1 Civic Du… male    1941       2 no        yes       no        no             0\n 2 Civic Du… female  1947       2 no        yes       no        no             1\n 3 Hawthorne male    1951       3 no        yes       no        yes            0\n 4 Hawthorne female  1950       3 no        yes       no        yes            1\n 5 Hawthorne female  1982       3 no        yes       no        yes            1\n 6 Control   male    1981       3 no        no        no        no             0\n 7 Control   female  1959       3 no        yes       no        yes            1\n 8 Control   male    1956       3 no        yes       no        yes            0\n 9 Control   female  1968       2 no        yes       no        no             1\n10 Control   male    1967       2 no        yes       no        no             0\n# ℹ 344,074 more rows\n```\n\n\n:::\n:::\n\n\n　また、`mutate()`内には複数のコードを書くこともできる。`voted2000`列から`voted2006`列までそれぞれの値が`\"yes\"`であれば、1を、それ以外の場合は0にリコーディングしてみよう。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nraw_df |>\n  mutate(female    = if_else(gender    == \"female\", 1, 0),\n         voted2000 = if_else(voted2000 == \"yes\", 1, 0),\n         voted2002 = if_else(voted2002 == \"yes\", 1, 0),\n         voted2004 = if_else(voted2004 == \"yes\", 1, 0),\n         voted2006 = if_else(voted2006 == \"yes\", 1, 0))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 344,084 × 9\n   treatment gender   yob hh_size voted2000 voted2002 voted2004 voted2006 female\n   <chr>     <chr>  <dbl>   <dbl>     <dbl>     <dbl>     <dbl>     <dbl>  <dbl>\n 1 Civic Du… male    1941       2         0         1         0         0      0\n 2 Civic Du… female  1947       2         0         1         0         0      1\n 3 Hawthorne male    1951       3         0         1         0         1      0\n 4 Hawthorne female  1950       3         0         1         0         1      1\n 5 Hawthorne female  1982       3         0         1         0         1      1\n 6 Control   male    1981       3         0         0         0         0      0\n 7 Control   female  1959       3         0         1         0         1      1\n 8 Control   male    1956       3         0         1         0         1      0\n 9 Control   female  1968       2         0         1         0         0      1\n10 Control   male    1967       2         0         1         0         0      0\n# ℹ 344,074 more rows\n```\n\n\n:::\n:::\n\n\n　また、パイプ演算子は2つ以上使うこともできる。たとえば、`rename()`を使って`gender`列を`female`に変更し、`mutate()`でリコーディングを行う場合、以下のように書く。これは`raw_df`を使って`rename()`の処理を行い、その結果を`mutate()`関数のデータとして渡すことを意味する。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nraw_df |>\n  rename(female = gender) |>\n  mutate(female    = if_else(female    == \"female\", 1, 0),\n         voted2000 = if_else(voted2000 == \"yes\", 1, 0),\n         voted2002 = if_else(voted2002 == \"yes\", 1, 0),\n         voted2004 = if_else(voted2004 == \"yes\", 1, 0),\n         voted2006 = if_else(voted2006 == \"yes\", 1, 0))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 344,084 × 8\n   treatment  female   yob hh_size voted2000 voted2002 voted2004 voted2006\n   <chr>       <dbl> <dbl>   <dbl>     <dbl>     <dbl>     <dbl>     <dbl>\n 1 Civic Duty      0  1941       2         0         1         0         0\n 2 Civic Duty      1  1947       2         0         1         0         0\n 3 Hawthorne       0  1951       3         0         1         0         1\n 4 Hawthorne       1  1950       3         0         1         0         1\n 5 Hawthorne       1  1982       3         0         1         0         1\n 6 Control         0  1981       3         0         0         0         0\n 7 Control         1  1959       3         0         1         0         1\n 8 Control         0  1956       3         0         1         0         1\n 9 Control         1  1968       2         0         1         0         0\n10 Control         0  1967       2         0         1         0         0\n# ℹ 344,074 more rows\n```\n\n\n:::\n:::\n\n\n　以上のコードはデータを加工し、その結果を**出力するだけ**であって、その結果を保存しない。もう一度`raw_df`を出力してみても、これまでのデータ加工内容は反映されていないことが分かる。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nraw_df\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 344,084 × 8\n   treatment  gender   yob hh_size voted2000 voted2002 voted2004 voted2006\n   <chr>      <chr>  <dbl>   <dbl> <chr>     <chr>     <chr>     <chr>    \n 1 Civic Duty male    1941       2 no        yes       no        no       \n 2 Civic Duty female  1947       2 no        yes       no        no       \n 3 Hawthorne  male    1951       3 no        yes       no        yes      \n 4 Hawthorne  female  1950       3 no        yes       no        yes      \n 5 Hawthorne  female  1982       3 no        yes       no        yes      \n 6 Control    male    1981       3 no        no        no        no       \n 7 Control    female  1959       3 no        yes       no        yes      \n 8 Control    male    1956       3 no        yes       no        yes      \n 9 Control    female  1968       2 no        yes       no        no       \n10 Control    male    1967       2 no        yes       no        no       \n# ℹ 344,074 more rows\n```\n\n\n:::\n:::\n\n\n　このように頑張ってデータを加工したもののその結果が全く反映されていない。加工したデータを引き続き使っていくためには、加工結果を作業環境内に保存する必要がある。作業環境内にオブジェクトを保存するためには代入演算子（`<-`）を使い、名前を付けて作業空間内に保存する（ファイルとして保存されるわけではない）必要がある。今回は加工の結果を`df`という名で保存する。`raw_df`に上書きしても問題はないが、生データはとりあえず作業空間内に残しておくことを推奨する（Rに慣れれば上書きしても良い）。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndf <- raw_df |>\n  rename(female = gender) |>\n  mutate(female    = if_else(female    == \"female\", 1, 0),\n         voted2000 = if_else(voted2000 == \"yes\", 1, 0),\n         voted2002 = if_else(voted2002 == \"yes\", 1, 0),\n         voted2004 = if_else(voted2004 == \"yes\", 1, 0),\n         voted2006 = if_else(voted2006 == \"yes\", 1, 0))\n\ndf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 344,084 × 8\n   treatment  female   yob hh_size voted2000 voted2002 voted2004 voted2006\n   <chr>       <dbl> <dbl>   <dbl>     <dbl>     <dbl>     <dbl>     <dbl>\n 1 Civic Duty      0  1941       2         0         1         0         0\n 2 Civic Duty      1  1947       2         0         1         0         0\n 3 Hawthorne       0  1951       3         0         1         0         1\n 4 Hawthorne       1  1950       3         0         1         0         1\n 5 Hawthorne       1  1982       3         0         1         0         1\n 6 Control         0  1981       3         0         0         0         0\n 7 Control         1  1959       3         0         1         0         1\n 8 Control         0  1956       3         0         1         0         1\n 9 Control         1  1968       2         0         1         0         0\n10 Control         0  1967       2         0         1         0         0\n# ℹ 344,074 more rows\n```\n\n\n:::\n:::\n\n\n　ちなみに、`across()`関数とラムダ式（無名関数）を組み合わせると以上のコードをより効率的に書くこともできる。`across()`は強力な関数だが、初心者にはやや難しいかも知れない。詳細は『私たちのR』の[第13.1章](https://www.jaysong.net/RBook/datahandling2.html#handling2-summarise)を参照されたい。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndf <- raw_df |>\n  rename(female = gender) |>\n  mutate(female = if_else(female == \"female\", 1, 0),\n         # 第1引数: votedで始まる変数を対象に処理を行う\n         # 第2引数: 当該変数の値が\"yes\"なら1、それ以外なら0を割り当てる無名関数\n         #          無名関数は「~」で始まり、変数が入る箇所は.xと表記する\n         #          引数が当該変数のみであれば、「~」を付けずに関数のみでもOK\n         across(starts_with(\"voted\"), ~if_else(.x == \"yes\", 1, 0)))\n```\n:::\n\n\n## 記述統計量\n\n　記述統計量の計算には{summarytools}の`descr()`関数が便利だ。`descr(データ名)`を入力するだけで各変数の記述統計量が出力される。実際にやってみると分かるが、情報量がかなり多い。しかし、実際の論文では各変数の歪度や尖度まで報告することはあまりないだろう。ここでは`stats`引数を追加して、論文などでよく使う平均値（`\"mean\"`）、標準偏差（`\"sd\"`）、最小値（`\"min\"`）、最大値（`\"max\"`）、有効ケース数（`\"n.valid\"`）のみ出力する。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndf |>\n  descr(stats = c(\"mean\", \"sd\", \"min\", \"max\", \"n.valid\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nDescriptive Statistics  \ndf  \nN: 344084  \n\n                   female     hh_size   voted2000   voted2002   voted2004   voted2006         yob\n------------- ----------- ----------- ----------- ----------- ----------- ----------- -----------\n         Mean        0.50        2.18        0.25        0.39        0.40        0.32     1956.21\n      Std.Dev        0.50        0.79        0.43        0.49        0.49        0.46       14.45\n          Min        0.00        1.00        0.00        0.00        0.00        0.00     1900.00\n          Max        1.00        8.00        1.00        1.00        1.00        1.00     1986.00\n      N.Valid   344084.00   344084.00   344084.00   344084.00   344084.00   344084.00   344084.00\n```\n\n\n:::\n:::\n\n\n　ただし、`descr()`を使うと数値型（numeric）変数の記述統計量のみ表示される。`df`だと、`treatment`列は文字型（character）であるため、表示されない[^data-type]。各グループがサンプルの何割かを計算するためには、`treatment`変数をダミー変数へ変換する必要がある。ダミー変数の作成は面倒な作業であるが、{fastDummies}パッケージの`dummy_cols()`を使えば簡単にできる。`dummy_cols()`の中には`select_columns = \"ダミー化する列名\"`を入れれば、当該変数をダミー変数へ変換し、新しい列として追加してくれる。それでは`treatment`列をダミー化&追加し、その結果を`df`に上書きしてみよう。\n\n[^data-type]: 変数のデータ型はデータを出力する際、列名の下段に表示される。`<chr>`は文字型、`<dbl>`と`<int>`は数値型、`<fct>`はfactor型である。他にもいくつかのデータ型がある。詳細は『私たちのR』の[第8章](https://www.jaysong.net/RBook/datatype.html)を参照すること。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndf <- df |>\n  dummy_cols(select_columns = \"treatment\")\n\ndf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 344,084 × 13\n   treatment  female   yob hh_size voted2000 voted2002 voted2004 voted2006\n   <chr>       <dbl> <dbl>   <dbl>     <dbl>     <dbl>     <dbl>     <dbl>\n 1 Civic Duty      0  1941       2         0         1         0         0\n 2 Civic Duty      1  1947       2         0         1         0         0\n 3 Hawthorne       0  1951       3         0         1         0         1\n 4 Hawthorne       1  1950       3         0         1         0         1\n 5 Hawthorne       1  1982       3         0         1         0         1\n 6 Control         0  1981       3         0         0         0         0\n 7 Control         1  1959       3         0         1         0         1\n 8 Control         0  1956       3         0         1         0         1\n 9 Control         1  1968       2         0         1         0         0\n10 Control         0  1967       2         0         1         0         0\n# ℹ 344,074 more rows\n# ℹ 5 more variables: `treatment_Civic Duty` <int>, treatment_Control <int>,\n#   treatment_Hawthorne <int>, treatment_Neighbors <int>, treatment_Self <int>\n```\n\n\n:::\n:::\n\n\n　画面には表示されないが、出力結果の下段を見ると`treatment_`で始まるいくつかの変数が追加されたことが分かる。ここでは`\"tretmant\"`で始まる列のみを抽出つして確認してみよう。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndf |>\n  select(starts_with(\"treatment\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 344,084 × 6\n   treatment  `treatment_Civic Duty` treatment_Control treatment_Hawthorne\n   <chr>                       <int>             <int>               <int>\n 1 Civic Duty                      1                 0                   0\n 2 Civic Duty                      1                 0                   0\n 3 Hawthorne                       0                 0                   1\n 4 Hawthorne                       0                 0                   1\n 5 Hawthorne                       0                 0                   1\n 6 Control                         0                 1                   0\n 7 Control                         0                 1                   0\n 8 Control                         0                 1                   0\n 9 Control                         0                 1                   0\n10 Control                         0                 1                   0\n# ℹ 344,074 more rows\n# ℹ 2 more variables: treatment_Neighbors <int>, treatment_Self <int>\n```\n\n\n:::\n:::\n\n\n　`select()`関数内には抽出する列名を入力するだけで良い。たとえば、`female`と`yob`列を抽出するなら`select(female, yob)`である。また、`female`**から**`voted2006`**まで**の意味で`female:voted2006`のような書き方もできる。他にも上の例のように`starts_with()`や`ends_with()`、`contain()`を使って特定の文字列で始まる（で終わる、を含む）列を指定することもできる。一部の列を除外する場合は変数名の前に`!`か`-`を付ける。\n\n　とにかく、問題なくダミー化されていることが分かる。もう一度記述統計量を出してみよう。`descr()`は仕様上、出力される変数の順番はアルファベット順になるが、ここでは元の順番を維持するために`order = \"p\"`を追加する。また、通常の記述統計表が、先ほど見たものとは違って、各行が変数を、列は記述統計量を表す場合が多い。このように行と列を交換するためには`transpose = TRUE`を追加する[^descr-rmarkdown]。\n\n[^descr-rmarkdown]: RMarkdown内に埋め込むなら更に`style = \"rmarkdown\"`を追加してみよう。ただし、Chunkオプションに`results = \"asis\"`（Quartoなら`#| results: \"asis\"`）を付けること。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndf |>\n  descr(stats = c(\"mean\", \"sd\", \"min\", \"max\", \"n.valid\"),\n        order = \"p\", transpose = TRUE, headings = FALSE)\n```\n\n                                Mean   Std.Dev       Min       Max     N.Valid\n-------------------------- --------- --------- --------- --------- -----------\n                    female      0.50      0.50      0.00      1.00   344084.00\n                       yob   1956.21     14.45   1900.00   1986.00   344084.00\n                   hh_size      2.18      0.79      1.00      8.00   344084.00\n                 voted2000      0.25      0.43      0.00      1.00   344084.00\n                 voted2002      0.39      0.49      0.00      1.00   344084.00\n                 voted2004      0.40      0.49      0.00      1.00   344084.00\n                 voted2006      0.32      0.46      0.00      1.00   344084.00\n      treatment_Civic Duty      0.11      0.31      0.00      1.00   344084.00\n         treatment_Control      0.56      0.50      0.00      1.00   344084.00\n       treatment_Hawthorne      0.11      0.31      0.00      1.00   344084.00\n       treatment_Neighbors      0.11      0.31      0.00      1.00   344084.00\n            treatment_Self      0.11      0.31      0.00      1.00   344084.00\n:::\n\n\n　他にも以下のように`dfSummary()`関数を使えば、綺麗な表としてまとめてくれる。しかも文字型、factor型変数の場合も度数分布表を作成してくれるので非常に便利だ。これも{summarytools}パッケージに含まれた機能なので、別途、パッケージを読み込む必要はない。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndf |>\n  select(-starts_with(\"treatment_\")) |>\n  dfSummary(headings = FALSE) |> \n  print(method = \"render\", round.digits = 3)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"container st-container\">\n<table class=\"table table-striped table-bordered st-table st-table-striped st-table-bordered st-multiline \">\n  <thead>\n    <tr>\n      <th align=\"center\" class=\"st-protect-top-border\"><strong>No</strong></th>\n      <th align=\"center\" class=\"st-protect-top-border\"><strong>Variable</strong></th>\n      <th align=\"center\" class=\"st-protect-top-border\"><strong>Stats / Values</strong></th>\n      <th align=\"center\" class=\"st-protect-top-border\"><strong>Freqs (% of Valid)</strong></th>\n      <th align=\"center\" class=\"st-protect-top-border\"><strong>Graph</strong></th>\n      <th align=\"center\" class=\"st-protect-top-border\"><strong>Valid</strong></th>\n      <th align=\"center\" class=\"st-protect-top-border\"><strong>Missing</strong></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td align=\"center\">1</td>\n      <td align=\"left\">treatment\n[character]</td>\n      <td align=\"left\" style=\"padding:8;vertical-align:middle\"><table style=\"border-collapse:collapse;border:none;margin:0\"><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">1. Civic Duty</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">2. Control</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">3. Hawthorne</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">4. Neighbors</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">5. Self</td></tr></table></td>\n      <td align=\"left\" style=\"padding:0;vertical-align:middle\"><table style=\"border-collapse:collapse;border:none;margin:0\"><tr style=\"background-color:transparent\"><td style=\"padding:0 5px 0 7px;margin:0;border:0\" align=\"right\">38218</td><td style=\"padding:0 2px 0 0;border:0;\" align=\"left\">(</td><td style=\"padding:0;border:0\" align=\"right\">11.1%</td><td style=\"padding:0 4px 0 2px;border:0\" align=\"left\">)</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0 5px 0 7px;margin:0;border:0\" align=\"right\">191243</td><td style=\"padding:0 2px 0 0;border:0;\" align=\"left\">(</td><td style=\"padding:0;border:0\" align=\"right\">55.6%</td><td style=\"padding:0 4px 0 2px;border:0\" align=\"left\">)</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0 5px 0 7px;margin:0;border:0\" align=\"right\">38204</td><td style=\"padding:0 2px 0 0;border:0;\" align=\"left\">(</td><td style=\"padding:0;border:0\" align=\"right\">11.1%</td><td style=\"padding:0 4px 0 2px;border:0\" align=\"left\">)</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0 5px 0 7px;margin:0;border:0\" align=\"right\">38201</td><td style=\"padding:0 2px 0 0;border:0;\" align=\"left\">(</td><td style=\"padding:0;border:0\" align=\"right\">11.1%</td><td style=\"padding:0 4px 0 2px;border:0\" align=\"left\">)</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0 5px 0 7px;margin:0;border:0\" align=\"right\">38218</td><td style=\"padding:0 2px 0 0;border:0;\" align=\"left\">(</td><td style=\"padding:0;border:0\" align=\"right\">11.1%</td><td style=\"padding:0 4px 0 2px;border:0\" align=\"left\">)</td></tr></table></td>\n      <td align=\"left\" style=\"vertical-align:middle;padding:0;background-color:transparent;\"><img style=\"border:none;background-color:transparent;padding:0;max-width:max-content;\" src=\"data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAGAAAAB9CAQAAAD32a72AAAAAmJLR0QA/4ePzL8AAAAHdElNRQfpBx0HDh0VBuRqAAABB0lEQVR42u3aQQrCMBBG4UR6Rw/hefQOPaVuE7G1xcWbX963ExHmQSpkaH+2bBd6AAPoAX61jB8eXx+IW6cHbq21ccxl/uq6+8OVnvyD+CNkAM0AmgE0A2gG0AygGUAzgPZ2I6t459rXx/tliQvvAePM8UfIANr0EN9TFqXDw3pqL1TD/E8Zf4QMoBlAM4BmAM0AmgE0A2gG0OIDXGwRXGxVcnIvVON9oc0A3xcywIA8BtAMoBlAM4BmAM0AmgE090IE90KVuBeixR8hA2gG0AygGUAzgGYAzQCaAbT4APdCBPdClbgXosUfIQNoBtAMoBlAM4BmAM0AmgG0+ID/2gslij9CBtBeu/od7x9DAtEAAAA9dEVYdGljYzpjb3B5cmlnaHQAQ29weXJpZ2h0IDIwMDcgQXBwbGUgSW5jLiwgYWxsIHJpZ2h0cyByZXNlcnZlZC6eZtwpAAAAI3RFWHRpY2M6ZGVzY3JpcHRpb24AR2VuZXJpYyBSR0IgUHJvZmlsZRqnOI4AAAAASUVORK5CYII=\"></td>\n      <td align=\"center\">344084\n(100.0%)</td>\n      <td align=\"center\">0\n(0.0%)</td>\n    </tr>\n    <tr>\n      <td align=\"center\">2</td>\n      <td align=\"left\">female\n[numeric]</td>\n      <td align=\"left\" style=\"padding:8;vertical-align:middle\"><table style=\"border-collapse:collapse;border:none;margin:0\"><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">Min  : 0</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">Mean : 0.5</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">Max  : 1</td></tr></table></td>\n      <td align=\"left\" style=\"padding:0;vertical-align:middle\"><table style=\"border-collapse:collapse;border:none;margin:0\"><tr style=\"background-color:transparent\"><td style=\"padding:0 2px 0 7px;margin:0;border:0\" align=\"right\">0</td><td style=\"padding:0 2px;border:0;\" align=\"left\">:</td><td style=\"padding:0 4px 0 6px;margin:0;border:0\" align=\"right\">172289</td><td style=\"padding:0;border:0\" align=\"left\">(</td><td style=\"padding:0 2px;margin:0;border:0\" align=\"right\">50.1%</td><td style=\"padding:0 4px 0 0;border:0\" align=\"left\">)</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0 2px 0 7px;margin:0;border:0\" align=\"right\">1</td><td style=\"padding:0 2px;border:0;\" align=\"left\">:</td><td style=\"padding:0 4px 0 6px;margin:0;border:0\" align=\"right\">171795</td><td style=\"padding:0;border:0\" align=\"left\">(</td><td style=\"padding:0 2px;margin:0;border:0\" align=\"right\">49.9%</td><td style=\"padding:0 4px 0 0;border:0\" align=\"left\">)</td></tr></table></td>\n      <td align=\"left\" style=\"vertical-align:middle;padding:0;background-color:transparent;\"><img style=\"border:none;background-color:transparent;padding:0;max-width:max-content;\" src=\"data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAFgAAAA3CAQAAAAiPkUwAAAAAmJLR0QA/4ePzL8AAAAHdElNRQfpBx0HDh0VBuRqAAAAkklEQVRo3u3YsQ2AMAxE0RixIzvAPLBDpoTWiaCJFOKL/nVurFecIsV2J60sowGAo2X1wxW00Lt9gFPaRttekotJrhKAAQMGDBgw4FABDBgw4MnA1Z8ut235MeY/yta8pm+8Ua4ScuCiw2fIQ8pRNDX8IaV+BuQqARgwYMCAAQMOFcCAAQOeDKx9SFGIXCUA984D81ILx+yzmEIAAAA9dEVYdGljYzpjb3B5cmlnaHQAQ29weXJpZ2h0IDIwMDcgQXBwbGUgSW5jLiwgYWxsIHJpZ2h0cyByZXNlcnZlZC6eZtwpAAAAI3RFWHRpY2M6ZGVzY3JpcHRpb24AR2VuZXJpYyBSR0IgUHJvZmlsZRqnOI4AAAAASUVORK5CYII=\"></td>\n      <td align=\"center\">344084\n(100.0%)</td>\n      <td align=\"center\">0\n(0.0%)</td>\n    </tr>\n    <tr>\n      <td align=\"center\">3</td>\n      <td align=\"left\">yob\n[numeric]</td>\n      <td align=\"left\" style=\"padding:8;vertical-align:middle\"><table style=\"border-collapse:collapse;border:none;margin:0\"><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">Mean (sd) : 1956.2 (14.4)</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">min &le; med &le; max:</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">1900 &le; 1956 &le; 1986</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">IQR (CV) : 18 (0)</td></tr></table></td>\n      <td align=\"left\" style=\"vertical-align:middle\">86 distinct values</td>\n      <td align=\"left\" style=\"vertical-align:middle;padding:0;background-color:transparent;\"><img style=\"border:none;background-color:transparent;padding:0;max-width:max-content;\" src=\"data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAJgAAABuCAQAAABxABKuAAAAAmJLR0QA/4ePzL8AAAAHdElNRQfpBx0HDh6MD7XQAAABx0lEQVR42u3cQZKCMBQAUbG8o3fQ8+gdPKVuQ7TUhoT8hH47NyN2zQ+BYZyeBxHH1gfQG4NBBoNO6Yup9dH87fa29F4rHnz6ZqfFP6Wx8+zVY7P3dSQhg0EGgzpZw25h9tedBGu3yOccSchgkMEgg0EGgwwGdbOt+GW+U6t3KT5MsHSfVnOX5khCBoMMBhkMCrvox7k/MRc22HbnPcaRhAwGGQwyGGQwyGCQwSCDQQaDDAYZDDIYZDDIYJDBIINBBoMMBhkMMhhkMMhgUOA/s62R/1Wz3NM8gwar98y1IwkZDAozklGfpciFCRbnfz2+cyQhg0EGgwwGGQwyGGQwyGCQwSCDQQaDAl1LtsK+x8dgB3bZ70hCBoMMBhkMarbo93JLOtfwLNnHLemcIwkZDDIYZDDIYNBOriXLPc2zk2DltjCOJGQwyGCQwaDNFv1YF9vLj2bDs2Ski+3l3+vjSEIGgwwGGQwyGFTxLBlrI1FK1W1FzC/lW8eRhAwGGQwyGFRw0R/nrPj2SZIb2kXPkpEur2t9DkcSMhhkMGjFGjbOIk+sWvRHWeQJRxJCv2H7HMK5KW1wN8hHl2TjOtmIcQ2DDAYZDHoBkgoxatSAN4MAAAA9dEVYdGljYzpjb3B5cmlnaHQAQ29weXJpZ2h0IDIwMDcgQXBwbGUgSW5jLiwgYWxsIHJpZ2h0cyByZXNlcnZlZC6eZtwpAAAAI3RFWHRpY2M6ZGVzY3JpcHRpb24AR2VuZXJpYyBSR0IgUHJvZmlsZRqnOI4AAAAASUVORK5CYII=\"></td>\n      <td align=\"center\">344084\n(100.0%)</td>\n      <td align=\"center\">0\n(0.0%)</td>\n    </tr>\n    <tr>\n      <td align=\"center\">4</td>\n      <td align=\"left\">hh_size\n[numeric]</td>\n      <td align=\"left\" style=\"padding:8;vertical-align:middle\"><table style=\"border-collapse:collapse;border:none;margin:0\"><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">Mean (sd) : 2.2 (0.8)</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">min &le; med &le; max:</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">1 &le; 2 &le; 8</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">IQR (CV) : 0 (0.4)</td></tr></table></td>\n      <td align=\"left\" style=\"padding:0;vertical-align:middle\"><table style=\"border-collapse:collapse;border:none;margin:0\"><tr style=\"background-color:transparent\"><td style=\"padding:0 2px 0 7px;margin:0;border:0\" align=\"right\">1</td><td style=\"padding:0 2px;border:0;\" align=\"left\">:</td><td style=\"padding:0 4px 0 6px;margin:0;border:0\" align=\"right\">47834</td><td style=\"padding:0;border:0\" align=\"left\">(</td><td style=\"padding:0 2px;margin:0;border:0\" align=\"right\">13.9%</td><td style=\"padding:0 4px 0 0;border:0\" align=\"left\">)</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0 2px 0 7px;margin:0;border:0\" align=\"right\">2</td><td style=\"padding:0 2px;border:0;\" align=\"left\">:</td><td style=\"padding:0 4px 0 6px;margin:0;border:0\" align=\"right\">214086</td><td style=\"padding:0;border:0\" align=\"left\">(</td><td style=\"padding:0 2px;margin:0;border:0\" align=\"right\">62.2%</td><td style=\"padding:0 4px 0 0;border:0\" align=\"left\">)</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0 2px 0 7px;margin:0;border:0\" align=\"right\">3</td><td style=\"padding:0 2px;border:0;\" align=\"left\">:</td><td style=\"padding:0 4px 0 6px;margin:0;border:0\" align=\"right\">57474</td><td style=\"padding:0;border:0\" align=\"left\">(</td><td style=\"padding:0 2px;margin:0;border:0\" align=\"right\">16.7%</td><td style=\"padding:0 4px 0 0;border:0\" align=\"left\">)</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0 2px 0 7px;margin:0;border:0\" align=\"right\">4</td><td style=\"padding:0 2px;border:0;\" align=\"left\">:</td><td style=\"padding:0 4px 0 6px;margin:0;border:0\" align=\"right\">20916</td><td style=\"padding:0;border:0\" align=\"left\">(</td><td style=\"padding:0 2px;margin:0;border:0\" align=\"right\">6.1%</td><td style=\"padding:0 4px 0 0;border:0\" align=\"left\">)</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0 2px 0 7px;margin:0;border:0\" align=\"right\">5</td><td style=\"padding:0 2px;border:0;\" align=\"left\">:</td><td style=\"padding:0 4px 0 6px;margin:0;border:0\" align=\"right\">3315</td><td style=\"padding:0;border:0\" align=\"left\">(</td><td style=\"padding:0 2px;margin:0;border:0\" align=\"right\">1.0%</td><td style=\"padding:0 4px 0 0;border:0\" align=\"left\">)</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0 2px 0 7px;margin:0;border:0\" align=\"right\">6</td><td style=\"padding:0 2px;border:0;\" align=\"left\">:</td><td style=\"padding:0 4px 0 6px;margin:0;border:0\" align=\"right\">402</td><td style=\"padding:0;border:0\" align=\"left\">(</td><td style=\"padding:0 2px;margin:0;border:0\" align=\"right\">0.1%</td><td style=\"padding:0 4px 0 0;border:0\" align=\"left\">)</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0 2px 0 7px;margin:0;border:0\" align=\"right\">7</td><td style=\"padding:0 2px;border:0;\" align=\"left\">:</td><td style=\"padding:0 4px 0 6px;margin:0;border:0\" align=\"right\">49</td><td style=\"padding:0;border:0\" align=\"left\">(</td><td style=\"padding:0 2px;margin:0;border:0\" align=\"right\">0.0%</td><td style=\"padding:0 4px 0 0;border:0\" align=\"left\">)</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0 2px 0 7px;margin:0;border:0\" align=\"right\">8</td><td style=\"padding:0 2px;border:0;\" align=\"left\">:</td><td style=\"padding:0 4px 0 6px;margin:0;border:0\" align=\"right\">8</td><td style=\"padding:0;border:0\" align=\"left\">(</td><td style=\"padding:0 2px;margin:0;border:0\" align=\"right\">0.0%</td><td style=\"padding:0 4px 0 0;border:0\" align=\"left\">)</td></tr></table></td>\n      <td align=\"left\" style=\"vertical-align:middle;padding:0;background-color:transparent;\"><img style=\"border:none;background-color:transparent;padding:0;max-width:max-content;\" src=\"data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAGoAAADECAQAAADdPnyCAAAAAmJLR0QA/4ePzL8AAAAHdElNRQfpBx0HDh6MD7XQAAABgUlEQVR42u3bYUoCURhG4Qz32CJaj+2hVdrfGY3SIrzn63n+SSBz6M6AL3o4P83z/OgLEPWfo47bF2933GCvh0df+t720o/7P73c+Bbvj2740sjjJ6pCVIWoClEVoipEVYiqEFUxMuri4/zaH9NvddgOFottKXfZdow8fiOjdvfUqTysb+6dH+5+q9k/4EYeP1EVoipEVYiqEFUhqkJUhaiKkVF2v5XZ/Yp+vfut9r2/q6j7d781Hywjj5+oClEVoipEVYiqEFUhqkJUhYlsZSayopFR3+5+K+56d0Vd737Np+HI4yeqQlSFqApRFaIqRFWIqhBVYfdbmd2vaH7U6Zz+pe/nUVOIqhBVIapCVIWoClEVoipEVYiqsPtViKq42P0efTl/EDWFqApRFaIqRFWIqhBVIapCVIWoCrtfxfwoE9nCRFWIqhBVIapCVIWoClEVoipEVYyMsvtVzI+y+y1MVIWoClEVoipEVYiqEFUhqkJUxciow5CtZWfkf0pUxQeNeCis3OJezAAAAD10RVh0aWNjOmNvcHlyaWdodABDb3B5cmlnaHQgMjAwNyBBcHBsZSBJbmMuLCBhbGwgcmlnaHRzIHJlc2VydmVkLp5m3CkAAAAjdEVYdGljYzpkZXNjcmlwdGlvbgBHZW5lcmljIFJHQiBQcm9maWxlGqc4jgAAAABJRU5ErkJggg==\"></td>\n      <td align=\"center\">344084\n(100.0%)</td>\n      <td align=\"center\">0\n(0.0%)</td>\n    </tr>\n    <tr>\n      <td align=\"center\">5</td>\n      <td align=\"left\">voted2000\n[numeric]</td>\n      <td align=\"left\" style=\"padding:8;vertical-align:middle\"><table style=\"border-collapse:collapse;border:none;margin:0\"><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">Min  : 0</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">Mean : 0.3</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">Max  : 1</td></tr></table></td>\n      <td align=\"left\" style=\"padding:0;vertical-align:middle\"><table style=\"border-collapse:collapse;border:none;margin:0\"><tr style=\"background-color:transparent\"><td style=\"padding:0 2px 0 7px;margin:0;border:0\" align=\"right\">0</td><td style=\"padding:0 2px;border:0;\" align=\"left\">:</td><td style=\"padding:0 4px 0 6px;margin:0;border:0\" align=\"right\">257464</td><td style=\"padding:0;border:0\" align=\"left\">(</td><td style=\"padding:0 2px;margin:0;border:0\" align=\"right\">74.8%</td><td style=\"padding:0 4px 0 0;border:0\" align=\"left\">)</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0 2px 0 7px;margin:0;border:0\" align=\"right\">1</td><td style=\"padding:0 2px;border:0;\" align=\"left\">:</td><td style=\"padding:0 4px 0 6px;margin:0;border:0\" align=\"right\">86620</td><td style=\"padding:0;border:0\" align=\"left\">(</td><td style=\"padding:0 2px;margin:0;border:0\" align=\"right\">25.2%</td><td style=\"padding:0 4px 0 0;border:0\" align=\"left\">)</td></tr></table></td>\n      <td align=\"left\" style=\"vertical-align:middle;padding:0;background-color:transparent;\"><img style=\"border:none;background-color:transparent;padding:0;max-width:max-content;\" src=\"data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAH0AAAA3CAQAAACLSo2kAAAAAmJLR0QA/4ePzL8AAAAHdElNRQfpBx0HDh6MD7XQAAAAnklEQVRo3u3ZsQ2AIBQAUTDu6A46j+7AlNqiiQ0REe9eR2O45GMBcQ9UQ+sNmG76m8Z8sf3+4M/xJj2EqfXeqkqnFXjgTScynch0ItOJTCcynch0ItOJTCe63M2lsq90KeaXsLH4M73Ia8EDD04/nfX1wSeI5fOnp9ITRA+/S/DAm05kOpHpRKYTmU5kOpHpRKYTmU7kEwQReOBNJzoAJacLx1TWcigAAAA9dEVYdGljYzpjb3B5cmlnaHQAQ29weXJpZ2h0IDIwMDcgQXBwbGUgSW5jLiwgYWxsIHJpZ2h0cyByZXNlcnZlZC6eZtwpAAAAI3RFWHRpY2M6ZGVzY3JpcHRpb24AR2VuZXJpYyBSR0IgUHJvZmlsZRqnOI4AAAAASUVORK5CYII=\"></td>\n      <td align=\"center\">344084\n(100.0%)</td>\n      <td align=\"center\">0\n(0.0%)</td>\n    </tr>\n    <tr>\n      <td align=\"center\">6</td>\n      <td align=\"left\">voted2002\n[numeric]</td>\n      <td align=\"left\" style=\"padding:8;vertical-align:middle\"><table style=\"border-collapse:collapse;border:none;margin:0\"><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">Min  : 0</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">Mean : 0.4</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">Max  : 1</td></tr></table></td>\n      <td align=\"left\" style=\"padding:0;vertical-align:middle\"><table style=\"border-collapse:collapse;border:none;margin:0\"><tr style=\"background-color:transparent\"><td style=\"padding:0 2px 0 7px;margin:0;border:0\" align=\"right\">0</td><td style=\"padding:0 2px;border:0;\" align=\"left\">:</td><td style=\"padding:0 4px 0 6px;margin:0;border:0\" align=\"right\">209947</td><td style=\"padding:0;border:0\" align=\"left\">(</td><td style=\"padding:0 2px;margin:0;border:0\" align=\"right\">61.0%</td><td style=\"padding:0 4px 0 0;border:0\" align=\"left\">)</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0 2px 0 7px;margin:0;border:0\" align=\"right\">1</td><td style=\"padding:0 2px;border:0;\" align=\"left\">:</td><td style=\"padding:0 4px 0 6px;margin:0;border:0\" align=\"right\">134137</td><td style=\"padding:0;border:0\" align=\"left\">(</td><td style=\"padding:0 2px;margin:0;border:0\" align=\"right\">39.0%</td><td style=\"padding:0 4px 0 0;border:0\" align=\"left\">)</td></tr></table></td>\n      <td align=\"left\" style=\"vertical-align:middle;padding:0;background-color:transparent;\"><img style=\"border:none;background-color:transparent;padding:0;max-width:max-content;\" src=\"data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAGgAAAA3CAQAAABKzccIAAAAAmJLR0QA/4ePzL8AAAAHdElNRQfpBx0HDh6MD7XQAAAAn0lEQVRo3u3YsQmAMBBA0UTc0R10Ht3BKbWNgk0Q7nv+36WRPLhYXD1KroboCwj6G2hsD9tHH9RcH0ClTNF362i/nNKNnCB6gugJoieIniB6gugJoieIniB6t53C3vcVULVd9NTuz8TWGtKNXDrQ5Q2tIYvG5dVJD180vv0bSjdygugJoieIniB6gugJoieIniB6gujlXjRmKN3ICaJ3AppiC8fdrh9zAAAAPXRFWHRpY2M6Y29weXJpZ2h0AENvcHlyaWdodCAyMDA3IEFwcGxlIEluYy4sIGFsbCByaWdodHMgcmVzZXJ2ZWQunmbcKQAAACN0RVh0aWNjOmRlc2NyaXB0aW9uAEdlbmVyaWMgUkdCIFByb2ZpbGUapziOAAAAAElFTkSuQmCC\"></td>\n      <td align=\"center\">344084\n(100.0%)</td>\n      <td align=\"center\">0\n(0.0%)</td>\n    </tr>\n    <tr>\n      <td align=\"center\">7</td>\n      <td align=\"left\">voted2004\n[numeric]</td>\n      <td align=\"left\" style=\"padding:8;vertical-align:middle\"><table style=\"border-collapse:collapse;border:none;margin:0\"><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">Min  : 0</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">Mean : 0.4</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">Max  : 1</td></tr></table></td>\n      <td align=\"left\" style=\"padding:0;vertical-align:middle\"><table style=\"border-collapse:collapse;border:none;margin:0\"><tr style=\"background-color:transparent\"><td style=\"padding:0 2px 0 7px;margin:0;border:0\" align=\"right\">0</td><td style=\"padding:0 2px;border:0;\" align=\"left\">:</td><td style=\"padding:0 4px 0 6px;margin:0;border:0\" align=\"right\">205934</td><td style=\"padding:0;border:0\" align=\"left\">(</td><td style=\"padding:0 2px;margin:0;border:0\" align=\"right\">59.8%</td><td style=\"padding:0 4px 0 0;border:0\" align=\"left\">)</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0 2px 0 7px;margin:0;border:0\" align=\"right\">1</td><td style=\"padding:0 2px;border:0;\" align=\"left\">:</td><td style=\"padding:0 4px 0 6px;margin:0;border:0\" align=\"right\">138150</td><td style=\"padding:0;border:0\" align=\"left\">(</td><td style=\"padding:0 2px;margin:0;border:0\" align=\"right\">40.2%</td><td style=\"padding:0 4px 0 0;border:0\" align=\"left\">)</td></tr></table></td>\n      <td align=\"left\" style=\"vertical-align:middle;padding:0;background-color:transparent;\"><img style=\"border:none;background-color:transparent;padding:0;max-width:max-content;\" src=\"data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAGYAAAA3CAQAAABUBPe7AAAAAmJLR0QA/4ePzL8AAAAHdElNRQfpBx0HDh6MD7XQAAAAoElEQVRo3u3YsQmAMBBA0UTc0R10Ht0hU2obBQtFyM/5X5dG8uFicXlPcQytL2DMH2LG+rB1+IDmfBOT0tT6bg+V0ynUmBlDZQyVMVTGUBlDZQyVMVTGUBlDddkBlHdfgcj1Qia//kw79f1DjVmomNObWZstAZdPJhyxBPzqtxNqzIyhMobKGCpjqIyhMobKGCpjqIyhirsE7F2oMTOG6gClgAvHCon2YAAAAD10RVh0aWNjOmNvcHlyaWdodABDb3B5cmlnaHQgMjAwNyBBcHBsZSBJbmMuLCBhbGwgcmlnaHRzIHJlc2VydmVkLp5m3CkAAAAjdEVYdGljYzpkZXNjcmlwdGlvbgBHZW5lcmljIFJHQiBQcm9maWxlGqc4jgAAAABJRU5ErkJggg==\"></td>\n      <td align=\"center\">344084\n(100.0%)</td>\n      <td align=\"center\">0\n(0.0%)</td>\n    </tr>\n    <tr>\n      <td align=\"center\">8</td>\n      <td align=\"left\">voted2006\n[numeric]</td>\n      <td align=\"left\" style=\"padding:8;vertical-align:middle\"><table style=\"border-collapse:collapse;border:none;margin:0\"><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">Min  : 0</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">Mean : 0.3</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0;margin:0;border:0\" align=\"left\">Max  : 1</td></tr></table></td>\n      <td align=\"left\" style=\"padding:0;vertical-align:middle\"><table style=\"border-collapse:collapse;border:none;margin:0\"><tr style=\"background-color:transparent\"><td style=\"padding:0 2px 0 7px;margin:0;border:0\" align=\"right\">0</td><td style=\"padding:0 2px;border:0;\" align=\"left\">:</td><td style=\"padding:0 4px 0 6px;margin:0;border:0\" align=\"right\">235388</td><td style=\"padding:0;border:0\" align=\"left\">(</td><td style=\"padding:0 2px;margin:0;border:0\" align=\"right\">68.4%</td><td style=\"padding:0 4px 0 0;border:0\" align=\"left\">)</td></tr><tr style=\"background-color:transparent\"><td style=\"padding:0 2px 0 7px;margin:0;border:0\" align=\"right\">1</td><td style=\"padding:0 2px;border:0;\" align=\"left\">:</td><td style=\"padding:0 4px 0 6px;margin:0;border:0\" align=\"right\">108696</td><td style=\"padding:0;border:0\" align=\"left\">(</td><td style=\"padding:0 2px;margin:0;border:0\" align=\"right\">31.6%</td><td style=\"padding:0 4px 0 0;border:0\" align=\"left\">)</td></tr></table></td>\n      <td align=\"left\" style=\"vertical-align:middle;padding:0;background-color:transparent;\"><img style=\"border:none;background-color:transparent;padding:0;max-width:max-content;\" src=\"data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAHMAAAA3CAQAAACVg70XAAAAAmJLR0QA/4ePzL8AAAAHdElNRQfpBx0HDh6MD7XQAAAAoElEQVRo3u3YQQ5AMBBA0Vbc0R04D3dwSrYlsdCg8ue/XTfSn0wtJm8pgq71Bcw0866+PCyohzrmi8yUhtZ3e8x6OAUZWjNJzCQxk8RMEjNJzCQxk8RMEjNJTrugte4rv5fLZV6u/swflWVBhjZI5uFtzi+vo6dmr+LDdXTL31uQoTWTxEwSM0nMJDGTxEwSM0nMJDGTJOI6mivI0JpJsgNdPQvHfudQawAAAD10RVh0aWNjOmNvcHlyaWdodABDb3B5cmlnaHQgMjAwNyBBcHBsZSBJbmMuLCBhbGwgcmlnaHRzIHJlc2VydmVkLp5m3CkAAAAjdEVYdGljYzpkZXNjcmlwdGlvbgBHZW5lcmljIFJHQiBQcm9maWxlGqc4jgAAAABJRU5ErkJggg==\"></td>\n      <td align=\"center\">344084\n(100.0%)</td>\n      <td align=\"center\">0\n(0.0%)</td>\n    </tr>\n  </tbody>\n</table>\n<p>Generated by <a href='https://github.com/dcomtois/summarytools'>summarytools</a> 1.1.4 (<a href='https://www.r-project.org/'>R</a> version 4.5.1)<br/>2025-07-29</p>\n</div>\n```\n\n:::\n:::\n\n\n## バランスチェック\n\n　バランスチェックの簡単な方法はグループごとに処置前変数（pre-treatment variables）の平均値を比較することである。無作為割当が成功しているのであれば、処置前に測定された変数の平均値は近似するはずである。ここではグループ（`treatment`）ごとに性別、誕生年、世帯規模、2000〜2004年の投票参加の平均値を比較してみる。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndf |>\n  group_by(treatment) |>\n  summarise(female    = mean(female, na.rm = TRUE),\n            yob       = mean(yob, na.rm = TRUE),\n            hh_size   = mean(hh_size, na.rm = TRUE),\n            voted2000 = mean(voted2000, na.rm = TRUE),\n            voted2002 = mean(voted2002, na.rm = TRUE),\n            voted2004 = mean(voted2004, na.rm = TRUE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 7\n  treatment  female   yob hh_size voted2000 voted2002 voted2004\n  <chr>       <dbl> <dbl>   <dbl>     <dbl>     <dbl>     <dbl>\n1 Civic Duty  0.500 1956.    2.19     0.254     0.389     0.399\n2 Control     0.499 1956.    2.18     0.252     0.389     0.400\n3 Hawthorne   0.499 1956.    2.18     0.250     0.394     0.403\n4 Neighbors   0.500 1956.    2.19     0.251     0.387     0.407\n5 Self        0.500 1956.    2.18     0.251     0.392     0.402\n```\n\n\n:::\n:::\n\n\n　それぞれの変数の平均値は非常に似ているため、無作為割当が成功したと考えられる。しかし、変数の単位によって判断が難しいかも知れない。たとえば、2つのグループがあり、年齢の平均値の差は3、世帯規模のそれは2だとする。これを見ると年齢の方がよりバランスが取れていないようにも見えるが、年齢の幅は数十であるに対し、世帯規模はせいぜい5〜6程度であろう。したがって、各変数のばらつきまで考慮した比較が適切であり、その方法の一つが標準化バイアス（=標準化差分）である。\n\n　標準化差分を計算する便利パッケージ、{BalanceR}を使ってみよう。第1引数はデータだから、パイプで渡せば良い。`BalanceR()`内には`group`引数にグループ識別変数を、`cov`には処置前変数のベクトルを入れる。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nblc_chk <- df |>\n  BalanceR(group = treatment,\n           cov   = c(female, yob, hh_size, voted2000, voted2002, voted2004))\n\nblc_chk\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Covariate Mean:Civic Duty SD:Civic Duty Mean:Control SD:Control\n1    female           0.500         0.500        0.499      0.500\n2       yob        1956.341        14.465     1956.186     14.436\n3   hh_size           2.189         0.802        2.184      0.788\n4 voted2000           0.254         0.435        0.252      0.434\n5 voted2002           0.389         0.487        0.389      0.488\n6 voted2004           0.399         0.490        0.400      0.490\n  Mean:Hawthorne SD:Hawthorne Mean:Neighbors SD:Neighbors Mean:Self SD:Self\n1          0.499        0.500          0.500        0.500     0.500   0.500\n2       1956.295       14.400       1956.147       14.579  1956.207  14.416\n3          2.180        0.789          2.188        0.805     2.181   0.782\n4          0.250        0.433          0.251        0.434     0.251   0.434\n5          0.394        0.489          0.387        0.487     0.392   0.488\n6          0.403        0.491          0.407        0.491     0.402   0.490\n  SB:Civic Duty-Control SB:Civic Duty-Hawthorne SB:Civic Duty-Neighbors\n1                 0.248                   0.236                   0.024\n2                 1.069                   0.317                   1.335\n3                 0.687                   1.130                   0.169\n4                 0.388                   0.738                   0.547\n5                -0.108                  -1.123                   0.464\n6                -0.182                  -0.772                  -1.472\n  SB:Civic Duty-Self SB:Control-Hawthorne SB:Control-Neighbors SB:Control-Self\n1              0.120               -0.013               -0.225          -0.128\n2              0.924               -0.754                0.272          -0.146\n3              1.051                0.448               -0.515           0.365\n4              0.566                0.350                0.158           0.178\n5             -0.628               -1.015                0.572          -0.520\n6             -0.619               -0.590               -1.289          -0.437\n  SB:Hawthorne-Neighbors SB:Hawthorne-Self SB:Neighbors-Self\n1                 -0.212            -0.115             0.097\n2                  1.022             0.609            -0.417\n3                 -0.958            -0.085             0.878\n4                 -0.192            -0.172             0.020\n5                  1.587             0.496            -1.092\n6                 -0.700             0.153             0.853\n```\n\n\n:::\n:::\n\n\n　ちなみに、`df`内に`female`から`voted2004`は連続している（`names(df)`で確認してみよう）。この場合は以下のように（`female:voted2004`）書き換えることもできる。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nblc_chk <- df |>\n  BalanceR(group = treatment,\n           cov   = female:voted2004)\n\nblc_chk\n```\n:::\n\n\n　標準化差分（標準化バイアス）を用いたバランスチェックはそれぞれのペアごとに計算を行うため、グループが多い場合は凡例が圧迫される場合が多い。しかし、重要なのは標準化差分の最大値だろう。ペア1、2、3でバランスが取れても、ペア4のバランスが取られていない場合は無意味だからだ。また、標準化差分の場合、符号の意味はなく、絶対値が重要だ。また、バランスチェックにおいてグループごとの平均値や標準偏差は不要である。ここで`summary()`関数を使うと、絶対値が最も大きい標準化差分のみ出力される。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsummary(blc_chk)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Covariate Abs_Maximum_SB\n1    female          0.248\n2       yob          1.335\n3   hh_size          1.130\n4 voted2000          0.738\n5 voted2002          1.587\n6 voted2004          1.472\n```\n\n\n:::\n:::\n\n\n　`plot()`関数を使えば、これらの結果を可視化することもできる。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplot(blc_chk)\n```\n\n::: {.cell-output-display}\n![標準化差分によるバランス✔](intro_rct_files/figure-html/fig-blc-1-1.png){#fig-blc-1 fig-align='center' width=1050}\n:::\n:::\n\n\n　先ほど述べたようにバランスチェックで重要なのは絶対値が最も大きい標準化差分である。`plot()`内に`simplify = TRUE`を指定すれば最大値のみ表示され、更に`abs = TRUE`にすると絶対値へ変換される。また、垂直のガイドラインは`vline`引数で変更できる。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# plot() の第1引数は blc_chk なのでパイプの使える\nblc_chk |>\n  plot(vline = c(5, 10), simplify = TRUE, abs = TRUE)\n```\n\n::: {.cell-output-display}\n![標準化差分を全て絶対値にし、最も大きいもののみを表示](intro_rct_files/figure-html/fig-blc-2-1.png){#fig-blc-2 fig-align='center' width=1050}\n:::\n:::\n\n\n## 処置効果の推定\n\n### グループごとの応答変数の平均値\n\n　処置効果を確認するためには各グループごとの応答変数（ここでは`voted2006`）の平均値を計算し、処置群の平均値から統制群の平均値を引く必要がある。まずは、特定の変数の平均値を計算する方法について紹介する。データ内にある特定の変数の平均値を計算するためには`summarise()`関数内に平均値を求める`mean()`関数を入れる。たとえば、`df`の`voted2006`の平均値を計算するコードは以下の通りである。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndf |>\n  summarise(mean(voted2006, na.rm = TRUE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 1\n  `mean(voted2006, na.rm = TRUE)`\n                            <dbl>\n1                           0.316\n```\n\n\n:::\n:::\n\n\n　`na.rm = TRUE`は「欠損値があれば、それを除外する」を意味し、指定されていない場合（=既定値）は`FALSE`になる。今回は欠損値がないものの、念の為に入れておく。\n\n　出力結果を見ると、平均値が表示される列の名前が```` `mean(voted2006, na.rm = TRUE)` ````となっており、非常に見にくい。この場合、以下のように`mean()`の前に出力される列名を予め指定することもできる。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndf |>\n  # voted2006の平均値が表示される列名を Outcome にする。\n  summarise(Outcome = mean(voted2006, na.rm = TRUE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 1\n  Outcome\n    <dbl>\n1   0.316\n```\n\n\n:::\n:::\n\n\n　我々が知りたいのは`voted2006`の平均値でなく、**グループごと**の平均値だろう。被験者がどのグループに属しているかわ示す変数は`treatment`であるが、`summarise()`にデータを渡す前に`group_by()`変数を使うと、グループごとに計算を行い、その結果を返す。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndf |>\n  group_by(treatment) |>\n  summarise(Outcome = mean(voted2006, na.rm = TRUE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 2\n  treatment  Outcome\n  <chr>        <dbl>\n1 Civic Duty   0.315\n2 Control      0.297\n3 Hawthorne    0.322\n4 Neighbors    0.378\n5 Self         0.345\n```\n\n\n:::\n:::\n\n\n　`group_by()`内でも`=`演算子を使うと、グループ名が出力される列名を変更することができる。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndf |>\n  # グループ名が表示される列名を Group にする。\n  group_by(Groups = treatment) |>\n  summarise(Outcome = mean(voted2006, na.rm = TRUE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 2\n  Groups     Outcome\n  <chr>        <dbl>\n1 Civic Duty   0.315\n2 Control      0.297\n3 Hawthorne    0.322\n4 Neighbors    0.378\n5 Self         0.345\n```\n\n\n:::\n:::\n\n\n　ここで一つ注目したいのが、グループの表示順番である。変数のデータ型が文字型だと（Rコンソール上で`class(df$treatment)`を入力するか、`df`の出力画面で`treatment`の下に`<chr>`と表示されていることで確認できる）、今のようにアルファベット順で表示される。しかし、統制群は最初か最後に来るのが通例である。この順番をアルファベット順でなく、任意の順番にするためには`treatment`変数をfactor型変数へ変換する必要がある。Factor型は「順序付きの文字型変数」だと理解しても良い[^factor-numeric]。列の追加・上書き（今回は`treatment`列の上書き）の処理が必要なので`mutate()`関数を使う。変数をfactor型に変換する関数は`factor()`関数で、第1引数としてはfactor型へ変換する変数名を指定する。第2引数は`levels`であり、出力したい順番の文字型ベクトルを指定する。**スペルミス**に注意すること。\n\n[^factor-numeric]: 中身が1、2、3、...であってもfactor型であれば1、2、3、...は数字でなく文字として認識される。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndf |>\n  mutate(treatment = factor(treatment,\n                            levels = c(\"Control\", \"Civic Duty\",\n                                       \"Self\", \"Neighbors\", \"Hawthorne\")))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 344,084 × 13\n   treatment  female   yob hh_size voted2000 voted2002 voted2004 voted2006\n   <fct>       <dbl> <dbl>   <dbl>     <dbl>     <dbl>     <dbl>     <dbl>\n 1 Civic Duty      0  1941       2         0         1         0         0\n 2 Civic Duty      1  1947       2         0         1         0         0\n 3 Hawthorne       0  1951       3         0         1         0         1\n 4 Hawthorne       1  1950       3         0         1         0         1\n 5 Hawthorne       1  1982       3         0         1         0         1\n 6 Control         0  1981       3         0         0         0         0\n 7 Control         1  1959       3         0         1         0         1\n 8 Control         0  1956       3         0         1         0         1\n 9 Control         1  1968       2         0         1         0         0\n10 Control         0  1967       2         0         1         0         0\n# ℹ 344,074 more rows\n# ℹ 5 more variables: `treatment_Civic Duty` <int>, treatment_Control <int>,\n#   treatment_Hawthorne <int>, treatment_Neighbors <int>, treatment_Self <int>\n```\n\n\n:::\n:::\n\n\n　`treatment`列名の下が`<fct>`となっていることが分かる。これは`treatment`列のデータ型がfactor型であることを意味する。問題なく動くことが確認できたので、`df`を上書きしよう。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndf <- df |>\n  mutate(treatment = factor(treatment,\n                            levels = c(\"Control\", \"Civic Duty\", \"Hawthorne\",\n                                       \"Self\", \"Neighbors\")))\n```\n:::\n\n\n　それでは、改めてグループごとの`voted2006`の平均値を計算してみよう。今回は計算結果を`out_mean_df`という名のオブジェクトとして格納する。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nout_mean_df <- df |>\n  group_by(Groups = treatment) |>\n  summarise(Outcome = mean(voted2006, na.rm = TRUE))\n\nout_mean_df\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 2\n  Groups     Outcome\n  <fct>        <dbl>\n1 Control      0.297\n2 Civic Duty   0.315\n3 Hawthorne    0.322\n4 Self         0.345\n5 Neighbors    0.378\n```\n\n\n:::\n:::\n\n\n　今回は統制群は最初に出力されていることが確認できる。\n\n　それではこの結果をグラフとして示してみよう。作図には{ggplot2}パッケージを使う。まずは`out_mean_df`を`ggplot()`関数に渡す。`ggplot()`関数以降は、`+`演算子を使ってレイヤーを足していくこととなる。棒グラフのレイヤーは`geom_col()`関数であり、その中に`aes()`関数を入れる。`aes()`の中には棒グラフの作図に必要な情報を入れる必要がある（これを**マッピング**（mapping）と呼ぶ）。棒グラフを作成するために必要な最低限の情報とは各棒の横軸上の位置（`x`）と棒の高さ（`y`）だ。今回は横軸がグループ名、縦軸が平均値となる棒グラフを作る。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nout_mean_df |>\n  ggplot() +\n  geom_col(aes(x = Groups, y = Outcome))\n```\n\n::: {.cell-output-display}\n![各グループごとの投票率](intro_rct_files/figure-html/fig-intro-bar-1-1.png){#fig-intro-bar-1 fig-align='center' width=1050}\n:::\n:::\n\n\n　続いて、このグラフの見た目を調整してみよう。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nout_mean_df |>\n  ggplot() +\n  geom_col(aes(x = Groups, y = Outcome)) +\n  # 縦軸（y軸）のラベルを変更する\n  labs(y = \"Mean(Outcome)\") +\n  # grayテーマ（デフォルトのテーマ）を使用し、フォントサイズは14\n  theme_gray(base_size = 14)\n```\n\n::: {.cell-output-display}\n![縦軸タイトルの変更 + 文字サイスの修正](intro_rct_files/figure-html/fig-intro-bar-2-1.png){#fig-intro-bar-2 fig-align='center' width=1050}\n:::\n:::\n\n\n　また、`geom_label()`レイヤーを足すと、棒の上にラベルを付けることもできる。ラベルに必要な情報は各ラベルの横軸上の位置（`x`）、縦軸上の位置（`y`）、ラベルの表示内容（`label`）だ。今回のラベルは平均値の具体的な数値を入れてみよう。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nout_mean_df |>\n  ggplot() +\n  geom_col(aes(x = Groups, y = Outcome)) +\n  geom_label(aes(x = Groups, y = Outcome, label = Outcome)) +\n  labs(y = \"Mean(Outcome)\") +\n  theme_gray(base_size = 14)\n```\n\n::: {.cell-output-display}\n![棒にラベルを追加](intro_rct_files/figure-html/fig-intro-bar-3-1.png){#fig-intro-bar-3 fig-align='center' width=1050}\n:::\n:::\n\n\n　小数点が長すぎるので3桁まで表示としよう。ここでは`sprintf()`を使用する。使い方が簡単とは言えないが、覚える必要はなく、必要な時にググるか、本資料のコードをコピペすれば良い[^sprintf]。\n\n[^sprintf]: もっと使いやすい`round()`があるが、`round()`の場合、丸めた結果が1.100なら1.1としか表記されない。表示される桁数を固定するためには`sprintf()`を使う。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nout_mean_df |>\n  ggplot() +\n  geom_col(aes(x = Groups, y = Outcome)) +\n  # 2桁までなら %.3f を %.2f に変更\n  geom_label(aes(x = Groups, y = Outcome, label = sprintf(\"%.3f\", Outcome))) +\n  labs(y = \"Mean(Outcome)\") +\n  theme_gray(base_size = 14)\n```\n\n::: {.cell-output-display}\n![推定値を小数点3桁まで表示](intro_rct_files/figure-html/fig-intro-bar-4-1.png){#fig-intro-bar-4 fig-align='center' width=1050}\n:::\n:::\n\n\n　これで可視化ができた。ただし、以上のコードには改善の余地がある。`geom_col()`と`geom_label()`内の`aes()`関数に注目して欲しい。よく見ると`x`と`y`と同じだろう。`geom_*()`が共有するマッピングがあれば、`ggplot()`内で指定することでコードを効率化することもできる。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nout_mean_df |>\n  ggplot(aes(x = Groups, y = Outcome)) +\n  geom_col() +\n  geom_label(aes(label = sprintf(\"%.3f\", Outcome))) +\n  labs(y = \"Mean(Outcome)\") +\n  theme_gray(base_size = 14)\n```\n\n::: {.cell-output-display}\n![マッピングを共有する箇所を`ggplot()`内でまとめる](intro_rct_files/figure-html/fig-intro-bar-5-1.png){#fig-intro-bar-5 fig-align='center' width=1050}\n:::\n:::\n\n\n### 統計的推定（単回帰分析）\n\n　これまでの作業はグループごとの応答変数の平均値であって、処置効果ではない。処置効果を計算するためには処置群の平均値から統制群の平均値を引く必要がある。たとえば、Civic Dutyはがき群の平均値は約0.315、統制群のそれは0.297であるため、Civic Dutyはがきの処置効果は約0.018である。しかし、これを各グループごとに計算することは面倒だし、何よりも得られた値が**点推定値**だという限界がある。得られた処置効果の不確実性は計算できない。\n\n　ここで有効なのが線形回帰分析である。回帰分析を行うことで処置効果の点推定値のみならず、不確実性の指標である標準誤差も計算され、区間推定や統計的仮説検定も可能となる。線形回帰分析の関数は`lm()`だ。第1引数としては回帰式であり、`応答変数 ~ 説明変数`と表記する。第2引数は`data`であり、回帰式で指定した変数が入っているデータ名を指定する。回帰分析の結果は名前を付けてオブジェクトとして格納し、`summary()`関数を使うと、詳細が確認できる。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit1 <- lm(voted2006 ~ treatment, data = df)\n\nsummary(fit1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = voted2006 ~ treatment, data = df)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-0.3780 -0.3145 -0.2966  0.6549  0.7034 \n\nCoefficients:\n                    Estimate Std. Error t value Pr(>|t|)    \n(Intercept)         0.296638   0.001061 279.525  < 2e-16 ***\ntreatmentCivic Duty 0.017899   0.002600   6.884 5.85e-12 ***\ntreatmentHawthorne  0.025736   0.002601   9.896  < 2e-16 ***\ntreatmentSelf       0.048513   0.002600  18.657  < 2e-16 ***\ntreatmentNeighbors  0.081310   0.002601  31.263  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.4641 on 344079 degrees of freedom\nMultiple R-squared:  0.003394,\tAdjusted R-squared:  0.003383 \nF-statistic:   293 on 4 and 344079 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n　ちなみに、これもパイプ演算子を使うことができる。ただし、第1引数として渡すパイプ演算子の特徴上、そのまま使うことはできない。なぜなら`lm()`関数の第1引数はデータでなく、回帰式（formula型）だから。この場合はプレースホルダー（place holder）を指定する必要がある。パイプ前のオブジェクトが入る位置を任意に指定することであり、`_`を使う。`%>%`演算子を使う場合は`_`でなく、`.`を使う。上記のコードと以下のコードは同じコードとなる。プレースホルダーは自分が使うパイプ演算子によって使い分けること。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit1 <- df |> # |> パイプを使う場合\n  lm(voted2006 ~ treatment, data = _)\n\nfit1 <- df %>% # %>% パイプを使う場合\n  lm(voted2006 ~ treatment, data = .)\n```\n:::\n\n\n　Factor型、または文字型変数が説明変数の場合、自動的にダミー変数として処理され、factor型の場合、最初の水準（ここでは`\"Control\"`）がベースカテゴリとなる。もし説明変数が文字型なら、アルファベット順で最初の水準がベースカテゴリとなり、今回の例だと`\"Civic Duty\"`がベースカテゴリとなる。処置効果は「統制群に比べて〜」が重要となるので、数値型以外の説明変数は予めfactor化しておいた方が望ましい。\n\n　Civic Dutyの推定値は約0.018であり、これは統制群に比べ、Civic Duty群の`voted2006`の平均値は約0.018高いことを意味する。応答変数が0、1であるため、これを割合（=投票率）で換算すると、約1.8%p高いことを意味する。つまり、Civic Dutyのはがきをもらった被験者はそうでない被験者に比べて投票率が約1.8%p高いことを意味する。他の推定値も同じやり方で解釈すれば良い。\n\n　それではこれらの処置効果が**統計的に有意**なものかを確認してみよう。統計的有意か否かを判定するためには有意と非有意の境界線が必要である、これは通常、**有意水準**（significance level; $\\alpha$）と呼ばれる。この有意水準は分析者が決めるものであるが、社会科学で広く使われる基準は$\\alpha = 0.05$、つまり5%だ。分析結果の画面には`Pr(>|t|)`列が表示されているが、これが$p$値と呼ばれるもので、これが0.05を下回る場合、統計的に有意と判定する。もし、$\\alpha = 0.1$を採用するなら、$p < 0.1$の場合において統計的に有意と判定する。Civic Dutyの$p$値は5.85e-12であり、これは$5.75 \\times 10^{-12}$を意味する。$10^{-1}$は0.1、$10^{-2}$は0.01であることを考えると非常に小さい数値であり、統計的に有意であると考えられる。また、$p$値が一定値以下であれば`< 2e-16`と表示される。4つの処置群において処置効果は統計的に有意であると判定できよう。\n\n　続いて、この結果を可視化してみよう。ここでも{ggplot2}パッケージを使って可視化をするが、{ggplot2}で使用可能なオブジェクトは表形式のデータである。Rコンソール上で`class(オブジェクト名)`を入力すると、データのクラスが出力されるが、このクラスに`\"data.frame\"`があれば、{ggplot2}で使用できる。たとえば、`fit1`オブジェクトのクラスは`\"lm\"`であるため、そのまま{ggplot2}で使うことはできない。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nclass(fit1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"lm\"\n```\n\n\n:::\n:::\n\n\n　推定結果を表形式に変換するためには{broom}パッケージの`tidy()`関数が便利だ。使い方は簡単で`tidy()`内に回帰分析の推定結果が格納されたオブジェクトを入れるだけである。ただし、デフォルトの設定では95%信頼区間が表示されないため、中には`conf.int = TRUE`を追加しておく必要がある。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# 90%信頼区間を使うのであれば conf.int = 0.9 を追加（デフォルトは0.95）\nfit1_coef <- tidy(fit1, conf.int = TRUE)\n\nfit1_coef\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 7\n  term                estimate std.error statistic   p.value conf.low conf.high\n  <chr>                  <dbl>     <dbl>     <dbl>     <dbl>    <dbl>     <dbl>\n1 (Intercept)           0.297    0.00106    280.   0           0.295     0.299 \n2 treatmentCivic Duty   0.0179   0.00260      6.88 5.85e- 12   0.0128    0.0230\n3 treatmentHawthorne    0.0257   0.00260      9.90 4.37e- 23   0.0206    0.0308\n4 treatmentSelf         0.0485   0.00260     18.7  1.22e- 77   0.0434    0.0536\n5 treatmentNeighbors    0.0813   0.00260     31.3  2.94e-214   0.0762    0.0864\n```\n\n\n:::\n\n```{.r .cell-code}\nclass(fit1_coef)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"tbl_df\"     \"tbl\"        \"data.frame\"\n```\n\n\n:::\n:::\n\n\n　`fit1_coef`のクラスに`\"data.frame\"`が含まれているので、これを使って作図することができる。\n\n　作図する前に、`fit1_coef`の加工しておきたい。それぞれの係数（`estimate`列）は処置効果を表しているが、切片（`\"(Intercept)\"`）の推定値は処置効果とは無関係である。したがって、予め切片の行を除外しておきたい。特定の行を残したり、除外する関数は`filter()`である。今回は`term`列の値が`\"(Intercept)\"`**ではない**行を残したいので、同値演算子（`==`）の否定を意味する`!=`演算子を使用する。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit1_coef <- fit1_coef |>\n  filter(term != \"(Intercept)\")\n\nfit1_coef\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 7\n  term                estimate std.error statistic   p.value conf.low conf.high\n  <chr>                  <dbl>     <dbl>     <dbl>     <dbl>    <dbl>     <dbl>\n1 treatmentCivic Duty   0.0179   0.00260      6.88 5.85e- 12   0.0128    0.0230\n2 treatmentHawthorne    0.0257   0.00260      9.90 4.37e- 23   0.0206    0.0308\n3 treatmentSelf         0.0485   0.00260     18.7  1.22e- 77   0.0434    0.0536\n4 treatmentNeighbors    0.0813   0.00260     31.3  2.94e-214   0.0762    0.0864\n```\n\n\n:::\n:::\n\n\n　それでは作図に入ろう。処置効果を示す場合は、点推定値以外にもその不確実性を示すのは一般的である。不確実性の指標として幅広く使われるのは標準誤差（standard error; 標準**偏差**ではない）であるが、可視化の際にはこの標準誤差に基づき計算した信頼区間を示すのが一般的だ。有意水準が5%（$\\alpha$ = 0.05）であれば、95%信頼区間を示し、10%（$\\alpha$ = 0.1）なら90%信頼区間を用いる。`tidy()`で得られたデータの場合、信頼区間の下限と上限はそれぞれ`conf.low`と`conf.high`という名の列に格納されている（`conf.int = TRUE`を指定しておかないと、信頼区間は計算されない）。\n\n　点と区間を同時に示すプロットがpoint-rangeプロットであり、{ggplot2}では`geom_pointrange()`レイヤーを使う。必要な情報はpoint-rangeの横軸上の位置（`x`）、点の縦軸上の位置（`y`）、区間の上限（`ymax`）と下限（`ymin`）である。これらの情報は全て`fit1_coef`に入っているため、`fit1_coef`をそのまま`ggplot()`関数に渡して作図することができる。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit1_coef |>\n  ggplot() +\n  geom_pointrange(aes(x = term, y = estimate,\n                      ymin = conf.low, ymax = conf.high))\n```\n\n::: {.cell-output-display}\n![処置効果と95%信頼区間](intro_rct_files/figure-html/fig-intro-pointrange-1-1.png){#fig-intro-pointrange-1 fig-align='center' width=1050}\n:::\n:::\n\n\n　それでは図をカスタマイズしてみよう。図内の様々なラベルを修正する`labs()`レイヤーでラベルを修正する。テーマはデフォルトの`theme_gray()`の代わりに白黒テーマ（`theme_bw()`）を使用し、フォントサイズは12とする。また、y = 0の水平線を追加する。95%信頼区間内に0が含まれる場合、「5%水準で統計的に有意でない」と判断できる。水平線を描くには`geom_hline()`レイヤーを追加し、`yintercept = 0`を指定することで、0のところに水平線が描ける。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit1_coef |>\n  ggplot() +\n  geom_hline(yintercept = 0) +\n  geom_pointrange(aes(x = term, y = estimate,\n                      ymin = conf.low, ymax = conf.high)) +\n  labs(x = \"Treatments\", y = \"Average Treatment Effects\") +\n  theme_bw(base_size = 12)\n```\n\n::: {.cell-output-display}\n![軸タイトルの修正 + y = 0の水平線を追加 + テーマの変更](intro_rct_files/figure-html/fig-intro-pointrange-2-1.png){#fig-intro-pointrange-2 fig-align='center' width=1050}\n:::\n:::\n\n\n　まだ気になる点がある。それは横軸の目盛りラベルに`treatment`という不要な情報がある点だ。これは作図の時点で修正することも可能だが、まずは`df`の`term`変数の値を修正する方法を紹介する。変数の値を修正する時には`recode()`関数を使用する。第1引数はリコーディングする変数名であり、引き続き`\"元の値\" = \"新しい値\"`を指定すれば良い。**スペルミスに注意**すること。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit1_coef <- fit1_coef |>\n  mutate(term = recode(term,\n                       \"treatmentCivic Duty\" = \"Civic Duty\",\n                       \"treatmentHawthorne\"  = \"Hawthorne\",\n                       \"treatmentSelf\"       = \"Self\",\n                       \"treatmentNeighbors\"  = \"Neighbors\"))\n\nfit1_coef\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 7\n  term       estimate std.error statistic   p.value conf.low conf.high\n  <chr>         <dbl>     <dbl>     <dbl>     <dbl>    <dbl>     <dbl>\n1 Civic Duty   0.0179   0.00260      6.88 5.85e- 12   0.0128    0.0230\n2 Hawthorne    0.0257   0.00260      9.90 4.37e- 23   0.0206    0.0308\n3 Self         0.0485   0.00260     18.7  1.22e- 77   0.0434    0.0536\n4 Neighbors    0.0813   0.00260     31.3  2.94e-214   0.0762    0.0864\n```\n\n\n:::\n:::\n\n\n　以上の作業は`term`列の各値から`\"treatment\"`文字を`\"\"`に置換することなので、文字列を置換する関数である`str_replace()`を使えば、より短くすることができる[^str-remove]。\n\n[^str-remove]: `str_replace(term, \"treatment\", \"\")`の代わりに`str_remove(term, \"treatment\")`でも良い。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit1_coef <- fit1_coef |>\n  mutate(term = str_replace(term, \"treatment\", \"\"))\n```\n:::\n\n\n　`fit1_coef`も修正できたので、 @fig-intro-pointrange-2 と同じコードでもう一度作図してみよう。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit1_coef |>\n  ggplot() +\n  geom_hline(yintercept = 0) +\n  geom_pointrange(aes(x = term, y = estimate,\n                      ymin = conf.low, ymax = conf.high)) +\n  labs(x = \"Treatments\", y = \"Average Treatment Effects\") +\n  theme_bw(base_size = 12)\n```\n\n::: {.cell-output-display}\n![横軸ラベルの変更](intro_rct_files/figure-html/fig-intro-pointrange-3-1.png){#fig-intro-pointrange-3 fig-align='center' width=1050}\n:::\n:::\n\n\n　最後に横軸の順番を修正してみよう。`fit1_coef`の`term`列は文字型変数であるため、アルファベット順になる。これを`df`の`treatment`列と同様、Civic Duty、Self、Neighbors、Hawthorneの順にしたい。この場合`fit1_coef`の`term`列をfactor化すれば良い。`factor()`関数を使っても良いが、ここではまた便利な技を紹介しよう。それは`fct_inorder()`関数だ。これは表示されている順番をfactorの順番とする関数だ。実際、`fit1_coef`の中身を見ると、表示順番はCivic Duty、Self、Neighbors、Hawthorneだ。非常に嬉しい状況なので、`fct_inorder()`を使ってみよう。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit1_coef <- fit1_coef |>\n  mutate(term = fct_inorder(term))\n\nfit1_coef\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 7\n  term       estimate std.error statistic   p.value conf.low conf.high\n  <fct>         <dbl>     <dbl>     <dbl>     <dbl>    <dbl>     <dbl>\n1 Civic Duty   0.0179   0.00260      6.88 5.85e- 12   0.0128    0.0230\n2 Hawthorne    0.0257   0.00260      9.90 4.37e- 23   0.0206    0.0308\n3 Self         0.0485   0.00260     18.7  1.22e- 77   0.0434    0.0536\n4 Neighbors    0.0813   0.00260     31.3  2.94e-214   0.0762    0.0864\n```\n\n\n:::\n:::\n\n\n　それでは、 @fig-intro-pointrange-3 と同じコードでもう一度作図してみよう。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit1_coef |>\n  ggplot() +\n  geom_hline(yintercept = 0) +\n  geom_pointrange(aes(x = term, y = estimate,\n                      ymin = conf.low, ymax = conf.high)) +\n  labs(x = \"Treatments\", y = \"Average Treatment Effects\") +\n  theme_bw(base_size = 12)\n```\n\n::: {.cell-output-display}\n![横軸ラベルの順番を変更した後](intro_rct_files/figure-html/fig-intro-pointrange-4-1.png){#fig-intro-pointrange-4 fig-align='center' width=1050}\n:::\n:::\n\n\n　これで処置効果の可視化もバッチリだ。\n\n### 多重比較の問題\n\n　グループが2つ、つまり統制群と統制群のみが存在する場合、我々が比較を行う回数は1回のみである（統制群 - 処置群）。しかし、今回のデータの場合、処置群は4つである。これは比較を4回行うことを意味する。具体的には「統制群 - 処置群1」、「統制群 - 処置群2」、「統制群 - 処置群3」、「統制群 - 処置群4」だ。比較を繰り返すほど、統計的に有意な結果が得られる可能性は高い。極端な話、1000回程度検定を繰り返せば、本当は効果がなくても**たまたま**統計的に有意な結果が何回かは得られるだろう。これが多重検定（multiple testing）の問題である。したがって、比較の回数が多くなるにつれ、統計的有意性検定にも何らかのペナルティーを課す必要がある。\n\n　多重比較におけるペナルティーの付け方はいくつかあるが、ここでは最も保守的な（=研究者にとって都合の悪い）補正法であるボンフェローニ補正（Bonferroni correction）を紹介する。これは非常に単純で、$p$値や信頼区間を計算する際、「統計的有意」と判定されるハードルを上げる方法である。予め決めておいた有意水準（$\\alpha$）が0.05で、比較の回数が4回であれば、$p$値が$0.05 \\times \\frac{1}{4} = 0.0125$を下回る場合において「5%水準で有意である」と判定する。信頼区間でいえば通常の95%信頼区間（1 - 0.05）でなく、98.75%信頼区間（1 - 0.0125）を使うこととなる。この結果、統計的に有意な結果が得られたら「1.25%水準で〜」と解釈するのではなく、「5%水準で〜」と解釈する必要がある。\n\n　95%以外の信頼区間を求めるのは簡単で、`tidy()`関数内に`conf.level`を修正すれば良い。指定されていない場合はデフォルトで0.95が割り当てられているが、これを0.9875と修正する。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit1_coef <- tidy(fit1, conf.int = TRUE, conf.level = 0.9875)\n\nfit1_coef\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 7\n  term                estimate std.error statistic   p.value conf.low conf.high\n  <chr>                  <dbl>     <dbl>     <dbl>     <dbl>    <dbl>     <dbl>\n1 (Intercept)           0.297    0.00106    280.   0           0.294     0.299 \n2 treatmentCivic Duty   0.0179   0.00260      6.88 5.85e- 12   0.0114    0.0244\n3 treatmentHawthorne    0.0257   0.00260      9.90 4.37e- 23   0.0192    0.0322\n4 treatmentSelf         0.0485   0.00260     18.7  1.22e- 77   0.0420    0.0550\n5 treatmentNeighbors    0.0813   0.00260     31.3  2.94e-214   0.0748    0.0878\n```\n\n\n:::\n:::\n\n\n　それでは @fig-intro-pointrange-4 と同じ図を作ってみよう。まず、切片の行を除外するが、ここでは`filter()`を使わず、`slice()`の使った方法を紹介する。`slice()`は`()`内に指定した行を残す関数だ。たとえば、`slice(fit1_coef, 2)`なら`fit1_coef`の2行目のみを残す。`fit1_coef`は`slice()`の第1引数だから、パイプ演算子を使うことも可能で、こちらの方を推奨する。そうすれば`()`内には残す行のみの指定で済む。`slice(2)`のみなら2行目を残し、`slice(1, 3, 5)`なら1、3、5行目を残す。`:`を使うと「〜行目から〜行目まで」の指定ができる。処置効果の係数は`fit1_coef`の2行目から5行目までなので、`2:5`と指定すれば良い。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit1_coef <- fit1_coef |>\n  slice(2:5)\n\nfit1_coef\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 7\n  term                estimate std.error statistic   p.value conf.low conf.high\n  <chr>                  <dbl>     <dbl>     <dbl>     <dbl>    <dbl>     <dbl>\n1 treatmentCivic Duty   0.0179   0.00260      6.88 5.85e- 12   0.0114    0.0244\n2 treatmentHawthorne    0.0257   0.00260      9.90 4.37e- 23   0.0192    0.0322\n3 treatmentSelf         0.0485   0.00260     18.7  1.22e- 77   0.0420    0.0550\n4 treatmentNeighbors    0.0813   0.00260     31.3  2.94e-214   0.0748    0.0878\n```\n\n\n:::\n:::\n\n\n　続いて、`term`変数の値から`\"treatment\"`の文字を除去し、`fit1_coef`での出力順番で`term`をfactor化する。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit1_coef <- fit1_coef |>\n  mutate(term = recode(term,\n                       \"treatmentCivic Duty\" = \"Civic Duty\",\n                       \"treatmentHawthorne\"  = \"Hawthorne\",\n                       \"treatmentSelf\"       = \"Self\",\n                       \"treatmentNeighbors\"  = \"Neighbors\"),\n         term = fct_inorder(term))\n\nfit1_coef\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 7\n  term       estimate std.error statistic   p.value conf.low conf.high\n  <fct>         <dbl>     <dbl>     <dbl>     <dbl>    <dbl>     <dbl>\n1 Civic Duty   0.0179   0.00260      6.88 5.85e- 12   0.0114    0.0244\n2 Hawthorne    0.0257   0.00260      9.90 4.37e- 23   0.0192    0.0322\n3 Self         0.0485   0.00260     18.7  1.22e- 77   0.0420    0.0550\n4 Neighbors    0.0813   0.00260     31.3  2.94e-214   0.0748    0.0878\n```\n\n\n:::\n:::\n\n\n　最後に @fig-intro-pointrange-4 と同じコードで作図する。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit1_coef |>\n  ggplot() +\n  geom_hline(yintercept = 0) +\n  geom_pointrange(aes(x = term, y = estimate,\n                      ymin = conf.low, ymax = conf.high)) +\n  labs(x = \"Treatments\", \n       y = \"Average Treatment Effects (w/ 98.75% CI)\") +\n  theme_bw(base_size = 12)\n```\n\n::: {.cell-output-display}\n![処置効果と98.75%信頼区間](intro_rct_files/figure-html/fig-intro-pointrange-5-1.png){#fig-intro-pointrange-5 fig-align='center' width=1050}\n:::\n:::\n\n\n### 統計的推定（重回帰分析）\n\n　今回の例は無作為割当が成功しており、処置前変数の偏りは見られない。しかし、何らかの理由で処置前変数の偏りが生じる場合がある。その「何らかの理由」が応答変数にまで影響を与えるのであれば、それは交絡変数（confounder）となり、バイアスの原因となる。この場合、偏りが生じている処置前変数を統制（control）することによってバイアスを小さくすることができる。今回は不要であるが、性別や誕生年などの共変量を統制した推定をしてみよう。\n\n　やり方は簡単で、`lm()`内の回帰式を`応答変数 ~ 説明変数1 + 説明変数2 + ...`のように説明変数を`+`で足していけば良い。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit2 <-lm(voted2006 ~ treatment + female + yob + hh_size +\n            voted2000 + voted2002 + voted2004, data = df)\n\nsummary(fit2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = voted2006 ~ treatment + female + yob + hh_size + \n    voted2000 + voted2002 + voted2004, data = df)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-0.7679 -0.3344 -0.1953  0.5300  0.9359 \n\nCoefficients:\n                      Estimate Std. Error t value Pr(>|t|)    \n(Intercept)          5.845e+00  1.099e-01  53.202  < 2e-16 ***\ntreatmentCivic Duty  1.839e-02  2.504e-03   7.343 2.10e-13 ***\ntreatmentHawthorne   2.506e-02  2.504e-03  10.005  < 2e-16 ***\ntreatmentSelf        4.797e-02  2.504e-03  19.157  < 2e-16 ***\ntreatmentNeighbors   8.064e-02  2.504e-03  32.199  < 2e-16 ***\nfemale              -5.783e-03  1.525e-03  -3.791  0.00015 ***\nyob                 -2.913e-03  5.642e-05 -51.633  < 2e-16 ***\nhh_size              5.075e-03  1.018e-03   4.986 6.17e-07 ***\nvoted2000            9.401e-02  1.783e-03  52.722  < 2e-16 ***\nvoted2002            1.414e-01  1.590e-03  88.876  < 2e-16 ***\nvoted2004            1.578e-01  1.564e-03 100.838  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.4469 on 344073 degrees of freedom\nMultiple R-squared:  0.07592,\tAdjusted R-squared:  0.0759 \nF-statistic:  2827 on 10 and 344073 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n　{modelsummary}パッケージの`modelsummary()`関数を使えば、推定結果がより見やすくなる。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmodelsummary(fit2)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script>\n\n      function styleCell_ndkubkmr7opurycobzs3(i, j, css_id) {\n          var table = document.getElementById(\"tinytable_ndkubkmr7opurycobzs3\");\n          var cell = table.querySelector(`[data-row=\"${i}\"][data-col=\"${j}\"]`);\n          if (cell) {\n              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);\n              cell.classList.add(css_id);\n          } else {\n              console.warn(`Cell at (${i}, ${j}) not found.`);\n          }\n      }\n      function insertSpanRow(i, colspan, content) {\n        var table = document.getElementById('tinytable_ndkubkmr7opurycobzs3');\n        // Find the row with data-row attribute matching i\n        var targetRow = table.querySelector(`tr [data-row=\"${i}\"]`).closest('tr');\n        var newRow = table.insertRow(targetRow.rowIndex);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        newCell.setAttribute(\"data-col\", \"0\");\n        newCell.setAttribute(\"data-row\", i - 1);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_ndkubkmr7opurycobzs3(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_ndkubkmr7opurycobzs3\");\n        const targetCell = table.querySelector(`[data-row=\"${i}\"][data-col=\"${j}\"]`);\n        if (!targetCell) {\n          console.warn(`Cell at (${i}, ${j}) not found.`);\n        }\n\n        // Get all cells that need to be removed\n        const cellsToRemove = [];\n        for (let r = 0; r < rowspan; r++) {\n          for (let c = 0; c < colspan; c++) {\n            if (r === 0 && c === 0) continue; // Skip the target cell\n            const cell = table.querySelector(`[data-row=\"${i + r}\"][data-col=\"${j + c}\"]`);\n            if (cell) {\n              cellsToRemove.push(cell);\n            }\n          }\n        }\n\n        // Remove all cells\n        cellsToRemove.forEach(cell => cell.remove());\n\n        // Set rowspan and colspan of the target cell if it exists\n        if (targetCell) {\n          targetCell.rowSpan = rowspan;\n          targetCell.colSpan = colspan;\n        }\n      }\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '30', j: 1 },  ], css_id: 'tinytable_css_ho4kfybydpuae46201xx',}, \n          { positions: [ { i: '22', j: 1 },  ], css_id: 'tinytable_css_9lehmgmvn3towaln0akh',}, \n          { positions: [ { i: '1', j: 1 }, { i: '2', j: 1 }, { i: '3', j: 1 }, { i: '4', j: 1 }, { i: '5', j: 1 }, { i: '6', j: 1 }, { i: '7', j: 1 }, { i: '8', j: 1 }, { i: '9', j: 1 }, { i: '10', j: 1 }, { i: '11', j: 1 }, { i: '12', j: 1 }, { i: '13', j: 1 }, { i: '14', j: 1 }, { i: '15', j: 1 }, { i: '16', j: 1 }, { i: '17', j: 1 }, { i: '18', j: 1 }, { i: '19', j: 1 }, { i: '20', j: 1 }, { i: '21', j: 1 }, { i: '26', j: 1 }, { i: '23', j: 1 }, { i: '24', j: 1 }, { i: '25', j: 1 }, { i: '27', j: 1 }, { i: '28', j: 1 }, { i: '29', j: 1 },  ], css_id: 'tinytable_css_wpie5h1uwwduojteps72',}, \n          { positions: [ { i: '0', j: 1 },  ], css_id: 'tinytable_css_kwrkpfkaj5mnyu2cadpt',}, \n          { positions: [ { i: '30', j: 0 },  ], css_id: 'tinytable_css_o8f2r6vbvqeybthx5g4n',}, \n          { positions: [ { i: '22', j: 0 },  ], css_id: 'tinytable_css_21l2fuelnkt2fbzraihe',}, \n          { positions: [ { i: '1', j: 0 }, { i: '2', j: 0 }, { i: '3', j: 0 }, { i: '4', j: 0 }, { i: '5', j: 0 }, { i: '6', j: 0 }, { i: '7', j: 0 }, { i: '8', j: 0 }, { i: '9', j: 0 }, { i: '10', j: 0 }, { i: '11', j: 0 }, { i: '12', j: 0 }, { i: '13', j: 0 }, { i: '14', j: 0 }, { i: '15', j: 0 }, { i: '16', j: 0 }, { i: '17', j: 0 }, { i: '18', j: 0 }, { i: '19', j: 0 }, { i: '20', j: 0 }, { i: '21', j: 0 }, { i: '26', j: 0 }, { i: '23', j: 0 }, { i: '24', j: 0 }, { i: '25', j: 0 }, { i: '27', j: 0 }, { i: '28', j: 0 }, { i: '29', j: 0 },  ], css_id: 'tinytable_css_6iw8ed2jcfv1wkcj8ppw',}, \n          { positions: [ { i: '0', j: 0 },  ], css_id: 'tinytable_css_206n9z0qmzs0lyqqny3e',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  styleCell_ndkubkmr7opurycobzs3(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <style>\n      /* tinytable css entries after */\n      .table td.tinytable_css_ho4kfybydpuae46201xx, .table th.tinytable_css_ho4kfybydpuae46201xx { text-align: center; border-bottom: solid #d3d8dc 0.1em; }\n      .table td.tinytable_css_9lehmgmvn3towaln0akh, .table th.tinytable_css_9lehmgmvn3towaln0akh { text-align: center; border-bottom: solid black 0.05em; }\n      .table td.tinytable_css_wpie5h1uwwduojteps72, .table th.tinytable_css_wpie5h1uwwduojteps72 { text-align: center; }\n      .table td.tinytable_css_kwrkpfkaj5mnyu2cadpt, .table th.tinytable_css_kwrkpfkaj5mnyu2cadpt { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }\n      .table td.tinytable_css_o8f2r6vbvqeybthx5g4n, .table th.tinytable_css_o8f2r6vbvqeybthx5g4n { text-align: left; border-bottom: solid #d3d8dc 0.1em; }\n      .table td.tinytable_css_21l2fuelnkt2fbzraihe, .table th.tinytable_css_21l2fuelnkt2fbzraihe { text-align: left; border-bottom: solid black 0.05em; }\n      .table td.tinytable_css_6iw8ed2jcfv1wkcj8ppw, .table th.tinytable_css_6iw8ed2jcfv1wkcj8ppw { text-align: left; }\n      .table td.tinytable_css_206n9z0qmzs0lyqqny3e, .table th.tinytable_css_206n9z0qmzs0lyqqny3e { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }\n    </style>\n    <div class=\"container\">\n      <table class=\"table table-borderless\" id=\"tinytable_ndkubkmr7opurycobzs3\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n        \n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"0\"> </th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">(1)</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"0\">(Intercept)</td>\n                  <td data-row=\"1\" data-col=\"1\">5.845</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"0\"></td>\n                  <td data-row=\"2\" data-col=\"1\">(0.110)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"0\">treatmentCivic Duty</td>\n                  <td data-row=\"3\" data-col=\"1\">0.018</td>\n                </tr>\n                <tr>\n                  <td data-row=\"4\" data-col=\"0\"></td>\n                  <td data-row=\"4\" data-col=\"1\">(0.003)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"5\" data-col=\"0\">treatmentHawthorne</td>\n                  <td data-row=\"5\" data-col=\"1\">0.025</td>\n                </tr>\n                <tr>\n                  <td data-row=\"6\" data-col=\"0\"></td>\n                  <td data-row=\"6\" data-col=\"1\">(0.003)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"7\" data-col=\"0\">treatmentSelf</td>\n                  <td data-row=\"7\" data-col=\"1\">0.048</td>\n                </tr>\n                <tr>\n                  <td data-row=\"8\" data-col=\"0\"></td>\n                  <td data-row=\"8\" data-col=\"1\">(0.003)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"9\" data-col=\"0\">treatmentNeighbors</td>\n                  <td data-row=\"9\" data-col=\"1\">0.081</td>\n                </tr>\n                <tr>\n                  <td data-row=\"10\" data-col=\"0\"></td>\n                  <td data-row=\"10\" data-col=\"1\">(0.003)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"11\" data-col=\"0\">female</td>\n                  <td data-row=\"11\" data-col=\"1\">-0.006</td>\n                </tr>\n                <tr>\n                  <td data-row=\"12\" data-col=\"0\"></td>\n                  <td data-row=\"12\" data-col=\"1\">(0.002)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"13\" data-col=\"0\">yob</td>\n                  <td data-row=\"13\" data-col=\"1\">-0.003</td>\n                </tr>\n                <tr>\n                  <td data-row=\"14\" data-col=\"0\"></td>\n                  <td data-row=\"14\" data-col=\"1\">(0.000)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"15\" data-col=\"0\">hh_size</td>\n                  <td data-row=\"15\" data-col=\"1\">0.005</td>\n                </tr>\n                <tr>\n                  <td data-row=\"16\" data-col=\"0\"></td>\n                  <td data-row=\"16\" data-col=\"1\">(0.001)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"17\" data-col=\"0\">voted2000</td>\n                  <td data-row=\"17\" data-col=\"1\">0.094</td>\n                </tr>\n                <tr>\n                  <td data-row=\"18\" data-col=\"0\"></td>\n                  <td data-row=\"18\" data-col=\"1\">(0.002)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"19\" data-col=\"0\">voted2002</td>\n                  <td data-row=\"19\" data-col=\"1\">0.141</td>\n                </tr>\n                <tr>\n                  <td data-row=\"20\" data-col=\"0\"></td>\n                  <td data-row=\"20\" data-col=\"1\">(0.002)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"21\" data-col=\"0\">voted2004</td>\n                  <td data-row=\"21\" data-col=\"1\">0.158</td>\n                </tr>\n                <tr>\n                  <td data-row=\"22\" data-col=\"0\"></td>\n                  <td data-row=\"22\" data-col=\"1\">(0.002)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"23\" data-col=\"0\">Num.Obs.</td>\n                  <td data-row=\"23\" data-col=\"1\">344084</td>\n                </tr>\n                <tr>\n                  <td data-row=\"24\" data-col=\"0\">R2</td>\n                  <td data-row=\"24\" data-col=\"1\">0.076</td>\n                </tr>\n                <tr>\n                  <td data-row=\"25\" data-col=\"0\">R2 Adj.</td>\n                  <td data-row=\"25\" data-col=\"1\">0.076</td>\n                </tr>\n                <tr>\n                  <td data-row=\"26\" data-col=\"0\">AIC</td>\n                  <td data-row=\"26\" data-col=\"1\">422192.9</td>\n                </tr>\n                <tr>\n                  <td data-row=\"27\" data-col=\"0\">BIC</td>\n                  <td data-row=\"27\" data-col=\"1\">422321.9</td>\n                </tr>\n                <tr>\n                  <td data-row=\"28\" data-col=\"0\">Log.Lik.</td>\n                  <td data-row=\"28\" data-col=\"1\">-211084.453</td>\n                </tr>\n                <tr>\n                  <td data-row=\"29\" data-col=\"0\">F</td>\n                  <td data-row=\"29\" data-col=\"1\">2826.942</td>\n                </tr>\n                <tr>\n                  <td data-row=\"30\" data-col=\"0\">RMSE</td>\n                  <td data-row=\"30\" data-col=\"1\">0.45</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n　また、複数のモデルを`list()`関数でまとめると、モデル間比較もできる。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmodelsummary(list(\"w/o Covariates\" = fit1, \"w/ Covariates\" = fit2))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script>\n\n      function styleCell_cs6fg1gcq58ahkaeq3j9(i, j, css_id) {\n          var table = document.getElementById(\"tinytable_cs6fg1gcq58ahkaeq3j9\");\n          var cell = table.querySelector(`[data-row=\"${i}\"][data-col=\"${j}\"]`);\n          if (cell) {\n              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);\n              cell.classList.add(css_id);\n          } else {\n              console.warn(`Cell at (${i}, ${j}) not found.`);\n          }\n      }\n      function insertSpanRow(i, colspan, content) {\n        var table = document.getElementById('tinytable_cs6fg1gcq58ahkaeq3j9');\n        // Find the row with data-row attribute matching i\n        var targetRow = table.querySelector(`tr [data-row=\"${i}\"]`).closest('tr');\n        var newRow = table.insertRow(targetRow.rowIndex);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        newCell.setAttribute(\"data-col\", \"0\");\n        newCell.setAttribute(\"data-row\", i - 1);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_cs6fg1gcq58ahkaeq3j9(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_cs6fg1gcq58ahkaeq3j9\");\n        const targetCell = table.querySelector(`[data-row=\"${i}\"][data-col=\"${j}\"]`);\n        if (!targetCell) {\n          console.warn(`Cell at (${i}, ${j}) not found.`);\n        }\n\n        // Get all cells that need to be removed\n        const cellsToRemove = [];\n        for (let r = 0; r < rowspan; r++) {\n          for (let c = 0; c < colspan; c++) {\n            if (r === 0 && c === 0) continue; // Skip the target cell\n            const cell = table.querySelector(`[data-row=\"${i + r}\"][data-col=\"${j + c}\"]`);\n            if (cell) {\n              cellsToRemove.push(cell);\n            }\n          }\n        }\n\n        // Remove all cells\n        cellsToRemove.forEach(cell => cell.remove());\n\n        // Set rowspan and colspan of the target cell if it exists\n        if (targetCell) {\n          targetCell.rowSpan = rowspan;\n          targetCell.colSpan = colspan;\n        }\n      }\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '30', j: 1 }, { i: '30', j: 2 },  ], css_id: 'tinytable_css_0u2fqlrhrbznqx9qrdag',}, \n          { positions: [ { i: '22', j: 1 }, { i: '22', j: 2 },  ], css_id: 'tinytable_css_d315onvufqv2w82azdyd',}, \n          { positions: [ { i: '2', j: 1 }, { i: '3', j: 1 }, { i: '4', j: 1 }, { i: '1', j: 1 }, { i: '6', j: 1 }, { i: '7', j: 1 }, { i: '8', j: 1 }, { i: '9', j: 1 }, { i: '10', j: 1 }, { i: '11', j: 1 }, { i: '12', j: 1 }, { i: '13', j: 1 }, { i: '14', j: 1 }, { i: '15', j: 1 }, { i: '16', j: 1 }, { i: '17', j: 1 }, { i: '5', j: 1 }, { i: '19', j: 1 }, { i: '20', j: 1 }, { i: '21', j: 1 }, { i: '4', j: 2 }, { i: '23', j: 1 }, { i: '24', j: 1 }, { i: '25', j: 1 }, { i: '26', j: 1 }, { i: '27', j: 1 }, { i: '28', j: 1 }, { i: '29', j: 1 }, { i: '12', j: 2 }, { i: '18', j: 1 }, { i: '1', j: 2 }, { i: '2', j: 2 }, { i: '3', j: 2 }, { i: '17', j: 2 }, { i: '5', j: 2 }, { i: '6', j: 2 }, { i: '7', j: 2 }, { i: '8', j: 2 }, { i: '9', j: 2 }, { i: '10', j: 2 }, { i: '11', j: 2 }, { i: '25', j: 2 }, { i: '13', j: 2 }, { i: '14', j: 2 }, { i: '15', j: 2 }, { i: '16', j: 2 }, { i: '21', j: 2 }, { i: '18', j: 2 }, { i: '19', j: 2 }, { i: '20', j: 2 }, { i: '29', j: 2 }, { i: '26', j: 2 }, { i: '23', j: 2 }, { i: '24', j: 2 }, { i: '27', j: 2 }, { i: '28', j: 2 },  ], css_id: 'tinytable_css_4ka989u4k2w791w8ubx0',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 },  ], css_id: 'tinytable_css_ejbyb07l4a390qbezv37',}, \n          { positions: [ { i: '30', j: 0 },  ], css_id: 'tinytable_css_g8uoc0p1nfiexduml6rg',}, \n          { positions: [ { i: '22', j: 0 },  ], css_id: 'tinytable_css_8165x2m660fked8ufafy',}, \n          { positions: [ { i: '1', j: 0 }, { i: '2', j: 0 }, { i: '3', j: 0 }, { i: '4', j: 0 }, { i: '5', j: 0 }, { i: '6', j: 0 }, { i: '7', j: 0 }, { i: '8', j: 0 }, { i: '9', j: 0 }, { i: '10', j: 0 }, { i: '11', j: 0 }, { i: '12', j: 0 }, { i: '13', j: 0 }, { i: '14', j: 0 }, { i: '15', j: 0 }, { i: '16', j: 0 }, { i: '17', j: 0 }, { i: '18', j: 0 }, { i: '19', j: 0 }, { i: '20', j: 0 }, { i: '21', j: 0 }, { i: '26', j: 0 }, { i: '23', j: 0 }, { i: '24', j: 0 }, { i: '25', j: 0 }, { i: '27', j: 0 }, { i: '28', j: 0 }, { i: '29', j: 0 },  ], css_id: 'tinytable_css_iynand4duovrkl6w091d',}, \n          { positions: [ { i: '0', j: 0 },  ], css_id: 'tinytable_css_jzqw9koanhdovxwhna7e',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  styleCell_cs6fg1gcq58ahkaeq3j9(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <style>\n      /* tinytable css entries after */\n      .table td.tinytable_css_0u2fqlrhrbznqx9qrdag, .table th.tinytable_css_0u2fqlrhrbznqx9qrdag { text-align: center; border-bottom: solid #d3d8dc 0.1em; }\n      .table td.tinytable_css_d315onvufqv2w82azdyd, .table th.tinytable_css_d315onvufqv2w82azdyd { text-align: center; border-bottom: solid black 0.05em; }\n      .table td.tinytable_css_4ka989u4k2w791w8ubx0, .table th.tinytable_css_4ka989u4k2w791w8ubx0 { text-align: center; }\n      .table td.tinytable_css_ejbyb07l4a390qbezv37, .table th.tinytable_css_ejbyb07l4a390qbezv37 { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }\n      .table td.tinytable_css_g8uoc0p1nfiexduml6rg, .table th.tinytable_css_g8uoc0p1nfiexduml6rg { text-align: left; border-bottom: solid #d3d8dc 0.1em; }\n      .table td.tinytable_css_8165x2m660fked8ufafy, .table th.tinytable_css_8165x2m660fked8ufafy { text-align: left; border-bottom: solid black 0.05em; }\n      .table td.tinytable_css_iynand4duovrkl6w091d, .table th.tinytable_css_iynand4duovrkl6w091d { text-align: left; }\n      .table td.tinytable_css_jzqw9koanhdovxwhna7e, .table th.tinytable_css_jzqw9koanhdovxwhna7e { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }\n    </style>\n    <div class=\"container\">\n      <table class=\"table table-borderless\" id=\"tinytable_cs6fg1gcq58ahkaeq3j9\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n        \n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"0\"> </th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">w/o Covariates</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">w/ Covariates</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"0\">(Intercept)</td>\n                  <td data-row=\"1\" data-col=\"1\">0.297</td>\n                  <td data-row=\"1\" data-col=\"2\">5.845</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"0\"></td>\n                  <td data-row=\"2\" data-col=\"1\">(0.001)</td>\n                  <td data-row=\"2\" data-col=\"2\">(0.110)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"0\">treatmentCivic Duty</td>\n                  <td data-row=\"3\" data-col=\"1\">0.018</td>\n                  <td data-row=\"3\" data-col=\"2\">0.018</td>\n                </tr>\n                <tr>\n                  <td data-row=\"4\" data-col=\"0\"></td>\n                  <td data-row=\"4\" data-col=\"1\">(0.003)</td>\n                  <td data-row=\"4\" data-col=\"2\">(0.003)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"5\" data-col=\"0\">treatmentHawthorne</td>\n                  <td data-row=\"5\" data-col=\"1\">0.026</td>\n                  <td data-row=\"5\" data-col=\"2\">0.025</td>\n                </tr>\n                <tr>\n                  <td data-row=\"6\" data-col=\"0\"></td>\n                  <td data-row=\"6\" data-col=\"1\">(0.003)</td>\n                  <td data-row=\"6\" data-col=\"2\">(0.003)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"7\" data-col=\"0\">treatmentSelf</td>\n                  <td data-row=\"7\" data-col=\"1\">0.049</td>\n                  <td data-row=\"7\" data-col=\"2\">0.048</td>\n                </tr>\n                <tr>\n                  <td data-row=\"8\" data-col=\"0\"></td>\n                  <td data-row=\"8\" data-col=\"1\">(0.003)</td>\n                  <td data-row=\"8\" data-col=\"2\">(0.003)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"9\" data-col=\"0\">treatmentNeighbors</td>\n                  <td data-row=\"9\" data-col=\"1\">0.081</td>\n                  <td data-row=\"9\" data-col=\"2\">0.081</td>\n                </tr>\n                <tr>\n                  <td data-row=\"10\" data-col=\"0\"></td>\n                  <td data-row=\"10\" data-col=\"1\">(0.003)</td>\n                  <td data-row=\"10\" data-col=\"2\">(0.003)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"11\" data-col=\"0\">female</td>\n                  <td data-row=\"11\" data-col=\"1\"></td>\n                  <td data-row=\"11\" data-col=\"2\">-0.006</td>\n                </tr>\n                <tr>\n                  <td data-row=\"12\" data-col=\"0\"></td>\n                  <td data-row=\"12\" data-col=\"1\"></td>\n                  <td data-row=\"12\" data-col=\"2\">(0.002)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"13\" data-col=\"0\">yob</td>\n                  <td data-row=\"13\" data-col=\"1\"></td>\n                  <td data-row=\"13\" data-col=\"2\">-0.003</td>\n                </tr>\n                <tr>\n                  <td data-row=\"14\" data-col=\"0\"></td>\n                  <td data-row=\"14\" data-col=\"1\"></td>\n                  <td data-row=\"14\" data-col=\"2\">(0.000)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"15\" data-col=\"0\">hh_size</td>\n                  <td data-row=\"15\" data-col=\"1\"></td>\n                  <td data-row=\"15\" data-col=\"2\">0.005</td>\n                </tr>\n                <tr>\n                  <td data-row=\"16\" data-col=\"0\"></td>\n                  <td data-row=\"16\" data-col=\"1\"></td>\n                  <td data-row=\"16\" data-col=\"2\">(0.001)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"17\" data-col=\"0\">voted2000</td>\n                  <td data-row=\"17\" data-col=\"1\"></td>\n                  <td data-row=\"17\" data-col=\"2\">0.094</td>\n                </tr>\n                <tr>\n                  <td data-row=\"18\" data-col=\"0\"></td>\n                  <td data-row=\"18\" data-col=\"1\"></td>\n                  <td data-row=\"18\" data-col=\"2\">(0.002)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"19\" data-col=\"0\">voted2002</td>\n                  <td data-row=\"19\" data-col=\"1\"></td>\n                  <td data-row=\"19\" data-col=\"2\">0.141</td>\n                </tr>\n                <tr>\n                  <td data-row=\"20\" data-col=\"0\"></td>\n                  <td data-row=\"20\" data-col=\"1\"></td>\n                  <td data-row=\"20\" data-col=\"2\">(0.002)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"21\" data-col=\"0\">voted2004</td>\n                  <td data-row=\"21\" data-col=\"1\"></td>\n                  <td data-row=\"21\" data-col=\"2\">0.158</td>\n                </tr>\n                <tr>\n                  <td data-row=\"22\" data-col=\"0\"></td>\n                  <td data-row=\"22\" data-col=\"1\"></td>\n                  <td data-row=\"22\" data-col=\"2\">(0.002)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"23\" data-col=\"0\">Num.Obs.</td>\n                  <td data-row=\"23\" data-col=\"1\">344084</td>\n                  <td data-row=\"23\" data-col=\"2\">344084</td>\n                </tr>\n                <tr>\n                  <td data-row=\"24\" data-col=\"0\">R2</td>\n                  <td data-row=\"24\" data-col=\"1\">0.003</td>\n                  <td data-row=\"24\" data-col=\"2\">0.076</td>\n                </tr>\n                <tr>\n                  <td data-row=\"25\" data-col=\"0\">R2 Adj.</td>\n                  <td data-row=\"25\" data-col=\"1\">0.003</td>\n                  <td data-row=\"25\" data-col=\"2\">0.076</td>\n                </tr>\n                <tr>\n                  <td data-row=\"26\" data-col=\"0\">AIC</td>\n                  <td data-row=\"26\" data-col=\"1\">448179.9</td>\n                  <td data-row=\"26\" data-col=\"2\">422192.9</td>\n                </tr>\n                <tr>\n                  <td data-row=\"27\" data-col=\"0\">BIC</td>\n                  <td data-row=\"27\" data-col=\"1\">448244.4</td>\n                  <td data-row=\"27\" data-col=\"2\">422321.9</td>\n                </tr>\n                <tr>\n                  <td data-row=\"28\" data-col=\"0\">Log.Lik.</td>\n                  <td data-row=\"28\" data-col=\"1\">-224083.935</td>\n                  <td data-row=\"28\" data-col=\"2\">-211084.453</td>\n                </tr>\n                <tr>\n                  <td data-row=\"29\" data-col=\"0\">F</td>\n                  <td data-row=\"29\" data-col=\"1\">292.976</td>\n                  <td data-row=\"29\" data-col=\"2\">2826.942</td>\n                </tr>\n                <tr>\n                  <td data-row=\"30\" data-col=\"0\">RMSE</td>\n                  <td data-row=\"30\" data-col=\"1\">0.46</td>\n                  <td data-row=\"30\" data-col=\"2\">0.45</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n　`modelsummary()`は推定値と標準誤差（カッコ内）が別々の行として出力する。これを一行でまとめるためには、以下のようにコードを修正する。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmodelsummary(list(\"w/o Covariates\" = fit1, \"w/ Covariates\" = fit2),\n             estimate  = \"{estimate} ({std.error})\",\n             statistic = NULL)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script>\n\n      function styleCell_tts3ao4mo17fyk3tql9z(i, j, css_id) {\n          var table = document.getElementById(\"tinytable_tts3ao4mo17fyk3tql9z\");\n          var cell = table.querySelector(`[data-row=\"${i}\"][data-col=\"${j}\"]`);\n          if (cell) {\n              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);\n              cell.classList.add(css_id);\n          } else {\n              console.warn(`Cell at (${i}, ${j}) not found.`);\n          }\n      }\n      function insertSpanRow(i, colspan, content) {\n        var table = document.getElementById('tinytable_tts3ao4mo17fyk3tql9z');\n        // Find the row with data-row attribute matching i\n        var targetRow = table.querySelector(`tr [data-row=\"${i}\"]`).closest('tr');\n        var newRow = table.insertRow(targetRow.rowIndex);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        newCell.setAttribute(\"data-col\", \"0\");\n        newCell.setAttribute(\"data-row\", i - 1);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_tts3ao4mo17fyk3tql9z(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_tts3ao4mo17fyk3tql9z\");\n        const targetCell = table.querySelector(`[data-row=\"${i}\"][data-col=\"${j}\"]`);\n        if (!targetCell) {\n          console.warn(`Cell at (${i}, ${j}) not found.`);\n        }\n\n        // Get all cells that need to be removed\n        const cellsToRemove = [];\n        for (let r = 0; r < rowspan; r++) {\n          for (let c = 0; c < colspan; c++) {\n            if (r === 0 && c === 0) continue; // Skip the target cell\n            const cell = table.querySelector(`[data-row=\"${i + r}\"][data-col=\"${j + c}\"]`);\n            if (cell) {\n              cellsToRemove.push(cell);\n            }\n          }\n        }\n\n        // Remove all cells\n        cellsToRemove.forEach(cell => cell.remove());\n\n        // Set rowspan and colspan of the target cell if it exists\n        if (targetCell) {\n          targetCell.rowSpan = rowspan;\n          targetCell.colSpan = colspan;\n        }\n      }\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '19', j: 1 }, { i: '19', j: 2 },  ], css_id: 'tinytable_css_kqcy5y33072tstfe37zm',}, \n          { positions: [ { i: '11', j: 2 }, { i: '11', j: 1 },  ], css_id: 'tinytable_css_rd4vapnnuguw3kczayoy',}, \n          { positions: [ { i: '1', j: 1 }, { i: '2', j: 1 }, { i: '4', j: 1 }, { i: '5', j: 1 }, { i: '6', j: 1 }, { i: '3', j: 1 }, { i: '8', j: 1 }, { i: '9', j: 1 }, { i: '10', j: 1 }, { i: '4', j: 2 }, { i: '12', j: 1 }, { i: '13', j: 1 }, { i: '14', j: 1 }, { i: '15', j: 1 }, { i: '16', j: 1 }, { i: '17', j: 1 }, { i: '18', j: 1 }, { i: '12', j: 2 }, { i: '7', j: 1 }, { i: '1', j: 2 }, { i: '2', j: 2 }, { i: '3', j: 2 }, { i: '17', j: 2 }, { i: '5', j: 2 }, { i: '6', j: 2 }, { i: '7', j: 2 }, { i: '8', j: 2 }, { i: '9', j: 2 }, { i: '10', j: 2 }, { i: '15', j: 2 }, { i: '16', j: 2 }, { i: '13', j: 2 }, { i: '14', j: 2 }, { i: '18', j: 2 },  ], css_id: 'tinytable_css_xnbduv9cun4yuxfrht40',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 },  ], css_id: 'tinytable_css_5gggxaautyuc41lkahho',}, \n          { positions: [ { i: '19', j: 0 },  ], css_id: 'tinytable_css_3ay50fg70i0fdc128dz4',}, \n          { positions: [ { i: '11', j: 0 },  ], css_id: 'tinytable_css_frw9bjjlhueapwxvhxhb',}, \n          { positions: [ { i: '1', j: 0 }, { i: '2', j: 0 }, { i: '3', j: 0 }, { i: '4', j: 0 }, { i: '5', j: 0 }, { i: '6', j: 0 }, { i: '7', j: 0 }, { i: '8', j: 0 }, { i: '9', j: 0 }, { i: '10', j: 0 }, { i: '15', j: 0 }, { i: '12', j: 0 }, { i: '13', j: 0 }, { i: '14', j: 0 }, { i: '16', j: 0 }, { i: '17', j: 0 }, { i: '18', j: 0 },  ], css_id: 'tinytable_css_yq7s0vpy2spn4y6xvhs0',}, \n          { positions: [ { i: '0', j: 0 },  ], css_id: 'tinytable_css_r16dtfyzbc0eptfzhmc6',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  styleCell_tts3ao4mo17fyk3tql9z(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <style>\n      /* tinytable css entries after */\n      .table td.tinytable_css_kqcy5y33072tstfe37zm, .table th.tinytable_css_kqcy5y33072tstfe37zm { text-align: center; border-bottom: solid #d3d8dc 0.1em; }\n      .table td.tinytable_css_rd4vapnnuguw3kczayoy, .table th.tinytable_css_rd4vapnnuguw3kczayoy { text-align: center; border-bottom: solid black 0.05em; }\n      .table td.tinytable_css_xnbduv9cun4yuxfrht40, .table th.tinytable_css_xnbduv9cun4yuxfrht40 { text-align: center; }\n      .table td.tinytable_css_5gggxaautyuc41lkahho, .table th.tinytable_css_5gggxaautyuc41lkahho { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }\n      .table td.tinytable_css_3ay50fg70i0fdc128dz4, .table th.tinytable_css_3ay50fg70i0fdc128dz4 { text-align: left; border-bottom: solid #d3d8dc 0.1em; }\n      .table td.tinytable_css_frw9bjjlhueapwxvhxhb, .table th.tinytable_css_frw9bjjlhueapwxvhxhb { text-align: left; border-bottom: solid black 0.05em; }\n      .table td.tinytable_css_yq7s0vpy2spn4y6xvhs0, .table th.tinytable_css_yq7s0vpy2spn4y6xvhs0 { text-align: left; }\n      .table td.tinytable_css_r16dtfyzbc0eptfzhmc6, .table th.tinytable_css_r16dtfyzbc0eptfzhmc6 { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }\n    </style>\n    <div class=\"container\">\n      <table class=\"table table-borderless\" id=\"tinytable_tts3ao4mo17fyk3tql9z\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n        \n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"0\"> </th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">w/o Covariates</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">w/ Covariates</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"0\">(Intercept)</td>\n                  <td data-row=\"1\" data-col=\"1\">0.297 (0.001)</td>\n                  <td data-row=\"1\" data-col=\"2\">5.845 (0.110)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"0\">treatmentCivic Duty</td>\n                  <td data-row=\"2\" data-col=\"1\">0.018 (0.003)</td>\n                  <td data-row=\"2\" data-col=\"2\">0.018 (0.003)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"0\">treatmentHawthorne</td>\n                  <td data-row=\"3\" data-col=\"1\">0.026 (0.003)</td>\n                  <td data-row=\"3\" data-col=\"2\">0.025 (0.003)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"4\" data-col=\"0\">treatmentSelf</td>\n                  <td data-row=\"4\" data-col=\"1\">0.049 (0.003)</td>\n                  <td data-row=\"4\" data-col=\"2\">0.048 (0.003)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"5\" data-col=\"0\">treatmentNeighbors</td>\n                  <td data-row=\"5\" data-col=\"1\">0.081 (0.003)</td>\n                  <td data-row=\"5\" data-col=\"2\">0.081 (0.003)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"6\" data-col=\"0\">female</td>\n                  <td data-row=\"6\" data-col=\"1\"></td>\n                  <td data-row=\"6\" data-col=\"2\">-0.006 (0.002)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"7\" data-col=\"0\">yob</td>\n                  <td data-row=\"7\" data-col=\"1\"></td>\n                  <td data-row=\"7\" data-col=\"2\">-0.003 (0.000)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"8\" data-col=\"0\">hh_size</td>\n                  <td data-row=\"8\" data-col=\"1\"></td>\n                  <td data-row=\"8\" data-col=\"2\">0.005 (0.001)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"9\" data-col=\"0\">voted2000</td>\n                  <td data-row=\"9\" data-col=\"1\"></td>\n                  <td data-row=\"9\" data-col=\"2\">0.094 (0.002)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"10\" data-col=\"0\">voted2002</td>\n                  <td data-row=\"10\" data-col=\"1\"></td>\n                  <td data-row=\"10\" data-col=\"2\">0.141 (0.002)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"11\" data-col=\"0\">voted2004</td>\n                  <td data-row=\"11\" data-col=\"1\"></td>\n                  <td data-row=\"11\" data-col=\"2\">0.158 (0.002)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"12\" data-col=\"0\">Num.Obs.</td>\n                  <td data-row=\"12\" data-col=\"1\">344084</td>\n                  <td data-row=\"12\" data-col=\"2\">344084</td>\n                </tr>\n                <tr>\n                  <td data-row=\"13\" data-col=\"0\">R2</td>\n                  <td data-row=\"13\" data-col=\"1\">0.003</td>\n                  <td data-row=\"13\" data-col=\"2\">0.076</td>\n                </tr>\n                <tr>\n                  <td data-row=\"14\" data-col=\"0\">R2 Adj.</td>\n                  <td data-row=\"14\" data-col=\"1\">0.003</td>\n                  <td data-row=\"14\" data-col=\"2\">0.076</td>\n                </tr>\n                <tr>\n                  <td data-row=\"15\" data-col=\"0\">AIC</td>\n                  <td data-row=\"15\" data-col=\"1\">448179.9</td>\n                  <td data-row=\"15\" data-col=\"2\">422192.9</td>\n                </tr>\n                <tr>\n                  <td data-row=\"16\" data-col=\"0\">BIC</td>\n                  <td data-row=\"16\" data-col=\"1\">448244.4</td>\n                  <td data-row=\"16\" data-col=\"2\">422321.9</td>\n                </tr>\n                <tr>\n                  <td data-row=\"17\" data-col=\"0\">Log.Lik.</td>\n                  <td data-row=\"17\" data-col=\"1\">-224083.935</td>\n                  <td data-row=\"17\" data-col=\"2\">-211084.453</td>\n                </tr>\n                <tr>\n                  <td data-row=\"18\" data-col=\"0\">F</td>\n                  <td data-row=\"18\" data-col=\"1\">292.976</td>\n                  <td data-row=\"18\" data-col=\"2\">2826.942</td>\n                </tr>\n                <tr>\n                  <td data-row=\"19\" data-col=\"0\">RMSE</td>\n                  <td data-row=\"19\" data-col=\"1\">0.46</td>\n                  <td data-row=\"19\" data-col=\"2\">0.45</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n　また、`align`で各列を左寄せや右寄せに（文字列は左寄せ、数値は右寄せが一般的）、`coef_rename`引数で表示される変数名を変更することもできる。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmodelsummary(list(\"w/o Covariates\" = fit1, \"w/ Covariates\" = fit2),\n             estimate  = \"{estimate} ({std.error})\",\n             statistic = NULL,\n             align = \"lrr\", # 1列は左寄せ、2列は右寄せ、3列は右寄せ\n             coef_rename = c(\"treatmentCivic Duty\" = \"Civic Duty\",\n                             \"treatmentHawthorne\"  = \"Hawthorne\",\n                             \"treatmentSelf\"       = \"Self\",\n                             \"treatmentNeighbors\"  = \"Neighbors\",\n                             \"female\"              = \"Female\",\n                             \"yob\"                 = \"Year of Birth\",\n                             \"hh_size\"             = \"Household Size\",\n                             \"voted2000\"           = \"Voted (2000)\",\n                             \"voted2002\"           = \"Voted (2002)\",\n                             \"voted2004\"           = \"Voted (2004)\"))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script>\n\n      function styleCell_8eyfza9w4ub6mfmhm1ie(i, j, css_id) {\n          var table = document.getElementById(\"tinytable_8eyfza9w4ub6mfmhm1ie\");\n          var cell = table.querySelector(`[data-row=\"${i}\"][data-col=\"${j}\"]`);\n          if (cell) {\n              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);\n              cell.classList.add(css_id);\n          } else {\n              console.warn(`Cell at (${i}, ${j}) not found.`);\n          }\n      }\n      function insertSpanRow(i, colspan, content) {\n        var table = document.getElementById('tinytable_8eyfza9w4ub6mfmhm1ie');\n        // Find the row with data-row attribute matching i\n        var targetRow = table.querySelector(`tr [data-row=\"${i}\"]`).closest('tr');\n        var newRow = table.insertRow(targetRow.rowIndex);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        newCell.setAttribute(\"data-col\", \"0\");\n        newCell.setAttribute(\"data-row\", i - 1);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_8eyfza9w4ub6mfmhm1ie(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_8eyfza9w4ub6mfmhm1ie\");\n        const targetCell = table.querySelector(`[data-row=\"${i}\"][data-col=\"${j}\"]`);\n        if (!targetCell) {\n          console.warn(`Cell at (${i}, ${j}) not found.`);\n        }\n\n        // Get all cells that need to be removed\n        const cellsToRemove = [];\n        for (let r = 0; r < rowspan; r++) {\n          for (let c = 0; c < colspan; c++) {\n            if (r === 0 && c === 0) continue; // Skip the target cell\n            const cell = table.querySelector(`[data-row=\"${i + r}\"][data-col=\"${j + c}\"]`);\n            if (cell) {\n              cellsToRemove.push(cell);\n            }\n          }\n        }\n\n        // Remove all cells\n        cellsToRemove.forEach(cell => cell.remove());\n\n        // Set rowspan and colspan of the target cell if it exists\n        if (targetCell) {\n          targetCell.rowSpan = rowspan;\n          targetCell.colSpan = colspan;\n        }\n      }\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '19', j: 1 }, { i: '19', j: 2 },  ], css_id: 'tinytable_css_y0gaw7fn38k0xckkbts1',}, \n          { positions: [ { i: '11', j: 2 }, { i: '11', j: 1 },  ], css_id: 'tinytable_css_5s0v8shml4ntbbtnafpb',}, \n          { positions: [ { i: '1', j: 1 }, { i: '2', j: 1 }, { i: '4', j: 1 }, { i: '5', j: 1 }, { i: '6', j: 1 }, { i: '3', j: 1 }, { i: '8', j: 1 }, { i: '9', j: 1 }, { i: '10', j: 1 }, { i: '4', j: 2 }, { i: '12', j: 1 }, { i: '13', j: 1 }, { i: '14', j: 1 }, { i: '15', j: 1 }, { i: '16', j: 1 }, { i: '17', j: 1 }, { i: '18', j: 1 }, { i: '12', j: 2 }, { i: '7', j: 1 }, { i: '1', j: 2 }, { i: '2', j: 2 }, { i: '3', j: 2 }, { i: '17', j: 2 }, { i: '5', j: 2 }, { i: '6', j: 2 }, { i: '7', j: 2 }, { i: '8', j: 2 }, { i: '9', j: 2 }, { i: '10', j: 2 }, { i: '15', j: 2 }, { i: '16', j: 2 }, { i: '13', j: 2 }, { i: '14', j: 2 }, { i: '18', j: 2 },  ], css_id: 'tinytable_css_bp557oo69is72op9bz5r',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 },  ], css_id: 'tinytable_css_wrggjpmlabeu8h2dh53e',}, \n          { positions: [ { i: '19', j: 0 },  ], css_id: 'tinytable_css_prru714vtijowxypxffd',}, \n          { positions: [ { i: '11', j: 0 },  ], css_id: 'tinytable_css_gdit869mx4yg3uzy5sv1',}, \n          { positions: [ { i: '1', j: 0 }, { i: '2', j: 0 }, { i: '3', j: 0 }, { i: '4', j: 0 }, { i: '5', j: 0 }, { i: '6', j: 0 }, { i: '7', j: 0 }, { i: '8', j: 0 }, { i: '9', j: 0 }, { i: '10', j: 0 }, { i: '15', j: 0 }, { i: '12', j: 0 }, { i: '13', j: 0 }, { i: '14', j: 0 }, { i: '16', j: 0 }, { i: '17', j: 0 }, { i: '18', j: 0 },  ], css_id: 'tinytable_css_wyw364k6kxz5bfd5ydv5',}, \n          { positions: [ { i: '0', j: 0 },  ], css_id: 'tinytable_css_71m7wp3ltf3t8xb5eoij',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  styleCell_8eyfza9w4ub6mfmhm1ie(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <style>\n      /* tinytable css entries after */\n      .table td.tinytable_css_y0gaw7fn38k0xckkbts1, .table th.tinytable_css_y0gaw7fn38k0xckkbts1 { text-align: right; border-bottom: solid #d3d8dc 0.1em; }\n      .table td.tinytable_css_5s0v8shml4ntbbtnafpb, .table th.tinytable_css_5s0v8shml4ntbbtnafpb { text-align: right; border-bottom: solid black 0.05em; }\n      .table td.tinytable_css_bp557oo69is72op9bz5r, .table th.tinytable_css_bp557oo69is72op9bz5r { text-align: right; }\n      .table td.tinytable_css_wrggjpmlabeu8h2dh53e, .table th.tinytable_css_wrggjpmlabeu8h2dh53e { text-align: right; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }\n      .table td.tinytable_css_prru714vtijowxypxffd, .table th.tinytable_css_prru714vtijowxypxffd { text-align: left; border-bottom: solid #d3d8dc 0.1em; }\n      .table td.tinytable_css_gdit869mx4yg3uzy5sv1, .table th.tinytable_css_gdit869mx4yg3uzy5sv1 { text-align: left; border-bottom: solid black 0.05em; }\n      .table td.tinytable_css_wyw364k6kxz5bfd5ydv5, .table th.tinytable_css_wyw364k6kxz5bfd5ydv5 { text-align: left; }\n      .table td.tinytable_css_71m7wp3ltf3t8xb5eoij, .table th.tinytable_css_71m7wp3ltf3t8xb5eoij { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }\n    </style>\n    <div class=\"container\">\n      <table class=\"table table-borderless\" id=\"tinytable_8eyfza9w4ub6mfmhm1ie\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n        \n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"0\"> </th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">w/o Covariates</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">w/ Covariates</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"0\">(Intercept)</td>\n                  <td data-row=\"1\" data-col=\"1\">0.297 (0.001)</td>\n                  <td data-row=\"1\" data-col=\"2\">5.845 (0.110)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"0\">Civic Duty</td>\n                  <td data-row=\"2\" data-col=\"1\">0.018 (0.003)</td>\n                  <td data-row=\"2\" data-col=\"2\">0.018 (0.003)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"0\">Hawthorne</td>\n                  <td data-row=\"3\" data-col=\"1\">0.026 (0.003)</td>\n                  <td data-row=\"3\" data-col=\"2\">0.025 (0.003)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"4\" data-col=\"0\">Self</td>\n                  <td data-row=\"4\" data-col=\"1\">0.049 (0.003)</td>\n                  <td data-row=\"4\" data-col=\"2\">0.048 (0.003)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"5\" data-col=\"0\">Neighbors</td>\n                  <td data-row=\"5\" data-col=\"1\">0.081 (0.003)</td>\n                  <td data-row=\"5\" data-col=\"2\">0.081 (0.003)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"6\" data-col=\"0\">Female</td>\n                  <td data-row=\"6\" data-col=\"1\"></td>\n                  <td data-row=\"6\" data-col=\"2\">-0.006 (0.002)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"7\" data-col=\"0\">Year of Birth</td>\n                  <td data-row=\"7\" data-col=\"1\"></td>\n                  <td data-row=\"7\" data-col=\"2\">-0.003 (0.000)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"8\" data-col=\"0\">Household Size</td>\n                  <td data-row=\"8\" data-col=\"1\"></td>\n                  <td data-row=\"8\" data-col=\"2\">0.005 (0.001)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"9\" data-col=\"0\">Voted (2000)</td>\n                  <td data-row=\"9\" data-col=\"1\"></td>\n                  <td data-row=\"9\" data-col=\"2\">0.094 (0.002)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"10\" data-col=\"0\">Voted (2002)</td>\n                  <td data-row=\"10\" data-col=\"1\"></td>\n                  <td data-row=\"10\" data-col=\"2\">0.141 (0.002)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"11\" data-col=\"0\">Voted (2004)</td>\n                  <td data-row=\"11\" data-col=\"1\"></td>\n                  <td data-row=\"11\" data-col=\"2\">0.158 (0.002)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"12\" data-col=\"0\">Num.Obs.</td>\n                  <td data-row=\"12\" data-col=\"1\">344084</td>\n                  <td data-row=\"12\" data-col=\"2\">344084</td>\n                </tr>\n                <tr>\n                  <td data-row=\"13\" data-col=\"0\">R2</td>\n                  <td data-row=\"13\" data-col=\"1\">0.003</td>\n                  <td data-row=\"13\" data-col=\"2\">0.076</td>\n                </tr>\n                <tr>\n                  <td data-row=\"14\" data-col=\"0\">R2 Adj.</td>\n                  <td data-row=\"14\" data-col=\"1\">0.003</td>\n                  <td data-row=\"14\" data-col=\"2\">0.076</td>\n                </tr>\n                <tr>\n                  <td data-row=\"15\" data-col=\"0\">AIC</td>\n                  <td data-row=\"15\" data-col=\"1\">448179.9</td>\n                  <td data-row=\"15\" data-col=\"2\">422192.9</td>\n                </tr>\n                <tr>\n                  <td data-row=\"16\" data-col=\"0\">BIC</td>\n                  <td data-row=\"16\" data-col=\"1\">448244.4</td>\n                  <td data-row=\"16\" data-col=\"2\">422321.9</td>\n                </tr>\n                <tr>\n                  <td data-row=\"17\" data-col=\"0\">Log.Lik.</td>\n                  <td data-row=\"17\" data-col=\"1\">-224083.935</td>\n                  <td data-row=\"17\" data-col=\"2\">-211084.453</td>\n                </tr>\n                <tr>\n                  <td data-row=\"18\" data-col=\"0\">F</td>\n                  <td data-row=\"18\" data-col=\"1\">292.976</td>\n                  <td data-row=\"18\" data-col=\"2\">2826.942</td>\n                </tr>\n                <tr>\n                  <td data-row=\"19\" data-col=\"0\">RMSE</td>\n                  <td data-row=\"19\" data-col=\"1\">0.46</td>\n                  <td data-row=\"19\" data-col=\"2\">0.45</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n　処置効果に注目すると、共変量の有無が推定結果に影響をほぼ与えないことが分かる。これは無作為割当に成功したことを意味する。\n\n## 番外編\n\n### 複数モデルの出力\n\n　`modelsummary()`を使えば、複数のモデルの推定結果を一つの表としてまとめられる。しかし、図の場合はどうだろう。共変量なしモデルとありモデルを @fig-intro-pointrange-5 のように一つにまとめることはできるだろうか。もちろん出来る。\n\n　まず、重回帰分析を行った結果（`fit2`）から処置効果の推定値情報を抽出し、`fit1_coef`と同じ構造のデータとしてまとめる。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit2_coef <- tidy(fit2, conf.int = TRUE, conf.level = 0.9875)\n\nfit2_coef <- fit2_coef |>\n  slice(2:5) |>\n  mutate(term = recode(term,\n                       \"treatmentCivic Duty\" = \"Civic Duty\",\n                       \"treatmentHawthorne\"  = \"Hawthorne\",\n                       \"treatmentSelf\"       = \"Self\",\n                       \"treatmentNeighbors\"  = \"Neighbors\"),\n         term = fct_inorder(term))\n\nfit2_coef\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 7\n  term       estimate std.error statistic   p.value conf.low conf.high\n  <fct>         <dbl>     <dbl>     <dbl>     <dbl>    <dbl>     <dbl>\n1 Civic Duty   0.0184   0.00250      7.34 2.10e- 13   0.0121    0.0246\n2 Hawthorne    0.0251   0.00250     10.0  1.45e- 23   0.0188    0.0313\n3 Self         0.0480   0.00250     19.2  9.27e- 82   0.0417    0.0542\n4 Neighbors    0.0806   0.00250     32.2  3.92e-227   0.0744    0.0869\n```\n\n\n:::\n:::\n\n\n　処置効果の推定値や標準誤差などが異なるが、構造としては同じである。続いて、`bind_rows()`を用い、この2つのデータを一つの表として結合する。2つの表は`list()`関数でまとめるが、それぞれ`\"モデル名\" = データ名`と指定する。最後に、`.id = \"Model\"`を追加する。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nbind_rows(list(\"Model 1\" = fit1_coef, \n               \"Model 2\" = fit2_coef),\n          .id = \"Model\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 8 × 8\n  Model   term       estimate std.error statistic   p.value conf.low conf.high\n  <chr>   <fct>         <dbl>     <dbl>     <dbl>     <dbl>    <dbl>     <dbl>\n1 Model 1 Civic Duty   0.0179   0.00260      6.88 5.85e- 12   0.0114    0.0244\n2 Model 1 Hawthorne    0.0257   0.00260      9.90 4.37e- 23   0.0192    0.0322\n3 Model 1 Self         0.0485   0.00260     18.7  1.22e- 77   0.0420    0.0550\n4 Model 1 Neighbors    0.0813   0.00260     31.3  2.94e-214   0.0748    0.0878\n5 Model 2 Civic Duty   0.0184   0.00250      7.34 2.10e- 13   0.0121    0.0246\n6 Model 2 Hawthorne    0.0251   0.00250     10.0  1.45e- 23   0.0188    0.0313\n7 Model 2 Self         0.0480   0.00250     19.2  9.27e- 82   0.0417    0.0542\n8 Model 2 Neighbors    0.0806   0.00250     32.2  3.92e-227   0.0744    0.0869\n```\n\n\n:::\n:::\n\n\n　2つの表が1つとなり、`Model`という列が追加される（これは`.id`で指定した名前）。そして、`fit1_coef`だった行は`\"Model 1\"`、`fit2_coef`だった行は`\"Model 2\"`が付く。ただし、これだけだと表が結合されて出力される**だけ**なので、`fit_coef`という名のオブジェクトとして作業環境内に格納しておく。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit_coef <- bind_rows(list(\"Model 1\" = fit1_coef, \n                           \"Model 2\" = fit2_coef),\n                      .id = \"Model\")\n```\n:::\n\n\n　それでは`fit_coef`を使って、作図をしてみよう。コードは @fig-intro-pointrange-5 と同じであるが、`facet_wrap()`レイヤーを追加する。これはグラフのファセット（facet）分割を意味し、ファセットとは「面」を意味する。`()`内には`~分割の基準となる変数名`を入れる。2つのモデルがあり、`fit_coef`だと`Model`列がどのモデルの推定値かを示している。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit_coef |>\n  ggplot() +\n  geom_hline(yintercept = 0) +\n  geom_pointrange(aes(x = term, y = estimate,\n                      ymin = conf.low, ymax = conf.high)) +\n  labs(x = \"Treatments\", y = \"Average Treatment Effects\") +\n  facet_wrap(~ Model) +\n  theme_bw(base_size = 12)\n```\n\n::: {.cell-output-display}\n![Model 1とModel 2の比較（ファセット分割）](intro_rct_files/figure-html/fig-intro-pointrange-6-1.png){#fig-intro-pointrange-6 fig-align='center' width=1050}\n:::\n:::\n\n\n　今回の結果だとモデル1もモデル2も推定値がほぼ同じである。ファセット分割の場合、小さい差の比較が難しいというデメリットがある。この場合、ファセット分割をせず、一つのファセットにpoint-rangeの色分けした方が読みやすくなる。point-rangeを`Model`の値に応じて色分けする場合、`aes()`内に`color = Model`を追加する。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit_coef |>\n  ggplot() +\n  geom_hline(yintercept = 0) +\n  geom_pointrange(aes(x = term, y = estimate,\n                      ymin = conf.low, ymax = conf.high,\n                      color = Model)) +\n  labs(x = \"Treatments\", y = \"Average Treatment Effects\") +\n  theme_bw(base_size = 12)\n```\n\n::: {.cell-output-display}\n![Model 1とModel 2の比較（色分け）](intro_rct_files/figure-html/fig-intro-pointrange-7-1.png){#fig-intro-pointrange-7 fig-align='center' width=1050}\n:::\n:::\n\n\n　何かおかしい。point-rangeの横軸上の位置が同じということから重なってしまい、モデル1のpoint-rangeがよく見えない。これをずらすために`aes()`の**外**側に`position = position_dodge2(1/2)`を追加する。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit_coef |>\n  ggplot() +\n  geom_hline(yintercept = 0) +\n  geom_pointrange(aes(x = term, y = estimate,\n                      ymin = conf.low, ymax = conf.high,\n                      color = Model),\n                  position = position_dodge2(1/2)) +\n  labs(x = \"Treatments\", y = \"Average Treatment Effects\") +\n  theme_bw(base_size = 12)\n```\n\n::: {.cell-output-display}\n![Pointrangeの位置調整](intro_rct_files/figure-html/fig-intro-pointrange-8-1.png){#fig-intro-pointrange-8 fig-align='center' width=1050}\n:::\n:::\n\n\n　これで図は完成だが、少し修正してみよう。{ggplot2}の場合、凡例は右側に表示されるが、これを下側へ移動させるためには`theme()`レイヤーを追加し、`legend.position = \"bottom\"`を指定する。また、モデル1とモデル2が具体的に何を意味するのかを明確に示したい。これは`fit_coef`の`Model`列を修正しても良いが、今回は`scale_color_discrete()`レイヤーで修正する例を紹介する。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit_coef |>\n  ggplot() +\n  geom_hline(yintercept = 0) +\n  geom_pointrange(aes(x = term, y = estimate,\n                      ymin = conf.low, ymax = conf.high,\n                      color = Model),\n                  position = position_dodge2(1/2)) +\n  labs(x = \"Treatments\", y = \"Average Treatment Effects\") +\n  scale_color_discrete(labels = c(\"Model 1\" = \"w/o Covariates\",\n                                  \"Model 2\" = \"w/ Covariates\")) +\n  theme_bw(base_size = 12) +\n  theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![凡例の位置調整](intro_rct_files/figure-html/fig-intro-pointrange-9-1.png){#fig-intro-pointrange-9 fig-align='center' width=1050}\n:::\n:::\n\n\n### 交互作用\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit3 <- lm(voted2006 ~ treatment * hh_size + female + yob + hh_size +\n             voted2000 + voted2002 + voted2004, data = df)\n\nmodelsummary(list(\"w/o Interaction\" = fit2, \"w/ Interaction\" = fit3),\n             estimate  = \"{estimate} ({std.error})\",\n             statistic = NULL)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script>\n\n      function styleCell_qdlw3puavb05dx5066z2(i, j, css_id) {\n          var table = document.getElementById(\"tinytable_qdlw3puavb05dx5066z2\");\n          var cell = table.querySelector(`[data-row=\"${i}\"][data-col=\"${j}\"]`);\n          if (cell) {\n              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);\n              cell.classList.add(css_id);\n          } else {\n              console.warn(`Cell at (${i}, ${j}) not found.`);\n          }\n      }\n      function insertSpanRow(i, colspan, content) {\n        var table = document.getElementById('tinytable_qdlw3puavb05dx5066z2');\n        // Find the row with data-row attribute matching i\n        var targetRow = table.querySelector(`tr [data-row=\"${i}\"]`).closest('tr');\n        var newRow = table.insertRow(targetRow.rowIndex);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        newCell.setAttribute(\"data-col\", \"0\");\n        newCell.setAttribute(\"data-row\", i - 1);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_qdlw3puavb05dx5066z2(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_qdlw3puavb05dx5066z2\");\n        const targetCell = table.querySelector(`[data-row=\"${i}\"][data-col=\"${j}\"]`);\n        if (!targetCell) {\n          console.warn(`Cell at (${i}, ${j}) not found.`);\n        }\n\n        // Get all cells that need to be removed\n        const cellsToRemove = [];\n        for (let r = 0; r < rowspan; r++) {\n          for (let c = 0; c < colspan; c++) {\n            if (r === 0 && c === 0) continue; // Skip the target cell\n            const cell = table.querySelector(`[data-row=\"${i + r}\"][data-col=\"${j + c}\"]`);\n            if (cell) {\n              cellsToRemove.push(cell);\n            }\n          }\n        }\n\n        // Remove all cells\n        cellsToRemove.forEach(cell => cell.remove());\n\n        // Set rowspan and colspan of the target cell if it exists\n        if (targetCell) {\n          targetCell.rowSpan = rowspan;\n          targetCell.colSpan = colspan;\n        }\n      }\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '23', j: 1 }, { i: '23', j: 2 },  ], css_id: 'tinytable_css_cegr6rtqk83bt5s25di8',}, \n          { positions: [ { i: '15', j: 2 }, { i: '15', j: 1 },  ], css_id: 'tinytable_css_xrawnw3hkwwraal1aeg3',}, \n          { positions: [ { i: '1', j: 1 }, { i: '2', j: 1 }, { i: '4', j: 1 }, { i: '5', j: 1 }, { i: '6', j: 1 }, { i: '3', j: 1 }, { i: '8', j: 1 }, { i: '9', j: 1 }, { i: '10', j: 1 }, { i: '7', j: 1 }, { i: '12', j: 1 }, { i: '13', j: 1 }, { i: '14', j: 1 }, { i: '4', j: 2 }, { i: '16', j: 1 }, { i: '17', j: 1 }, { i: '18', j: 1 }, { i: '19', j: 1 }, { i: '20', j: 1 }, { i: '21', j: 1 }, { i: '22', j: 1 }, { i: '12', j: 2 }, { i: '11', j: 1 }, { i: '1', j: 2 }, { i: '2', j: 2 }, { i: '3', j: 2 }, { i: '17', j: 2 }, { i: '5', j: 2 }, { i: '6', j: 2 }, { i: '7', j: 2 }, { i: '8', j: 2 }, { i: '9', j: 2 }, { i: '10', j: 2 }, { i: '11', j: 2 }, { i: '16', j: 2 }, { i: '13', j: 2 }, { i: '14', j: 2 }, { i: '19', j: 2 }, { i: '20', j: 2 }, { i: '21', j: 2 }, { i: '18', j: 2 }, { i: '22', j: 2 },  ], css_id: 'tinytable_css_0iv0lmrrim1mbw8j75ql',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 },  ], css_id: 'tinytable_css_7piv6c96covamcacjpal',}, \n          { positions: [ { i: '23', j: 0 },  ], css_id: 'tinytable_css_dqszgxb1d2hjy6ihs780',}, \n          { positions: [ { i: '15', j: 0 },  ], css_id: 'tinytable_css_1prmvy1dvb4g8rkpmj6x',}, \n          { positions: [ { i: '1', j: 0 }, { i: '2', j: 0 }, { i: '3', j: 0 }, { i: '4', j: 0 }, { i: '5', j: 0 }, { i: '6', j: 0 }, { i: '7', j: 0 }, { i: '8', j: 0 }, { i: '9', j: 0 }, { i: '10', j: 0 }, { i: '11', j: 0 }, { i: '12', j: 0 }, { i: '13', j: 0 }, { i: '14', j: 0 }, { i: '19', j: 0 }, { i: '16', j: 0 }, { i: '17', j: 0 }, { i: '18', j: 0 }, { i: '20', j: 0 }, { i: '21', j: 0 }, { i: '22', j: 0 },  ], css_id: 'tinytable_css_304cuxen720wfc4zpnf8',}, \n          { positions: [ { i: '0', j: 0 },  ], css_id: 'tinytable_css_ett3crasieixloj8mtq7',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  styleCell_qdlw3puavb05dx5066z2(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <style>\n      /* tinytable css entries after */\n      .table td.tinytable_css_cegr6rtqk83bt5s25di8, .table th.tinytable_css_cegr6rtqk83bt5s25di8 { text-align: center; border-bottom: solid #d3d8dc 0.1em; }\n      .table td.tinytable_css_xrawnw3hkwwraal1aeg3, .table th.tinytable_css_xrawnw3hkwwraal1aeg3 { text-align: center; border-bottom: solid black 0.05em; }\n      .table td.tinytable_css_0iv0lmrrim1mbw8j75ql, .table th.tinytable_css_0iv0lmrrim1mbw8j75ql { text-align: center; }\n      .table td.tinytable_css_7piv6c96covamcacjpal, .table th.tinytable_css_7piv6c96covamcacjpal { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }\n      .table td.tinytable_css_dqszgxb1d2hjy6ihs780, .table th.tinytable_css_dqszgxb1d2hjy6ihs780 { text-align: left; border-bottom: solid #d3d8dc 0.1em; }\n      .table td.tinytable_css_1prmvy1dvb4g8rkpmj6x, .table th.tinytable_css_1prmvy1dvb4g8rkpmj6x { text-align: left; border-bottom: solid black 0.05em; }\n      .table td.tinytable_css_304cuxen720wfc4zpnf8, .table th.tinytable_css_304cuxen720wfc4zpnf8 { text-align: left; }\n      .table td.tinytable_css_ett3crasieixloj8mtq7, .table th.tinytable_css_ett3crasieixloj8mtq7 { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }\n    </style>\n    <div class=\"container\">\n      <table class=\"table table-borderless\" id=\"tinytable_qdlw3puavb05dx5066z2\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n        \n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"0\"> </th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">w/o Interaction</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">w/ Interaction</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"0\">(Intercept)</td>\n                  <td data-row=\"1\" data-col=\"1\">5.845 (0.110)</td>\n                  <td data-row=\"1\" data-col=\"2\">5.836 (0.110)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"0\">treatmentCivic Duty</td>\n                  <td data-row=\"2\" data-col=\"1\">0.018 (0.003)</td>\n                  <td data-row=\"2\" data-col=\"2\">0.044 (0.007)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"0\">treatmentHawthorne</td>\n                  <td data-row=\"3\" data-col=\"1\">0.025 (0.003)</td>\n                  <td data-row=\"3\" data-col=\"2\">0.034 (0.007)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"4\" data-col=\"0\">treatmentSelf</td>\n                  <td data-row=\"4\" data-col=\"1\">0.048 (0.003)</td>\n                  <td data-row=\"4\" data-col=\"2\">0.076 (0.007)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"5\" data-col=\"0\">treatmentNeighbors</td>\n                  <td data-row=\"5\" data-col=\"1\">0.081 (0.003)</td>\n                  <td data-row=\"5\" data-col=\"2\">0.111 (0.007)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"6\" data-col=\"0\">female</td>\n                  <td data-row=\"6\" data-col=\"1\">-0.006 (0.002)</td>\n                  <td data-row=\"6\" data-col=\"2\">-0.006 (0.002)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"7\" data-col=\"0\">yob</td>\n                  <td data-row=\"7\" data-col=\"1\">-0.003 (0.000)</td>\n                  <td data-row=\"7\" data-col=\"2\">-0.003 (0.000)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"8\" data-col=\"0\">hh_size</td>\n                  <td data-row=\"8\" data-col=\"1\">0.005 (0.001)</td>\n                  <td data-row=\"8\" data-col=\"2\">0.010 (0.001)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"9\" data-col=\"0\">voted2000</td>\n                  <td data-row=\"9\" data-col=\"1\">0.094 (0.002)</td>\n                  <td data-row=\"9\" data-col=\"2\">0.094 (0.002)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"10\" data-col=\"0\">voted2002</td>\n                  <td data-row=\"10\" data-col=\"1\">0.141 (0.002)</td>\n                  <td data-row=\"10\" data-col=\"2\">0.141 (0.002)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"11\" data-col=\"0\">voted2004</td>\n                  <td data-row=\"11\" data-col=\"1\">0.158 (0.002)</td>\n                  <td data-row=\"11\" data-col=\"2\">0.158 (0.002)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"12\" data-col=\"0\">treatmentCivic Duty × hh_size</td>\n                  <td data-row=\"12\" data-col=\"1\"></td>\n                  <td data-row=\"12\" data-col=\"2\">-0.012 (0.003)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"13\" data-col=\"0\">treatmentHawthorne × hh_size</td>\n                  <td data-row=\"13\" data-col=\"1\"></td>\n                  <td data-row=\"13\" data-col=\"2\">-0.004 (0.003)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"14\" data-col=\"0\">treatmentSelf × hh_size</td>\n                  <td data-row=\"14\" data-col=\"1\"></td>\n                  <td data-row=\"14\" data-col=\"2\">-0.013 (0.003)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"15\" data-col=\"0\">treatmentNeighbors × hh_size</td>\n                  <td data-row=\"15\" data-col=\"1\"></td>\n                  <td data-row=\"15\" data-col=\"2\">-0.014 (0.003)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"16\" data-col=\"0\">Num.Obs.</td>\n                  <td data-row=\"16\" data-col=\"1\">344084</td>\n                  <td data-row=\"16\" data-col=\"2\">344084</td>\n                </tr>\n                <tr>\n                  <td data-row=\"17\" data-col=\"0\">R2</td>\n                  <td data-row=\"17\" data-col=\"1\">0.076</td>\n                  <td data-row=\"17\" data-col=\"2\">0.076</td>\n                </tr>\n                <tr>\n                  <td data-row=\"18\" data-col=\"0\">R2 Adj.</td>\n                  <td data-row=\"18\" data-col=\"1\">0.076</td>\n                  <td data-row=\"18\" data-col=\"2\">0.076</td>\n                </tr>\n                <tr>\n                  <td data-row=\"19\" data-col=\"0\">AIC</td>\n                  <td data-row=\"19\" data-col=\"1\">422192.9</td>\n                  <td data-row=\"19\" data-col=\"2\">422163.5</td>\n                </tr>\n                <tr>\n                  <td data-row=\"20\" data-col=\"0\">BIC</td>\n                  <td data-row=\"20\" data-col=\"1\">422321.9</td>\n                  <td data-row=\"20\" data-col=\"2\">422335.5</td>\n                </tr>\n                <tr>\n                  <td data-row=\"21\" data-col=\"0\">Log.Lik.</td>\n                  <td data-row=\"21\" data-col=\"1\">-211084.453</td>\n                  <td data-row=\"21\" data-col=\"2\">-211065.750</td>\n                </tr>\n                <tr>\n                  <td data-row=\"22\" data-col=\"0\">F</td>\n                  <td data-row=\"22\" data-col=\"1\">2826.942</td>\n                  <td data-row=\"22\" data-col=\"2\">2022.112</td>\n                </tr>\n                <tr>\n                  <td data-row=\"23\" data-col=\"0\">RMSE</td>\n                  <td data-row=\"23\" data-col=\"1\">0.45</td>\n                  <td data-row=\"23\" data-col=\"2\">0.45</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npacman::p_load(marginaleffects)\n```\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit3_pred <- predictions(fit3,\n                         newdata = datagrid(treatment = c(\"Control\",\n                                                          \"Civic Duty\",\n                                                          \"Hawthorne\",\n                                                          \"Neighbors\",\n                                                          \"Self\"),\n                                            hh_size   = c(1, 4, 8)))\n\nfit3_pred\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n  treatment hh_size Estimate Std. Error    z Pr(>|z|)     S 2.5 % 97.5 %\n Control          1    0.146    0.00232 62.8   <0.001   Inf 0.141  0.150\n Control          4    0.175    0.00285 61.5   <0.001   Inf 0.170  0.181\n Control          8    0.215    0.00787 27.3   <0.001 542.3 0.199  0.230\n Civic Duty       1    0.178    0.00433 41.2   <0.001   Inf 0.170  0.187\n Civic Duty       4    0.173    0.00578 29.8   <0.001 647.9 0.161  0.184\n Civic Duty       8    0.165    0.01684  9.8   <0.001  72.9 0.132  0.198\n Hawthorne        1    0.176    0.00435 40.4   <0.001   Inf 0.167  0.184\n Hawthorne        4    0.193    0.00588 32.9   <0.001 785.2 0.182  0.205\n Hawthorne        8    0.217    0.01714 12.7   <0.001 119.9 0.184  0.251\n Neighbors        1    0.243    0.00431 56.3   <0.001   Inf 0.234  0.251\n Neighbors        4    0.231    0.00577 40.1   <0.001   Inf 0.220  0.242\n Neighbors        8    0.215    0.01678 12.8   <0.001 122.7 0.182  0.248\n Self             1    0.209    0.00438 47.8   <0.001   Inf 0.201  0.218\n Self             4    0.200    0.00592 33.8   <0.001 827.7 0.188  0.212\n Self             8    0.188    0.01728 10.9   <0.001  88.8 0.154  0.221\n\nType: response\n```\n\n\n:::\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit3_pred |> \n  ggplot() +\n  geom_col(aes(x = treatment, y = Estimate)) +\n  facet_wrap(~hh_size)\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in `geom_col()`:\n! Problem while computing aesthetics.\nℹ Error occurred in the 1st layer.\nCaused by error:\n! object 'Estimate' not found\n```\n\n\n:::\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprint(fit3_pred, style = \"data.frame\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   rowid  estimate   std.error statistic       p.value   s.value  conf.low\n1      1 0.1459165 0.002323454 62.801566  0.000000e+00       Inf 0.1413627\n2      2 0.1754264 0.002851464 61.521525  0.000000e+00       Inf 0.1698376\n3      3 0.2147729 0.007870487 27.288382 5.826749e-164 542.25352 0.1993470\n4      4 0.1782236 0.004325704 41.201066  0.000000e+00       Inf 0.1697454\n5      5 0.1725458 0.005780891 29.847619 9.425960e-196 647.86127 0.1612155\n6      6 0.1649754 0.016840204  9.796522  1.165292e-22  72.86173 0.1319692\n7      7 0.1755679 0.004349619 40.363982  0.000000e+00       Inf 0.1670428\n8      8 0.1934422 0.005883334 32.879697 4.288219e-237 785.19658 0.1819111\n9      9 0.2172746 0.017138668 12.677451  7.885487e-37 119.93214 0.1836834\n10    10 0.2429128 0.004311551 56.340003  0.000000e+00       Inf 0.2344623\n11    11 0.2310648 0.005768525 40.056126  0.000000e+00       Inf 0.2197587\n12    12 0.2152674 0.016782230 12.827101  1.156090e-37 122.70209 0.1823748\n13    13 0.2091471 0.004375073 47.804251  0.000000e+00       Inf 0.2005721\n14    14 0.1999174 0.005921035 33.763922 6.679244e-250 827.74234 0.1883123\n15    15 0.1876110 0.017280299 10.856931  1.848586e-27  88.80564 0.1537422\n   conf.high  df female      yob voted2000 voted2002 voted2004  treatment\n1  0.1504704 Inf      0 1956.214         0         0         0    Control\n2  0.1810152 Inf      0 1956.214         0         0         0    Control\n3  0.2301987 Inf      0 1956.214         0         0         0    Control\n4  0.1867018 Inf      0 1956.214         0         0         0 Civic Duty\n5  0.1838762 Inf      0 1956.214         0         0         0 Civic Duty\n6  0.1979816 Inf      0 1956.214         0         0         0 Civic Duty\n7  0.1840930 Inf      0 1956.214         0         0         0  Hawthorne\n8  0.2049734 Inf      0 1956.214         0         0         0  Hawthorne\n9  0.2508658 Inf      0 1956.214         0         0         0  Hawthorne\n10 0.2513633 Inf      0 1956.214         0         0         0  Neighbors\n11 0.2423709 Inf      0 1956.214         0         0         0  Neighbors\n12 0.2481599 Inf      0 1956.214         0         0         0  Neighbors\n13 0.2177221 Inf      0 1956.214         0         0         0       Self\n14 0.2115224 Inf      0 1956.214         0         0         0       Self\n15 0.2214798 Inf      0 1956.214         0         0         0       Self\n   hh_size voted2006\n1        1         0\n2        4         0\n3        8         0\n4        1         0\n5        4         0\n6        8         0\n7        1         0\n8        4         0\n9        8         0\n10       1         0\n11       4         0\n12       8         0\n13       1         0\n14       4         0\n15       8         0\n```\n\n\n:::\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit3_pred |> \n  ggplot() +\n  geom_col(aes(x = treatment, y = estimate)) +\n  facet_wrap(~hh_size)\n```\n\n::: {.cell-output-display}\n![](intro_rct_files/figure-html/unnamed-chunk-58-1.png){fig-align='center' width=1200}\n:::\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit3_pred |> \n  mutate(hh_size = case_when(hh_size == 1 ~ \"Household size = 1\",\n                             hh_size == 4 ~ \"Household size = 4\",\n                             hh_size == 8 ~ \"Household size = 8\"),\n         hh_size = fct_inorder(hh_size)) |> \n  ggplot() +\n  geom_col(aes(x = treatment, y = estimate)) +\n  labs(x = \"Groups\", y = \"Predicted Turnout\") +\n  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +\n  facet_wrap(~hh_size)\n```\n\n::: {.cell-output-display}\n![](intro_rct_files/figure-html/unnamed-chunk-59-1.png){fig-align='center' width=1200}\n:::\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit3_pred |> \n  mutate(hh_size = case_when(hh_size == 1 ~ \"Household size = 1\",\n                             hh_size == 4 ~ \"Household size = 4\",\n                             hh_size == 8 ~ \"Household size = 8\"),\n         hh_size = fct_inorder(hh_size)) |> \n  ggplot() +\n  geom_col(aes(x = treatment, y = estimate)) +\n  geom_text(aes(x = treatment, y = estimate, label = sprintf(\"%.3f\", estimate))) +\n  labs(x = \"Groups\", y = \"Predicted Turnout\") +\n  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +\n  facet_wrap(~hh_size)\n```\n\n::: {.cell-output-display}\n![](intro_rct_files/figure-html/unnamed-chunk-60-1.png){fig-align='center' width=1200}\n:::\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit3_pred |> \n  mutate(hh_size = case_when(hh_size == 1 ~ \"Household size = 1\",\n                             hh_size == 4 ~ \"Household size = 4\",\n                             hh_size == 8 ~ \"Household size = 8\"),\n         hh_size = fct_inorder(hh_size)) |> \n  ggplot() +\n  geom_col(aes(x = treatment, y = estimate)) +\n  geom_text(aes(x = treatment, y = estimate, label = sprintf(\"%.3f\", estimate)),\n            color = \"white\", vjust = 2) +\n  labs(x = \"Groups\", y = \"Predicted Turnout\") +\n  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +\n  facet_wrap(~hh_size)\n```\n\n::: {.cell-output-display}\n![](intro_rct_files/figure-html/unnamed-chunk-61-1.png){fig-align='center' width=1200}\n:::\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit3_ame <- fit3 |> \n  slopes(variables = \"treatment\",\n         newdata = datagrid(hh_size = 1:8))\n\nprint(fit3_ame, style = \"data.frame\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   rowid      term             contrast      estimate   std.error   statistic\n1      1 treatment Civic Duty - Control  0.0323070808 0.004485340  7.20281612\n2      2 treatment Civic Duty - Control  0.0205778631 0.002572273  7.99987543\n3      3 treatment Civic Duty - Control  0.0088486454 0.003568488  2.47966211\n4      4 treatment Civic Duty - Control -0.0028805723 0.006202487 -0.46442217\n5      5 treatment Civic Duty - Control -0.0146097900 0.009155697 -1.59570485\n6      6 treatment Civic Duty - Control -0.0263390077 0.012198440 -2.15921112\n7      7 treatment Civic Duty - Control -0.0380682254 0.015277314 -2.49181409\n8      8 treatment Civic Duty - Control -0.0497974431 0.018374163 -2.71018834\n9      1 treatment  Hawthorne - Control  0.0296514006 0.004508577  6.57666514\n10     2 treatment  Hawthorne - Control  0.0257728789 0.002569135 10.03173439\n11     3 treatment  Hawthorne - Control  0.0218943571 0.003610946  6.06333052\n12     4 treatment  Hawthorne - Control  0.0180158353 0.006296244  2.86136215\n13     5 treatment  Hawthorne - Control  0.0141373135 0.009295792  1.52082938\n14     6 treatment  Hawthorne - Control  0.0102587917 0.012383299  0.82843770\n15     7 treatment  Hawthorne - Control  0.0063802699 0.015506312  0.41146277\n16     8 treatment  Hawthorne - Control  0.0025017481 0.018647000  0.13416358\n17     1 treatment  Neighbors - Control  0.0969962701 0.004473502 21.68240168\n18     2 treatment  Neighbors - Control  0.0832103023 0.002571525 32.35834603\n19     3 treatment  Neighbors - Control  0.0694243344 0.003565984 19.46849168\n20     4 treatment  Neighbors - Control  0.0556383666 0.006190536  8.98764986\n21     5 treatment  Neighbors - Control  0.0418523987 0.009134122  4.58198361\n22     6 treatment  Neighbors - Control  0.0280664309 0.012167360  2.30669851\n23     7 treatment  Neighbors - Control  0.0142804630 0.015236800  0.93723505\n24     8 treatment  Neighbors - Control  0.0004944951 0.018324260  0.02698582\n25     1 treatment       Self - Control  0.0632305717 0.004532556 13.95031202\n26     2 treatment       Self - Control  0.0503173668 0.002570076 19.57815989\n27     3 treatment       Self - Control  0.0374041619 0.003623024 10.32401664\n28     4 treatment       Self - Control  0.0244909571 0.006333017  3.86718662\n29     5 treatment       Self - Control  0.0115777522 0.009356692  1.23737664\n30     6 treatment       Self - Control -0.0013354527 0.012467881 -0.10711145\n31     7 treatment       Self - Control -0.0142486576 0.015614359 -0.91253556\n32     8 treatment       Self - Control -0.0271618625 0.018778395 -1.44644215\n         p.value      s.value     conf.low    conf.high predicted_lo\n1   5.898149e-13  40.62480292  0.023515975  0.041098186    0.1459165\n2   1.245451e-15  49.51225261  0.015536301  0.025619425    0.1557532\n3   1.315069e-02   6.24871731  0.001854537  0.015842754    0.1655898\n4   6.423453e-01   0.63857903 -0.015037223  0.009276078    0.1754264\n5   1.105547e-01   3.17716767 -0.032554626  0.003335046    0.1852630\n6   3.083379e-02   5.01934386 -0.050247511 -0.002430504    0.1950996\n7   1.270925e-02   6.29797681 -0.068011210 -0.008125241    0.2049363\n8   6.724501e-03   7.21635703 -0.085810141 -0.013784745    0.2147729\n9   4.811166e-11  34.27482244  0.020814752  0.038488049    0.1459165\n10  1.105573e-23  76.25955221  0.020737467  0.030808291    0.1557532\n11  1.333313e-09  29.48233766  0.014817034  0.028971681    0.1655898\n12  4.218249e-03   7.88914003  0.005675423  0.030356247    0.1754264\n13  1.283027e-01   2.96237701 -0.004082104  0.032356731    0.1852630\n14  4.074227e-01   1.29540186 -0.014012028  0.034529612    0.1950996\n15  6.807332e-01   0.55483854 -0.024011543  0.036772082    0.2049363\n16  8.932732e-01   0.16282657 -0.034045699  0.039049196    0.2147729\n17 3.007683e-104 343.89186917  0.088228367  0.105764173    0.1459165\n18 1.058753e-229 760.63916829  0.078170205  0.088250399    0.1557532\n19  2.031661e-84 278.01930021  0.062435134  0.076413535    0.1655898\n20  2.525732e-19  61.77993215  0.043505140  0.067771593    0.1754264\n21  4.605860e-06  17.72809798  0.023949848  0.059754949    0.1852630\n22  2.107163e-02   5.56855404  0.004218844  0.051914018    0.1950996\n23  3.486377e-01   1.52019965 -0.015583116  0.044144042    0.2049363\n24  9.784710e-01   0.03139893 -0.035420394  0.036409385    0.2147729\n25  3.132320e-44 144.51760437  0.054346925  0.072114218    0.1459165\n26  2.374442e-85 281.11629947  0.045280110  0.055354624    0.1557532\n27  5.487823e-25  80.59196838  0.030303165  0.044505159    0.1655898\n28  1.100982e-04  13.14892185  0.012078473  0.036903441    0.1754264\n29  2.159473e-01   2.21124890 -0.006761027  0.029916532    0.1852630\n30  9.147006e-01   0.12862855 -0.025772050  0.023101145    0.1950996\n31  3.614869e-01   1.46798490 -0.044852238  0.016354923    0.2049363\n32  1.480532e-01   2.75581216 -0.063966841  0.009643116    0.2147729\n   predicted_hi predicted treatment female      yob voted2000 voted2002\n1     0.1782236 0.1459165   Control      0 1956.214         0         0\n2     0.1763310 0.1557532   Control      0 1956.214         0         0\n3     0.1744384 0.1655898   Control      0 1956.214         0         0\n4     0.1725458 0.1754264   Control      0 1956.214         0         0\n5     0.1706532 0.1852630   Control      0 1956.214         0         0\n6     0.1687606 0.1950996   Control      0 1956.214         0         0\n7     0.1668680 0.2049363   Control      0 1956.214         0         0\n8     0.1649754 0.2147729   Control      0 1956.214         0         0\n9     0.1755679 0.1459165   Control      0 1956.214         0         0\n10    0.1815260 0.1557532   Control      0 1956.214         0         0\n11    0.1874841 0.1655898   Control      0 1956.214         0         0\n12    0.1934422 0.1754264   Control      0 1956.214         0         0\n13    0.1994003 0.1852630   Control      0 1956.214         0         0\n14    0.2053584 0.1950996   Control      0 1956.214         0         0\n15    0.2113165 0.2049363   Control      0 1956.214         0         0\n16    0.2172746 0.2147729   Control      0 1956.214         0         0\n17    0.2429128 0.1459165   Control      0 1956.214         0         0\n18    0.2389635 0.1557532   Control      0 1956.214         0         0\n19    0.2350141 0.1655898   Control      0 1956.214         0         0\n20    0.2310648 0.1754264   Control      0 1956.214         0         0\n21    0.2271154 0.1852630   Control      0 1956.214         0         0\n22    0.2231661 0.1950996   Control      0 1956.214         0         0\n23    0.2192167 0.2049363   Control      0 1956.214         0         0\n24    0.2152674 0.2147729   Control      0 1956.214         0         0\n25    0.2091471 0.1459165   Control      0 1956.214         0         0\n26    0.2060705 0.1557532   Control      0 1956.214         0         0\n27    0.2029939 0.1655898   Control      0 1956.214         0         0\n28    0.1999174 0.1754264   Control      0 1956.214         0         0\n29    0.1968408 0.1852630   Control      0 1956.214         0         0\n30    0.1937642 0.1950996   Control      0 1956.214         0         0\n31    0.1906876 0.2049363   Control      0 1956.214         0         0\n32    0.1876110 0.2147729   Control      0 1956.214         0         0\n   voted2004 hh_size voted2006\n1          0       1         0\n2          0       2         0\n3          0       3         0\n4          0       4         0\n5          0       5         0\n6          0       6         0\n7          0       7         0\n8          0       8         0\n9          0       1         0\n10         0       2         0\n11         0       3         0\n12         0       4         0\n13         0       5         0\n14         0       6         0\n15         0       7         0\n16         0       8         0\n17         0       1         0\n18         0       2         0\n19         0       3         0\n20         0       4         0\n21         0       5         0\n22         0       6         0\n23         0       7         0\n24         0       8         0\n25         0       1         0\n26         0       2         0\n27         0       3         0\n28         0       4         0\n29         0       5         0\n30         0       6         0\n31         0       7         0\n32         0       8         0\n```\n\n\n:::\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit3_ame |> \n  ggplot() +\n  geom_hline(yintercept = 0) +\n  geom_pointrange(aes(x = hh_size, y = estimate, ymin = conf.low, ymax = conf.high)) +\n  labs(x = \"Household Size\", y = \"Average Marginal Effects\") +\n  facet_wrap(~contrast)\n```\n\n::: {.cell-output-display}\n![](intro_rct_files/figure-html/unnamed-chunk-63-1.png){fig-align='center' width=1050}\n:::\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit3_ame |> \n  mutate(contrast = str_remove(contrast, \" - Control\")) |> \n  ggplot() +\n  geom_hline(yintercept = 0) +\n  geom_pointrange(aes(x = hh_size, y = estimate, ymin = conf.low, ymax = conf.high)) +\n  labs(x = \"Household Size\", y = \"Average Marginal Effects\") +\n  facet_wrap(~contrast)\n```\n\n::: {.cell-output-display}\n![](intro_rct_files/figure-html/unnamed-chunk-64-1.png){fig-align='center' width=1050}\n:::\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit3_ame |> \n  mutate(contrast = str_remove(contrast, \" - Control\"),\n         sig      = if_else(p.value < 0.05, \"sig\", \"insig\")) |> \n  ggplot() +\n  geom_hline(yintercept = 0) +\n  geom_pointrange(aes(x = hh_size, y = estimate, ymin = conf.low, ymax = conf.high,\n                      color = sig)) +\n  labs(x = \"Household Size\", y = \"Average Marginal Effects\") +\n  facet_wrap(~contrast)\n```\n\n::: {.cell-output-display}\n![](intro_rct_files/figure-html/unnamed-chunk-65-1.png){fig-align='center' width=1050}\n:::\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfit3_ame |> \n  mutate(contrast = str_remove(contrast, \" - Control\"),\n         sig      = if_else(p.value < 0.05, \"sig\", \"insig\")) |> \n  ggplot() +\n  geom_hline(yintercept = 0) +\n  geom_pointrange(aes(x = hh_size, y = estimate, ymin = conf.low, ymax = conf.high,\n                      color = sig)) +\n  labs(x = \"Household Size\", y = \"Average Marginal Effects\") +\n  scale_color_manual(values = c(\"sig\" = \"black\", \"insig\" = \"gray80\")) +\n  facet_wrap(~contrast) +\n  theme_bw() +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](intro_rct_files/figure-html/unnamed-chunk-66-1.png){fig-align='center' width=1050}\n:::\n:::\n",
    "supporting": [
      "intro_rct_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}