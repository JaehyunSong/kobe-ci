{
  "hash": "d0ae8f4217259b893681a7dad0675838",
  "result": {
    "engine": "knitr",
    "markdown": "---\nsubtitle: \"差分の差分法\"\ndate: \"2025/08/19\"\nformat: revealjs\nmetadata-files: \n  - _slide.yml\n---\n\n# 自然実験\n\n\n\n## マッチングの限界\n\n**条件付き独立の仮定** (Conditional Independent Assumption; CIA)\n\n* 処置変数（$T$）と応答変数（$Y$）の間に存在する交絡要因（$W$）が全て観察されている場合\n   * ${Y_i (T_i = 1), Y_i (T_i = 0) \\perp T_i | W_i}$\n   * $\\rightarrow$ 交絡変数を共変量として統制する場合、観察データからも因果効果の推定が可能 \n* しかし、**全て**の交絡要因がデータに含まれる場合もほぼゼロ\n   * $\\rightarrow$ **仮定としては強すぎる**ため、（回帰分析を含む）マッチングによる**厳密**な因果推論は困難\n   * ただし、単純に処置変数と応答変数の単回帰分析よりは望ましい。\n* より緩い仮定の下で可能な因果推論の手法 \n   * $\\rightarrow$ **自然実験**（Natural Experiment）\n\n## 自然実験とは\n\nRCTの3つの特徴（Freedman, Pisani, and Purves 2007）\n\n1. The response of experimental subjects assigned to receive a treatment is\ncompared to the response of subjects assigned to a control group.\n2. The assignment of subjects to treatment and control groups is done at random, through a randomizing device such as a coin flip.\n3. The manipulation of the treatment—also known as the intervention—is under the control of an experimental researcher.\n\n<br/>\n\n自然実験は（Dunning 2012）\n\n1. 同じ\n2. 処置の有無は無作為の**ように**決まる（as-if random）。\n3. 処置内容などを研究者が操作することは不可能\n   * 2と3は自然、制度などによって影響を受ける。\n\n## 自然実験の例\n\n処置を受けるか否かが**自然、制度、偶然など**によって規定される\n\n* 多数代表制と比例代表制\n   * 人口3500未満なら多数代表制、以上なら比例代表制を採用（フランス地方選挙）\n* 軍の経験と所得\n   * ベトナム戦争時、徴兵対象がくじによって決まる（アメリカ）\n* 最低賃金の効果\n   * 隣接するペンシルベニア州とニュージャージー州の最低賃金の格差\n* 現職効果\n   * 惜敗・辛勝の場合、候補者間の**質**には大差ないはず\n* 選挙区定数の効果\n   * 人口によって選挙区定数が決まる\n* その他\n\n## 自然実験の方法\n\n本講義では1と2を解説\n\n1. **差分の差分法**（Difference-in-Difference; Diff-in-Diff/DID/DD）\n2. **回帰不連続デザイン** (Regression Discontinuity Design; RDD)\n   * 中断時系列デザイン（Interrupted Time-series Design; ITS）\n      * RDDの時系列版であるが、自己相関などの対処が必要であるため本講義では省略\n3. **操作変数**（Instrumental Variable; IV）\n4. **集積分析**（Bunching Analysis）など\n\n# 差分の差分法の考え方\n\n## 保育所の整備と母の就労率（1）\n\n横軸: $\\frac{\\mbox{認可保育所定員}}{\\mbox{5歳以下子供数}}$; 縦軸: 女性の就労率（元ネタ: [Asai, Kambayashi, and Yamaguchi (2015)](https://www.sciencedirect.com/science/article/pii/S088915831500043X) / データは宋が収集）\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](did_files/figure-revealjs/unnamed-chunk-2-1.png){fig-align='center' width=2400}\n:::\n:::\n\n\n## 保育所の整備と母の就労率（2）\n\n保育所が整備されると母は安心して働けるから就労率が上がる\n\n::::{.columns}\n:::{.column width=50%}\n* ロジックとして問題はなさそう\n* 内生性は?\n   * (たとえば、)「**県民性**」の存在\n   * 母親の就業意識が高く、地域社会もこの意識に好意的なら ...\n      * $\\rightarrow$ 就労率が上がる\n      * $\\rightarrow$ 政治・行政も支持拡大のために保育所整備に力を入れる\n:::\n\n:::{.column width=50%}\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](did_files/figure-revealjs/unnamed-chunk-3-1.png){fig-align='center' width=1200}\n:::\n:::\n\n:::\n::::\n\n## 差分の差分法\n\n**Difference in Difference** (Diff-in-Diff, DID, DD)\n\n* 同一対象に対して複数の観測が前提\n   * 保育所の整備と母の就労率を47都道府県に対して4回 (2000, 2005, 2010, 2015年) 観察\n   * 「**パネルデータ**」\n* 個々の有権者を対象にした場合、パネルデータの収集は高費用\n   * 日本の政治学だとJESが代表的\n* 国、自治体、選挙区、団体は集計データが整備され、公表されているため利用しやすい\n\n## タバコの値段と消費量\n\n元ネタはカルフォルニア州のProposition99\n\n* $t+1$期において、A州のみタバコの値上げ\n* $t$期におけるA州のタバコ消費量（箱/人）：15\n* $t+1$期におけるA州のタバコ消費量（箱/人）：10\n   * $\\rightarrow$ 値上げ後、タバコの消費量が5箱$\\downarrow$\n\n<br/><br/>\n\n* 実際の分析例は\n   * Breslow, M Johnson. 1993. \"[California’s Proposition 99 on Tobacco, and its Impact](https://www.annualreviews.org/doi/10.1146/annurev.pu.14.050193.003101),\" *Annual Review of Public Health,* 14: 585–604.\n   * 他にも Proposition 99 の因果効果に関する研究多数\n* 以下は100%架空データ\n\n## タバコの値段と消費量\n\nタバコ消費量の変化\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](did_files/figure-revealjs/unnamed-chunk-4-1.png){fig-align='center' width=2400}\n:::\n:::\n\n\n## タバコの値段と消費量\n\n値上げ後、タバコの消費量が5箱減少 \n\n* 「5箱減」は値上げによる効果か\n   * たまたま全国的な禁煙ブームと重なった?\n   * A州の喫煙量はもともと減少傾向だったかも?\n* $\\rightarrow$ **比較対象**が必要\n\n## B州の登場\n\n値上げを行っていないB州におけるタバコ消費量\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](did_files/figure-revealjs/unnamed-chunk-5-1.png){fig-align='center' width=2400}\n:::\n:::\n\n\n## 潜在的結果枠組みから考える\n\n因果推論の枠組みから考えると ...\n\n* 処置変数 ( $T$ ): タバコの値上げ\n* 応答変数 ( $Y$ ): タバコの消費量\n* $i$ : 観測単位 (人/自治体/国/企業など) \n* $t$ : 観測時期\n\n|ID ( $i$ )| $\\quad t \\quad$ | $\\quad T_{it} \\quad$ | $\\quad Y_{it} \\quad$ |\n|:---:|:---:|:---:|:---:|\n|1|1|0|15|\n|1|2|1|10|\n|2|1|0|17|\n|2|2|0|15|\n\n## 潜在的結果枠組みから考える\n\n* $t = 2$ において処置を受けた場合、 $Z = 1$ とする\n* $Z = 1$ であるA州の変化量 ( $\\Delta Y_1$ ): 10 − 15 = −5\n* $Z = 0$ であるB州の変化量 ( $\\Delta Y_2$ ): 15 − 17 = −2\n\n|ID ( $i$ )| $\\quad Z_{i} \\quad$ | $\\quad \\Delta Y_{i} \\quad$ |\n|:---:|:---:|:---:|\n|1|1|-5|\n|2|0|-2|\n\n## 潜在的結果枠組みから考える\n\n* A州が処置を受けなかった場合の**潜在的結果**としてB州のデータを用いる\n* 因果効果: $\\Delta Y(Z = 1) - \\Delta Y(Z = 0)$\n   * (−5) − (−2) = −3\n* タバコ値上げの効果は**-3箱**\n\n| $\\quad \\Delta Y(Z = 1) \\quad$ | $\\quad \\Delta Y(Z = 0) \\quad$ | 差分 |\n|:---:|:---:|:---:|\n|-5|-2|-3|\n\n## 潜在的結果枠組みから考える\n\n数式で表すと\n\n$$\\begin{align}\\Delta = & [\\mathbb{E}(Y_{t+1}(Z = 1)) - \\mathbb{E}(Y_t(Z = 1))] \\\\ & - [\\mathbb{E}(Y_{t+1}(Z = 0)) - \\mathbb{E}(Y_t(Z = 0))]\\end{align}$$\n\n* $t + 1$ 期に処置を受けたら $Z = 1$ 、受けなかったら $Z = 0$\n* $t$ 期は誰も処置を受けていない\n   * 初期状態は一緒で、一部のユニットだけ処置を受ける\n\n## 図なら、もっと分かりやすい\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](did_files/figure-revealjs/unnamed-chunk-6-1.png){fig-align='center' width=2400}\n:::\n:::\n\n\n## 並行トレンドの仮定\n\n**Parallel Trend Assumption**\n\n* 差分の差分法から推定された値が因果効果になるための前提\n   * A州が値上げしなかったらB州**並に**消費量が減っただろうというのが前提\n* 処置を受けたユニットが、もし処置を受けなかった場合、応答変数の変化は統制群の変化と一致する\n   * 処置群の潜在的結果は観測された統制群の動きと並行する\n   * = A州が値上げしなかったら、B州のように2箱減に留まる\n\n## 並行トレンドの仮定:どう確認するか\n\n一般的に2つの方法\n\n1. 他の処置群や統制群を見つけて追加する\n   * 同じく値上げをしていないC州を追加\n2. 3期以上のデータを用意する\n   * $t − 1$ 期のデータも投入する\n   * むろん、 $t − 1$ 期のA州は値上げ前\n3. 上記2つの方法を**組み合わせ**る\n   * 実質的にはこれがメイン\n\n## 統制群を増やしてみた\n\n並行トレンドの仮定が満たされている場合 $\\rightarrow$ どの州を潜在的結果として使ってもOK\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](did_files/figure-revealjs/unnamed-chunk-7-1.png){fig-align='center' width=2400}\n:::\n:::\n\n\n## 統制群を増やしてみた\n\n並行トレンドの仮定が満たされていない場合 $\\rightarrow$ どの州を潜在的結果として用いるか\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](did_files/figure-revealjs/unnamed-chunk-8-1.png){fig-align='center' width=2400}\n:::\n:::\n\n\n## $t−1$のデータを入れてみた\n\n並行トレンドの仮定が満たされている場合\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](did_files/figure-revealjs/unnamed-chunk-9-1.png){fig-align='center' width=2400}\n:::\n:::\n\n\n## $t−1$ のデータを入れてみた\n\n並行トレンドの仮定が満たされていない場合 (1) $\\rightarrow$ 潜在的結果は15、または13\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](did_files/figure-revealjs/unnamed-chunk-10-1.png){fig-align='center' width=2400}\n:::\n:::\n\n\n## $t−1$ のデータを入れてみた\n\n並行トレンドの仮定が満たされていない場合 (2) $\\rightarrow$ 潜在的結果は10、または13\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](did_files/figure-revealjs/unnamed-chunk-11-1.png){fig-align='center' width=2400}\n:::\n:::\n\n\n# 回帰分析を用いた差分の差分法\n\n## 回帰分析による差分の差分法\n\nデータが2期のみ $(t \\in \\{0, 1\\})$ の場合\n\n$$\\hat{Y} = \\beta_0 + \\beta_1 T + \\beta_2 \\mbox{POST} + \\delta T \\cdot \\mbox{Post}$$\n\n* T: 処置群か否か\n* POST: 処置が行われた後か否か\n* Y: 応答変数\n\n|ID|Name|POST|T|Y|\n|---|---|---|---|---|\n|1|A州|0|1|15|\n|2|A州|1|1|10|\n|3|B州|0|0|17|\n|4|B州|1|0|15|\n\n## 回帰分析による差分の差分法\n\nデータが2期のみ $(t \\in \\{0, 1\\})$ の場合\n\n$$\\hat{Y} = \\beta_0 + \\beta_1 T + \\beta_2 \\mbox{POST} + \\delta T \\cdot \\mbox{Post}$$\n\n* 処置群の差分: $\\hat{Y}(T = 1, POST = 1) − \\hat{Y}(T = 1,POST = 0)$\n   * $\\beta_2 + \\delta = \\underbrace{(\\beta_0 + \\beta_1 + \\beta_2 + \\delta)}_{\\hat{Y}(T = 1, POST = 1)} - \\underbrace{(\\beta_0 + \\beta_1)}_{\\hat{Y}(T = 1,POST = 0)}$\n* 統制群の差分: $\\hat{Y}(T = 0, POST = 1) − \\hat{Y}(T = 0,POST = 0)$\n   * $\\beta_2 = \\underbrace{(\\beta_0 + \\beta_2)}_{\\hat{Y}(T = 0, POST = 1)} - \\underbrace{(\\beta_0)}_{\\hat{Y}(T = 0,POST = 0)}$\n* 差分の差分: $\\delta = (\\beta_2 + \\delta) - \\beta_2$\n   * $\\delta$ : **処置効果**\n\n## 一般化された回帰モデル\n\n先ほどのモデルの限界\n\n1. 期間が2期のみ\n   * 実際にはもっとデータがあるはず\n2. 観察されたユニットが2個 (A州とB州)のみ\n   * 実際にはもっとデータがあるはず\n3. 処置変数が {0, 1} のバイナリー変数\n   * 保育所整備の例の場合、処置変数は連続変数( $T = [0, 1]$ )\n\n<br/><br/>\n\n以下では、保育所整備の例で解説\n\n## 一般化された回帰モデル\n\nより一般化されたモデル\n\n$$\\hat{Y}_{pt} = \\beta + \\delta \\mbox{Treat}_{pt} + \\sum_{k = \\mbox{Aomori}}^{\\mbox{Okinawa}}\\gamma_k \\cdot \\mbox{Pref}_{kp} + \\sum_{j = 2005}^{2015} \\psi_j \\cdot \\mbox{Year}_{jt}$$\n\n* $Y_{pt}$ : $t$ 期における $p$ 県の女性就労率 ( $= [0, 1]$ )\n* $\\mbox{Treat}_{pt}$ : $t$ 期における $p$ 県の保育所の整備率 ( $= [0, 1]$ )\n* $\\mbox{Pref}_p$ : $p$ 県か否かを表す各都道府県ダミー変数 ( $\\in \\{0, 1\\}$ )\n* $\\mbox{Year}_t$ : $t$ 期か否かわ表す年ダミー変数 ( $\\in \\{0, 1\\}$ )\n\n<br/>\n\n* 標準誤差は**クラスター標準誤差**を使用\n   * 上記の例だと、都道府県単位でクラスター化\n\n## 一般化された回帰モデル\n\n単回帰分析と差分の差分法推定量の比較\n\n* 保育所の整備率と母の就労率の間に統計的有意な関係が見られない\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script>\n\n      function styleCell_zm6081cawfflc3poktf6(i, j, css_id) {\n          var table = document.getElementById(\"tinytable_zm6081cawfflc3poktf6\");\n          var cell = table.querySelector(`[data-row=\"${i}\"][data-col=\"${j}\"]`);\n          if (cell) {\n              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);\n              cell.classList.add(css_id);\n          } else {\n              console.warn(`Cell at (${i}, ${j}) not found.`);\n          }\n      }\n      function insertSpanRow(i, colspan, content) {\n        var table = document.getElementById('tinytable_zm6081cawfflc3poktf6');\n        // Find the row with data-row attribute matching i\n        var targetRow = table.querySelector(`tr [data-row=\"${i}\"]`).closest('tr');\n        var newRow = table.insertRow(targetRow.rowIndex);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        newCell.setAttribute(\"data-col\", \"0\");\n        newCell.setAttribute(\"data-row\", i - 1);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_zm6081cawfflc3poktf6(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_zm6081cawfflc3poktf6\");\n        const targetCell = table.querySelector(`[data-row=\"${i}\"][data-col=\"${j}\"]`);\n        if (!targetCell) {\n          console.warn(`Cell at (${i}, ${j}) not found.`);\n        }\n\n        // Get all cells that need to be removed\n        const cellsToRemove = [];\n        for (let r = 0; r < rowspan; r++) {\n          for (let c = 0; c < colspan; c++) {\n            if (r === 0 && c === 0) continue; // Skip the target cell\n            const cell = table.querySelector(`[data-row=\"${i + r}\"][data-col=\"${j + c}\"]`);\n            if (cell) {\n              cellsToRemove.push(cell);\n            }\n          }\n        }\n\n        // Remove all cells\n        cellsToRemove.forEach(cell => cell.remove());\n\n        // Set rowspan and colspan of the target cell if it exists\n        if (targetCell) {\n          targetCell.rowSpan = rowspan;\n          targetCell.colSpan = colspan;\n        }\n      }\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '11', j: 1 }, { i: '11', j: 2 },  ], css_id: 'tinytable_css_39rs8uk9solfwxip4nne',}, \n          { positions: [ { i: '2', j: 1 }, { i: '2', j: 2 },  ], css_id: 'tinytable_css_ww798nyzyeejad0eiiqo',}, \n          { positions: [ { i: '1', j: 1 }, { i: '3', j: 2 }, { i: '3', j: 1 }, { i: '5', j: 1 }, { i: '6', j: 1 }, { i: '7', j: 1 }, { i: '4', j: 1 }, { i: '9', j: 1 }, { i: '10', j: 1 }, { i: '7', j: 2 }, { i: '8', j: 1 }, { i: '1', j: 2 }, { i: '6', j: 2 }, { i: '4', j: 2 }, { i: '5', j: 2 }, { i: '10', j: 2 }, { i: '8', j: 2 }, { i: '9', j: 2 },  ], css_id: 'tinytable_css_qh5zsi35jpry58wnt88u',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 },  ], css_id: 'tinytable_css_c9gu4jrxx3v9sdht9ztr',}, \n          { positions: [ { i: '11', j: 0 },  ], css_id: 'tinytable_css_63yqmxyh9y8q9nfhaw5j',}, \n          { positions: [ { i: '2', j: 0 },  ], css_id: 'tinytable_css_9nuaybotqtp2np9ry96i',}, \n          { positions: [ { i: '1', j: 0 }, { i: '6', j: 0 }, { i: '3', j: 0 }, { i: '4', j: 0 }, { i: '5', j: 0 }, { i: '10', j: 0 }, { i: '7', j: 0 }, { i: '8', j: 0 }, { i: '9', j: 0 },  ], css_id: 'tinytable_css_jh5a5hd2dvs2l63h1sl0',}, \n          { positions: [ { i: '0', j: 0 },  ], css_id: 'tinytable_css_fge3149c6xfzonwxo54e',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  styleCell_zm6081cawfflc3poktf6(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <style>\n      /* tinytable css entries after */\n      .table td.tinytable_css_39rs8uk9solfwxip4nne, .table th.tinytable_css_39rs8uk9solfwxip4nne { text-align: center; border-bottom: solid #d3d8dc 0.1em; }\n      .table td.tinytable_css_ww798nyzyeejad0eiiqo, .table th.tinytable_css_ww798nyzyeejad0eiiqo { text-align: center; border-bottom: solid black 0.05em; }\n      .table td.tinytable_css_qh5zsi35jpry58wnt88u, .table th.tinytable_css_qh5zsi35jpry58wnt88u { text-align: center; }\n      .table td.tinytable_css_c9gu4jrxx3v9sdht9ztr, .table th.tinytable_css_c9gu4jrxx3v9sdht9ztr { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }\n      .table td.tinytable_css_63yqmxyh9y8q9nfhaw5j, .table th.tinytable_css_63yqmxyh9y8q9nfhaw5j { text-align: left; border-bottom: solid #d3d8dc 0.1em; }\n      .table td.tinytable_css_9nuaybotqtp2np9ry96i, .table th.tinytable_css_9nuaybotqtp2np9ry96i { text-align: left; border-bottom: solid black 0.05em; }\n      .table td.tinytable_css_jh5a5hd2dvs2l63h1sl0, .table th.tinytable_css_jh5a5hd2dvs2l63h1sl0 { text-align: left; }\n      .table td.tinytable_css_fge3149c6xfzonwxo54e, .table th.tinytable_css_fge3149c6xfzonwxo54e { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }\n    </style>\n    <div class=\"container\">\n      <table class=\"table table-borderless\" id=\"tinytable_zm6081cawfflc3poktf6\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n        \n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"0\"> </th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">Model 1</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">Model 2</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"0\">保育所の整備率</td>\n                  <td data-row=\"1\" data-col=\"1\">0.358</td>\n                  <td data-row=\"1\" data-col=\"2\">-0.003</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"0\"></td>\n                  <td data-row=\"2\" data-col=\"1\">(0.022)</td>\n                  <td data-row=\"2\" data-col=\"2\">(0.030)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"0\">Num.Obs.</td>\n                  <td data-row=\"3\" data-col=\"1\">188</td>\n                  <td data-row=\"3\" data-col=\"2\">188</td>\n                </tr>\n                <tr>\n                  <td data-row=\"4\" data-col=\"0\">R2</td>\n                  <td data-row=\"4\" data-col=\"1\">0.510</td>\n                  <td data-row=\"4\" data-col=\"2\">0.987</td>\n                </tr>\n                <tr>\n                  <td data-row=\"5\" data-col=\"0\">R2 Adj.</td>\n                  <td data-row=\"5\" data-col=\"1\">0.508</td>\n                  <td data-row=\"5\" data-col=\"2\">0.982</td>\n                </tr>\n                <tr>\n                  <td data-row=\"6\" data-col=\"0\">AIC</td>\n                  <td data-row=\"6\" data-col=\"1\">-640.9</td>\n                  <td data-row=\"6\" data-col=\"2\">-1222.7</td>\n                </tr>\n                <tr>\n                  <td data-row=\"7\" data-col=\"0\">BIC</td>\n                  <td data-row=\"7\" data-col=\"1\">-631.2</td>\n                  <td data-row=\"7\" data-col=\"2\">-1054.4</td>\n                </tr>\n                <tr>\n                  <td data-row=\"8\" data-col=\"0\">RMSE</td>\n                  <td data-row=\"8\" data-col=\"1\">0.04</td>\n                  <td data-row=\"8\" data-col=\"2\">0.01</td>\n                </tr>\n                <tr>\n                  <td data-row=\"9\" data-col=\"0\">Std.Errors</td>\n                  <td data-row=\"9\" data-col=\"1\"></td>\n                  <td data-row=\"9\" data-col=\"2\">by: Pref_J</td>\n                </tr>\n                <tr>\n                  <td data-row=\"10\" data-col=\"0\">都道府県ダミー</td>\n                  <td data-row=\"10\" data-col=\"1\">X</td>\n                  <td data-row=\"10\" data-col=\"2\">O</td>\n                </tr>\n                <tr>\n                  <td data-row=\"11\" data-col=\"0\">年ダミー</td>\n                  <td data-row=\"11\" data-col=\"1\">X</td>\n                  <td data-row=\"11\" data-col=\"2\">O</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n## 平行トレンドは?\n\n回帰モデルでも平行トレンドの仮定は必要\n\n* 処置変数がバイナリー変数なら平行トレンドの仮定が満たされているか否かを可視化可能\n   * 例) 電子投票の導入と投票率 (京都市)\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](did_files/figure-revealjs/unnamed-chunk-13-1.png){fig-align='center' width=2400}\n:::\n:::\n\n\n## 平行トレンドは?\n\n回帰モデルでも平行トレンドの仮定は必要\n\n* 処置変数が連続変数の場合、平行トレンドの仮定を視覚的に確認することは困難\n* 都道府県ダミーと年ダミー変数を投入したということは...\n   * 都道府県ごとに**切片のみ**が異なる\n   * 各年の就労率の変動は全都道府県で共通\n   * = 平行トレンド\n\n<br/>\n\n* 都道府県ごとに切片だけでなく、**異なる傾き**まで許容するモデル \n   1. **トレンド変数**の投入\n      * 簡単だが、都道府県ごとのトレンド効果が線形という仮定 \n   2. **都道府県レベルの共変量**の投入\n      * 柔軟だが、適切な共変量の発見が重要\n\n## トレンド変数\n\n処置を受けていない場合も、傾きが都道府県ごとに異なる場合\n\n* 都道府県ダミーとトレンド変数 (連続変数としての年など) の**交差項**を投入\n* 仮定:都道府県間は平行でなくても、**都道府県のトレンドは線形**\n\n<br/>\n\n$$\\hat{Y}_{pt} = \\beta + \\delta \\mbox{Treat}_{pt} + \\sum_{k = \\mbox{Aomori}}^{\\mbox{Okinawa}}\\gamma_k \\cdot \\mbox{Pref}_{kp} + \\sum_{j = 2005}^{2015} \\psi_j \\cdot \\mbox{Year}_{jt} + \\sum_{k = \\mbox{Aomori}}^{\\mbox{Okinawa}}\\theta_k (\\mbox{Pref}_{kp} \\cdot t)$$\n\n* $t$ : トレンド変数 (2000 年: t = 1、2005 年: t = 2、...)\n   * $\\mbox{Year}_t$ はダミー変数であるが、トレンド変数は連続変数\n\n## トレンド変数\n\n結果の比較\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script>\n\n      function styleCell_6as3xrbioqm84sf57pf5(i, j, css_id) {\n          var table = document.getElementById(\"tinytable_6as3xrbioqm84sf57pf5\");\n          var cell = table.querySelector(`[data-row=\"${i}\"][data-col=\"${j}\"]`);\n          if (cell) {\n              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);\n              cell.classList.add(css_id);\n          } else {\n              console.warn(`Cell at (${i}, ${j}) not found.`);\n          }\n      }\n      function insertSpanRow(i, colspan, content) {\n        var table = document.getElementById('tinytable_6as3xrbioqm84sf57pf5');\n        // Find the row with data-row attribute matching i\n        var targetRow = table.querySelector(`tr [data-row=\"${i}\"]`).closest('tr');\n        var newRow = table.insertRow(targetRow.rowIndex);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        newCell.setAttribute(\"data-col\", \"0\");\n        newCell.setAttribute(\"data-row\", i - 1);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_6as3xrbioqm84sf57pf5(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_6as3xrbioqm84sf57pf5\");\n        const targetCell = table.querySelector(`[data-row=\"${i}\"][data-col=\"${j}\"]`);\n        if (!targetCell) {\n          console.warn(`Cell at (${i}, ${j}) not found.`);\n        }\n\n        // Get all cells that need to be removed\n        const cellsToRemove = [];\n        for (let r = 0; r < rowspan; r++) {\n          for (let c = 0; c < colspan; c++) {\n            if (r === 0 && c === 0) continue; // Skip the target cell\n            const cell = table.querySelector(`[data-row=\"${i + r}\"][data-col=\"${j + c}\"]`);\n            if (cell) {\n              cellsToRemove.push(cell);\n            }\n          }\n        }\n\n        // Remove all cells\n        cellsToRemove.forEach(cell => cell.remove());\n\n        // Set rowspan and colspan of the target cell if it exists\n        if (targetCell) {\n          targetCell.rowSpan = rowspan;\n          targetCell.colSpan = colspan;\n        }\n      }\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '12', j: 1 }, { i: '12', j: 2 }, { i: '12', j: 3 },  ], css_id: 'tinytable_css_l4zvuvkxvsi0rbuxboxv',}, \n          { positions: [ { i: '2', j: 3 }, { i: '2', j: 1 }, { i: '2', j: 2 },  ], css_id: 'tinytable_css_heta8r5gbet6zrjyk9xd',}, \n          { positions: [ { i: '3', j: 1 }, { i: '4', j: 1 }, { i: '1', j: 1 }, { i: '6', j: 1 }, { i: '7', j: 1 }, { i: '8', j: 1 }, { i: '5', j: 1 }, { i: '10', j: 1 }, { i: '11', j: 1 }, { i: '3', j: 2 }, { i: '9', j: 1 }, { i: '1', j: 2 }, { i: '6', j: 2 }, { i: '7', j: 2 }, { i: '4', j: 2 }, { i: '5', j: 2 }, { i: '10', j: 2 }, { i: '11', j: 2 }, { i: '8', j: 2 }, { i: '9', j: 2 }, { i: '1', j: 3 }, { i: '6', j: 3 }, { i: '3', j: 3 }, { i: '4', j: 3 }, { i: '5', j: 3 }, { i: '10', j: 3 }, { i: '7', j: 3 }, { i: '8', j: 3 }, { i: '9', j: 3 }, { i: '11', j: 3 },  ], css_id: 'tinytable_css_53e5c4bi3os5y5libuj1',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 },  ], css_id: 'tinytable_css_kd9vvju6maso1x6k77js',}, \n          { positions: [ { i: '12', j: 0 },  ], css_id: 'tinytable_css_350rwgnngdo3e6ag1uty',}, \n          { positions: [ { i: '2', j: 0 },  ], css_id: 'tinytable_css_qiqe9r2gxw3euwjh6yig',}, \n          { positions: [ { i: '1', j: 0 }, { i: '6', j: 0 }, { i: '3', j: 0 }, { i: '4', j: 0 }, { i: '5', j: 0 }, { i: '10', j: 0 }, { i: '7', j: 0 }, { i: '8', j: 0 }, { i: '9', j: 0 }, { i: '11', j: 0 },  ], css_id: 'tinytable_css_6qtf7re9q8c53mreghle',}, \n          { positions: [ { i: '0', j: 0 },  ], css_id: 'tinytable_css_u2y6lbgaskqjohqb61sv',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  styleCell_6as3xrbioqm84sf57pf5(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <style>\n      /* tinytable css entries after */\n      .table td.tinytable_css_l4zvuvkxvsi0rbuxboxv, .table th.tinytable_css_l4zvuvkxvsi0rbuxboxv { text-align: center; border-bottom: solid #d3d8dc 0.1em; }\n      .table td.tinytable_css_heta8r5gbet6zrjyk9xd, .table th.tinytable_css_heta8r5gbet6zrjyk9xd { text-align: center; border-bottom: solid black 0.05em; }\n      .table td.tinytable_css_53e5c4bi3os5y5libuj1, .table th.tinytable_css_53e5c4bi3os5y5libuj1 { text-align: center; }\n      .table td.tinytable_css_kd9vvju6maso1x6k77js, .table th.tinytable_css_kd9vvju6maso1x6k77js { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }\n      .table td.tinytable_css_350rwgnngdo3e6ag1uty, .table th.tinytable_css_350rwgnngdo3e6ag1uty { text-align: left; border-bottom: solid #d3d8dc 0.1em; }\n      .table td.tinytable_css_qiqe9r2gxw3euwjh6yig, .table th.tinytable_css_qiqe9r2gxw3euwjh6yig { text-align: left; border-bottom: solid black 0.05em; }\n      .table td.tinytable_css_6qtf7re9q8c53mreghle, .table th.tinytable_css_6qtf7re9q8c53mreghle { text-align: left; }\n      .table td.tinytable_css_u2y6lbgaskqjohqb61sv, .table th.tinytable_css_u2y6lbgaskqjohqb61sv { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }\n    </style>\n    <div class=\"container\">\n      <table class=\"table table-borderless\" id=\"tinytable_6as3xrbioqm84sf57pf5\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n        \n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"0\"> </th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">Model 1</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">Model 2</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"3\">Model 3</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"0\">保育所の整備率</td>\n                  <td data-row=\"1\" data-col=\"1\">0.358</td>\n                  <td data-row=\"1\" data-col=\"2\">-0.003</td>\n                  <td data-row=\"1\" data-col=\"3\">-0.009</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"0\"></td>\n                  <td data-row=\"2\" data-col=\"1\">(0.022)</td>\n                  <td data-row=\"2\" data-col=\"2\">(0.030)</td>\n                  <td data-row=\"2\" data-col=\"3\">(0.028)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"0\">Num.Obs.</td>\n                  <td data-row=\"3\" data-col=\"1\">188</td>\n                  <td data-row=\"3\" data-col=\"2\">188</td>\n                  <td data-row=\"3\" data-col=\"3\">188</td>\n                </tr>\n                <tr>\n                  <td data-row=\"4\" data-col=\"0\">R2</td>\n                  <td data-row=\"4\" data-col=\"1\">0.510</td>\n                  <td data-row=\"4\" data-col=\"2\">0.987</td>\n                  <td data-row=\"4\" data-col=\"3\">0.997</td>\n                </tr>\n                <tr>\n                  <td data-row=\"5\" data-col=\"0\">R2 Adj.</td>\n                  <td data-row=\"5\" data-col=\"1\">0.508</td>\n                  <td data-row=\"5\" data-col=\"2\">0.982</td>\n                  <td data-row=\"5\" data-col=\"3\">0.995</td>\n                </tr>\n                <tr>\n                  <td data-row=\"6\" data-col=\"0\">AIC</td>\n                  <td data-row=\"6\" data-col=\"1\">-640.9</td>\n                  <td data-row=\"6\" data-col=\"2\">-1222.7</td>\n                  <td data-row=\"6\" data-col=\"3\">-1439.2</td>\n                </tr>\n                <tr>\n                  <td data-row=\"7\" data-col=\"0\">BIC</td>\n                  <td data-row=\"7\" data-col=\"1\">-631.2</td>\n                  <td data-row=\"7\" data-col=\"2\">-1054.4</td>\n                  <td data-row=\"7\" data-col=\"3\">-1122.0</td>\n                </tr>\n                <tr>\n                  <td data-row=\"8\" data-col=\"0\">RMSE</td>\n                  <td data-row=\"8\" data-col=\"1\">0.04</td>\n                  <td data-row=\"8\" data-col=\"2\">0.01</td>\n                  <td data-row=\"8\" data-col=\"3\">0.00</td>\n                </tr>\n                <tr>\n                  <td data-row=\"9\" data-col=\"0\">Std.Errors</td>\n                  <td data-row=\"9\" data-col=\"1\"></td>\n                  <td data-row=\"9\" data-col=\"2\">by: Pref_J</td>\n                  <td data-row=\"9\" data-col=\"3\">by: Pref_J</td>\n                </tr>\n                <tr>\n                  <td data-row=\"10\" data-col=\"0\">都道府県ダミー</td>\n                  <td data-row=\"10\" data-col=\"1\">X</td>\n                  <td data-row=\"10\" data-col=\"2\">O</td>\n                  <td data-row=\"10\" data-col=\"3\">O</td>\n                </tr>\n                <tr>\n                  <td data-row=\"11\" data-col=\"0\">年ダミー</td>\n                  <td data-row=\"11\" data-col=\"1\">X</td>\n                  <td data-row=\"11\" data-col=\"2\">O</td>\n                  <td data-row=\"11\" data-col=\"3\">O</td>\n                </tr>\n                <tr>\n                  <td data-row=\"12\" data-col=\"0\">トレンド変数</td>\n                  <td data-row=\"12\" data-col=\"1\">X</td>\n                  <td data-row=\"12\" data-col=\"2\">X</td>\n                  <td data-row=\"12\" data-col=\"3\">O</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n## 共変量の投入\n\n* 既存のモデルは年度ごとに就労率の伸びは変化するものの、その変化の度合いは全都道府県において共通していると仮定\n* 景気が良いと母の就労率が上がる\n   * しかし、都道府県ごとに景気変動の度合いは異なることが一般的\n   * 都道府県の失業率など、各都道府県の景気状況を表す変数を投入\n\n$$\\hat{Y}_{pt} = \\beta + \\delta \\mbox{Treat}_{pt} + \\sum_{k = \\mbox{Aomori}}^{\\mbox{Okinawa}}\\gamma_k \\cdot \\mbox{Pref}_{kp} + \\sum_{j = 2005}^{2015} \\psi_j \\cdot \\mbox{Year}_{jt} + \\theta \\mbox{Unemp}_{pt}$$\n\n* $\\mbox{Unemp}_{pt}$ : $t$ 期における $p$ 県の完全失業率\n* トレンド変数は、「同じ都道府県なら、傾きは変わらない」と仮定しているが、共変量を統制する場合、このような仮定は必要としない\n   * 適切な共変量の選択はトレンド変数よりも有効\n   * 共変量は母の就労率、保育所の整備率、**両方**と関係のあるもの\n\n## 共変量の投入\n\n結果の比較\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script>\n\n      function styleCell_fdwodi9czwn60956s2o0(i, j, css_id) {\n          var table = document.getElementById(\"tinytable_fdwodi9czwn60956s2o0\");\n          var cell = table.querySelector(`[data-row=\"${i}\"][data-col=\"${j}\"]`);\n          if (cell) {\n              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);\n              cell.classList.add(css_id);\n          } else {\n              console.warn(`Cell at (${i}, ${j}) not found.`);\n          }\n      }\n      function insertSpanRow(i, colspan, content) {\n        var table = document.getElementById('tinytable_fdwodi9czwn60956s2o0');\n        // Find the row with data-row attribute matching i\n        var targetRow = table.querySelector(`tr [data-row=\"${i}\"]`).closest('tr');\n        var newRow = table.insertRow(targetRow.rowIndex);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        newCell.setAttribute(\"data-col\", \"0\");\n        newCell.setAttribute(\"data-row\", i - 1);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_fdwodi9czwn60956s2o0(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_fdwodi9czwn60956s2o0\");\n        const targetCell = table.querySelector(`[data-row=\"${i}\"][data-col=\"${j}\"]`);\n        if (!targetCell) {\n          console.warn(`Cell at (${i}, ${j}) not found.`);\n        }\n\n        // Get all cells that need to be removed\n        const cellsToRemove = [];\n        for (let r = 0; r < rowspan; r++) {\n          for (let c = 0; c < colspan; c++) {\n            if (r === 0 && c === 0) continue; // Skip the target cell\n            const cell = table.querySelector(`[data-row=\"${i + r}\"][data-col=\"${j + c}\"]`);\n            if (cell) {\n              cellsToRemove.push(cell);\n            }\n          }\n        }\n\n        // Remove all cells\n        cellsToRemove.forEach(cell => cell.remove());\n\n        // Set rowspan and colspan of the target cell if it exists\n        if (targetCell) {\n          targetCell.rowSpan = rowspan;\n          targetCell.colSpan = colspan;\n        }\n      }\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '13', j: 1 }, { i: '13', j: 2 }, { i: '13', j: 3 }, { i: '13', j: 4 }, { i: '13', j: 5 },  ], css_id: 'tinytable_css_5xl2qwv3ilpqkbs3jd4d',}, \n          { positions: [ { i: '2', j: 1 }, { i: '2', j: 4 }, { i: '2', j: 5 }, { i: '2', j: 2 }, { i: '2', j: 3 },  ], css_id: 'tinytable_css_fk8timixet5uje57yj57',}, \n          { positions: [ { i: '5', j: 1 }, { i: '6', j: 1 }, { i: '7', j: 1 }, { i: '8', j: 1 }, { i: '9', j: 1 }, { i: '10', j: 1 }, { i: '11', j: 1 }, { i: '12', j: 1 }, { i: '12', j: 2 }, { i: '1', j: 1 }, { i: '1', j: 2 }, { i: '3', j: 1 }, { i: '4', j: 1 }, { i: '4', j: 2 }, { i: '5', j: 2 }, { i: '6', j: 2 }, { i: '7', j: 2 }, { i: '8', j: 2 }, { i: '9', j: 2 }, { i: '10', j: 2 }, { i: '11', j: 2 }, { i: '11', j: 3 }, { i: '12', j: 3 }, { i: '12', j: 4 }, { i: '1', j: 3 }, { i: '3', j: 2 }, { i: '3', j: 3 }, { i: '4', j: 3 }, { i: '5', j: 3 }, { i: '6', j: 3 }, { i: '7', j: 3 }, { i: '8', j: 3 }, { i: '9', j: 3 }, { i: '10', j: 3 }, { i: '10', j: 4 }, { i: '11', j: 4 }, { i: '11', j: 5 }, { i: '12', j: 5 }, { i: '1', j: 4 }, { i: '1', j: 5 }, { i: '3', j: 4 }, { i: '4', j: 4 }, { i: '5', j: 4 }, { i: '6', j: 4 }, { i: '7', j: 4 }, { i: '8', j: 4 }, { i: '9', j: 4 }, { i: '9', j: 5 }, { i: '10', j: 5 }, { i: '6', j: 5 }, { i: '3', j: 5 }, { i: '4', j: 5 }, { i: '5', j: 5 }, { i: '7', j: 5 }, { i: '8', j: 5 },  ], css_id: 'tinytable_css_equq07poxx1hu41v8tef',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 },  ], css_id: 'tinytable_css_065zbeohoygqin4vyll4',}, \n          { positions: [ { i: '13', j: 0 },  ], css_id: 'tinytable_css_p3fssqyv3fbc57dldkoo',}, \n          { positions: [ { i: '2', j: 0 },  ], css_id: 'tinytable_css_e1fn126ic2jifxm8vw4u',}, \n          { positions: [ { i: '1', j: 0 }, { i: '6', j: 0 }, { i: '3', j: 0 }, { i: '4', j: 0 }, { i: '5', j: 0 }, { i: '10', j: 0 }, { i: '7', j: 0 }, { i: '8', j: 0 }, { i: '9', j: 0 }, { i: '11', j: 0 }, { i: '12', j: 0 },  ], css_id: 'tinytable_css_23c8deurudahzo6i574m',}, \n          { positions: [ { i: '0', j: 0 },  ], css_id: 'tinytable_css_gy5s4ak2p6a353kne2ob',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  styleCell_fdwodi9czwn60956s2o0(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <style>\n      /* tinytable css entries after */\n      .table td.tinytable_css_5xl2qwv3ilpqkbs3jd4d, .table th.tinytable_css_5xl2qwv3ilpqkbs3jd4d { text-align: center; border-bottom: solid #d3d8dc 0.1em; }\n      .table td.tinytable_css_fk8timixet5uje57yj57, .table th.tinytable_css_fk8timixet5uje57yj57 { text-align: center; border-bottom: solid black 0.05em; }\n      .table td.tinytable_css_equq07poxx1hu41v8tef, .table th.tinytable_css_equq07poxx1hu41v8tef { text-align: center; }\n      .table td.tinytable_css_065zbeohoygqin4vyll4, .table th.tinytable_css_065zbeohoygqin4vyll4 { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }\n      .table td.tinytable_css_p3fssqyv3fbc57dldkoo, .table th.tinytable_css_p3fssqyv3fbc57dldkoo { text-align: left; border-bottom: solid #d3d8dc 0.1em; }\n      .table td.tinytable_css_e1fn126ic2jifxm8vw4u, .table th.tinytable_css_e1fn126ic2jifxm8vw4u { text-align: left; border-bottom: solid black 0.05em; }\n      .table td.tinytable_css_23c8deurudahzo6i574m, .table th.tinytable_css_23c8deurudahzo6i574m { text-align: left; }\n      .table td.tinytable_css_gy5s4ak2p6a353kne2ob, .table th.tinytable_css_gy5s4ak2p6a353kne2ob { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }\n    </style>\n    <div class=\"container\">\n      <table class=\"table table-borderless\" id=\"tinytable_fdwodi9czwn60956s2o0\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n        \n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"0\"> </th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">Model 1</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">Model 2</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"3\">Model 3</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"4\">Model 4</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"5\">Model 5</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"0\">保育所の整備率</td>\n                  <td data-row=\"1\" data-col=\"1\">0.358</td>\n                  <td data-row=\"1\" data-col=\"2\">-0.003</td>\n                  <td data-row=\"1\" data-col=\"3\">-0.009</td>\n                  <td data-row=\"1\" data-col=\"4\">0.002</td>\n                  <td data-row=\"1\" data-col=\"5\">0.003</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"0\"></td>\n                  <td data-row=\"2\" data-col=\"1\">(0.022)</td>\n                  <td data-row=\"2\" data-col=\"2\">(0.030)</td>\n                  <td data-row=\"2\" data-col=\"3\">(0.028)</td>\n                  <td data-row=\"2\" data-col=\"4\">(0.030)</td>\n                  <td data-row=\"2\" data-col=\"5\">(0.024)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"0\">Num.Obs.</td>\n                  <td data-row=\"3\" data-col=\"1\">188</td>\n                  <td data-row=\"3\" data-col=\"2\">188</td>\n                  <td data-row=\"3\" data-col=\"3\">188</td>\n                  <td data-row=\"3\" data-col=\"4\">188</td>\n                  <td data-row=\"3\" data-col=\"5\">188</td>\n                </tr>\n                <tr>\n                  <td data-row=\"4\" data-col=\"0\">R2</td>\n                  <td data-row=\"4\" data-col=\"1\">0.510</td>\n                  <td data-row=\"4\" data-col=\"2\">0.987</td>\n                  <td data-row=\"4\" data-col=\"3\">0.997</td>\n                  <td data-row=\"4\" data-col=\"4\">0.987</td>\n                  <td data-row=\"4\" data-col=\"5\">0.998</td>\n                </tr>\n                <tr>\n                  <td data-row=\"5\" data-col=\"0\">R2 Adj.</td>\n                  <td data-row=\"5\" data-col=\"1\">0.508</td>\n                  <td data-row=\"5\" data-col=\"2\">0.982</td>\n                  <td data-row=\"5\" data-col=\"3\">0.995</td>\n                  <td data-row=\"5\" data-col=\"4\">0.982</td>\n                  <td data-row=\"5\" data-col=\"5\">0.995</td>\n                </tr>\n                <tr>\n                  <td data-row=\"6\" data-col=\"0\">AIC</td>\n                  <td data-row=\"6\" data-col=\"1\">-640.9</td>\n                  <td data-row=\"6\" data-col=\"2\">-1222.7</td>\n                  <td data-row=\"6\" data-col=\"3\">-1439.2</td>\n                  <td data-row=\"6\" data-col=\"4\">-1322.0</td>\n                  <td data-row=\"6\" data-col=\"5\">-1543.8</td>\n                </tr>\n                <tr>\n                  <td data-row=\"7\" data-col=\"0\">BIC</td>\n                  <td data-row=\"7\" data-col=\"1\">-631.2</td>\n                  <td data-row=\"7\" data-col=\"2\">-1054.4</td>\n                  <td data-row=\"7\" data-col=\"3\">-1122.0</td>\n                  <td data-row=\"7\" data-col=\"4\">-1312.3</td>\n                  <td data-row=\"7\" data-col=\"5\">-1385.2</td>\n                </tr>\n                <tr>\n                  <td data-row=\"8\" data-col=\"0\">RMSE</td>\n                  <td data-row=\"8\" data-col=\"1\">0.04</td>\n                  <td data-row=\"8\" data-col=\"2\">0.01</td>\n                  <td data-row=\"8\" data-col=\"3\">0.00</td>\n                  <td data-row=\"8\" data-col=\"4\">0.01</td>\n                  <td data-row=\"8\" data-col=\"5\">0.00</td>\n                </tr>\n                <tr>\n                  <td data-row=\"9\" data-col=\"0\">Std.Errors</td>\n                  <td data-row=\"9\" data-col=\"1\"></td>\n                  <td data-row=\"9\" data-col=\"2\">by: Pref_J</td>\n                  <td data-row=\"9\" data-col=\"3\">by: Pref_J</td>\n                  <td data-row=\"9\" data-col=\"4\">by: Pref_J</td>\n                  <td data-row=\"9\" data-col=\"5\">by: Pref_J</td>\n                </tr>\n                <tr>\n                  <td data-row=\"10\" data-col=\"0\">都道府県ダミー</td>\n                  <td data-row=\"10\" data-col=\"1\">X</td>\n                  <td data-row=\"10\" data-col=\"2\">O</td>\n                  <td data-row=\"10\" data-col=\"3\">O</td>\n                  <td data-row=\"10\" data-col=\"4\">O</td>\n                  <td data-row=\"10\" data-col=\"5\">O</td>\n                </tr>\n                <tr>\n                  <td data-row=\"11\" data-col=\"0\">年ダミー</td>\n                  <td data-row=\"11\" data-col=\"1\">X</td>\n                  <td data-row=\"11\" data-col=\"2\">O</td>\n                  <td data-row=\"11\" data-col=\"3\">O</td>\n                  <td data-row=\"11\" data-col=\"4\">O</td>\n                  <td data-row=\"11\" data-col=\"5\">O</td>\n                </tr>\n                <tr>\n                  <td data-row=\"12\" data-col=\"0\">トレンド変数</td>\n                  <td data-row=\"12\" data-col=\"1\">X</td>\n                  <td data-row=\"12\" data-col=\"2\">X</td>\n                  <td data-row=\"12\" data-col=\"3\">O</td>\n                  <td data-row=\"12\" data-col=\"4\">X</td>\n                  <td data-row=\"12\" data-col=\"5\">O</td>\n                </tr>\n                <tr>\n                  <td data-row=\"13\" data-col=\"0\">共変量</td>\n                  <td data-row=\"13\" data-col=\"1\">X</td>\n                  <td data-row=\"13\" data-col=\"2\">X</td>\n                  <td data-row=\"13\" data-col=\"3\">X</td>\n                  <td data-row=\"13\" data-col=\"4\">O</td>\n                  <td data-row=\"13\" data-col=\"5\">O</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n## 結果の比較\n\n処置効果の点推定値と95%信頼区間\n\n* 保育所の整備が女性の就労率を上げるとは言えない\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](did_files/figure-revealjs/unnamed-chunk-16-1.png){fig-align='center' width=2400}\n:::\n:::\n\n\n## 並行トレンドのチェック\n\n並行トレンドをどう確認するか\n\n1. より多くの時点のデータを収集し、プロット\n   * 検定 (test) ではなく、診断 (diagnostics)\n2. プラセボ・テスト\n   * **方法1：** $t=3$が処置を受けた時期なら、$t = 3$をデータから除外し、$t = 2$を処置とコーディングしてDIDを実行（3期以上のデータが必要）\n   * **方法2：** 統制群の一部を処置群とコーディング&処置群をデータから除外してDIDを実行（3つ以上の対象が必要）\n   * 検定の結果、DID推定量が統計的有意であったら平行トレンドが満たされていないと判断する（並行トレンドの仮定が満たされていることは示せない）\n\n# Diff-in-Diffの応用\n\n## Synthetic Control Method: 概要\n\n**並行トレンドを満たすケースを仮想的に作り上げる**手法\n\n* 処置群以外のケースを重み付け&合成\n   * 合成に使われるケース: **ドナー**（Donor）\n* 一つ一つの観察対象が処置群と並行トレンドを満たさない場合でも使用可能\n   * 精度を上げるには共変量が必要\n   * プラセボ・テストも必要\n   * 統制群、処置前のサンプルサイズは大きいほど良い（DIDと同じ）\n* {Synth}、または{gsynth}パッケージで実装可能\n   * ベイジアン・アプローチだと{bpCausal}\n\n<br/>\n\n* 参考) Abadie, Alberto, Alexis Diamond, and Jens Hainmueller. 2015. \"[Comparative Politics and the Synthetic Control Method,](https://onlinelibrary.wiley.com/doi/full/10.1111/ajps.12116)\" *American Journal of Political Science,* 59 (2): 495–510.\n\n## SCMの例: 事例\n\nドイツ統一 (1990年) がもたらした経済効果は?\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](did_files/figure-revealjs/unnamed-chunk-17-1.png){fig-align='center' width=2400}\n:::\n:::\n\n\n## SCMの例: 事例\n\nドイツ統一 (1990年) がもたらした経済効果は?\n\n* 長期間の場合、並行トレンドが確認されない\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](did_files/figure-revealjs/unnamed-chunk-18-1.png){fig-align='center' width=2400}\n:::\n:::\n\n\n## SCMの例: 事例\n\nOECDに加盟している16カ国のトレンドから架空の西ドイツ(潜在的結果)を生成\n\n* どうしても使えなさそうな国は合成に使わない or 重み $\\downarrow$\n* 西ドイツのトレンドと類似している国は重み $\\uparrow$\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](did_files/figure-revealjs/unnamed-chunk-19-1.png){fig-align='center' width=2400}\n:::\n:::\n\n\n## SCMの例: 結果\n\n5カ国のトレンドを合成し、架空の西ドイツのトレンドを生成\n\n* 合成に使用されない国の重みは0\n\n|ドナー国|重み|ドナー国|重み|\n|:-------|---:|:-------|---:|\n|**アメリカ**|**0.216**|ノルウェー|0.000|\n|イギリス|0.000|**スイス**|**0.113**|\n|**オーストリア**|**0.402**|**日本**|**0.161**|\n|ベルギー|0.000|ギリシャ|0.000|\n|デンマーク|0.000|ポルトガル|0.000|\n|フランス|0.000|スペイン|0.000|\n|イタリア|0.000|オーストラリア|0.000|\n|**オランダ**|**0.107**|ニュージーランド|0.000|\n\n## SCMの例: 結果\n\nバランスチェックの例\n\n* 西ドイツと架空の西ドイツ間の共変量比較\n* 実際の西ドイツと非常に似た架空のケースが生成\n\n||西ドイツ|架空の西ドイツ|ドナー国|\n|:---|---:|---:|---:|\n|一人当たりGDP|15808.9|15801.4|13669.4|\n|貿易依存度|56.8|57.3|59.8|\n|インフレーション率|2.6|3.4|7.6|\n|付加価値産業|34.5|34.4|33.8|\n|教育水準|55.5|54.9|38.7|\n|国内総投資|27.0|27.0|25.9|\n\n## SCMの例: 結果\n\n* 左側の図: 西ドイツと架空の西ドイツのGDPトレンド\n* 右側の図: トレンドの差分\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](did_files/figure-revealjs/unnamed-chunk-21-1.png){fig-align='center' width=3000}\n:::\n:::\n\n\n# 実習\n\n## 実習用データ\n\nスライドで使ったデータ\n\n* `did_data1.csv`: 保育所の整備と母の就労率\n* `did_data2.csv`: 電子投票の導入と投票率\n* OECD諸国の経済指標データ: <https://doi.org/10.7910/DVN/24714>\n\n実習用データ\n\n* `did_data4.csv`: 学校内銃撃事件と政治参加\n   * Laura García-Montoya, Ana Arjona, and Matthew Lacombe. 2022. \"[Violence and Voting in the United States: How School Shootings Affect Elections](https://www.cambridge.org/core/journals/american-political-science-review/article/violence-and-voting-in-the-united-states-how-school-shootings-affect-elections/48D77237C8B89BCA106ED7BAC20CE2E4),\" *American Political Science Review,* 116 (3): 807-826.\n* `did_data5.csv`: 参院選投票率（都道府県）\n\n## データの説明\n\nGarcía-Montoya, Arjona, and Lacombe (2022)のFigure 3&4の一部を再現\n\n* 銃撃事件は前回の選挙から今回の選挙の間に発生した場合1とし、今後続く。\n* 銃撃事件の深刻さは死者の有無で判定\n\n| 変数名             | 説明 |\n| :----------------- | :--- |\n|`county`            | カウンティー（郡）のID |\n|`state`             | 州ID |\n|`year`              | 年 |\n|`shooting`          | 学校内銃撃事件の発生 |\n|`fatal_shooting`    | 深刻な学校内銃撃事件の発生 |\n|`non_fatal_shooting`| 軽微な学校内銃撃事件の発生 |\n|`turnout`           | 大統領選挙の投票率 |\n|`demvote`           | 民主党候補者の得票率 |\n|`population`        | 人口（カウンティー） |\n|`non_white`         | 非白人の割合（カウンティー） |\n|`change_unem_rate`  | 失業率の変化（カウンティー） |\n\n## 実習内容\n\n1. {estimatr}パッケージ（`lm_robust()`関数）の使い方\n1. 推定結果の可視化\n1. Synthetic Control Methodの実装 ({gsynth})\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}